<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="ansible-role-suseconnect"
 role="concept" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>&suseconnect;</title>
    <meta name="maintainer" content="amrita.sakthivel@suse.com" its:translate="no"/>
    <abstract>
      <para>
     This &ansible; role is used to manage SUSE Linux system registrations with &scc; or a &smt; server.      </para>
    </abstract>
  </info>
  <para>It automates the process of registering and deregistering systems, as well as managing additional products and modules on a SUSE system.
    </para>
    <para>This role includes: </para>
    <itemizedlist>
      <listitem>
        <para>
      Registration of a SUSE system to &scc; or &smt;.
        </para>
      </listitem>
      <listitem>
        <para>
         Activation or removal of specific add-on products or modules.
        </para>
      </listitem>
      <listitem>
        <para>
         Deregistration of systems or products
        </para>
      </listitem>
      <listitem>
        <para>
          Pre-check tasks to ensure a smooth registration process.
        </para>
      </listitem>
       </itemizedlist>
       <section xml:id="ansible-role-variables">
 <title>Ansible role variables</title>
 <para>The following variables can be configured in this role:</para>
            <itemizedlist>
              <listitem>
                <para>The<literal>suseconnect_base_product</literal> variable is of <literal>type:dict</literal>.
                It defines the base product that should be activated on the target system. The dictionary includes the following
                keys:
              </para>
<table xml:id="suseconnect-table">
  <title><literal>suseconnect_base_product</literal>keys</title>
  <tgroup cols="4">
   <colspec colname="c1"/>
   <colspec colname="c2"/>
   <colspec colname="c3"/>
<colspec colname="c4"/>
   <thead>
    <row>
      <entry>Key</entry>
     <entry>Type</entry>
     <entry>Description</entry>
     <entry>Required</entry>
    </row>
  </thead>
  <tbody>
   <row>
    <entry><literal>product</literal></entry>
    <entry>string</entry>
    <entry>Internal product name</entry>
<entry>No</entry>
</row>
<row>
 <entry><literal>key</literal></entry>
 <entry>string</entry>
 <entry>Registration key for the product</entry>
<entry>Yes</entry>
</row>
<row>
 <entry><literal>version</literal></entry>
 <entry>string</entry>
 <entry>Version of the product to be activated, default is the base OS version <literal>ansible_distribution_version</literal></entry>
<entry>No</entry>
</row>
<row>
 <entry><literal>arch</literal></entry>
 <entry>string</entry>
 <entry>Architecture of the product, default is the OS architecture <literal>ansible_machine</literal></entry>
 <entry>No</entry>
 </row>
 <row>
   <entry><literal>email</literal></entry>
   <entry>string</entry>
   <entry>Email address used for &scc; registration</entry>
 <entry>No</entry>
 </row>
  </tbody>
   </tgroup>
  </table>
 </listitem>
 <listitem>
   <para>The<literal>suseconnect_subscriptions</literal> variable is of <literal>type:list</literal>.
   It defines the list of additional modules or products to be added or removed on the target system.
   Each item in the dictionary has the following keys:
  </para>
  <table xml:id="suseconnect-sub-table">
  <title><literal>suseconnect_subscriptions</literal>keys</title>
  <tgroup cols="4">
  <colspec colname="c1"/>
  <colspec colname="c2"/>
  <colspec colname="c3"/>
  <colspec colname="c4"/>
  <thead>
  <row>
  <entry>Key</entry>
  <entry>Type</entry>
  <entry>Description</entry>
  <entry>Required</entry>
  </row>
  </thead>
  <tbody>
  <row>
  <entry><literal>name</literal></entry>
  <entry>string</entry>
  <entry>Internal product name</entry>
  <entry>Yes</entry>
  </row>
  <row>
    <entry><literal>state</literal></entry>
    <entry>string</entry>
    <entry>The state of the subscription, which is either <literal>enabled</literal> or <literal>disabled</literal>.
      If not specified, the default state is enabled.</entry>
    <entry>No</entry>
    </row>
    <row>
<entry><literal>version</literal></entry>
<entry>string</entry>
<entry>Version of the product to be activated, default is the base OS version <literal>ansible_distribution_version</literal></entry>
<entry>No</entry>
</row>
<row>
<entry><literal>arch</literal></entry>
<entry>string</entry>
<entry>Architecture of the product, default is the OS architecture <literal>ansible_machine</literal></entry>
<entry>No</entry>
</row>
<row>
<entry><literal>email</literal></entry>
<entry>string</entry>
<entry>Email address used for &scc; registration</entry>
<entry>No</entry>
</row>
<row>
  <entry><literal>key</literal></entry>
  <entry>string</entry>
  <entry>Registration key for the product</entry>
<entry>Yes</entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
<listitem><para>The<literal>suseconnect_reregister</literal> variable is of <literal>type:bool</literal>.
 It defines whether to force re-registration of base product, regardless of current status <literal>default: false</literal>.</para></listitem>
 <listitem><para>The<literal>suseconnect_deregister</literal> variable is of <literal>type:bool</literal>.
 It defines whether to whether to deregister the system, regardless of current status <literal>default: false</literal>.</para></listitem>
</itemizedlist>
            </section>
              <section xml:id="role-examples">
              <title>Role examples</title>
             <para>Some examples include:</para>
              <itemizedlist>
                <listitem>
                  <para>This example registers a &productname; system and activates several modules.</para>
                  <screen>
                    - name: Register with SCC and activate modules
                      hosts: all
                      vars:
                        suseconnect_base_product:
                          key: '{{ sles_registration_key }}'
                          product: '{{ ansible_distribution }}'

                        suseconnect_subscriptions:
                          - {name: "sle-module-containers", state: enabled}
                          - {name: "PackageHub", state: disabled}
                          - {name: "sle-module-python3", state: enabled}

                      tasks:
                        - name: Register system and modules with SUSE Customer Center
                          ansible.builtin.include_role:
                            name: suseconnect
                  </screen>
                  </listitem>
                  <listitem>
                    <para>This example adds or removes modules and extensions and also registers and de-registers
                    components as well as enables or disables their repositories.
                    </para>
                    <screen>
                      - name: Adding or deleting modules and extensions
                        hosts: all
                        vars:
                          suseconnect_subscriptions:
                          - {name: "sle-module-containers", state: enabled}
                          - {name: "PackageHub", state: disabled}
                          - {name: "sle-module-python3", state: enabled}
                          - {name: "sle-ha", state: enabled, key: "REGISTRATION-KEY"}

                        tasks:
                          - name: Remove other subscriptions
                            ansible.builtin.include_role:
                              name: suseconnect
                  </screen>
                    </listitem>
                    <listitem>
                      <para>This example shows how to de-register base products that are no longer required.
                      </para>
                         <screen>
                          - name: Deregister products from SCC
                          hosts: all
                          vars:
                            suseconnect_deregister: true

                          tasks:
                            - name: Deregister products from SUSE Customer Center
                              ansible.builtin.include_role:
                                name: suseconnect
                    </screen>
                    </listitem>
                </itemizedlist>
            </section>
     </topic>