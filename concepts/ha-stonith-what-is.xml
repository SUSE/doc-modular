<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_fencing.xml -->

<topic xml:id="ha-stonith-what-is"
 role="concept" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>What is &stonith;?</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <xi:include href="../snippets/ha-fencing.xml"/>
      <xi:include href="../snippets/ha-stonith.xml"/>
    </abstract>
  </info>
  <section xml:id="ha-stonith-what-is-components">
    <title>Components</title>
    <para>
      In &sleha;, &stonith; consists of two components:
    </para>
    <variablelist>
      <varlistentry>
        <term>pacemaker-fenced</term>
        <listitem>
          <para>
            A daemon that runs on every node in the &ha; cluster. It accepts fencing requests from
            <systemitem>pacemaker-controld</systemitem>. It can also check the status of the fencing
            device.
        </para>
      </listitem>
      </varlistentry>
      <varlistentry>
        <term>&stonith; plug-in</term>
        <listitem>
          <para>
            The interface to the fencing device. Every supported fencing device can be controlled
            by a specific &stonith; plug-in. Some plug-ins support more than one device.
            For example, <literal>ipmilan</literal> (or <literal>external/ipmi</literal>) implements
            the IPMI protocol and can control any device that supports this protocol.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
  <section xml:id="ha-stonith-what-is-device-types">
    <title>&stonith; devices</title>
    <para>
      The &stonith; device you use depends on your budget and hardware. &stonith; devices can be classified into the following categories:
      TODO: Improve these descriptions
    </para>
    <variablelist>
      <title>Physical devices</title>
      <varlistentry>
        <term>Power Distribution Units (PDU)</term>
        <listitem>
          <para>
            Power Distribution Units are an essential element in managing power capacity and functionality for critical network, server and data center equipment. They can provide remote load monitoring of connected equipment and individual outlet power control for remote power recycling.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Uninterruptible Power Supplies (UPS)</term>
        <listitem>
          <para>
            A stable power supply that provides emergency power to connected equipment by supplying power from a separate source if a utility power failure occurs.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Blade power control devices</term>
        <listitem>
          <para>
            If you are running a cluster on a set of blades, then the power control device in the blade enclosure is the only candidate for fencing. This device must be capable of managing single blade computers.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
      <term>Lights-out devices</term>
        <listitem>
          <para>
          <!--This para just describes why these devices suck; is that really all we want to say?-->
            Lights-out devices (IBM RSA, HP iLO, Dell DRAC) are becoming increasingly popular and may even become standard in off-the-shelf computers. However, they are inferior to UPS devices, because they share a power supply with their host (a cluster node). If a node stays without power, the device supposed to control it would be useless. In that case, the CRM would continue its attempts to fence the node indefinitely while all other resource operations would wait for the fencing/&stonith; operation to complete.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <title>Software mechanisms</title>
      <varlistentry>
        <term>Disk-based &sbd;</term>
        <listitem>
          <para>
            This is a self-fencing device. It reacts to a so-called <quote>poison
            pill</quote> which can be inserted into a shared disk. On
            shared-storage connection loss, it stops the node from operating.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Diskless &sbd;</term>
        <listitem>
          <para>
            This configuration is useful if you want a fencing mechanism without shared storage. In this diskless mode, &sbd; fences nodes by using the hardware watchdog without relying on any shared device. However, diskless &sbd; cannot handle a split-brain scenario for a two-node cluster. Use this option only for clusters with <emphasis>more than two</emphasis> nodes, or in combination with &qdevice; to help handle split-brain scenarios.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>fence_kdump</term>
        <listitem>
          <para>
            This plug-in checks if a Kernel dump is in progress on a node. If so,
            it returns <literal>true</literal>, and acts as if the node has been
            fenced. The node cannot run any resources during the dump anyway. This
            avoids fencing a node that is already down but doing a dump, which
            takes some time. The plug-in must be used together with a physical &stonith; device.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
  <section xml:id="ha-stonith-what-is-more-info">
    <title>For more information</title>
    <itemizedlist>
      <listitem>
        <para>
          For more information, see <link xlink:href="https://clusterlabs.org/projects/pacemaker/doc/3.0/Pacemaker_Explained/html/fencing.html"/>.
        </para>
      </listitem>
      <listitem>
        <para>
          To see the &stonith; devices that are supported by &sleha;, run the following command on a cluster node:
        </para>
<screen>&prompt.user;<command>sudo crm ra list stonith</command></screen>
      </listitem>
      <listitem>
        <para>
          For more information about a specific &stonith; device, run the following command on a cluster node:
        </para>
<screen>&prompt.user;<command>sudo crm ra info <replaceable>STONITH_DEVICE</replaceable></command></screen>
      </listitem>
    </itemizedlist>
  </section>
</topic>
