<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="concept-sle16-upgrade-upgrade-distribution-migration-systemt"
 role="concept" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <!-- can be changed via merge in the assembly -->
    <title>Distribution migration system</title>
    <!--add author's email address-->
    <meta name="maintainer" content="cwickert@suse.com" its:translate="no"/>
    <!-- can be changed via merge in the assembly -->
    <abstract>
      <para>
      The distribution migration system provides an upgrade path for an installed &productname;
      system from one major version to another, for example, from &productnameshort; 15&nbsp;SP7 to
      &productnameshort; 16.0.
      </para>
    </abstract>
  </info>
  <section xml:id="concept-sle16-upgrade-distribution-migration-systemt">
    <title>Concept</title>
    <para>
      While previous versions of &productname; were upgraded from the @leanos;, &productnameshort;
      16 is uses the distribution migration system. This upgrade is done via the network using the &zypper; migration
      workflow, which sends a request to the repository server, asking for an upgrade path.
      Supported repository servers are the &scc; (SCC) and repository mirroring tool (&rmt;). The
      request response contains the list of repositories required to upgrade the system. This
      requires the system to be upgraded to be registered. Additionally, the server providing the
      updates must have the necessary channels available and those channels must be up to date.
      This requirement is automatically met when a system is registered to the &scc; (SCC) or for
      &quot;Pay as you go&quot;-instances in the public cloud that are automatically registered
      to the SUSE-operated update infrastructure of the public cloud provider. However
      administrative work may be required when the system to be upgraded is connected to an &rmt;
      server.
    </para>
    <!-- FIXME Currently not supported.
    <para>
      The migration implementation also supports an upgrade mode that works with systems not
      registered to a repository service. For details, see
      <xref linkend="_optional_customization_of_the_upgrade_process"/>.
    </para>
    -->
    <para>
      The upgrade to a new major version requires the system to be migrated to be offline during the
      upgrade to avoid system inconsistencies that may leave the system in a state that does not
      allow recovery. This behavior is implemented using a live migration image.
    </para>
    <para>
      The distribution migration system provides the live image and a startup utility 
      <command>run_migration</command> that reboots the running system into the upgrade live image.
      Once booted into the upgrade live image the following chain of services will be executed:
    </para>
    <orderedlist>
      <listitem>
        <para>
          Detect the system to be upgraded
        </para>
      </listitem>
      <listitem>
        <para>
          Mount the necessary file systems
        </para>
      </listitem>
      <listitem>
        <para>
          Setup the network to match the network configuration of the system to be upgraded
        </para>
      </listitem>
      <listitem>
        <para>
          Prepare SSH access to the upgrade live image
        </para>
      </listitem>
      <listitem>
        <para>
          Prepare the package manager for the upgrade task
        </para>
      </listitem>
      <listitem>
        <para>
          Upgrade the system using zypper
        </para>
      </listitem>
      <listitem>
        <para>
          Update the boot loader configuration
        </para>
      </listitem>
      <listitem>
        <para>
          Unmount all mounted file systems
        </para>
      </listitem>
      <listitem>
        <para>
          Reboot
        </para>
      </listitem>
    </orderedlist>
    <para>
      In case an error occurs prior to the start of the upgrade, the system will be reverted to its
      original state.
    </para>
  </section>
</topic>
