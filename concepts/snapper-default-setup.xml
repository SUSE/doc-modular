<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="snapper-default-setup"
 role="concept" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
 <info>
  <title>Snapper default setup</title>    
    <meta name="maintainer" content="daria.vladykina@suse.com" its:translate="no"/>
    <abstract>
       <para>
        Learn about the default setup of Snapper and its default settings.
       </para>
     </abstract>
  </info>
  <para>Snapper on &sles; is set up as an undo and recovery tool for system
    changes. By default, the root partition (<filename>/</filename>) of 
    &sles; is formatted with <literal>Btrfs</literal>. Taking snapshots
    is automatically enabled if the root partition (<filename>/</filename>) 
    is big enough (more than approximately 16&nbsp;GB). 
    By default, snapshots are disabled on partitions other than <filename>/</filename>.</para>
    
    <section xml:id="snapper-default-basics">
      <title>Snapper on root</title> 
    <para>When Snapper is configured to operate on root, every Btrfs subvolume is
    excluded by default. This means that if a user has the subvolume <filename>/srv</filename>,
    Snapper will not take snapshots of anything in <filename>/srv</filename> unless the user
    decides to specifically do so. This also means that if you add a subvolume to 
    <filename>/</filename> at any point in time, it will be excluded from Snapper's
    default snapshot behavior.</para>
   <para>The default behavior of Snapper is defined in a configuration file that 
    is specific for each partition or Btrfs subvolume. These configuration files reside
    under <filename>/etc/snapper/configs/</filename>.</para>
    <tip>
      <title>Enabling Snapper in the installed system</title>
      <para>
       If you disabled Snapper during the installation, you can enable it at
       any time later. To do so, create a default Snapper configuration for the
       root file system by running:
      </para>
      <screen>&prompt.sudo;snapper -c root create-config /</screen>
      <para>
       Afterward, enable the different snapshot types as described in <!--<xref
       linkend="sec-snapper-setup-customize-auto-snapshots"/>.-->
      </para>
      <para>
       Note that on a Btrfs root file system, snapshots require a file system with
       subvolumes configured as proposed by the installer and a partition size of at
       least 16&nbsp;GB.
      </para>
     </tip>
    </section>

  <section xml:id="snapper-default-settings">
    <title>Snapper default settings</title>

    <para>If the root partition (<filename>/</filename>) has enough space 
      (16&nbsp;GB or more), taking snapshots is enabled automatically. 
      By default, snapshots are disabled on partitions other than <filename>/</filename>.
      The following table presents comparison details:</para>
    
    <table>
      <title>Default aspects for disks larger than 16&nbsp;GB and smaller than 16&nbsp;GB</title>
      <tgroup cols="2">
          <colspec colnum="1" colname="1" colwidth="3334*"/>
          <colspec colnum="2" colname="2" colwidth="3334*"/>
        <thead>
        <row>
         <entry>
          <para>
            Disk &gt; 16 GB
          </para>
         </entry>
         <entry>
          <para>
            Disk &lt; 16 GB
          </para>
         </entry>
         </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para>
            Configuration <filename>/etc/snapper/configs/root</filename> (0 single) is created automatically.
          </para>
         </entry>
         <entry>
          <para>
            No configuration <filename>/etc/snapper/configs/root</filename> (0 single) is created automatically.
            It must be created manually by Snapper's <command>create-config</command> command.
          </para>
         </entry>
         </row>
        <row>
         <entry>
          <para>
            Snapshot 1 single for root partition (<filename>/</filename>) is taken automatically 
            with the name <literal>first root filesystem</literal>.
          </para>
         </entry>
         <entry>
          <para>
            No snapshot 1 single is automatically taken. The user can create it manually with any name.
          </para>
         </entry>
        </row>
        <row>
          <entry>
           <para>
            Snapshot 2 single <literal>After installation, important=yes</literal> is taken automatically.
           </para>
          </entry>
          <entry>
           <para>
            No snapshot 2 single is automatically created.
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            Default <literal>USE_SNAPPER=yes</literal> parameter in 
            <filename>/etc/sysconfig/yast2</filename> configuration.
            <literal>Administrative Snapshots</literal> creation is <emphasis>ON</emphasis>.
           </para>
          </entry>
          <entry>
           <para>
            Default <parameter>USE_SNAPPER=no</parameter> parameter in 
            <filename>/etc/sysconfig/yast2</filename> configuration.
            <literal>Administrative Snapshots</literal> creation is <emphasis>OFF</emphasis>.
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            Default <parameter>TIMELINE_CREATE=yes</parameter> in <filename>/etc/snapper/configs/root</filename>. 
            This means that <literal>Timeline Snapshots</literal> creation is <emphasis>ON</emphasis>.
           </para>
          </entry>
          <entry>
           <para>
            Default <parameter>TIMELINE_CREATE=no</parameter> in <filename>/etc/snapper/configs/root</filename>. 
            <literal>Timeline Snapshots</literal> creation is <emphasis>OFF</emphasis>.
           </para>
          </entry>
         </row>
       </tbody>
      </tgroup>
     </table>
  </section>

  <section xml:id="snapper-snapshot-creation"> 
    <title>Snapshot creation</title>
     <para>
     When a snapshot is created, both the snapshot and the original point to the
     same blocks in the file system. So, initially a snapshot does not occupy
     additional disk space. If data in the original file system is modified,
     changed data blocks are copied while the old data blocks are kept for the
     snapshot. Therefore, a snapshot occupies the same amount of space as the
     data modified. So, over time, the amount of space a snapshot allocates
     constantly grows. As a consequence, deleting files from a
     <literal>Btrfs</literal> file system containing snapshots may
     <emphasis>not</emphasis> free disk space!</para>
     <note>
       <title>Snapshot location</title>
       <para>
        Snapshots always reside on the same partition or subvolume on which the
        snapshot has been taken. It is not possible to store snapshots on a
        different partition or subvolume.
       </para>
      </note>
      <para>
       As a result, partitions containing snapshots need to be larger than
       partitions not containing snapshots. The exact amount depends strongly on the
       number of snapshots you keep and the amount of data modifications. As a rule
       of thumb, give partitions twice as much space as you normally would.
       To prevent disks from running out of space, old snapshots are automatically
       cleaned up. Refer to
       <!--<xref linkend="sec-snapper-setup-customize-archiving"/>--> for details.
      </para>  
      <tip>
        <para>
          To see what subvolumes are created under <filename>/</filename> and 
          therefore see which directories (subvolumes) are excluded from the 
          default snapshots behavior, run:</para>
        <screen>&prompt.sudo;btrfs subvolume list /</screen>
      </tip> 
 </section>
</topic>
