<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="concept-systemd-targets" role="concept" xml:lang="en"
  xmlns="http://docbook.org/ns/docbook" version="5.2"
  xmlns:its="http://www.w3.org/2005/11/its"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Understanding &systemd; targets</title>    <!-- can be changed via merge in the assembly -->
    <!--add author's email address-->
    <meta name="maintainer" content="amrita.sakthivel@suse.com" its:translate="no"/>
    <abstract>      <!-- can be changed via merge in the assembly -->
      <para>
     &systemd; uses units and targets. A &systemd; unit defines a service or action on the system, which consists of a name, type, and  configuration file.
     </para>
    </abstract>
    </info>
     <section xml:id="systemd-what-are-targets">
<title>What are &systemd; targets?</title>
      <para>
     A &systemd; target combines several units and defines which services have to be started to reach the target.
        On a server, for example, this is a state where the network is running and multiple users can log in.
        These files are identified by the suffix <literal>.target</literal>.
      </para>
      <para>Similar to unit files, different targets may be nested via dependencies. For example, <literal>multi-user.target</literal> requires (among others) the targets
        that set up login and user session services.
      </para>
    <para>
    Common &systemd; targets:
  </para>
  <variablelist>
    <varlistentry>
      <term>
        <literal>default.target</literal>
      </term>
      <listitem>
        <para>Boots by default. The <literal>default.target</literal> file is a symbolic link to the
        true target file, such as <literal>graphical.target</literal> for a desktop workstation. For a server, it is usually
          <literal>graphical.target</literal>.
        </para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>poweroff.target</literal>
      </term>
      <listitem>
        <para>Shuts down and powers off the system.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>rescue.target</literal>
      </term>
      <listitem>
        <para>Target unit that pulls the base system and starts a rescue shell session.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>multi-user.target</literal>
      </term>
      <listitem>
        <para>Sets up a non-graphical (console) multi-user system.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>graphical.target</literal>
      </term>
      <listitem>
        <para>Uses a graphical multi-user system with network services.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>reboot.target</literal>
      </term>
      <listitem>
        <para>Shuts down and reboots the system.
        </para>
      </listitem>
    </varlistentry>
  </variablelist>
 </section>
<section xml:id="systemd-set-targets">
<title>Setting up a &systemd; target</title>
<para>To set up a &systemd; target, you need to create a new target unit file and define any required dependencies.
  A target is a group of unit files that manages the state of services. A target can be used to control groups of services
  or to define system states.</para>
  <procedure>
    <step>
    <para>Create a new file with the <literal>.target</literal> extension in <filename>/etc/systemd/system/</filename>. </para>
    <para>For example:</para>
    <screen>&prompt.sudo; <command>vi /etc/systemd/system/test.target</command></screen>
  </step>
  <step>
    <para>Define the target with basic configuration.</para>
    <para>For example:</para>
<screen>[Unit]
Description= Test target
Requires=multi-user.target
After=multi-user.target

[Install]
WantedBy=multi-user.target
</screen>
<itemizedlist>
<listitem>
  <para>
   <emphasis>Requires:</emphasis> specifies that <literal>multi-user.target</literal> must be reached
   for <literal>test.target</literal>  to be active.
  </para>
</listitem>
<listitem>
  <para>
    <emphasis>After:</emphasis> specifies that this target starts after the <literal>multi-user.target</literal>.
       </para>
</listitem>
     <listitem>
      <para>
        <emphasis>WantedBy:</emphasis> specifies that this target should be part of <literal>multi-user.target</literal>.
      </para>
      </listitem>
      </itemizedlist>
  </step>
  <step>
    <para>Set permissions for the target file. </para>
    <para>For example:</para>
    <screen>&prompt.sudo; <command>chmod 644 /etc/systemd/system/test.target
    </command></screen> </step>
    <step>
    <para>Link the required services to the target file. Create a <literal>.wants</literal> directory and then create
    symbolic links to the services you want to include in your custom target.</para>
    <para>For example:</para>
    <screen>&prompt.sudo; <command>mkdir -p /etc/systemd/system/custom.target.wants/ </command></screen>
    <screen>&prompt.sudo; <command>ln -s /etc/systemd/system/test.service /etc/systemd/system/custom.target.wants/
    </command></screen>
  </step>
  <step>
    <para>Reload &systemd;. </para>
    <para>For example:</para>
    <screen>&prompt.sudo; <command>systemctl daemon-reload</command></screen> </step>
    <step>
      <para>Start and enable the target. </para>
      <para>For example:</para>
      <screen>&prompt.sudo; <command>systemctl start test.target</command></screen>
      <screen>&prompt.sudo; <command>systemctl enable test.target</command></screen>
    </step>
    <step>
      <para>Verify the status of the custom target. </para>
      <para>For example:</para>
      <screen>&prompt.sudo; <command>systemctl status test.target</command></screen>
      </step>
      <step>
        <para>Verify all the units that are part of this target. </para>
        <para>For example:</para>
        <screen>&prompt.sudo; <command>systemctl list-dependencies test.target </command></screen>
        </step>
       <step><para>Your custom &systemd; target is set up and configured.</para></step>
      </procedure>
      <para>You can use the following common configuration options: </para>
      <itemizedlist>
        <listitem>
          <para>
           <emphasis>Description:</emphasis> A human-readable description of the target.
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis>Documentation:</emphasis> URIs pointing to documentation.</para>
        </listitem>
             <listitem>
              <para>
                <emphasis>AllowIsolate:</emphasis>
                If set to <literal>true</literal>, this unit can be used with the <command>systemctl isolate</command> command.
              </para>
              </listitem>
              <listitem>
                <para>
                  <emphasis>Wants:</emphasis>
                  Units that can be started but are not mandatory.
                </para>
                </listitem>
                <listitem>
                  <para>
                    <emphasis>After/Before:</emphasis>
                    Defines the order of dependencies.
                  </para>
                  </listitem>
                  <listitem>
                    <para>
                      <emphasis>Conflicts:</emphasis>
                     Units that should not be active while this target is active.
                    </para>
                    </listitem>
              </itemizedlist>
<para>For more information on &systemd; targets, refer to <emphasis>man 5 systemd.target</emphasis>
  and <emphasis>man 7 systemd.special</emphasis>.
</para>
</section>
</topic>
