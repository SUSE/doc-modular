<?xml version='1.0' encoding='UTF-8'?><article xmlns="http://docbook.org/ns/docbook" version="5.2" xml:id="sles-pxe-server-setup" xml:lang="es">
  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">Configuración de un servidor de arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
    <revhistory xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="rh-sles-pxe-server-setup">
      <revision>
        <date>4/11/2025</date>
        <revdescription>
          <para>
              Versión inicial
            </para>
        </revdescription>
      </revision>
    </revhistory>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="architecture">
      <phrase>AMD64/Intel 64</phrase>
      <phrase>AArch64</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="productname" its:translate="no">
      <productname version="16.0">
        <phrase>
          <phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase>
        </phrase>
      </productname>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="title" its:translate="yes">Configuración de un servidor de arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="description" its:translate="yes">Cómo configurar un servidor de arranque PXE usando imágenes de GRUB 2, nginx y el instalador Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="social-descr" its:translate="yes">Configurar un servidor de arranque PXE con GRUB 2 y Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="category" its:translate="no">
      <phrase>Deployment &amp; Upgrade</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="task" its:translate="no">
      <phrase>Configuration</phrase>
      <phrase>Installation</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="series" its:translate="no">Products &amp; Solutions</meta>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <dm:bugtracker>
        <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
        <dm:component>Documentation</dm:component>
        <dm:product>SUSE Linux Enterprise Server 16.0</dm:product>
        <dm:assignee>souvik.sarkar@suse.com</dm:assignee>
      </dm:bugtracker>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <variablelist>
        <varlistentry>
          <term>DESCRIPCIÓN</term>
          <listitem>
            <para>
                Configure un servidor de arranque PXE compatible con arranque seguro UEFI y el instalador Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>INTENCIÓN</term>
          <listitem>
            <para>
                Automatizar y agilizar la instalación de varios sistemas <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> a través de la red.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>ESFUERZO</term>
          <listitem>
            <para>
                Los administradores de sistemas o redes suelen tardar de 30 a 45 minutos en leer y comprender este artículo.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>OBJETIVO</term>
          <listitem>
            <para>
                Conseguir un servidor PXE operativo que pueda arrancar varias arquitecturas en el instalador Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>REQUISITOS</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>
                    Un sistema <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> con privilegios de administrador
                  </para>
              </listitem>
              <listitem>
                <para>
                    Conexión a Internet para obtener las imágenes ISO
                  </para>
              </listitem>
              <listitem>
                <para>
                    Una configuración de IP estática para el servidor PXE
                  </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </abstract>
  </info>
  <section role="concept" xml:lang="es" version="5.2" xml:id="sles-pxe-server-introduction">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Descripción general del arranque PXE con <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        El arranque PXE permite que los equipos arranquen a través de la red en un entorno de instalación o ejecución sin almacenamiento local. En esta sección se explica cómo funciona PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> con imágenes de Agama y del instalador en directo, centrándose en GRUB 2.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-what-is">
      <title>¿Qué es el arranque PXE?</title>
      <para>
      PXE (entorno de ejecución de prearranque) es un método que permite a los sistemas recuperar cargadores de arranque e instaladores de SO desde un servidor de red utilizando DHCP y TFTP o HTTP. Es ampliamente utilizado para el aprovisionamiento de equipos sin medios físicos ni sistemas operativos preinstalados.
    </para>
    </section>
    <section xml:id="sles-pxe-server-benefits">
      <title>Ventajas del arranque PXE</title>
      <para>
      El arranque PXE simplifica el aprovisionamiento al eliminar la necesidad de medios de instalación locales o configuración manual. Permite lo siguiente:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Instalar sin asistencia muchos sistemas a través de la red
        </para>
        </listitem>
        <listitem>
          <para>
          Gestionar de forma centralizada versiones del instalador y configuraciones de arranque
        </para>
        </listitem>
        <listitem>
          <para>
          Ofrecer compatibilidad para diversas arquitecturas y tipos de firmware, incluido el arranque seguro UEFI
        </para>
        </listitem>
        <listitem>
          <para>
          Seleccionar de forma dinámica instaladores o parámetros de instalación mediante los menús de GRUB 2
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-how-it-works">
      <title>Cómo funciona el arranque PXE con <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
      <para>
      El arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> utiliza GRUB 2 como cargador de arranque y el instalador Agama como interfaz de instalación. Los cargadores de arranque y los archivos de instalador se proporcionan a través de la red mediante HTTP o TFTP. GRUB 2 se encarga de recuperar el kernel, initrd y la imagen en directo. Los clientes PXE pueden utilizar distinto firmware (incluyendo los más comunes como BIOS o UEFI), ejecutables de cargador de arranque o formatos de imagen, según lo requieran sus arquitecturas, por ejemplo AMD64/Intel 64, AArch64, ppc64le y s390x. Además, deben funcionar tanto en redes IPv4 como IPv6.
    </para>
      <para>
      El cargador de arranque pasa parámetros del kernel como <literal>root=live:</literal> para cargar el sistema de archivos raíz basado en squashfs desde una imagen ISO en directo, iniciando la interfaz Agama ya sea localmente o como un servicio Web para una interfaz de usuario Web remota.
    </para>
      <section xml:id="sles-pxe-server-backward-compatibility-with-sle-15">
        <title>Retrocompatibilidad con <phrase><phrase os="sles">SLES</phrase></phrase> 15.x</title>
        <para>
        La información de este artículo se aplica principalmente a <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 16.0 y versiones posteriores. Se centra en los flujos de trabajo de arranque PXE que se integran con el instalador Agama y se basan en imágenes de instalación en directo. En el contexto y alcance de este artículo, <phrase><phrase os="sles">SLES</phrase></phrase> 16.0 y versiones posteriores difieren de <phrase><phrase os="sles">SLES</phrase></phrase> 15.x en los siguientes aspectos:
      </para>
        <variablelist>
          <varlistentry>
            <term>Instalador</term>
            <listitem>
              <para>
              Usa <literal>dracut</literal> y Agama en lugar de <literal>linuxrc</literal> y YaST.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Servidor DHCP</term>
            <listitem>
              <para>
              Ya no se usa ISC DHCP (final de vida en 2022). Para un servidor DHCP, use Kea o dnsmasq en su lugar.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Parámetros de arranque</term>
            <listitem>
              <para>
              Usa el parámetro <literal>root=live:</literal> para cargar la imagen del instalador Agama y el parámetro <literal>inst.install_url=</literal> opcional para el repositorio de instalación no predeterminado, en lugar del parámetro <literal>install=</literal>.
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>
        La elección del cargador de arranque (GRUB 2, pxelinux, etc.) sigue siendo flexible y no depende de la versión.
      </para>
      </section>
      <section xml:id="sles-pxe-server-different-possible-setups">
        <title>Diferentes configuraciones y pasos posibles</title>
        <para>
        Este artículo consta de pasos de configuración obligatorios y configuraciones opcionales o alternativas. Siga solo las secciones relevantes para su despliegue y omita cualquier alternativa que no sea aplicable.
      </para>
        <variablelist>
          <varlistentry>
            <term>Obligatorio</term>
            <listitem>
              <para>
              Tareas como instalar componentes, preparar la imagen del instalador, configurar GRUB 2 y validar el servidor deben completarse en todas las configuraciones.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Método de entrega de archivos</term>
            <listitem>
              <para>
              Un servidor HTTP (recomendado con Agama) como <literal>nginx</literal>, o un servidor TFTP como <literal>tftp</literal> o <literal>dnsmasq</literal>.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Servidor DHCP</term>
            <listitem>
              <para>
              Elija Kea o dnsmasq.
            </para>
              <note>
                <title>limitaciones y características del método elegido</title>
                <itemizedlist>
                  <listitem>
                    <para>
                    Use <emphasis role="strong">Kea</emphasis>, el nuevo servidor DHCP de ISC, para sustituir a ISC DHCP con una opción más moderna. Para obtener más información acerca de Kea, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/kea/"></link>. Para el aviso de final de vida de ISC DHCP, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/dhcp/"></link>. Kea es un servidor DHCP y requiere software de servidor TFTP separado. El servidor DHCP Kea admite opciones para el arranque TFTP/PXE a través de IPv4 e IPv6, así como para el arranque HTTP a través de IPv4. El arranque HTTP a través de IPv6 requiere que el servidor DHCPv6 pueda enviar la <literal>Vendor Class Option</literal> (consulte <literal>RFC3315, Section 22.16</literal>), que, supuestamente, <quote>un cliente usará para identificar al proveedor</quote> de vuelta al cliente, pero actualmente no se admite.
                  </para>
                  </listitem>
                  <listitem>
                    <para><emphasis role="strong">dnsmasq</emphasis> es una combinación de un servidor DNS, un servidor DHCP y un servidor TFTP. Puede usarlo para proporcionar el cargador de arranque, el kernel, initrd (y otros archivos) a través de TFTP. Para obtener más información sobre dnsmasq, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://thekelleys.org.uk/dnsmasq/doc.html"></link>. El servidor DHCP dnsmasq admite opciones para el arranque TFTP/PXE a través de IPv4 e IPv6, así como para el arranque HTTP a través de IPv4. El arranque HTTP a través de IPv6 requiere que el servidor DHCPv6 pueda enviar la <literal>Vendor Class Option</literal> (consulte <literal>RFC3315, Section 22.16</literal>), que, supuestamente, <quote>un cliente usará para identificar al proveedor</quote> de vuelta al cliente, pero actualmente no se admite.
                  </para>
                  </listitem>
                </itemizedlist>
              </note>
            </listitem>
          </varlistentry>
        </variablelist>
        <figure xml:id="sles-pxe-server-setup-workflow">
          <title>Flujo de trabajo de configuración del servidor PXE de ejemplo</title>
          <mediaobject>
            <imageobject role="html">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg"/>
            </imageobject>
            <imageobject role="fo">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg" width="85%"/>
            </imageobject>
            <textobject role="description">
              <phrase>Diagrama del flujo de trabajo de la configuración de un servidor de arranque PXE</phrase>
            </textobject>
          </mediaobject>
        </figure>
      </section>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-prepare-network">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Preparación de la red para los servicios de arranque PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se describen los requisitos de la infraestructura de red para desplegar servicios de arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-network-configuration-introduction">
      <title>Introducción</title>
      <para>
      Un servidor PXE consta de tres servidores: un servidor DHCP que proporciona la dirección y la ubicación del archivo de arranque (cargador de arranque) y un servidor TFTP y un servidor HTTP para recuperar los archivos. Además, puede haber un servidor DNS, un servidor NTP y un router que admita IPv6; por lo general, están separados del servidor PXE en una red de producción. Un servidor PXE que ejecute <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> también puede necesitar una configuración de interfaz de red específica, ciertas reglas persistentes añadidas al firewall y algunos permisos en <systemitem>SELinux</systemitem>. Esta sección muestra una red de ejemplo con intervalos de IP adecuados y las reglas necesarias para el firewall y SELinux.
    </para>
    </section>
    <section xml:id="sles-pxe-server-network-configuration">
      <title>Suposiciones y configuración de red de muestra</title>
      <para>
      En este artículo, se presupone lo siguiente:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          El servidor PXE se ejecuta en la interfaz de red <literal>eno1</literal> con la siguiente configuración de red:
        </para>
          <table frame="all">
            <title>Configuración de red PXE de ejemplo</title>
            <tgroup cols="4">
              <colspec colname="c1"/>
              <colspec colname="c2"/>
              <colspec colname="c3"/>
              <colspec colname="c4"/>
              <thead>
                <row>
                  <entry/>
                  <entry>IPv4</entry>
                  <entry>IPv6</entry>
                  <entry>Nombre DNS</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>Red PXE</entry>
                  <entry>192.168.1.0/24</entry>
                  <entry>2001:db8:0:1::/64</entry>
                  <entry>example.net</entry>
                </row>
                <row>
                  <entry>Servidor PXE</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry>pxe.example.net</entry>
                </row>
                <row>
                  <entry>Gateway PXE</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Servidor DNS</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Servidor NTP</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
              </tbody>
            </tgroup>
          </table>
        </listitem>
        <listitem>
          <para>
          De forma predeterminada, los servidores de router, NTP y DNS son externos y se ejecutan en otro equipo. Este artículo proporciona algunas sugerencias, pero no cubre su configuración completa.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-firewall-selinux">
      <title>Configuración de la interfaz de red, el firewall y <systemitem>SELinux</systemitem> para servicios PXE</title>
      <para>
      Configure la interfaz de red y el firewall para permitir los servicios de red requeridos por el servidor PXE. Ajuste la configuración de <systemitem>SELinux</systemitem> para habilitar las pruebas de instalación y definir políticas locales persistentes.
    </para>
      <procedure>
        <step>
          <para>
          Compruebe y asigne la interfaz de red PXE a la zona protegida por firewall apropiada.
        </para>
          <substeps>
            <step>
              <para>
              Compruebe las zonas activas actualmente y sus interfaces asignadas:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --get-active-zones</command>
              </screen>
            </step>
            <step>
              <para>
              Si no se asigna <literal>eno1</literal> a la zona <literal>public</literal>, asígnela:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --change-interface=eno1</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que la asignación de interfaz sea persistente entre rearranques:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-interface=eno1</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio DNS.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio DNS para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dns</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dns</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio NTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio NTP para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=ntp</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=ntp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio DHCP (IPv4).
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio DHCP para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcp</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio DHCPv6.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio DHCPv6 para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio TFTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio TFTP para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=tftp</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=tftp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio HTTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio HTTP para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=http</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=http</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure el firewall para el acceso al servicio HTTPS.
        </para>
          <substeps>
            <step>
              <para>
              Permita el servicio HTTPS para la sesión actual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=https</command>
              </screen>
            </step>
            <step>
              <para>
              Haga que los cambios sean persistentes:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=https</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Inhabilite temporalmente <systemitem>SELinux</systemitem> para probar la configuración.
        </para>
          <substeps>
            <step>
              <para>
              Establezca <systemitem>SELinux</systemitem> en modo permisivo:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 0</command>
              </screen>
            </step>
            <step>
              <para>
              Compruebe el estado de <systemitem>SELinux</systemitem>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Genere e instale módulos de directivas de <systemitem>SELinux</systemitem> locales para los servicios relacionados con PXE.
        </para>
          <substeps>
            <step>
              <para>
              Cree e instale un módulo para <literal>nginx</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'nginx' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'nginx' --raw | audit2allow -a -M local-nginx</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-nginx.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              Cree e instale un módulo para <literal>dnsmasq</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'dnsmasq' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'dnsmasq' --raw | audit2allow -a -M local-dnsmasq</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-dnsmasq.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              Cree e instale un módulo para <literal>in.tftpd</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'in.tftpd' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'in.tftpd' --raw | audit2allow -a -M local-tftpd</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-tftpd.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Vuelva a habilitar el modo de aplicación de <systemitem>SELinux</systemitem>.
        </para>
          <substeps>
            <step>
              <para>
              Establezca <systemitem>SELinux</systemitem> en el modo de aplicación:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 1</command>
              </screen>
            </step>
            <step>
              <para>
              Verifique el estado de <systemitem>SELinux</systemitem>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-firewall-selinux-summary">
      <title>Resumen</title>
      <para>
      Este procedimiento garantiza que la interfaz de red, el firewall y la directiva de <systemitem>SELinux</systemitem> del servidor PXE estén correctamente configurados para un funcionamiento seguro y funcional.
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Se verifica y se asigna la interfaz que proporciona PXE (<filename>eno1</filename> en este ejemplo) a la zona <literal>public</literal> protegida por el firewall.
        </para>
        </listitem>
        <listitem>
          <para>
          Se abren los servicios de firewall necesarios para el funcionamiento de PXE, incluidos <literal>dns</literal>, <literal>ntp</literal>, <literal>dhcp</literal>, <literal>dhcpv6</literal>, <literal>tftp</literal>, <literal>http</literal> y <literal>https</literal>.
        </para>
        </listitem>
        <listitem>
          <para>
          Se establece temporalmente <systemitem>SELinux</systemitem> en modo <literal>permissive</literal> para facilitar las pruebas de servicio y registrar denegaciones de acceso AVC.
        </para>
        </listitem>
        <listitem>
          <para>
          Se usan <command>ausearch</command> y <command>audit2allow</command> para generar e instalar módulos de directivas de SELinux personalizados para servicios como <systemitem>nginx</systemitem>, <systemitem>dnsmasq</systemitem> y <systemitem>in.tftpd</systemitem>.
        </para>
        </listitem>
        <listitem>
          <para>
          Se restablece el modo <systemitem>SELinux</systemitem> a <literal>enforcing</literal> para proteger el sistema para su uso en producción.
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Una vez completados estos pasos, el servidor PXE está configurado de forma segura y listo para proveer equipos cliente a través de la red utilizando IPv4 o IPv6.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-install-components">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Instalación de los componentes necesarios del servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo instalar los paquetes necesarios para permitir el arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, incluidos los componentes GRUB 2, DHCP, TFTP o HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-install-components-intro">
      <title>Introducción</title>
      <para>
      Para configurar un servidor de arranque PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, debe instalar varios servicios y herramientas. Dependiendo de su configuración, es posible que necesite lo siguiente:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>dnsmasq</package> proporciona una combinación de un servidor DNS, un servidor TFTP y un servidor DHCP (DHCPv4 y DHCPv6) con compatibilidad limitada para anuncios de router IPv6. Incluye lo siguiente:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Servidor DHCP dnsmasq: admite la entrega condicional de opciones DHCP dependiendo de la solicitud y la arquitectura del cliente para:
            </para>
              <itemizedlist>
                <listitem>
                  <para>
                  Solicitudes de arranque PXE con DHCPv4 y DHCPv6
                </para>
                </listitem>
                <listitem>
                  <para>
                  Solicitudes de arranque HTTP con DHCPv4
                </para>
                  <note>
                    <title>limitaciones de dnsmasq para el arranque HTTP a través de DHCPv6</title>
                    <para>
                    Actualmente, dnsmasq no admite el envío de la opción DHCPv6 <literal>vendor-class</literal> requerida.
                  </para>
                  </note>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
              Servidor TFTP dnsmasq: entrega archivos de cargador de arranque, de kernel e initrd a través de TFTP durante el arranque PXE.
            </para>
            </listitem>
            <listitem>
              <para>
              Servidor DNS dnsmasq: proporciona resolución recursiva de nombres de dominio y direcciones IP para firmware y <filename>/etc/resolv.conf</filename> de cliente en el instalador/sistema operativo.
            </para>
            </listitem>
            <listitem>
              <para>
              Anuncios de router IPv6 dnsmasq: admite el envío de anuncios de router IPv6 cuando el servidor PXE también actúa como router (configurabilidad limitada a un <quote>patrón común de anuncios de router</quote>).
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          El paquete <package>kea</package> es un servidor DHCP y un sucesor del servidor ISC DHCP. Admite la entrega condicional de opciones DHCP dependiendo de la solicitud y la arquitectura del cliente para:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Solicitudes de arranque PXE con DHCPv4 y DHCPv6
            </para>
            </listitem>
            <listitem>
              <para>
              Solicitudes de arranque HTTP con DHCPv4
            </para>
              <note>
                <title>limitaciones de Kea para el arranque HTTP a través de DHCPv6</title>
                <para>
                Actualmente, Kea no admite el envío de la opción DHCPv6 <literal>vendor-class</literal> requerida. Para obtener más información, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://kea.readthedocs.io/en/latest/arm/dhcp6-srv.html#id4"></link>.
              </para>
              </note>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Un servidor TFTP entrega los archivos del cargador de arranque, el kernel e initrd a través de TFTP, mientras que el arranque PXE con Kea es proporcionado por el paquete <package>tftp</package> y no es necesario para el arranque HTTP. Si está usando <package>dnsmasq</package>, no necesita el paquete <package>tftp</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Un servidor Web como el paquete <package>nginx</package> para proporcionar imágenes del instalador a través de HTTP.
        </para>
          <note>
            <title>necesidad de servidores HTTP</title>
            <para>
            Casi siempre se requiere un servidor HTTP/HTTPS como nginx. Su uso va más allá del arranque HTTP. En particular, puede necesitarlo en las siguientes situaciones:
          </para>
            <itemizedlist>
              <listitem>
                <para>
                Es un requisito básico para el arranque HTTP.
              </para>
              </listitem>
              <listitem>
                <para>
                Se recomienda para proporcionar <filename>squashfs.img</filename>. Puede usar <literal>root=live:tftp://.../squashfs.img</literal> en la línea de comandos de arranque.
              </para>
              </listitem>
              <listitem>
                <para>
                También se recomienda para proporcionar los RPM a Agama en el parámetro de línea de comandos de arranque <literal>inst.install_url=http://.../install/</literal> en una imagen <filename>SLES-16.0-Full-*.inline.iso</filename>, junto con perfiles de instalación y otros archivos para la instalación sin supervisión.
              </para>
              </listitem>
            </itemizedlist>
          </note>
        </listitem>
        <listitem>
          <para>
          Los paquetes del cargador de arranque GRUB 2 proporcionan arranque en red para las arquitecturas y los métodos compatibles. Por ejemplo, la arquitectura AMD64/Intel 64 ofrece dos métodos para el arranque en red: BIOS y UEFI. Además, UEFI generalmente admite PXE (TFTP) y arranque HTTP. Otros cargadores de arranque, como pxelinux, no admiten UEFI ni el arranque HTTP.
        </para>
        </listitem>
        <listitem>
          <para>
          Opcionalmente, un daemon de anuncios de router para IPv6, como el paquete <package>radvd</package>. Se requiere en <phrase><phrase os="sles">SLES</phrase></phrase> si también actúa como router para una red de instaladores a fin de realizar lo siguiente:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configurar el enrutamiento en una red para clientes de arranque PXE o HTTP.
            </para>
            </listitem>
            <listitem>
              <para>
              Habilitar el uso de DHCPv6 en una red para clientes de arranque PXE o HTTP.
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Un sistema que ejecute <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> con privilegios administrativos, registrado en el Centro de servicios al cliente de SUSE y configurado con acceso a los repositorios en línea apropiados mediante SUSEConnect.
        </para>
        </listitem>
        <listitem>
          <para>
          Módulos de SLE habilitados: módulo de aplicaciones de servidor, módulo heredado y módulo del sistema base.
        </para>
        </listitem>
        <listitem>
          <para>
          Acceso a los repositorios del módulo de SLE para servicios de red y cargadores de arranque.
        </para>
        </listitem>
        <listitem>
          <para>
          Conexión a Internet funcional para obtener las imágenes ISO.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-exec">
      <title>Instalación de los paquetes</title>
      <para>
      Siga estos pasos para instalar los paquetes principales necesarios para el servidor de arranque PXE.
    </para>
      <procedure>
        <title>Instalación de los paquetes necesarios para un servidor de arranque PXE</title>
        <step>
          <para>
          Instale el cargador de arranque GRUB 2 y el servidor HTTP nginx como requisitos comunes.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install grub2 nginx</command>
          </screen>
        </step>
        <step>
          <para>
          Ejecute cualquiera de los siguientes comandos para instalar los paquetes esenciales según su enfoque:
        </para>
          <stepalternatives>
            <step>
              <para><package>kea</package> para el servidor DHCP o <package>tftp</package> para el servidor TFTP
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install kea tftp</command>
              </screen>
            </step>
            <step>
              <para><package>dnsmasq</package> como proveedor común de servidores DHCP, DNS y TFTP
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install dnsmasq</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>limitaciones de los servidores DHCP proporcionados por Kea y dnsmasq</title>
            <para>
            El arranque HTTP a través de IPv6 no es compatible <emphasis>actualmente</emphasis> con servidores DHCP proporcionados por los paquetes <package>kea</package> y <package>dnsmasq</package>. No admite el envío de una opción <literal>vendor-class</literal> al cliente HTTP, como requiere la especificación UEFI.
          </para>
          </note>
        </step>
        <step>
          <para>
          Opcionalmente, puede instalar destinos de GRUB 2 específicos para arquitectura adicionales si planea admitir otras plataformas.
        </para>
          <stepalternatives>
            <step>
              <para>
              Para la arquitectura AMD64/Intel 64:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-x86_64-efi grub2-i386-pc</command>
              </screen>
            </step>
            <step>
              <para>
              Para la arquitectura AArch64:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-aarch64-efi</command>
              </screen>
            </step>
            <step>
              <para>
              Para la arquitectura ppc64le:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-ppc64le-ieee1275</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>cómo entrega el servidor PXE paquetes de GRUB 2 a clientes que tienen una arquitectura distinta a la del equipo del servidor</title>
            <para>
            Los paquetes <package>noarch.rpm</package> específicos de cada arquitectura de GRUB 2 se incluyen en el subdirectorio <filename>noarch</filename> del medio o repositorio de instalación, independientemente de la arquitectura del equipo en el que se configure el servidor PXE. Es decir, puede instalar paquetes <package>grub2-arm64-efi</package> y <package>grub2-powerpc-ieee1275</package> en un servidor PXE que se ejecute en un equipo AMD64/Intel 64 para admitir clientes con otras arquitecturas.
          </para>
          </note>
        </step>
        <step>
          <para>
          Opcionalmente, puede instalar el paquete <package>shim</package> si necesita arranque seguro UEFI para AMD64/Intel 64 o AArch64, pero no desea utilizar los archivos de la ISO del medio de instalación.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install shim</command>
          </screen>
        </step>
        <step>
          <para>
          Opcionalmente, puede instalar el daemon de anuncios de router <package>radvd</package> si desea usar el servidor PXE como router (no se recomienda para redes de producción).
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install radvd</command>
          </screen>
        </step>
        <step>
          <para>
          Instale la utilidad <package>rsync</package> para copiar o sincronizar cómodamente la imagen ISO y el árbol de directorios.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install rsync</command>
          </screen>
        </step>
        <step>
          <para>
          Asegúrese de que los servicios están instalados pero aún no se han iniciado. La configuración se tratará en secciones posteriores.
        </para>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Creación de directorios NetBoot de GRUB 2 para el servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta sección explica cómo crear directorios NetBoot de GRUB 2 para servidores PXE mediante <command>grub2-mknetdir</command>, lo que genera directorios específicos de cada arquitectura para sistemas AMD64/Intel 64 (UEFI y BIOS), AArch64 y ppc64le. Para la compatibilidad con el arranque seguro UEFI, los administradores deben copiar los archivos EFI firmados de los medios de instalación o utilizar el paquete <package>shim</package> para sustituir los archivos por defecto del cargador de arranque sin firmar.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-introduction">
      <title>Introducción</title>
      <para>
      En esta sección se describe cómo configurar directorios NetBoot de GRUB 2 para desplegar servidores PXE en varias arquitecturas. El comando <command>grub2-mknetdir</command> crea directorios específicos de arquitectura en <filename>/srv/tftpboot/boot/grub2/</filename> para diferentes plataformas. Por ejemplo, los sistemas AMD64/Intel 64 generan directorios UEFI (<filename>x86_64-efi</filename>) y BIOS heredados (<filename>i386-pc</filename>), mientras que los sistemas AArch64 y ppc64le crean sus respectivos directorios UEFI (<filename>arm64-efi</filename> y <filename>powerpc-ieee1275</filename>).
    </para>
      <para>
      Para la compatibilidad con el arranque seguro UEFI, que los archivos <filename>core.efi</filename> no firmados predeterminados no proporcionan, los administradores pueden copiar archivos EFI firmados desde los medios de instalación o instalar el paquete <package>shim</package> y copiar manualmente los archivos del cargador de arranque necesarios (<filename>shim.efi</filename>, <filename>grub.efi</filename> y <filename>MokManager.efi</filename>) en los directorios de la arquitectura apropiada, lo que asegura una resolución de enlace simbólico adecuada para mantener todos los archivos dentro del sistema de archivos raíz TFTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-requirements">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Asegúrese de haber instalado los siguientes paquetes: <package>grub2</package>, <package>tftp</package> y cualquier otro paquete de GRUB 2 específico de la arquitectura, como <package>grub2-x86_64-efi</package> y <package>grub2-i386-pc</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Asegúrese de tener disponible el medio de instalación (ISO) para el montaje o el paquete <package>shim</package> instalado en el sistema. Puede descargar los medios de instalación (ISO) para su arquitectura de destino desde el Centro de servicios al cliente de SUSE.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-executing">
      <title>Preparación de directorios NetBoot y el arranque seguro UEFI</title>
      <para>
      Este procedimiento crea la estructura de directorios de GRUB 2 necesaria para el arranque de red PXE y, opcionalmente, configura la compatibilidad con el arranque seguro UEFI en varias arquitecturas.
    </para>
      <procedure>
        <step>
          <para>
          Cree una estructura de directorios NetBoot de GRUB 2.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>grub2-mknetdir --net-directory=/srv/tftpboot
--subdir=/boot/grub2</command>
          </screen>
          <para>
          Esto crea directorios específicos para cada arquitectura:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              AMD64/Intel 64: <filename>/srv/tftpboot/boot/grub2/x86_64-efi</filename> y <filename>/srv/tftpboot/boot/grub2/i386-pc </filename>
            </para>
            </listitem>
            <listitem>
              <para>
              AArch64: <filename>/srv/tftpboot/boot/grub2/arm64-efi</filename>
            </para>
            </listitem>
            <listitem>
              <para>
              ppc64le: <filename>/srv/tftpboot/boot/grub2/powerpc-ieee1275</filename>
            </para>
            </listitem>
          </itemizedlist>
          <warning>
            <para>
            No sobrescriba manualmente el archivo <filename>grub.cfg</filename> creado por <command>grub2-mknetdir</command>.
          </para>
          </warning>
        </step>
        <step>
          <para>
          Copie al servidor TFTP otros directorios independientes de la arquitectura, como <filename>fonts/</filename> y <filename>locale/</filename>, que están disponibles en el directorio <filename>/srv/tftpboot/boot/grub2/</filename>.
        </para>
        </step>
        <step>
          <para>
          También puede usar el archivo <filename>/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/core.efi</filename> instalado por el comando <command>grub2-mknetdir</command> para arquitecturas AMD64/Intel 64 o AArch64 para PXE UEFI. Sin embargo, <emphasis>no están firmados</emphasis> y no admiten el arranque seguro UEFI. Para habilitar opcionalmente el arranque seguro UEFI para las arquitecturas compatibles AMD64/Intel 64 y AArch64, realice cualquiera de los siguientes pasos:
        </para>
          <stepalternatives>
            <step>
              <para>
              Copie los archivos necesarios del medio de instalación ISO:
            </para>
              <substeps>
                <step>
                  <para>
                  Monte la imagen ISO:
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>mount -o loop /PATH/TO/SLES.ISO /mnt</command>
                  </screen>
                </step>
                <step>
                  <para>
                  Copie los archivos EFI.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>cp -v /mnt/EFI/BOOT/*.efi
/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/</command>
                    <co xml:id="copy-efi-files"/>
                  </screen>
                  <calloutlist>
                    <callout arearefs="copy-efi-files">
                      <para>
                      Sustituya <filename><replaceable>ARCH</replaceable>-efi</filename> por <filename>x86_64-efi</filename> o <filename>arm64-efi</filename>: las arquitecturas compatibles con el arranque seguro UEFI.
                    </para>
                    </callout>
                  </calloutlist>
                </step>
                <step>
                  <para>
                  Desmonte el medio de instalación ISO.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>umount /mnt</command>
                  </screen>
                </step>
              </substeps>
            </step>
            <step>
              <para>
              Use el paquete <package>shim</package> si no desea utilizar los archivos del medio de instalación ISO:
            </para>
              <substeps>
                <step>
                  <para>
                  Si aún no está instalado, instale el paquete <package>shim</package>.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>zypper install shim</command>
                  </screen>
                </step>
                <step>
                  <para>
                  Copie los archivos del cargador de arranque firmados para la arquitectura necesaria:
                </para>
                  <substeps>
                    <step>
                      <para>
                      Copie el archivo <filename>shim.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para la arquitectura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/shim.efi /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para la arquitectura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/shim.efi /srv/tftpboot/boot/grub2/arm64-efi/bootaa64.efi</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copie el archivo <filename>grub.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para la arquitectura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/grub.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para la arquitectura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/grub.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copie el archivo <filename>MokManager.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para la arquitectura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/MokManager.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para la arquitectura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/MokManager.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                  </substeps>
                  <note>
                    <para>
                    El indicador <literal>-L</literal> resuelve los enlaces simbólicos para garantizar que los archivos permanezcan dentro de la raíz TFTP.
                  </para>
                  </note>
                </step>
              </substeps>
            </step>
          </stepalternatives>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-prepare-installer">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Preparación del contenido de la imagen del instalador</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se describe cómo extraer y organizar los archivos de instalador de los medios de instalación de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> para entornos de arranque PXE. Cubre tanto imágenes <literal>.install.iso</literal> como paquetes RPM, con instrucciones específicas para diferentes arquitecturas y tipos de instalación.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-prepare-installer-intro">
      <title>Introducción</title>
      <para><phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> proporciona archivos de instalador en múltiples formatos para admitir diferentes escenarios de arranque PXE. El instalador Agama requiere tres archivos esenciales: la imagen del kernel (<filename>linux</filename>), el disco RAM inicial (<filename>initrd</filename>) y el sistema de archivos raíz comprimido (<filename>squashfs.img</filename>). Estos archivos deben extraerse del medio de instalación y organizarse en una estructura de directorios a la que se pueda acceder a través de TFTP y HTTP.
    </para>
      <para>
      Esta sección cubre los métodos de preparación tanto para imágenes <literal>.install.iso</literal> como para paquetes RPM, lo que asegura la compatibilidad con varias arquitecturas y tipos de instalación compatibles con <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>Medio de instalación de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, disponible en el Centro de servicios al cliente de SUSE. Elija entre lo siguiente:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              ISO en línea: solo incluye el instalador para instalaciones de red (<filename>SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              ISO completa: el instalador con el repositorio de instalación (<filename>SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              Paquetes RPM: <package>tftpboot-agama-installer-SUSE_SLE_16_PXE-<replaceable>ARCH</replaceable></package>
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Un punto de montaje temporal, como <filename>/mnt</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Espacio en disco suficiente en <filename>/srv/tftpboot</filename> y <filename>/srv/install</filename> para el método de instalación elegido.
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para crear directorios y copiar archivos.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-iso">
      <title>Preparación de archivos de instalador a partir de imágenes ISO</title>
      <para>
      Las imágenes ISO proporcionan un método sencillo para extraer archivos de instalador. Los siguientes procedimientos cubren los métodos de ISO en línea y de ISO completa para diferentes arquitecturas.
    </para>
      <section xml:id="sles-pxe-server-prepare-installer-iso-online">
        <title>Uso de imágenes ISO en línea</title>
        <para>
        Las imágenes ISO en línea contienen solo los componentes del instalador, por lo que se requiere acceso de red a los repositorios de instalación durante la instalación del sistema. Esto se corresponde con la entrada del menú de arranque <literal>SLES-16.0 Online Installation</literal> en GRUB.
       </para>
        <procedure xml:id="proc-prepare-online-iso-x86-aarch64">
          <title>Extracción de archivos de ISO en línea (x86_64 y aarch64)</title>
          <step>
            <para>
            Cree la estructura de directorio para los archivos de instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Monte la imagen ISO en línea:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie los archivos del kernel y de initrd:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie el sistema de archivos raíz comprimido:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte la imagen ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
        <procedure xml:id="proc-prepare-online-iso-ppc64le">
          <title>Extraiga los archivos de la ISO en línea (ppc64le)</title>
          <step>
            <para>
            Cree la estructura de directorio:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Monte la imagen ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-ppc64le-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie los archivos del kernel e initrd (observe que la estructura de la vía es distinta para ppc64le):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/linux /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/initrd /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie el sistema de archivos raíz comprimido:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte la imagen ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-prepare-installer-iso-full">
        <title>Uso de imágenes ISO completas</title>
        <para>
        Las imágenes ISO completas incluyen tanto el instalador como los repositorios de instalación, lo que permite instalaciones locales sin dependencias de red externas. Se corresponde con la entrada del menú de arranque <literal>SLES-16.0 Local Installation</literal> en GRUB con el parámetro <literal>inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch}</literal> adicional.
      </para>
        <procedure xml:id="proc-prepare-full-iso">
          <title>Extracción de archivos de la ISO completa</title>
          <step>
            <para>
            Cree directorios tanto para los archivos de instalador como para el repositorio de instalación:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install/SLES-16.0</command>
            </screen>
          </step>
          <step>
            <para>
            Monte la imagen ISO completa:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie los archivos de kernel y de initrd (ajuste las vías para ppc64le como se muestra en procedimientos anteriores):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie el sistema de archivos raíz comprimido:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie el repositorio de instalación para el acceso local al servidor HTTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>rsync -avP /mnt/install/ /srv/install/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte la imagen ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-rpm">
      <title>Preparación de los archivos de instalador a partir de paquetes RPM</title>
      <para>
      Los paquetes RPM proporcionan un método alternativo para obtener archivos de instalador en línea.
    </para>
      <procedure xml:id="proc-prepare-rpm-packages">
        <title>Instalación y uso de paquetes RPM de tftpboot</title>
        <step>
          <para>
          Instale los paquetes necesarios:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper in tftpboot-agama-installer-SUSE_SLE_16-<replaceable>ARCH</replaceable></command>
          </screen>
        </step>
        <step>
          <para>
          Copie linux, initrd y squashfs.img en tftpboot:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cd
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/linux .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/initrd .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/squashfs.img .</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-dir-structure">
      <title>Estructura de directorios recomendada</title>
      <para>
      Organice los archivos extraídos de acuerdo con el siguiente diseño de directorio para garantizar la consistencia y facilidad de mantenimiento. Esta estructura admite múltiples arquitecturas y tipos de instalación.
    </para>
      <example xml:id="ex-pxe-directory-layout">
        <title>Diseño completo del directorio del servidor PXE</title>
        <screen>/srv/tftpboot/
├── boot/
│   ├── grub2/
│   │   ├── x86_64-efi/
│   │   │   ├── bootx64.efi
│   │   │   └── grub.cfg
│   │   ├── i386-pc/
│   │   │   └── core.0
│   │   ├── arm64-efi/
│   │   │   └── bootaa64.efi
│   │   └── powerpc-ieee1275/
│   │       └── core.elf
│   └── images/
│       └── SLES-16.0/
│           ├── x86_64/
│           │   ├── linux <co xml:id="co-kernel"/>
│           │   ├── initrd <co xml:id="co-initrd"/>
│           │   └── squashfs.img <co xml:id="co-squashfs"/>
│           ├── aarch64/
│           └── ppc64le/
/srv/install/
└── SLES-16.0/
    ├── x86_64/ <co xml:id="co-install-repo"/>
    ├── aarch64/
    └── ppc64le/</screen>
      </example>
      <calloutlist>
        <callout arearefs="co-kernel">
          <para>
          Imagen del kernel extraída del medio de instalación
        </para>
        </callout>
        <callout arearefs="co-initrd">
          <para>
          Imagen de disco RAM inicial
        </para>
        </callout>
        <callout arearefs="co-squashfs">
          <para>
          Sistema de archivos raíz comprimido para el instalador Agama
        </para>
        </callout>
        <callout arearefs="co-install-repo">
          <para>
          Repositorio de instalación desde el directorio <filename>install</filename> de la imagen ISO completa (opcional)
        </para>
        </callout>
      </calloutlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-verify">
      <title>Verificación de la instalación</title>
      <para>
      Después de extraer y organizar los archivos de instalador, compruebe que todos los componentes necesarios están presentes y se puede acceder a ellos.
    </para>
      <procedure xml:id="proc-verify-installer-files">
        <title>Pasos de verificación</title>
        <step>
          <para>
          Compruebe que los archivos esenciales están presentes:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/*</command>
          </screen>
        </step>
        <step>
          <para>
          Asegúrese de que los permisos del archivo sean correctos:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 0755 {} \;</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type f -exec chmod 0644 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>accesibilidad de los archivos</title>
        <para>
        Asegúrese de que los servicios TFTP y HTTP puedan leer todos los archivos extraídos. Los clientes PXE accederán a los archivos durante el proceso de arranque, por lo que para que el despliegue se realice correctamente, es esencial que se disponga de los permisos y la configuración del servicio adecuados.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-next">
      <title>Pasos siguientes</title>
      <para>
      Con los archivos de instalador correctamente preparados y organizados, puede proceder a:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurar GRUB 2 para el arranque PXE con entradas de menú que hagan referencia a estos archivos
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar los servicios HTTP y TFTP para proporcionar el contenido extraído
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar DHCP para dirigir a los clientes PXE a los cargadores de arranque apropiados
        </para>
        </listitem>
      </itemizedlist>
      <para>
      En la configuración de GRUB 2 se hará referencia a los archivos extraídos usando vías como <literal>root=live:http://pxe.example.net/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/squashfs.img</literal>.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-configure-grub2">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de GRUB 2 para el arranque PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se describe cómo configurar el cargador de arranque de GRUB 2 para el arranque basado en PXE en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Cubre la creación de la estructura de directorios de arranque de red, la configuración de cargadores de arranque específicos de arquitectura y la implementación de un sistema de configuración flexible que admite múltiples arquitecturas y escenarios de instalación.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-grub2-intro">
      <title>Introducción</title>
      <para>
      GRUB 2 sirve como cargador de arranque de red para clientes PXE. Carga los archivos de kernel e initrd para iniciar el instalador Agama. Esta sección muestra cómo crear una configuración avanzada de GRUB 2 que detecta automáticamente la arquitectura del cliente, gestiona la selección de la interfaz de red y proporciona un menú de arranque unificado que admite múltiples tipos de instalación y arquitecturas de destino.
    </para>
      <para>
      El enfoque de configuración utiliza un diseño modular con archivos separados para la detección de arquitectura, definiciones de variables y entradas del menú de arranque. Esto permite la compatibilidad con configuraciones específicas del equipo y perfiles de instalación automatizados, manteniendo la coherencia entre las diferentes plataformas de hardware.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Asegúrese de que la estructura del directorio de arranque de red de GRUB 2 está instalada, como se describe en las secciones anteriores.
        </para>
        </listitem>
        <listitem>
          <para>
          Asegúrese de que los archivos de instalador están organizados correctamente como se describe en las secciones anteriores.
        </para>
        </listitem>
        <listitem>
          <para>
          Se deben instalar paquetes GRUB 2 para todas las arquitecturas de destino: <package>grub2-x86_64-efi</package>, <package>grub2-i386-pc</package>, <package>grub2-aarch64-efi</package> y <package>grub2-ppc64le-ieee1275</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          El paquete <package>shim</package> para la compatibilidad con el arranque seguro UEFI (opcional).
        </para>
        </listitem>
        <listitem>
          <para>
          Acceso administrativo a <filename>/srv/tftpboot</filename> o raíz PXE equivalente.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-main-config">
      <title>Creación de la configuración de GRUB 2</title>
      <para>
      El archivo de configuración de GRUB 2 se encarga de tres tareas principales: detectar la arquitectura del cliente, gestionar las interfaces de red y cargar otros archivos de configuración. Este enfoque modular ofrece flexibilidad para diferentes escenarios de despliegue.
    </para>
      <procedure xml:id="proc-create-main-grub-config">
        <title>Configuración del archivo <filename>grub.cfg</filename> principal</title>
        <step>
          <para>
          Cree el archivo de configuración principal de GRUB 2 en <filename>/srv/tftpboot/boot/grub2/grub.cfg</filename>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Architecture detection and mapping
if [ "$grub_cpu" == "i386" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "x86_64" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "arm64" ]; then
  set arch='aarch64'
elif [ "$grub_cpu" == "powerpc" ]; then
  set arch='ppc64le'
fi

if [ "X$arch" == "X" ]; then
  echo "ERROR: No architecture found for ${grub_cpu}"
  exit
else
  echo "Running on $arch CPU architecture"
fi
export arch


# Network interface configuration for PXE-selected NIC
# - dracut based images on SLE-16:
set ipcfg="ifname=pxe0:${net_default_mac} ip=pxe0:dhcp"
export ipcfg
# - linuxrc installer on SLE-15:
set ifcfg="ifcfg=${net_default_mac}=dhcp"
export ifcfg

# Define typical serial console kernel parameter
#set sconsole="console=tty0 console=ttyS0,115200n8"
#export sconsole

# Load machine-specific configuration if available
if [ -s "${config}/${net_default_mac}/grub.cfg" ]; then
  ## Source a host specific configuration of grub menu:
  source "${config}/${net_default_mac}/grub.cfg"
else
  ## Source default grub boot menu:
  source "${prefix}/menu.cfg"
fi
EOF
</screen>
        </step>
      </procedure>
      <variablelist>
        <title>Elementos clave de la configuración</title>
        <varlistentry>
          <term>Detección de arquitectura</term>
          <listitem>
            <para>
            Asigna tipos de CPU de GRUB 2 a arquitecturas de distribución, lo que permite entradas de menú unificadas que funcionan en diferentes plataformas de hardware.
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Gestión de la interfaz de red</term>
          <listitem>
            <para>
            Define una variable <varname>${ipcfg}</varname> que usa la variable <varname>${net_default_mac}</varname> de grub2 para activar dhcp solo en la interfaz de arranque PXE llamada <literal>pxe0</literal>, evitando problemas de sondeo de red en sistemas de varias interfaces.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Definiciones de utilidad</term>
          <listitem>
            <para>
            Define una variable <varname>${sconsole}</varname> típica con parámetros de consola serie.
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Configuración específica del equipo</term>
          <listitem>
            <para>
            Carga archivos de configuración opcionales por equipo basados en la dirección MAC, lo que permite personalizar los parámetros de arranque por equipo y los perfiles de instalación automatizados.
          </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-menu">
      <title>Creación del menú de arranque unificado</title>
      <para>
      El menú de arranque utiliza variables de la configuración principal para proporcionar entradas de menú adaptadas a la arquitectura que se adaptan automáticamente a diferentes plataformas de hardware y tipos de instalación.
    </para>
      <procedure xml:id="proc-create-grub-menu">
        <title>Configuración del archivo menu.cfg</title>
        <step>
          <para>
          Cree el menú de arranque unificado en <filename>/srv/tftpboot/boot/grub2/menu.cfg</filename>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'SLES-16.0 Online Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}

menuentry 'SLES-16.0 Local Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <note>
        <title>flexibilidad de entrada de menú</title>
        <para>
        Las entradas de menú utilizan variables que se rellenan automáticamente en función de la arquitectura y configuración del cliente. La variable <varname>${arch}</varname> garantiza que se carguen los archivos correctos.
       </para>
        <para>
        La variable <varname>${ipcfg}</varname> opcional hace que solo se configure la interfaz de red seleccionada por PXE.
       </para>
        <para>
        La variable <varname>${sconsole}</varname> opcional habilita una consola serie en el sistema instalador.
       </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-machine-specific">
      <title>Configuraciones específicas del equipo</title>
      <para>
      Para despliegues avanzados, puede crear archivos de configuración específicos del equipo que anulen los ajustes predeterminados o proporcionen parámetros de instalación automatizados.
    </para>
      <procedure xml:id="proc-machine-specific-config">
        <title>Creación de una configuración específica del equipo</title>
        <step>
          <para>
          Cree un directorio para configuraciones específicas del equipo:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config</command>
          </screen>
        </step>
        <step>
          <para>
          Para un equipo con una dirección MAC <literal>aa:bb:cc:dd:ee:ff</literal>, cree una configuración específica:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff</command>
          </screen>
        </step>
        <step>
          <para>
          Cree el archivo <filename>grub.cfg</filename> específico del equipo:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
# Machine-specific configuration for aa:bb:cc:dd:ee:ff
set default='SLES-16.0 Full Installation'

# Activate the menu-entry after 5sec timeout
set timeout=5

# Use know predictable network interface name
set ipcfg="ip=eno1:dhcp"

# Set the autoinstall variable for this machine
set autoinstall="inst.auto=http://pxe.example.net/install/profiles/aa:bb:cc:dd:ee:ff/sles16.json"
export autoinstall

# Load the default menu
source "/boot/grub2/menu.cfg"
EOF
</screen>
          <para>
          Como alternativa, puede proporcionar su propia entrada de menú en el archivo <filename>grub.cfg</filename> específico del host (por ejemplo, generada para un intento de arranque específico):
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
set default='SLES-16.0 Auto-Installation'
set timeout=5

menuentry 'SLES-16.0 Auto-Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} inst.auto=http://pxe.example.net/install/profiles/${net_default_mac}/sles16.json ip=eno1:dhcp
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <example xml:id="ex-machine-specific-parameters">
        <title>Parámetros comunes específicos del equipo</title>
        <variablelist>
          <varlistentry>
            <term>
              <varname>default</varname>
            </term>
            <listitem>
              <para>
              Especifica qué entrada de menú se debe arrancar automáticamente.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>timeout</varname>
            </term>
            <listitem>
              <para>
              Establece el tiempo límite del arranque en segundos.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>ipcfg</varname>
            </term>
            <listitem>
              <para>
              Anula la configuración de la interfaz de red para hardware específico.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>autoinstall</varname>
            </term>
            <listitem>
              <para>
              Proporciona URL de perfil de instalación automatizadas específicas del equipo.
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </example>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-verify">
      <title>Verificación de la configuración de GRUB 2</title>
      <para>
      Después de crear los archivos de configuración, compruebe que la configuración sea correcta y que todos los archivos necesarios estén en su lugar.
    </para>
      <procedure xml:id="proc-verify-grub-config">
        <title>Pasos de verificación</title>
        <step>
          <para>
          Compruebe la estructura de directorios de GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>find /srv/tftpboot/boot/grub2 -type f -name "*.cfg" -o -name "*.efi" -o -name "core.*"</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique la sintaxis del archivo de configuración probando las herramientas de GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
          </screen>
        </step>
        <step>
          <para>
          Asegúrese de que los permisos del archivo sean correctos:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>chmod -R 644 /srv/tftpboot/boot/grub2/*.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/grub2 -type d -exec chmod 0755 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>prueba de configuración</title>
        <para>
        Pruebe la configuración de GRUB 2 con clientes PXE reales para garantizar que se detecta la arquitectura y que los menús funcionan de forma adecuada. La variable <varname>${net_default_mac}</varname> solo está disponible en situaciones de arranque de red reales.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-troubleshooting">
      <title>Solución de problemas de configuración de GRUB 2</title>
      <para>
      Aquí se explican los problemas comunes y sus soluciones cuando se trabaja con configuraciones PXE de GRUB 2. Cada problema incluye pasos de diagnóstico y comandos específicos para resolverlo.
    </para>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-arch">
        <title>La detección de la arquitectura falla</title>
        <para>
        Si GRUB 2 no detecta la arquitectura correcta, los clientes pueden arrancar con binarios incorrectos o pueden incluso no cargarse.
      </para>
        <procedure xml:id="proc-debug-arch-detection">
          <title>Depuración de la detección de arquitectura</title>
          <step>
            <para>
            Añada la salida de depuración a la configuración de GRUB 2 para ver los valores detectados:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Debug architecture detection
echo "Detected grub_cpu: ${grub_cpu}"
echo "Mapped arch: ${arch}"
sleep 3
EOF</screen>
          </step>
          <step>
            <para>
            Pruebe la sintaxis de configuración:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Si la asignación de arquitectura está incompleta, extienda la lógica de detección:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/elif \[ "$grub_cpu" == "powerpc" \]/a\\nelif [ "$grub_cpu" == "riscv64" ]; then\n  set arch='\''riscv64'\''\\' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que existen directorios específicos de la arquitectura:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-network">
        <title>No se encuentra la interfaz de red</title>
        <para>
        Es posible que algunas implementaciones de firmware no definan correctamente la variable <varname>${net_default_mac}</varname>, lo que provoca fallos de configuración de red.
      </para>
        <procedure xml:id="proc-debug-network-interface">
          <title>Diagnóstico de problemas de interfaz de red</title>
          <step>
            <para>
            Añada la salida de depuración para comprobar las variables de red:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/set ipcfg=/i\\necho "Default MAC: ${net_default_mac}"\necho "Network variables set"\nsleep 2' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Cree una configuración de red alternativa:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>

# Fallback network configuration if net_default_mac is empty
if [ "X${net_default_mac}" == "X" ]; then
  set ipcfg="ip=dhcp"
  set ifcfg="ifcfg=*=dhcp"
  echo "WARNING: Using fallback network configuration"
  sleep 2
fi
EOF
</screen>
          </step>
          <step>
            <para>
            Pruebe la configuración de red con una interfaz específica:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo 'set ipcfg="ip=eno1:dhcp"' &gt; /srv/tftpboot/boot/config/test-network.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique los nombres de interfaz de red en el sistema de destino:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-file-paths">
        <title>No se encuentran las vías de los archivos</title>
        <para>
        Si las vías son incorrectas, GRUB 2 no puede cargar los archivos de kernel e initrd, lo que provoca fallos de arranque.
      </para>
        <procedure xml:id="proc-debug-file-paths">
          <title>Verificación de la accesibilidad de la ruta de archivo</title>
          <step>
            <para>
            Compruebe si los archivos de instalador se encuentran en las ubicaciones esperadas:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images -name "linux" -o -name "initrd" -o -name "squashfs.img"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique el acceso TFTP a los archivos de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/grub.cfg /tmp/test-grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe el acceso HTTP a los archivos de instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/linux</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe los permisos y la propiedad del archivo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/*/</command>
            </screen>
          </step>
          <step>
            <para>
            Corrija los permisos si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 644 /srv/tftpboot/boot/images/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 755 {} \;</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que los enlaces simbólicos no estén rotos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images/ -type l -exec ls -la {} \;</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-efi">
        <title>Fallo de arranque EFI</title>
        <para>
        Los problemas de EFI y del arranque seguro pueden impedir que el cargador de arranque se inicialice correctamente, o causar fallos de autenticación.
      </para>
        <procedure xml:id="proc-debug-efi-boot">
          <title>Diagnóstico de problemas de arranque EFI</title>
          <step>
            <para>
            Verifique que los archivos de arranque seguro estén presentes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe que los archivos shim (bootx64.efi o shim.efi), grub.efi y MokManager.efi se copien correctamente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>file /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la integridad del archivo EFI:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sha256sum /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe si se puede acceder a los archivos a través de TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-shim.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Para los sistemas aarch64, verifique los archivos EFI ARM64:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/arm64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe que la configuración de DHCP proporcione las vías correctas del cargador de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -n "bootx64.efi\|shim.efi\|bootaa64.efi"
/etc/dnsmasq.d/dhcp.conf /etc/kea/kea-dhcp?.conf /etc/dhcpd?.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Si faltan archivos, vuelva a copiarlos de la ISO montada en /mnt o de los archivos del paquete shim:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -v /mnt/EFI/BOOT/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -pL /usr/share/efi/x86_64/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-menu">
        <title>Las entradas de menú no se cargan</title>
        <para>
        Si GRUB 2 se carga, pero las entradas del menú fallan o muestran errores, el problema a menudo está relacionado con la expansión variable o las referencias de archivos.
      </para>
        <procedure xml:id="proc-debug-menu-entries">
          <title>Solución de problemas de entrada de menú</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración del menú:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Añada la salida de depuración a las entradas del menú:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/linux_kernel.*{images}/i\\necho "Loading: ${images}/SLES-16.0/${arch}/linux"\necho "Architecture: ${arch}"' /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que la expansión variable funcione correctamente:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Debug Variables' {
  echo "arch = ${arch}"
  echo "images = ${images}"
  echo "ipcfg = ${ipcfg}"
  sleep 5
}
EOF
</screen>
          </step>
          <step>
            <para>
            Pruebe con una entrada de menú simplificada:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/simple-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Simple Test' {
  linux /boot/images/SLES-16.0/x86_64/linux
  initrd /boot/images/SLES-16.0/x86_64/initrd
}
EOF
</screen>
          </step>
          <step>
            <para>
            Cargue el menú de prueba temporalmente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/menu.cfg"|source "${prefix}/simple-menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Restaure el menú original después de la prueba:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/simple-menu.cfg"|source "${prefix}/menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-logging">
        <title>Habilitación del registro detallado</title>
        <para>
        Para problemas persistentes, habilite el registro exhaustivo para capturar información detallada sobre el proceso de arranque.
      </para>
        <procedure xml:id="proc-enable-grub-logging">
          <title>Configuración del registro de depuración de GRUB 2</title>
          <step>
            <para>
            Cree una versión de depuración de la configuración principal:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /srv/tftpboot/boot/grub2/grub.cfg /srv/tftpboot/boot/grub2/grub.cfg.backup</command>
            </screen>
          </step>
          <step>
            <para>
            Añada la salida de depuración completa:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug.cfg &lt;&lt; 'EOF'</command>
# Debug configuration for GRUB troubleshooting
set debug=all
set pager=1

echo "=== GRUB Debug Information ==="
echo "grub_cpu: ${grub_cpu}"
echo "grub_platform: ${grub_platform}"
echo "net_default_mac: ${net_default_mac}"
echo "net_default_server: ${net_default_server}"
echo "============================="
sleep 5
EOF
</screen>
          </step>
          <step>
            <para>
            Incluya la configuración de depuración en el archivo principal:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\source "${prefix}/debug.cfg"' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise los registros de TFTP durante los intentos de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u tftp.socket</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise los registros de DHCP para solicitudes de PXE:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Desactive el modo de depuración después de solucionar el problema:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/source "${prefix}\/debug.cfg"/d' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Cuando GRUB 2 se haya configurado correctamente, puede proceder a:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurar los servicios HTTP y TFTP para proporcionar los archivos de arranque y el contenido del instalador
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar los servicios DHCP para dirigir a los clientes PXE a los cargadores de arranque apropiados
        </para>
        </listitem>
        <listitem>
          <para>
          Probar el proceso de arranque PXE completo en el hardware de destino
        </para>
        </listitem>
      </itemizedlist>
      <para>
      El sistema de configuración de GRUB 2 es muy flexible y sirve de base para crear escenarios de despliegue de PXE avanzados, que admitan múltiples arquitecturas y tipos de instalación mediante una interfaz unificada.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-configure-tftp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de TFTP para el arranque PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar los servicios TFTP para que proporcionen contenido de los cargadores de arranque de GRUB 2 y de arranque PXE a las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Trata sobre el servidor <systemitem>in.tftpd</systemitem> tradicional y la funcionalidad de TFTP integrada suministrada por <systemitem>dnsmasq</systemitem>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-tftp-intro">
      <title>Introducción</title>
      <para>
      TFTP proporciona archivos de arranque a clientes PXE durante el proceso de arranque de red. <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> admite dos implementaciones de servidor TFTP: el servidor <systemitem>in.tftpd</systemitem> tradicional del paquete <package>tftp</package> y la funcionalidad TFTP integrada dentro de <systemitem>dnsmasq</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>tftp</package> o el paquete <package>dnsmasq</package> deben estar instalados
        </para>
        </listitem>
        <listitem>
          <para>
          Los archivos de arranque PXE deben estar organizados en <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-intftpd">
      <title>Configuración del servidor in.tftpd</title>
      <para>
      El servidor <systemitem>in.tftpd</systemitem> utiliza el archivo de configuración <filename>/etc/sysconfig/tftp</filename> para definir el sistema de archivos raíz TFTP y las opciones del servidor.
    </para>
      <procedure xml:id="proc-configure-intftpd">
        <title>Configuración del servidor TFTP in.tftpd</title>
        <step>
          <para>
          Opcionalmente, puede habilitar el registro detallado configurando las opciones de TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
          </screen>
          <para>
          La opción <option>-v</option> permite el registro detallado para ver los nombres de archivo obtenidos a través de TFTP.
        </para>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now tftp.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-dnsmasq">
      <title>Configuración del servidor TFTP dnsmasq</title>
      <para><systemitem>dnsmasq</systemitem> proporciona un servidor TFTP integrado que se puede habilitar y configurar para usar el directorio <filename>/srv/tftpboot</filename>.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-tftp">
        <title>Configuración de la funcionalidad TFTP de dnsmasq</title>
        <step>
          <para>
          Cree el archivo de configuración de TFTP:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/tftp.conf &lt;&lt; 'EOF'</command>
enable-tftp
tftp-root=/srv/tftpboot
EOF
</screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-verify">
      <title>Verificación de la configuración de TFTP</title>
      <para>
      Pruebe la funcionalidad del servidor TFTP para asegurarse de que puede proporcionar archivos a clientes PXE.
    </para>
      <procedure xml:id="proc-verify-tftp">
        <title>Prueba de la funcionalidad del servidor TFTP</title>
        <step>
          <para>
          Cree un archivo de prueba:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>echo "test file" | sudo tee /srv/tftpboot/test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Recupere el archivo de prueba a través de TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique que el archivo se ha recuperado correctamente:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Borre los archivos de prueba:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>rm /srv/tftpboot/test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-troubleshooting">
      <title>Solución de problemas de la configuración de TFTP</title>
      <para>
      Estos son los problemas comunes al configurar servicios TFTP para entornos de arranque PXE.
    </para>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-service-conflicts">
        <title>Conflictos de servicio en el puerto 69</title>
        <para>
        Tanto <systemitem>in.tftpd</systemitem> como <systemitem>dnsmasq</systemitem> utilizan el puerto UDP 69 para los servicios TFTP y no pueden ejecutarse simultáneamente.
      </para>
        <procedure xml:id="proc-resolve-tftp-conflicts">
          <title>Resolución de conflictos de servicios TFTP</title>
          <step>
            <para>
            Comprueba qué servicios se están ejecutando:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status tftp.service dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe cuál está usando el puerto 69:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :69</command>
            </screen>
          </step>
          <step>
            <para>
            Detenga el servicio conflictivo (ejemplo para dnsmasq):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Inicie su servicio TFTP preferido:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start tftp.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-directory">
        <title>Problemas con el directorio TFTP</title>
        <para>
        Los problemas de acceso al sistema de archivos raíz TFTP pueden impedir que los archivos se entreguen.
      </para>
        <procedure xml:id="proc-debug-tftp-directory">
          <title>Verificación de la configuración del directorio TFTP</title>
          <step>
            <para>
            Verifique la configuración del directorio TFTP para in.tftpd:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_DIRECTORY /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la configuración del directorio TFTP para dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep tftp-root /etc/dnsmasq.d/tftp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si el directorio existe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/</command>
            </screen>
          </step>
          <step>
            <para>
            Cree la estructura de directorio, si no existe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-verbose">
        <title>Habilitación del registro de TFTP</title>
        <para>
        El registro detallado ayuda a identificar problemas de acceso a archivos con transferencias TFTP.
      </para>
        <procedure xml:id="proc-enable-tftp-verbose">
          <title>Habilitación de un registro detallado de TFTP</title>
          <step>
            <para>
            Compruebe las opciones de TFTP actuales:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_OPTIONS /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite el registro detallado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie el servicio TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart tftp.service</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe los registros de TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.service -f</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con TFTP configurado, puede proceder a configurar los servicios HTTP para proporcionar archivos de instalador y servicios DHCP a fin de dirigir a los clientes PXE a los cargadores de arranque apropiados.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-configure-nginx">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de nginx para la entrega HTTP</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar nginx para proporcionar contenido de arranque PXE a través de HTTP, lo que permite a los clientes cargar archivos de instalador como imágenes de kernel, initrd y squashfs desde una ubicación central. La entrega HTTP proporciona un mejor rendimiento que TFTP para archivos grandes y es necesaria para las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> Agama.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-nginx-intro">
      <title>Introducción</title>
      <para>
      nginx sirve como servidor HTTP para entornos de arranque PXE, proporcionando acceso a archivos de instalador a través de la entrega basada en Web. El servidor HTTP expone el directorio de arranque TFTP y los repositorios de instalación, lo que permite a los clientes PXE descargar imágenes de kernel, archivos initrd y los componentes del instalador Agama a través de HTTP, en lugar de con el protocolo TFTP, que es más lento.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>nginx</package> debe estar instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Archivos de arranque PXE organizados en <filename>/srv/tftpboot/boot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Repositorios de instalación disponibles en <filename>/srv/install</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para modificar la configuración de nginx
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-setup">
      <title>Configuración de nginx para el arranque PXE</title>
      <para>
      La configuración de nginx define los alias de ubicación que exponen el directorio de arranque TFTP y los repositorios de instalación a través de varias URL HTTP.
    </para>
      <procedure xml:id="proc-configure-nginx">
        <title>Configuración del servidor HTTP nginx</title>
        <step>
          <para>
          Edite el archivo de configuración de nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>vim /etc/nginx/nginx.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Configure el bloque del servidor HTTP en la sección <literal>http</literal>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/nginx/nginx.conf &lt;&lt; 'EOF'</command>
http {

    include             mime.types;
    default_type        application/octet-stream;

    charset             utf-8;
    sendfile            on;
    keepalive_timeout   65;

    server {
        listen          80  default_server;
        listen     [::]:80  default_server;

        location / {
            root   /srv/www/htdocs/;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /srv/www/htdocs/;
        }

        # Expose TFTP boot directory for HTTP boot
        location /boot {
            alias      /srv/tftpboot/boot;
            autoindex  on;
        }

        # Expose installation repositories and profiles
        location /install {
            alias      /srv/install;
            autoindex  on;
        }
    }
}

events {
    worker_connections  1024;
}
EOF
</screen>
        </step>
        <step>
          <para>
          Pruebe la sintaxis de configuración de nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>nginx -t</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now nginx.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-verify">
      <title>Verificación de la configuración de nginx</title>
      <para>
      Pruebe la funcionalidad del servidor HTTP para asegurarse de que puede proporcionar archivos de arranque PXE y contenido de instalación a los clientes.
    </para>
      <procedure xml:id="proc-verify-nginx">
        <title>Prueba del servidor HTTP nginx</title>
        <step>
          <para>
          Pruebe el acceso HTTP a los archivos de arranque:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe el acceso al directorio de instalación:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/install/</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe que se pueda acceder a un archivo de instalación específico:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-troubleshooting">
      <title>Solución de problemas de configuración de nginx</title>
      <para>
      Estos son los problemas comunes al configurar nginx para la entrega HTTP de arranque PXE.
    </para>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-config">
        <title>Errores de sintaxis de configuración</title>
        <para>
        Una sintaxis incorrecta de la configuración de nginx puede impedir que el servicio se inicie o se recargue correctamente.
      </para>
        <procedure xml:id="proc-debug-nginx-config">
          <title>Solución de problemas de configuración de nginx</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>nginx -t</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado del servicio nginx si falla el inicio:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de error detallados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u nginx.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el archivo de registro de errores de nginx:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/nginx/error.log</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-permissions">
        <title>Problemas de acceso a archivos y permisos</title>
        <para>
        Puede que nginx no proporcione archivos porque haya permisos incorrectos o falten directorios.
      </para>
        <procedure xml:id="proc-debug-nginx-permissions">
          <title>Solución de problemas de acceso a archivos</title>
          <step>
            <para>
            Compruebe si el directorio de arranque existe y se puede acceder a él:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si existe el directorio install:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/install/</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que nginx pueda leer los directorios:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo -u nginx ls /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            Cree los directorios que falten si es necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install</command>
            </screen>
          </step>
          <step>
            <para>
            Establezca los permisos apropiados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 755 /srv/tftpboot/boot /srv/install</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-port">
        <title>Conflictos de vinculación de puertos</title>
        <para>
        Puede que nginx no se inicie si otro servicio está utilizando el puerto 80.
      </para>
        <procedure xml:id="proc-debug-nginx-port">
          <title>Resolución de conflictos de puerto</title>
          <step>
            <para>
            Compruebe qué servicio está usando el puerto 80:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
          <step>
            <para>
            Detenga los servicios en conflicto si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop apache2</command>
            </screen>
          </step>
          <step>
            <para>
            Inicie el servicio nginx:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que nginx esté escuchando en el puerto 80:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Cuando nginx esté configurado para la entrega HTTP, puede proceder a configurar los servicios DHCP para dirigir a los clientes PXE a los cargadores de arranque y recursos HTTP apropiados.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-configure-dns">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de un servidor DNS con dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar los servicios DNS mediante dnsmasq para proporcionar resolución de nombres de host a los clientes PXE que acceden a los recursos de instalación de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. La configuración de DNS permite a los clientes usar nombres de host en lugar de direcciones IP en las URL de arranque y configuraciones DHCP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-dns-intro">
      <title>Introducción</title>
      <para>
      Los servicios DNS permiten a los clientes PXE resolver nombres de host en las URL de arranque y en orígenes de instalación. Aunque la configuración completa del servidor DNS está fuera del alcance de este documento, esta sección proporciona una configuración DNS básica mediante dnsmasq que permite a los clientes resolver el nombre de host (<replaceable>PXE.EXAMPLE.NET</replaceable>) del servidor PXE a sus direcciones IP.
    </para>
      <para>
      Sin la configuración DNS, las URL de arranque deben usar direcciones IP directamente, como <literal>http://192.168.1.200/</literal> o <literal>http://[2001:db8:0:1::200]/</literal>. Algunas implementaciones de firmware BIOS/UEFI no admiten nombres de host en las URL TFTP DHCP y requieren direcciones IP como <literal>tftp://[2001:db8:0:1::200]/</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-requirements">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>dnsmasq</package> debe estar instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Direcciones IP estáticas configuradas para el servidor PXE
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios DNS
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-setup">
      <title>Configuración de los servicios DNS de dnsmasq</title>
      <para>
      La configuración de DNS de dnsmasq proporciona resolución de nombres de host local y utiliza servidores de nombres ascendentes para consultas externas.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dns">
        <title>Configuración del servidor DNS dnsmasq</title>
        <step>
          <para>
          Cree el archivo de configuración de DNS para dnsmasq:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dns.conf &lt;&lt; 'EOF'</command>
# DNS configuration file for dnsmasq

# Log DNS queries
log-queries

# DNS cache behavior
cache-size=10000
local-ttl=60
neg-ttl=10

# Never forward A or AAAA queries for plain names to upstream name servers
domain-needed

# Add local domain to simple names in /etc/hosts and DHCP
expand-hosts

# Specifies DNS domain and networks including local forward and reverse declarations
domain=<replaceable>EXAMPLE.NET</replaceable>,192.168.1.0/24,local
domain=<replaceable>EXAMPLE.NET</replaceable>,2001:db8:0:1::/64,local
EOF
</screen>
        </step>
        <step>
          <para>
          Añada entradas de nombre de host al archivo de hosts del sistema:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/hosts &lt;&lt; 'EOF'</command>
192.168.1.200 <replaceable>PXE.EXAMPLE.NET</replaceable>
2001:db8:0:1::200 <replaceable>PXE.EXAMPLE.NET</replaceable>
EOF
</screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>comportamiento de reenvío DNS</title>
        <para>
        De forma predeterminada, dnsmasq utiliza los servidores de nombres en <filename>/etc/resolv.conf</filename> como reenviadores y proporciona registros de <filename>/etc/hosts</filename>. Esto permite al servidor PXE resolver nombres de host externos mientras proporciona resolución local para servicios relacionados con PXE.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-verify">
      <title>Verificación de la configuración de DNS</title>
      <para>
      Pruebe la funcionalidad del servidor DNS para garantizar que la resolución de nombres de host funcione para clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dns">
        <title>Prueba de la funcionalidad del servidor DNS</title>
        <step>
          <para>
          Pruebe la resolución de nombres de host IPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe la resolución de nombres de host IPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost | grep 2001:db8</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe la búsqueda DNS inversa para IPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup 192.168.1.200 localhost</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe que el reenvío DNS externo siga funcionando:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup google.com localhost</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-troubleshooting">
      <title>Solución de problemas de configuración de DNS</title>
      <para>
      Estos son los problemas comunes al configurar dnsmasq para servicios DNS en entornos PXE.
    </para>
      <section xml:id="sles-pxe-server-dns-troubleshoot-config">
        <title>Problemas de configuración y servicio</title>
        <para>
        Puede que dnsmasq no se inicie debido a errores de configuración o conflictos de puertos.
      </para>
        <procedure xml:id="proc-debug-dns-config">
          <title>Solución de problemas de configuración de DNS</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado del servicio dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe qué servicio está usando el puerto DNS 53:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :53</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte si hay errores en los registros de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            Detenga los servicios DNS en conflicto si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop systemd-resolved</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-resolution">
        <title>Fallos en la resolución de nombres de host</title>
        <para>
        Las consultas DNS pueden fallar porque la configuración sea incorrecta o porque falten entradas de nombre de host.
      </para>
        <procedure xml:id="proc-debug-dns-resolution">
          <title>Diagnóstico de problemas de resolución de DNS</title>
          <step>
            <para>
            Compruebe si existen entradas de nombre de host en el archivo de hosts:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep <replaceable>PXE.EXAMPLE.NET</replaceable> /etc/hosts</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la configuración del dominio en dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep domain= /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la consulta DNS con salida detallada:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dig @localhost <replaceable>PXE.EXAMPLE.NET</replaceable></command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de consultas de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "query"</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie dnsmasq para volver a cargar la configuración:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-forwarding">
        <title>Problemas de reenvío DNS</title>
        <para>
        Las consultas DNS externas pueden fallar si la configuración del servidor de nombres ascendente es incorrecta.
      </para>
        <procedure xml:id="proc-debug-dns-forwarding">
          <title>Solución de problemas de reenvío DNS</title>
          <step>
            <para>
            Compruebe la configuración del servidor de nombres ascendente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/resolv.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la consulta directa al servidor de nombres ascendente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nslookup google.com 8.8.8.8</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la configuración de reenvío de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "server=|no-resolv" /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Añada un servidor de nombres ascendente específico si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo "server=8.8.8.8" &gt;&gt; /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie el servicio dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los servicios DNS configurados, los clientes PXE ahora pueden resolver nombres de host en las URL de arranque y en orígenes de instalación. Puede proceder a configurar los servicios DHCP que hacen referencia al servidor DNS para la configuración del cliente.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-configure-ntp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de un servidor NTP con <systemitem>chrony</systemitem></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar los servicios NTP mediante <systemitem>chrony</systemitem> para proporcionar una sincronización horaria precisa a los clientes PXE durante las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Sincronizar adecuadamente la hora es esencial para la validación de certificados y el registro del sistema durante las instalaciones basadas en red.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-ntp-intro">
      <title>Introducción</title>
      <para>
      Los servicios NTP garantizan una sincronización de hora precisa en toda la infraestructura de red. Para entornos de arranque PXE, que la hora esté sincronizada es crucial para la validación de certificados durante las conexiones HTTPS, para tener marcas de tiempo de registro adecuadas y en las operaciones coordinadas del sistema. Esta sección proporciona la configuración básica del servidor NTP mediante <systemitem>chrony</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>chrony</package> debe estar instalado
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install chrony</command>
          </screen>
        </listitem>
        <listitem>
          <para>
          Conectividad de red a servidores NTP ascendentes
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios NTP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-setup">
      <title>Configuración del servicio NTP con <systemitem>chrony</systemitem>.</title>
      <para>
      El servicio <systemitem>chrony</systemitem> proporciona funcionalidad NTP con sincronización horaria automática a servidores ascendentes y capacidades de provisión de hora local para clientes de red.
    </para>
      <procedure xml:id="proc-configure-chrony">
        <title>Configuración del servidor TFTP con <systemitem>chrony</systemitem></title>
        <step>
          <para>
          Habilite e inicie el servicio <systemitem>chrony</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now chronyd.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-verify">
      <title>Verificación de la configuración de NTP</title>
      <para>
      Pruebe la funcionalidad del servicio NTP para garantizar que la sincronización horaria funcione correctamente.
    </para>
      <procedure xml:id="proc-verify-ntp">
        <title>Prueba de la funcionalidad del servidor NTP</title>
        <step>
          <para>
          Compruebe el estado del servicio <systemitem>chrony</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd.service</command>
          </screen>
        </step>
        <step>
          <para>
          Consulte el estado de sincronización de hora actual:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc tracking</command>
          </screen>
        </step>
        <step>
          <para>
          Muestre las fuentes NTP configuradas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sources</command>
          </screen>
        </step>
        <step>
          <para>
          Consulte las estadísticas del servidor NTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sourcestats</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-troubleshooting">
      <title>Solución de problemas de configuración de NTP</title>
      <para>
      Estos son los problemas comunes al configurar <systemitem>chrony</systemitem> para servicios NTP en entornos PXE.
    </para>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-service">
        <title>Problemas de inicio del servicio</title>
        <para>El servicio <systemitem>chrony</systemitem> puede no iniciarse debido a errores de configuración o problemas de conectividad de red.
      </para>
        <procedure xml:id="proc-debug-ntp-service">
          <title>Solución de problemas del servicio NTP</title>
          <step>
            <para>
            Compruebe el estado del servicio <systemitem>chrony</systemitem> y los registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status chronyd.service</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de servicio detallados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u chronyd.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la configuración de <systemitem>chrony</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyd -Q</command>
            </screen>
          </step>
          <step>
            <para>
            Si es necesario, reinicie el servicio:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart chronyd.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-sync">
        <title>Fallos de sincronización horaria</title>
        <para>
        La sincronización horaria puede fallar debido a problemas de red o a una configuración incorrecta del servidor.
      </para>
        <procedure xml:id="proc-debug-ntp-sync">
          <title>Diagnóstico de problemas de sincronización horaria</title>
          <step>
            <para>
            Consulte el estado actual de la sincronización:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc tracking</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte la conectividad del origen NTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc sources -v</command>
            </screen>
          </step>
          <step>
            <para>
            Fuerce una sincronización inmediata:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyc makestep</command>
            </screen>
          </step>
          <step>
            <para>
            Compare la hora del sistema con la del reloj de hardware:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>timedatectl status</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la conectividad de red a los servidores NTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc activity</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-firewall">
        <title>Problemas del firewall y la red</title>
        <para>
        El tráfico NTP puede estar bloqueado por reglas del firewall que impidan la sincronización horaria.
      </para>
        <procedure xml:id="proc-debug-ntp-firewall">
          <title>Resolución de problemas de conectividad de red</title>
          <step>
            <para>
            Compruebe si el puerto NTP está abierto en el firewall:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-services | grep ntp</command>
            </screen>
          </step>
          <step>
            <para>
            Añada el servicio NTP al firewall si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --permanent --add-service=ntp</command>
            </screen>
          </step>
          <step>
            <para>
            Vuelva a cargar la configuración del firewall:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --reload</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe manualmente la conectividad NTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ntpdate -q pool.ntp.org</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el uso del puerto <systemitem>chrony</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :123</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los servicios NTP configurados, el servidor PXE y los clientes mantendrán una sincronización horaria precisa. Esto garantiza una validación de certificados adecuada y operaciones coordinadas del sistema durante las instalaciones basadas en la red.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-ipv6-router">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de anuncios de router IPv6</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se describe cómo configurar la funcionalidad de anuncios de router IPv6 para proporcionar anuncios de router adecuados para los clientes PXE. Los anuncios de router IPv6 permiten la configuración de enrutamiento IPv6 y la configuración automática de direcciones DHCPv6 con estado para las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-ipv6-router-intro">
      <title>Introducción</title>
      <para>
      Los anuncios de router IPv6 proporcionan información esencial de configuración de red a los clientes PXE, incluidos el enrutamiento IPv6 y los ajustes de configuración automática de direcciones DHCPv6. En esta sección se presupone que hay un router IPv6 configurado para proporcionar anuncios de router adecuados a fin de configurar el enrutamiento IPv6 a la red y la vía predeterminada, así como para habilitar la configuración automática de direcciones DHCPv6 con estado mediante <literal>AdvManagedFlag on</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>radvd</package> debe estar instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Configuración de red IPv6 en la interfaz de servidor
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar los servicios de anuncios de router
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-setup">
      <title>Configuración de <systemitem>radvd</systemitem> para los anuncios de router IPv6</title>
      <para>
      El servicio <systemitem>radvd</systemitem> proporciona la funcionalidad de anuncios de router IPv6 mediante la configuración definida en <filename>/etc/radvd.conf</filename>.
    </para>
      <procedure xml:id="proc-configure-radvd">
        <title>Configuración de anuncios de router IPv6 con <systemitem>radvd</systemitem></title>
        <step>
          <para>
          Configure el servicio <systemitem>radvd</systemitem>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/radvd.conf &lt;&lt; 'EOF'</command>
interface eno1
{
    # radvd options
    IgnoreIfMissing on;                 # Do not fail and exit when interface is missed
    AdvSendAdvert on;                   # Sending RAs on the interface is not disabled

    # Configuration settings

    AdvManagedFlag on;                  # Request IPv6 address and dns options via DHCPv6
    AdvOtherConfigFlag off;             # Request only dns info via DHCPv6, IP via SLAAC

    AdvDefaultLifetime 1800;            # Add default route via this router for 1800sec

    prefix 2001:db8:0:1::/64            # Add direct route for this local network/prefix
    {
        AdvAutonomous           off;    # Assign IPv6 address via SLAAC
        AdvValidLifetime        7200;
        AdvPreferredLifetime    3600;
    };
};
EOF
</screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio <systemitem>radvd</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now radvd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-verify">
      <title>Verificación de los anuncios de router IPv6</title>
      <para>
      Pruebe la funcionalidad de anuncios de router IPv6 para garantizar una configuración y un funcionamiento adecuados.
    </para>
      <procedure xml:id="proc-verify-radvd">
        <title>Prueba de los anuncios de router IPv6</title>
        <step>
          <para>
          Compruebe el estado del servicio <systemitem>radvd</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
        </step>
        <step>
          <para>
          Revise y verifique la configuración de los anuncios de router IPv6 mediante <command>ravdump</command>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>radvdump</command>
          </screen>
          <para>
          La utilidad <command>radvdump</command> muestra la configuración de anuncios de router de IPv6 enviada por el router IPv6 cada pocos minutos.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-forwarding">
      <title>Configuración de reenvío de IP para la funcionalidad del router</title>
      <para>
      Si el servidor PXE también actúa como router, el reenvío de IP debe estar habilitado para permitir que el sistema funcione con dicho rol.
    </para>
      <procedure xml:id="proc-enable-ip-forwarding">
        <title>Habilitación del reenvío de IP en el servidor PXE</title>
        <step>
          <para>
          Cree el archivo de configuración de red:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/sysctl.d/90-network.conf &lt;&lt; 'EOF'</command>
# This machine is a router
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Accept host autoconf on router uplink
net.ipv6.conf.uplink.accept_ra = 2
EOF
</screen>
        </step>
        <step>
          <para>
          Aplique la configuración de la red:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>asunto a tener en cuenta sobre la configuración del router</title>
        <para>
        Un router no procesa por defecto los anuncios de router IPv6 para la configuración automática del host. Para aceptar los anuncios de router IPv6 en una interfaz de enlace ascendente de router, es preciso el ajuste <literal>accept_ra = 2</literal> de sysctl. Consulte la sección sobre la configuración de la red en la Guía de administración para obtener más detalles sobre la configuración del router, incluidos los ajustes del firewall y otros pasos necesarios.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-troubleshooting">
      <title>Solución de problemas de anuncios de router IPv6</title>
      <para>
      Estos son los problemas comunes al configurar los anuncios de router IPv6 en entornos PXE.
    </para>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-service">
        <title>Problemas del servicio <systemitem>radvd</systemitem></title>
        <para>
        El servicio <systemitem>radvd</systemitem> puede no iniciarse debido a errores de configuración o problemas de la interfaz.
      </para>
        <procedure xml:id="proc-debug-radvd-service">
          <title>Solución de problemas del servicio <systemitem>radvd</systemitem></title>
          <step>
            <para>
            Compruebe el estado del servicio <systemitem>radvd</systemitem> y los registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de servicio detallados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u radvd -f</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la sintaxis de configuración de <systemitem>radvd</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>radvd -C /etc/radvd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si existe la interfaz especificada:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie el servicio después de arreglar la configuración:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart radvd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-forwarding">
        <title>Problemas de configuración de reenvío de IP</title>
        <para>
        Si la configuración de reenvío de IP es incorrecta, el router podría no funcionar de forma adecuada.
      </para>
        <procedure xml:id="proc-debug-ip-forwarding">
          <title>Diagnóstico de problemas de reenvío de IP</title>
          <step>
            <para>
            Compruebe el estado actual del reenvío de IP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv4.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado de reenvío de IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique el archivo de configuración de sysctl:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Si los valores no son correctos, aplique la configuración:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el ajuste accept_ra en la interfaz del enlace ascendente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.uplink.accept_ra</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-ra">
        <title>Problemas de recepción de anuncios de router</title>
        <para>
        Es posible que los clientes no reciban o procesen correctamente los anuncios de router IPv6.
      </para>
        <procedure xml:id="proc-debug-ra-reception">
          <title>Solución de problemas de recepción de anuncios de router</title>
          <step>
            <para>
            Supervise los anuncios de router con <command>ravdump</command>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>radvdump -d</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la configuración de la interfaz IPv6 en los clientes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 addr show</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la tabla de enrutamiento IPv6 en los clientes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 route show</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la conectividad IPv6 al router:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::1</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe las reglas del firewall para ICMPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-protocols | grep ipv6-icmp</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los anuncios de router IPv6 configurados, los clientes PXE pueden recibir una configuración de red IPv6 adecuada. Esto permite la funcionalidad de DHCPv6 y la conectividad IPv6 para instalaciones basadas en red.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-dhcp-dnsmasq">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de un servidor DHCP con dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar los servicios DHCP mediante dnsmasq para proporcionar configuración de red e información de arranque PXE para las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. El servidor DHCP dnsmasq utiliza una configuración basada en etiquetas para admitir clientes PXE IPv4 e IPv6 con capacidades de arranque UEFI y BIOS.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-intro">
      <title>Introducción</title>
      <para>
      El servidor DHCP dnsmasq proporciona configuración de red e información de archivos de arranque a clientes PXE mediante un sistema basado en etiquetas que se corresponden con los tipos de clientes y proporcionan los cargadores de arranque adecuados. Esta configuración admite correspondencias de PXEClient y HTTPClient que funcionan para DHCPv4 y DHCPv6, lo que permite el arranque a través de sistemas UEFI y BIOS en múltiples arquitecturas.
    </para>
      <important>
        <title>limitaciones de HTTPClient en dnsmasq</title>
        <para>
        En dnsmasq 2.90 y versiones anteriores, no se admite el envío de la clase de proveedor option6:16 de vuelta a los clientes DHCPv6 para configuraciones de HTTPClient. Para obtener compatibilidad completa con HTTPClient, plantéese usar los servidores Kea o ISC DHCP.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          El paquete <package>dnsmasq</package> debe estar instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Archivos de arranque PXE correctamente organizados en <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interfaz de red configurada para el servicio DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-setup">
      <title>Configuración de los servicios DHCP con dnsmasq</title>
      <para>
      La configuración de DHCP con dnsmasq incluye la correspondencia del tipo de cliente, los intervalos de red y las asignaciones de archivos de arranque para redes IPv4 e IPv6.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dhcp">
        <title>Configuración del servidor DHCP con dnsmasq</title>
        <step>
          <para>
          Cree el archivo de configuración de DHCP para dnsmasq:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>
# DHCP configuration file for dnsmasq

# Log DHCP processing
log-dhcp

# This is the only DHCP server, don't ignore unknown clients/send NAK
dhcp-authoritative

# Disable re-use of the DHCPv4 servername and filename fields as extra
# option space, which may confuse old or broken clients
dhcp-no-override

# IPv4 PXE/HTTP boot client matches (no enterprise number)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,HTTPClient:Arch:00019

# IPv6 PXE/HTTP boot client matches (enterprise:343 intel)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,enterprise:343,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,enterprise:343,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,enterprise:343,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,enterprise:343,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,enterprise:343,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,enterprise:343,HTTPClient:Arch:00019
EOF
</screen>
        </step>
        <step>
          <para>
          Configure el intervalo y las opciones de DHCP de IPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 range and options
dhcp-range=set:net0v4,192.168.1.100,192.168.1.199,255.255.255.0,1h
dhcp-option=tag:net0v4,option:domain-search,example.net
dhcp-option=tag:net0v4,option:dns-server,192.168.1.200
dhcp-option=tag:net0v4,option:ntp-server,192.168.1.1
dhcp-option=tag:net0v4,option:router,192.168.1.1
EOF
</screen>
        </step>
        <step>
          <para>
          Configure las opciones de arranque PXE de IPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 PXEClient boot
dhcp-boot=tag:net0v4,tag:tftp_bios_x86_pc,/boot/grub2/i386-pc/core.0,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_x86_64,/boot/grub2/x86_64-efi/bootx64.efi,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_ieee_ppc_64,/boot/grub2/powerpc-ieee1275/core.elf,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_arm_64,/boot/grub2/arm64-efi/bootaa64.efi,192.168.1.200

# IPv4 HTTPClient boot
dhcp-option-force=tag:net0v4,tag:http_uefi_x86_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_x86_64,http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option-force=tag:net0v4,tag:http_uefi_arm_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_arm_64,http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi
EOF
</screen>
        </step>
        <step>
          <para>
          Configure el intervalo y las opciones de DHCP de IPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 range and options
dhcp-range=set:net0v6,2001:db8:0:1:d::,2001:db8:0:1:d::ffff,64,1h
dhcp-option=tag:net0v6,option6:domain-search,example.net
dhcp-option=tag:net0v6,option6:dns-server,[2001:db8:0:1::200]
dhcp-option=tag:net0v6,option6:sntp-server,[2001:db8:0:1::1]
EOF
</screen>
        </step>
        <step>
          <para>
          Configure las opciones de arranque PXE de IPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 PXEClient boot
dhcp-option=tag:net0v6,tag:tftp_bios_x86_pc,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0
dhcp-option=tag:net0v6,tag:tftp_uefi_x86_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option=tag:net0v6,tag:tftp_ieee_ppc_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf
dhcp-option=tag:net0v6,tag:tftp_uefi_arm_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi

# IPv6 HTTPClient boot
# Note: dnsmasq &lt;= 2.90 does not support sending vendor-class option6:16 back to client
EOF
</screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-verify">
      <title>Verificación de la configuración de DHCP</title>
      <para>
      Pruebe la funcionalidad del servidor DHCP para garantizar una configuración de red adecuada y la entrega de archivos de arranque a clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-dnsmasq">
        <title>Prueba del servidor DHCP dnsmasq</title>
        <step>
          <para>
          Compruebe el estado del servicio dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique la vinculación de puertos DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep :67</command>
          </screen>
        </step>
        <step>
          <para>
          Supervise las asignaciones de concesión de DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe las concesiones de DHCP activas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshooting">
      <title>Solución de problemas de configuración de DHCP de dnsmasq</title>
      <para>
      Estos son los problemas comunes al configurar dnsmasq para servicios DHCP en entornos PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-service">
        <title>Problemas de inicio y configuración del servicio</title>
        <para>
        Puede que dnsmasq no se inicie debido a errores de configuración o conflictos de puertos con otros servicios DHCP.
      </para>
        <procedure xml:id="proc-debug-dnsmasq-dhcp-service">
          <title>Solución de problemas de servicio DHCP de dnsmasq</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si hay conflictos de puertos DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Detenga los servicios DHCP en conflicto:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de servicio detallados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie dnsmasq después de resolver los conflictos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-leases">
        <title>Problemas de asignación de concesión de DHCP</title>
        <para>
        Puede que los clientes no reciban direcciones IP debido a problemas de configuración del intervalo o la conectividad de la red.
      </para>
        <procedure xml:id="proc-debug-dhcp-leases">
          <title>Diagnóstico de problemas de concesión de DHCP</title>
          <step>
            <para>
            Compruebe la configuración del intervalo de DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-range /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise las solicitudes DHCP en tiempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f | grep DHCP</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado de la interfaz de red:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la configuración autorizada de DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-authoritative /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la respuesta DHCP con dhcping:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-pxe">
        <title>Problemas de entrega de archivos de arranque PXE</title>
        <para>
        Los clientes PXE pueden recibir direcciones IP, pero no pueden arrancar debido a una configuración incorrecta del archivo de arranque o problemas de correspondencia de tipos de cliente.
      </para>
        <procedure xml:id="proc-debug-pxe-boot">
          <title>Solución de problemas de configuración de arranque PXE</title>
          <step>
            <para>
            Compruebe que la clase de proveedor cliente coincida:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-vendorclass /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique las vías del archivo de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-boot /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe el acceso TFTP a los archivos de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de DHCP específicos de PXE:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep -E "PXE|HTTP"</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la asignación de etiquetas en los registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "tags:"</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-ipv6">
        <title>Problemas de configuración de DHCP de IPv6</title>
        <para>
        Los clientes DHCP IPv6 requieren una configuración adecuada de los anuncios de router y pueden tener requisitos de direccionamiento diferentes a IPv4.
      </para>
        <procedure xml:id="proc-debug-ipv6-dhcp">
          <title>Resolución de problemas de DHCP IPv6</title>
          <step>
            <para>
            Verifique la configuración del intervalo de DHCP de IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "2001:db8" /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado de los anuncios de router IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise las solicitudes DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "DHCPv6"</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la conectividad IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la configuración de la opción IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep option6 /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los servicios DHCP de dnsmasq configurados, los clientes PXE pueden recibir la configuración de red y la información del archivo de arranque para entornos IPv4 e IPv6. El sistema basado en etiquetas proporciona una asignación flexible de archivos de arranque basada en la arquitectura del cliente y los requisitos del método de arranque.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-dhcp-kea">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de un servidor DHCP con Kea</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar los servicios DHCP mediante Kea para proporcionar información de configuración de red y arranque PXE para las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Kea es un servidor DHCP moderno que admite tanto IPv4 como IPv6 con correspondencia de clases de clientes para escenarios de arranque PXE y HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-kea-intro">
      <title>Introducción</title>
      <para>
      Kea es el servidor DHCP moderno desarrollado por ISC como sucesor del servidor ISC DHCP heredado. Proporciona una compatibilidad robusta tanto para DHCPv4 como para DHCPv6 con capacidades de clasificación de clientes que permiten la entrega adecuada de archivos de arranque basados en la arquitectura y el método de arranque del cliente. Kea utiliza archivos de configuración basados en JSON y admite funciones avanzadas como la identificación de la clase del proveedor para el arranque HTTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Paquetes DHCP de Kea instalados: <package>kea-dhcp4</package> y <package>kea-dhcp6</package>
        </para>
        </listitem>
        <listitem>
          <para>
          Archivos de arranque PXE correctamente organizados en <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interfaz de red configurada para el servicio DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv4">
      <title>Configuración del servidor DHCPv4 de Kea</title>
      <para>
      La configuración de DHCPv4 de Kea utiliza clases de cliente que se corresponden con los tipos de cliente PXE y HTTP para proporcionar archivos de arranque apropiados para diferentes arquitecturas.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv4">
        <title>Configuración del servidor DHCPv4 de Kea</title>
        <step>
          <para>
          Configure el servidor DHCPv4 de Kea:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp4.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea4-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp4.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 3150,
    "valid-lifetime": 3600,
    "option-data": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00000'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/i386-pc/core.0"
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00007'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/x86_64-efi/bootx64.efi"
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:0000e'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/powerpc-ieee1275/core.elf"
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00011'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/arm64-efi/bootaa64.efi"
      },
      {
        "name": "httpclients#00016",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00016'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      },
      {
        "name": "httpclients#00019",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00019'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      }
    ],
    "subnet4": [
      {
        "id": 1,
        "subnet": "192.168.1.0/24",
        "pools": [
          {
            "pool": "192.168.1.100 - 192.168.1.199"
          }
        ],
        "option-data": [
          {
            "name": "routers",
            "data": "192.168.1.1"
          },
          {
            "name": "ntp-servers",
            "data": "192.168.1.1"
          },
          {
            "name": "domain-name-servers",
            "data": "192.168.1.200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp4",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp4.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Cree el directorio de registro de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /var/log/kea</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de DHCPv4 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio DHCPv4 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp4</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv6">
      <title>Configuración del servidor DHCPv6 de Kea</title>
      <para>
      La configuración de DHCPv6 de Kea proporciona asignación de direcciones IPv6 e información de archivos de arranque mediante la correspondencia con clases de proveedor para diferentes arquitecturas de cliente.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv6">
        <title>Configuración del servidor DHCPv6 de Kea</title>
        <step>
          <para>
          Configure el servidor DHCPv6 de Kea:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp6.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp6": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea6-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp6.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 2880,
    "preferred-lifetime": 3600,
    "valid-lifetime": 7200,
    "option-data": [],
    "option-def": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00000'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0"
          }
        ]
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00007'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi"
          }
        ]
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:0000e'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf"
          }
        ]
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00011'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi"
          }
        ]
      }
    ],
    "subnet6": [
      {
        "id": 1,
        "subnet": "2001:db8:0:1::/64",
        "interface": "eno1",
        "pools": [
          {
            "pool": "2001:db8:0:1:d::/112"
          }
        ],
        "option-data": [
          {
            "name": "sntp-servers",
            "data": "2001:db8:0:1::1"
          },
          {
            "name": "dns-servers",
            "data": "2001:db8:0:1::200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp6.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de DHCPv6 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio DHCPv6 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-verify">
      <title>Verificación de la configuración de DHCP de Kea</title>
      <para>
      Pruebe la funcionalidad del servidor DHCP de Kea para garantizar una configuración de red adecuada y la entrega de archivos de arranque a clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-kea">
        <title>Prueba de los servidores DHCP de Kea</title>
        <step>
          <para>
          Compruebe el estado del servicio DHCPv4 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe el estado del servicio DHCPv6 de Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp6</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique la vinculación de puertos DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          Supervise los registros de DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp4.log</command>
          </screen>
        </step>
        <step>
          <para>
          Supervise los registros de DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp6.log</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe las concesiones de DHCP activas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-troubleshooting">
      <title>Solución de problemas de la configuración de DHCP de Kea</title>
      <para>
      Estos son los problemas comunes al configurar servidores DHCP de Kea para entornos de arranque PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-config">
        <title>Problemas de configuración y servicio</title>
        <para>
        Los servicios de Kea pueden no iniciarse debido a errores de configuración de JSON o a problemas de la interfaz de red.
      </para>
        <procedure xml:id="proc-debug-kea-config">
          <title>Solución de problemas de configuración de Kea</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración de DHCPv4:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la sintaxis de configuración de DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si hay errores de sintaxis de JSON:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>python3 -m json.tool /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la configuración de la interfaz de red:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros del servicio de Kea:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u kea-dhcp4 -f</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-leases">
        <title>Problemas de asignación de concesión de DHCP</title>
        <para>
        Puede que los clientes no reciban direcciones IP debido a problemas de la configuración de subred o por agotamiento del grupo.
      </para>
        <procedure xml:id="proc-debug-kea-leases">
          <title>Diagnóstico de problemas de concesión de Kea</title>
          <step>
            <para>
            Compruebe la configuración de la subred y del grupo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet4\|pools" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise las asignaciones de concesión en tiempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -E "ALLOC|DISCOVER"</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe en la base de datos de concesión si hay conflictos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /var/lib/kea/dhcp4.leases | tail -20</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la vinculación de interfaz:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep interfaces /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Borre la base de datos de concesiones si fuera necesario:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop kea-dhcp4</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mv /var/lib/kea/dhcp4.leases /var/lib/kea/dhcp4.leases.backup</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-pxe">
        <title>Problemas de correspondencia de clase de cliente PXE</title>
        <para>
        Los clientes PXE pueden recibir direcciones IP, pero no pueden obtener los archivos de arranque correctos debido a problemas de configuración de la clase de cliente.
      </para>
        <procedure xml:id="proc-debug-kea-pxe">
          <title>Solución de problemas de la clasificación de clientes de Kea</title>
          <step>
            <para>
            Compruebe las definiciones de clase de cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "client-classes" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte la correspondencia de clases de cliente en los registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -i class</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique los patrones del identificador de clase de proveedor:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "PXEClient\|HTTPClient" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la accesibilidad del archivo de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite el registro de depuración para realizar un análisis detallado del cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/"debuglevel": 0/"debuglevel": 99/' /etc/kea/kea-dhcp4.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-ipv6">
        <title>Problemas específicos de DHCPv6</title>
        <para>
        Los clientes DHCP IPv6 requieren una configuración adecuada de los anuncios de router y gestionan la opción de clase de proveedor de forma diferente a como se hace para IPv4.
      </para>
        <procedure xml:id="proc-debug-kea-ipv6">
          <title>Solución de problemas de DHCPv6 de Kea</title>
          <step>
            <para>
            Compruebe la configuración de la subred DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet6" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el estado de los anuncios de router IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise la correspondencia de clases de proveedores DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp6.log | grep "option\[16\]"</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el formato de la opción bootfile-url de IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la conectividad IPv6 al servidor de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los servicios DHCP de Kea configurados, los clientes PXE pueden recibir información completa de configuración de red y archivos de arranque para entornos IPv4 e IPv6. El sistema de clasificación de clientes proporciona una asignación precisa de archivos de arranque basada en la arquitectura del cliente y admite los métodos de arranque PXE tradicionales y HTTP modernos.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-dhcp-isc">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuración de un servidor DHCP con ISC DHCP</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se explica cómo configurar el servidor ISC DHCP para proporcionar la configuración de red e información de arranque PXE para instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 15. El paquete dhcp-server de ISC ya no está disponible en <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. ISC DHCP utiliza la correspondencia de clases y subclases para admitir escenarios de arranque PXE y HTTP en diferentes arquitecturas de cliente.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-isc-intro">
      <title>Introducción</title>
      <para>
      ISC DHCP es el servidor DHCP tradicional que proporciona configuración de red e información de archivos de arranque a clientes PXE mediante un sistema de clases y subclases. Si bien ISC ha declarado que este servidor llegó al final de su vida útil en 2022, sigue siendo ampliamente utilizado en despliegues existentes y proporciona una compatibilidad sólida para escenarios de arranque PXE y HTTP con identificación de clase de proveedor.
    </para>
      <important>
        <title>estado de final de vida útil de ISC DHCP</title>
        <para>
        Según ISC, ISC DHCP llegó al final de su vida útil en 2022. Para nuevos despliegues, plantéese usar Kea o dnsmasq en su lugar. Esta configuración se proporciona para la compatibilidad con las instalaciones ISC DHCP existentes.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Paquetes de ISC DHCP instalados: <package>dhcp-server</package>
        </para>
        </listitem>
        <listitem>
          <para>
          Archivos de arranque PXE correctamente organizados en <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interfaz de red configurada para el servicio DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilegios administrativos para configurar servicios DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv4">
      <title>Configuración del servidor ISC DHCPv4</title>
      <para>
      La configuración de ISC DHCPv4 usa declaraciones de clase y subclase que se corresponden con los tipos de clientes PXE y HTTP para proporcionar archivos de arranque apropiados para diferentes arquitecturas.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv4">
        <title>Configuración del servidor ISC DHCPv4</title>
        <step>
          <para>
          Configure el servidor ISC DHCPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first read
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
#
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# default lease time
default-lease-time              3600;
max-lease-time                  7200;

##
## PXE / HTTP boot option declarations
##
class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        match substring (option vendor-class-identifier, 0, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        match substring (option vendor-class-identifier, 0, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet 192.168.1.0 netmask 255.255.255.0 {
        authoritative;

        range  dynamic-bootp            192.168.1.100 192.168.1.199;

        option subnet-mask              255.255.255.0;

        option routers                  192.168.1.1;
        option ntp-servers              192.168.1.1;
        option domain-name-servers      192.168.1.200;
        option domain-name              "example.net";
        option domain-search            "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configure la interfaz de DHCP en sysconfig:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD_INTERFACE="eno1"' &gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -t -cf /etc/dhcpd.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio ISC DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv6">
      <title>Configuración del servidor ISC DHCPv6</title>
      <para>
      La configuración de ISC DHCPv6 proporciona asignación de direcciones IPv6 e información de archivos de arranque mediante la correspondencia de clases de proveedores con la gestión adecuada de la opción de DHCPv6.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv6">
        <title>Configuración del servidor ISC DHCPv6</title>
        <step>
          <para>
          Configure el servidor ISC DHCPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd6.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd6.conf
#
# Sample DHCPv6 configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD6_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# IPv6 address valid lifetime
#  (at the end the address is no longer usable by the client)
#  (set to 30 days, the usual IPv6 default)
default-lease-time 7200;

# IPv6 address preferred lifetime
#  (at the end the address is deprecated, i.e., the client should use
#   other addresses for new connections)
#  (set to 7 days, the	usual IPv6 default)
preferred-lifetime 3600;

##
## PXE / HTTP boot option declarations
##

# The dhcp6 option 16 is in fact an:
#   { uint32 enterprise-number, array of { uint16 len, string tag} vendor-class-data }
# this declaration is using the whole option data as string for substring match:
option dhcp6.vendor-class-as-string code 16 = string;

# this declaration is using the enterprise-number with 1st tag length and string:
option dhcp6.vendor-class-en-len-tag code 16 = {integer 32, integer 16, string};

class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        # note: +6 to skip the enterprise-number+len until the PXEClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        # note: +6 to skip the enterprise-number+len until the HTTPClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet6 2001:db8:0:1::/64 {
       authoritative;

       range6  2001:db8:0:1:d:: 2001:db8:0:1:d::ffff;

       option dhcp6.sntp-servers       2001:db8:0:1::1;
       option dhcp6.name-servers       2001:db8:0:1::200;
       option dhcp6.domain-search      "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configure la interfaz de DHCPv6 en sysconfig:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD6_INTERFACE="eno1"' &gt;&gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe la configuración de DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie el servicio ISC DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-verify">
      <title>Verificación de la configuración de ISC DHCP</title>
      <para>
      Pruebe la funcionalidad del servidor ISC DHCP para garantizar una configuración de red adecuada y la entrega de archivos de arranque a clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-isc">
        <title>Prueba de los servidores ISC DHCP</title>
        <step>
          <para>
          Compruebe el estado del servicio ISC DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe el estado del servicio ISC DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd6</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique la vinculación de puertos DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          Consulte los registros de DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
        </step>
        <step>
          <para>
          Compruebe las concesiones de DHCP activas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
        <step>
          <para>
          Supervise la actividad de DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd6 -f</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-troubleshooting">
      <title>Solución de problemas de configuración de ISC DHCP</title>
      <para>
      Estos son los problemas comunes al configurar servidores ISC DHCP para entornos de arranque PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-config">
        <title>Problemas de configuración y servicio</title>
        <para>
        Los servicios ISC DHCP pueden no iniciarse debido a errores de sintaxis de configuración o problemas de vinculación de interfaz.
      </para>
        <procedure xml:id="proc-debug-isc-config">
          <title>Solución de problemas de configuración de ISC DHCP</title>
          <step>
            <para>
            Pruebe la sintaxis de configuración de DHCPv4:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -t -cf /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la sintaxis de configuración de DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la configuración de la interfaz:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysconfig/dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique el estado de la interfaz de red:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe si hay conflictos de puerto:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de servicio detallados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd -xe</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-leases">
        <title>Problemas de asignación de concesión de DHCP</title>
        <para>
        Puede que los clientes no reciban direcciones IP debido a problemas de la configuración de subred o problemas de autorización.
      </para>
        <procedure xml:id="proc-debug-isc-leases">
          <title>Diagnóstico de problemas de concesiones de ISC DHCP</title>
          <step>
            <para>
            Compruebe la configuración de la subred y el intervalo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet\|range" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la configuración autorizada:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep authoritative /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise las asignaciones de concesión en tiempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe en la base de datos de concesiones si hay errores:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -20 /var/lib/dhcp/dhcpd.leases</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe manualmente la respuesta DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200 -h aa:bb:cc:dd:ee:ff</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-classes">
        <title>Problemas de correspondencia de clases y subclases</title>
        <para>
        Los clientes PXE pueden recibir direcciones IP, pero no pueden obtener archivos de arranque correctos debido a problemas de configuración de la correspondencia de clases.
      </para>
        <procedure xml:id="proc-debug-isc-classes">
          <title>Solución de problemas de la correspondencia de clases de ISC DHCP</title>
          <step>
            <para>
            Compruebe las definiciones de clase:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "class.*clients" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique las entradas de subclase:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "subclass" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise la identificación de la clase de proveedor:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep -E "PXEClient|HTTPClient"</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la accesibilidad del archivo de arranque:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite el registro detallado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\log-facility local7;' /etc/dhcpd.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dhcpd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-ipv6">
        <title>Problemas con la opción de clase de proveedor DHCPv6</title>
        <para>
        Los clientes DHCP IPv6 gestionan la opción de clase de proveedor de una forma compleja que puede requerir una configuración específica para proporcionar la compatibilidad adecuada para el arranque PXE.
      </para>
        <procedure xml:id="proc-debug-isc-ipv6">
          <title>Resolución de problemas de ISC DHCPv6</title>
          <step>
            <para>
            Compruebe las definiciones de la opción DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "option dhcp6" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique el análisis de la cadena de clase de proveedor:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "substring.*6.*20\|21" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise la correspondencia de clases de proveedores DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd6 | grep -i vendor</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe el formato bootfile-url de IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique la dependencia de los anuncios de router:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Pruebe la conectividad IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-next-steps">
      <title>Pasos siguientes</title>
      <para>
      Con los servicios ISC DHCP configurados, los clientes PXE pueden recibir la configuración de la red e información de los archivos de arranque utilizando el sistema tradicional de clases y subclases. Si bien ISC DHCP se encuentra al final de su vida útil, esta configuración proporciona compatibilidad para despliegues existentes que requieren funcionalidad de arranque PXE y HTTP en múltiples arquitecturas de cliente.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="es" version="5.2" xml:id="sles-pxe-server-validate">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Validación de la configuración del servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        En esta sección se describe cómo validar y probar la configuración completa del servidor PXE para garantizar que todos los componentes funcionen correctamente para las instalaciones de red de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Cubre la verificación del servicio, las pruebas de conectividad de red y la validación del arranque PXE de extremo a extremo.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-validate-intro">
      <title>Introducción</title>
      <para>
      Después de configurar todos los componentes del servidor PXE, incluidos los servicios de arranque TFTP, HTTP, DNS, DHCP y GRUB 2, es esencial validar que el sistema completo funcione correctamente. Esta validación garantiza que los clientes PXE puedan arrancar correctamente en el instalador Agama y realizar instalaciones basadas en red de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-validate-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Todos los componentes del servidor PXE configurados y en ejecución
        </para>
        </listitem>
        <listitem>
          <para>
          Sistemas cliente de prueba capaces de arrancar PXE
        </para>
        </listitem>
        <listitem>
          <para>
          Conectividad de red entre el servidor PXE y los clientes
        </para>
        </listitem>
        <listitem>
          <para>
          Acceso administrativo para supervisar los servicios del servidor
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-validate-services">
      <title>Validación de los servicios de servidor PXE</title>
      <para>
      Compruebe que todos los servicios esenciales del servidor PXE se están ejecutando y se han configurado correctamente antes de hacer pruebas con los clientes PXE.
    </para>
      <procedure xml:id="proc-validate-services">
        <title>Comprobación del estado del servicio del servidor PXE</title>
        <step>
          <para>
          Verifique el estado del servicio TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status tftp.socket</command>
          </screen>
          <para>
          Resultado esperado: el servicio debe estar activo y a la escucha en el puerto 69.
        </para>
        </step>
        <step>
          <para>
          Compruebe el servicio HTTP de nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status nginx</command>
          </screen>
          <para>
          Resultado esperado: el servicio debe estar activo y a la escucha en el puerto 80.
        </para>
        </step>
        <step>
          <para>
          Verifique el servicio DNS (si usa dnsmasq):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          Resultado esperado: el servicio debe estar activo y a la escucha en el puerto 53.
        </para>
        </step>
        <step>
          <para>
          Compruebe el estado del servicio DHCP (elija el servicio apropiado):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
          <para>
          Para DHCP dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          Para DHCP Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4 kea-dhcp6</command>
          </screen>
          <para>
          Resultado esperado: el servicio DHCP debe estar activo y a la escucha en los puertos apropiados.
        </para>
        </step>
        <step>
          <para>
          Verifique los anuncios de router IPv6 (si están configurados):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
          <para>
          Resultado esperado: el servicio debe estar activo para entornos IPv6.
        </para>
        </step>
        <step>
          <para>
          Compruebe el servicio NTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd</command>
          </screen>
          <para>
          Resultado esperado: el servicio debe estar activo y sincronizado.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-network">
      <title>Prueba de conectividad de red y acceso a archivos</title>
      <para>
      Valide que los clientes PXE puedan acceder a los archivos de arranque y al contenido de instalación a través de la red utilizando los protocolos TFTP y HTTP.
    </para>
      <procedure xml:id="proc-validate-network">
        <title>Prueba de acceso a archivos de red</title>
        <step>
          <para>
          Pruebe el acceso TFTP a los archivos del cargador de arranque:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          Verifique que el archivo se recupera:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>file /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          Borre el archivo de prueba:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>rm /tmp/test-bootx64.efi</command>
          </screen>
        </step>
        <step>
          <para>
          Pruebe el acceso HTTP a la configuración de GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/grub2/grub.cfg</command>
          </screen>
          <para>
          Resultado esperado: respuesta correcta de HTTP 200.
        </para>
        </step>
        <step>
          <para>
          Verifique el acceso HTTP a los archivos de instalador:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
          <para>
          Resultado esperado: respuesta correcta de HTTP 200 con la longitud de contenido adecuada.
        </para>
        </step>
        <step>
          <para>
          Pruebe la resolución DNS (si se ha configurado el DNS local):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup pxe.example.net localhost</command>
          </screen>
          <para>
          Resultado esperado: resolución de registro A y AAAA adecuada.
        </para>
        </step>
        <step>
          <para>
          Verifique la navegación de directorios para ubicaciones de autoíndice:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl http://localhost/boot/</command>
          </screen>
          <para>
          Resultado esperado: listado de directorios que muestra los archivos de arranque.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-dhcp">
      <title>Validación de la funcionalidad de DHCP</title>
      <para>
      Pruebe las respuestas del servidor DHCP y compruebe que se proporciona la información de arranque adecuada a los diferentes tipos de clientes.
    </para>
      <procedure xml:id="proc-validate-dhcp">
        <title>Prueba de las respuestas del servidor DHCP</title>
        <step>
          <para>
          Compruebe la vinculación de puertos DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
          <para>
          Resultado esperado: los servicios DHCP escuchan en los puertos 67 (IPv4) y 547 (IPv6).
        </para>
        </step>
        <step>
          <para>
          Supervise las solicitudes DHCP en tiempo real:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
          <para>
          O para dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
          <para>
          Deje esto funcionando para observar la actividad de DHCP durante las pruebas.
        </para>
        </step>
        <step>
          <para>
          Pruebe la respuesta DHCP usando dhcping (si está disponible):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>dhcping -s 192.168.1.200</command>
          </screen>
          <para>
          Resultado esperado: respuesta DHCP correcta del servidor.
        </para>
        </step>
        <step>
          <para>
          Compruebe las concesiones de DHCP activas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
          <para>
          O para Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
          <para>
          Resultado esperado: entradas de concesión para clientes de prueba.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-pxe-boot">
      <title>Pruebas de arranque PXE de extremo a extremo</title>
      <para>
      Realice pruebas de arranque PXE completas con sistemas cliente reales para validar todo el proceso de arranque desde DHCP hasta el inicio del instalador Agama.
    </para>
      <procedure xml:id="proc-validate-pxe-boot">
        <title>Prueba del proceso de arranque PXE completo</title>
        <step>
          <para>
          Prepare un sistema cliente de prueba:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configure BIOS/UEFI para habilitar el arranque de red.
            </para>
            </listitem>
            <listitem>
              <para>
              Establezca el arranque de red como primera prioridad de arranque.
            </para>
            </listitem>
            <listitem>
              <para>
              Conecte el cliente a la misma red que el servidor PXE.
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Consulte los registros del servidor PXE durante el arranque del cliente:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -f | grep -E "dhcp|tftp|nginx"</command>
          </screen>
        </step>
        <step>
          <para>
          Arranque el cliente de prueba y observe la siguiente secuencia:
        </para>
          <orderedlist>
            <listitem>
              <para>
              El cliente debe recibir la dirección IP a través de DHCP.
            </para>
            </listitem>
            <listitem>
              <para>
              El cliente debe descargar el cargador de arranque a través de TFTP.
            </para>
            </listitem>
            <listitem>
              <para>
              El menú de GRUB 2 debe aparecer con las opciones de instalación.
            </para>
            </listitem>
            <listitem>
              <para>
              El kernel e initrd deben cargarse a través de HTTP.
            </para>
            </listitem>
            <listitem>
              <para>
              El instalador Agama debería iniciarse correctamente.
            </para>
            </listitem>
          </orderedlist>
        </step>
        <step>
          <para>
          Compruebe que la arquitectura del cliente se detecta probando diferentes tipos de cliente:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Sistemas BIOS x86_64 heredados (deberían obtener core.0)
            </para>
            </listitem>
            <listitem>
              <para>
              Sistemas UEFI x86_64 (debería obtener bootx64.efi)
            </para>
            </listitem>
            <listitem>
              <para>
              Sistemas UEFI aarch64 (debería obtener bootaa64.efi)
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Pruebe el arranque PXE IPv6 (si IPv6 está configurado):
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Habilite la configuración de la red solo IPv6 en el cliente de prueba.
            </para>
            </listitem>
            <listitem>
              <para>
              Verifique la asignación de direcciones DHCPv6.
            </para>
            </listitem>
            <listitem>
              <para>
              Confirme la entrega de bootfile-url IPv6.
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-installation">
      <title>Validación de la funcionalidad del instalador Agama</title>
      <para>
      Compruebe que el instalador Agama se inicia correctamente y puede acceder a los orígenes de instalación para completar las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
      <procedure xml:id="proc-validate-agama">
        <title>Pruebas de inicio del instalador Agama</title>
        <step>
          <para>
          Verifique la accesibilidad de la interfaz web de Agama:
        </para>
          <para>
          Durante el arranque del cliente, anote la dirección IP asignada y acceda a:
        </para>
          <screen>http://<replaceable>CLIENT_IP_ADDRESS</replaceable></screen>
          <para>
          Resultado esperado: la interfaz Web de Agama debería cargarse correctamente.
        </para>
        </step>
        <step>
          <para>
          Compruebe los registros del instalador Agama en el cliente:
        </para>
          <para>
          Cambie a la consola (Alt+F2) y ejecute:
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>journalctl -u agama-web-server -f</command>
          </screen>
          <para>
          Resultado esperado: no hay errores críticos en el inicio de Agama.
        </para>
        </step>
        <step>
          <para>
          Verifique la accesibilidad del origen de instalación:
        </para>
          <para>
          Para instalaciones ISO completas, compruebe el acceso al repositorio:
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>curl -I http://192.168.1.200/install/SLES-16.0/x86_64/</command>
          </screen>
          <para>
          Resultado esperado: respuesta correcta de HTTP 200 con listado de directorios.
        </para>
        </step>
        <step>
          <para>
          Pruebe la capacidad de instalación del paquete:
        </para>
          <para>
          En la interfaz de Agama, compruebe que:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              El sistema puede detectar los discos disponibles.
            </para>
            </listitem>
            <listitem>
              <para>
              No se requiere ninguna configuración de red.
            </para>
            </listitem>
            <listitem>
              <para>
              Se puede acceder al repositorio de paquetes.
            </para>
            </listitem>
            <listitem>
              <para>
              La instalación puede continuar hasta su finalización.
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-troubleshooting">
      <title>Solución de problemas de fallos de validación</title>
      <para>
      Estos son los problemas comunes durante la validación del servidor PXE y los pasos para solucionarlos.
    </para>
      <section xml:id="sles-pxe-server-validate-troubleshoot-dhcp">
        <title>Fallos en la asignación de DHCP</title>
        <para>
        Los clientes no reciben direcciones IP durante el arranque PXE.
      </para>
        <procedure xml:id="proc-troubleshoot-dhcp-validation">
          <title>Solución de problemas de validación de DHCP</title>
          <step>
            <para>
            Compruebe si hay conflictos del servicio DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que la interfaz de red esté activa:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la disponibilidad del intervalo de DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nmap -sn 192.168.1.100-199</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte en los registros de DHCP si hay errores:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd | tail -50</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-boot">
        <title>Errores de entrega del archivo de arranque</title>
        <para>
        Los clientes reciben direcciones IP, pero no pueden descargar los archivos de arranque.
      </para>
        <procedure xml:id="proc-troubleshoot-boot-validation">
          <title>Solución de problemas del archivo de arranque</title>
          <step>
            <para>
            Verifique que se puede acceder al servicio TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe los permisos del archivo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte los registros de acceso de TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.socket -f</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que se detecta la arquitectura del cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "PXEClient|HTTPClient" /var/log/messages</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-installer">
        <title>Fallos de inicio del instalador Agama</title>
        <para>
        Los archivos de arranque se cargan correctamente, pero el instalador Agama no se inicia.
      </para>
        <procedure xml:id="proc-troubleshoot-installer-validation">
          <title>Solución de problemas de arranque de Agama</title>
          <step>
            <para>
            Compruebe el acceso HTTP a los archivos de instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la sintaxis del parámetro del kernel en la configuración de GRUB 2:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "root=live:" /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Supervise el proceso de arranque del cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -f | grep -E "kernel|initrd|agama"</command>
            </screen>
          </step>
          <step>
            <para>
            Compruebe la persistencia de la configuración de red:
          </para>
            <screen>
              <prompt role="root"># </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-validate-checklist">
      <title>Lista de verificación para validar el servidor PXE</title>
      <para>
      Utilice esta lista para verificar sistemáticamente todos los aspectos de la configuración de su servidor PXE.
    </para>
      <table xml:id="table-pxe-validation-checklist">
        <title>Lista de verificación para validar el servidor PXE</title>
        <tgroup cols="3">
          <colspec colnum="1" colname="col1" colwidth="30*"/>
          <colspec colnum="2" colname="col2" colwidth="50*"/>
          <colspec colnum="3" colname="col3" colwidth="20*"/>
          <thead>
            <row>
              <entry>Componente</entry>
              <entry>Paso de validación</entry>
              <entry>Estado</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Servicio TFTP</entry>
              <entry>Servicio activo, puerto 69 a la escucha, archivos accesibles</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Servicio HTTP</entry>
              <entry>nginx activo, puerto 80 a la escucha, archivos de instalador accesibles</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Servicio DNS</entry>
              <entry>La resolución de nombres de host funciona, puerto 53 a la escucha</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Servicio DHCP</entry>
              <entry>La asignación de IP funciona, las opciones de arranque se entregan</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Configuración de GRUB 2</entry>
              <entry>El menú se carga, la detección de arquitectura funciona</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Compatibilidad con IPv6</entry>
              <entry>Anuncios de router activos, DHCPv6 funciona</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Arranque PXE</entry>
              <entry>El cliente arranca correctamente, recibe el cargador de arranque correcto</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Instalador Agama</entry>
              <entry>El instalador se inicia, interfaz web accesible</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Origen de la instalación</entry>
              <entry>Repositorio accesible, paquetes instalables</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Persistencia de la red</entry>
              <entry>La configuración de red se mantiene durante la instalación</entry>
              <entry>☐</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section xml:id="sles-pxe-server-validate-conclusion">
      <title>Conclusión de la validación</title>
      <para>
      Un servidor PXE debidamente validado debe demostrar una funcionalidad completa y correcta desde el arranque de la red del cliente hasta el inicio del instalador Agama. Todos los servicios deben funcionar sin errores y los clientes deben poder completar las instalaciones de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> a través de la red. Las pruebas de validación periódicas garantizan la fiabilidad continua de la infraestructura PXE para implementaciones automatizadas.
    </para>
    </section>
  </section>
  <section version="5.2" xml:id="legal-disclaimer">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">Información legal</title>
    </info>
    <para> Copyright© 2006–<?dbtimestamp format="Y"?> SUSE LLC y colaboradores. Reservados todos los derechos. </para>
    <para>
    Está permitido copiar, distribuir y modificar este documento según los términos de la licencia de documentación gratuita GNU, versión 1.2 o (según su criterio) versión 1.3. Esta información de copyright y licencia deberán permanecer inalterados. En la sección titulada <quote>GNU Free Documentation License</quote> (Licencia de documentación gratuita GNU) se incluye una copia de la versión 1.2 de la licencia.
  </para>
    <para>
    Para obtener información sobre las marcas comerciales de SUSE, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.suse.com/company/legal/"></link>. Todas las marcas comerciales de otros fabricantes son propiedad de sus respectivas empresas. Los símbolos de marcas comerciales (®, ™, etc.) indican marcas comerciales de SUSE y sus filiales. Los asteriscos (*) indican marcas comerciales de otros fabricantes.
  </para>
    <para>
    Toda la información recogida en esta publicación se ha compilado prestando toda la atención posible al más mínimo detalle. Sin embargo, esto no garantiza una precisión total. Ni SUSE LLC, ni sus filiales, ni los autores o traductores serán responsables de los posibles errores o las consecuencias que de ellos pudieran derivarse.
  </para>
  </section>
  <appendix xmlns:its="http://www.w3.org/2005/11/its" version="5.2" role="legal" its:translate="no" xml:id="doc-gfdl-license">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">GNU Free Documentation License</title>
    </info>
    <para>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </para>
    <bridgehead renderas="sect4">
    0. PREAMBLE
  </bridgehead>
    <para>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </para>
    <para>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </para>
    <para>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </para>
    <bridgehead renderas="sect4">
    1. APPLICABILITY AND DEFINITIONS
  </bridgehead>
    <para>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </para>
    <para>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </para>
    <para>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </para>
    <para>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </para>
    <para>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </para>
    <para>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </para>
    <para>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </para>
    <para>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </para>
    <para>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </para>
    <para>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </para>
    <bridgehead renderas="sect4">
    2. VERBATIM COPYING
  </bridgehead>
    <para>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </para>
    <para>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </para>
    <bridgehead renderas="sect4">
    3. COPYING IN QUANTITY
  </bridgehead>
    <para>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </para>
    <para>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </para>
    <para>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </para>
    <para>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </para>
    <bridgehead renderas="sect4">
    4. MODIFICATIONS
  </bridgehead>
    <para>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </para>
    <orderedlist numeration="upperalpha" spacing="normal">
      <listitem>
        <para>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </para>
      </listitem>
      <listitem>
        <para>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the copyright notices of the Document.
   </para>
      </listitem>
      <listitem>
        <para>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </para>
      </listitem>
      <listitem>
        <para>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </para>
      </listitem>
      <listitem>
        <para>
    Include an unaltered copy of this License.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </para>
      </listitem>
      <listitem>
        <para>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </para>
      </listitem>
      <listitem>
        <para>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve any Warranty Disclaimers.
   </para>
      </listitem>
    </orderedlist>
    <para>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </para>
    <para>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </para>
    <para>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </para>
    <para>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </para>
    <bridgehead renderas="sect4">
    5. COMBINING DOCUMENTS
  </bridgehead>
    <para>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </para>
    <para>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </para>
    <para>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </para>
    <bridgehead renderas="sect4">
    6. COLLECTIONS OF DOCUMENTS
  </bridgehead>
    <para>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </para>
    <para>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </para>
    <bridgehead renderas="sect4">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </bridgehead>
    <para>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </para>
    <para>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </para>
    <bridgehead renderas="sect4">
    8. TRANSLATION
  </bridgehead>
    <para>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </para>
    <para>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </para>
    <bridgehead renderas="sect4">
    9. TERMINATION
  </bridgehead>
    <para>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </para>
    <bridgehead renderas="sect4">
    10. FUTURE REVISIONS OF THIS LICENSE
  </bridgehead>
    <para>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.gnu.org/copyleft/"></link>.
 </para>
    <para>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </para>
    <bridgehead renderas="sect4">
    ADDENDUM: How to use this License for your documents
  </bridgehead>
    <screen>Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</screen>
    <para>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the &#x201C;with...Texts.&#x201D; line with this:
 </para>
    <screen>with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</screen>
    <para>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </para>
    <para>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
</para>
  </appendix>
</article>
