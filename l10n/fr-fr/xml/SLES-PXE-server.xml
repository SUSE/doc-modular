<?xml version="1.0"?>
<article xmlns="http://docbook.org/ns/docbook" version="5.2" xml:id="sles-pxe-server-setup" xml:lang="fr">
  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">Configuration d'un serveur de démarrage PXE sous <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
    <revhistory xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="rh-sles-pxe-server-setup">
      <revision>
        <date>2025-11-04</date>
        <revdescription>
          <para>
              Version initiale
            </para>
        </revdescription>
      </revision>
    </revhistory>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="architecture">
      <phrase>AMD64/Intel 64</phrase>
      <phrase>AArch64</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="productname" its:translate="no">
      <productname version="16.0">
        <phrase>
          <phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase>
        </phrase>
      </productname>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="title" its:translate="yes">Configuration d'un serveur de démarrage PXE sous <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="description" its:translate="yes">Procédure de configuration d'un serveur de démarrage PXE à l'aide de GRUB 2, nginx et les images du programme d'installation Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="social-descr" its:translate="yes">Configurer un serveur de démarrage PXE avec GRUB 2 et Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="category" its:translate="no">
      <phrase>Deployment &amp; Upgrade</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="task" its:translate="no">
      <phrase>Configuration</phrase>
      <phrase>Installation</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="series" its:translate="no">Products &amp; Solutions</meta>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <dm:bugtracker>
        <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
        <dm:component>Documentation</dm:component>
        <dm:product>SUSE Linux Enterprise Server 16.0</dm:product>
        <dm:assignee>souvik.sarkar@suse.com</dm:assignee>
      </dm:bugtracker>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <variablelist>
        <varlistentry>
          <term>CONTENU</term>
          <listitem>
            <para>
                Configurez un serveur de démarrage PXE prenant en charge UEFI Secure Boot et le programme d'installation Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>MOTIF</term>
          <listitem>
            <para>
                Automatisez et rationalisez l'installation de plusieurs instances <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> sur le réseau.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>EFFORT</term>
          <listitem>
            <para>
                Pour un administrateur de système ou de réseau, la lecture et la compréhension de cet article prennent généralement 30 à 45 minutes.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>OBJECTIF</term>
          <listitem>
            <para>
                Disposer d'un serveur PXE fonctionnel qui peut démarrer plusieurs architectures dans le programme d'installation Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>CONDITIONS REQUISES</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>
                    Un système <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> doté de privilèges administratifs
                  </para>
              </listitem>
              <listitem>
                <para>
                    Une connexion Internet pour récupérer les images ISO
                  </para>
              </listitem>
              <listitem>
                <para>
                    Une configuration IP statique pour le serveur PXE
                  </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </abstract>
  </info>
  <section role="concept" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-introduction">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Présentation du démarrage PXE avec <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Le démarrage PXE permet aux machines de se lancer sur le réseau dans un environnement d'installation ou d'exécution sans stockage local. Cette section explique le fonctionnement de PXE dans le programme d'installation Agama de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> et les images dynamiques de ce programme d'installation, en mettant l'accent sur GRUB 2.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-what-is">
      <title>Qu'est-ce que le démarrage PXE ?</title>
      <para>
      PXE (Preboot Execution Environment) est une méthode qui permet aux systèmes de récupérer les chargeurs de démarrage et les programmes d'installation de système d'exploitation à partir d'un serveur réseau en utilisant DHCP et TFTP ou HTTP. Elle est largement utilisée pour provisionner des machines sans support physique ni système d'exploitation préinstallé.
    </para>
    </section>
    <section xml:id="sles-pxe-server-benefits">
      <title>Avantages du démarrage PXE</title>
      <para>
      Le démarrage PXE simplifie l'approvisionnement en supprimant la nécessité d'un support d'installation local ou d'une configuration manuelle. Il offre les avantages suivants :
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Installation sans surveillance de nombreux systèmes sur le réseau
        </para>
        </listitem>
        <listitem>
          <para>
          Gestion centralisée des versions du programme d'installation et des configurations de démarrage
        </para>
        </listitem>
        <listitem>
          <para>
          Prise en charge de divers types d'architectures et de microprogrammes, y compris UEFI Secure Boot
        </para>
        </listitem>
        <listitem>
          <para>
          Sélection dynamique des programmes d'installation ou des paramètres d'installation à l'aide des menus GRUB 2
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-how-it-works">
      <title>Fonctionnement du démarrage PXE dans <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></title>
      <para>
      Le démarrage PXE dans <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> utilise GRUB 2 comme chargeur de démarrage et le programme d'installation Agama comme interface d'installation. Les chargeurs de démarrage et les fichiers du programme d'installation sont fournis sur le réseau à l'aide de HTTP ou TFTP, GRUB 2 récupérant le kernel Linux, l'unité RAM initiale (initrd) et l'image dynamique. Les clients PXE peuvent utiliser une variété de microprogrammes (notamment les plus courants tels que BIOS ou UEFI), d'exécutables de chargeur de démarrage ou de formats d'image, en fonction de leur architecture, par exemple AMD64/Intel 64, AArch64, ppc64le et s390x. En outre, ils doivent fonctionner à la fois sur les réseaux IPv4 et IPv6.
    </para>
      <para>
      Le chargeur de démarrage transmet les paramètres du kernel Linux, tels que <literal>root=live:</literal>, pour charger le système de fichiers racine basé sur squashfs à partir d'une image ISO dynamique, en démarrant l'interface Agama soit localement, soit en tant que service Web pour une interface utilisateur Web distante.
    </para>
      <section xml:id="sles-pxe-server-backward-compatibility-with-sle-15">
        <title>Compatibilité avec les versions précédentes <phrase><phrase os="sles">SLES</phrase></phrase> 15.x</title>
        <para>
        Les informations contenues dans cet article s'appliquent principalement à <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 16.0 et versions ultérieures. Il se concentre sur les flux de travail de démarrage PXE qui s'intègrent au programme d'installation Agama et s'appuient sur des images d'installation dynamiques. Dans le contexte et la portée de cet article, <phrase><phrase os="sles">SLES</phrase></phrase> 16.0 et les versions ultérieures diffèrent de <phrase><phrase os="sles">SLES</phrase></phrase> 15.x comme suit :
      </para>
        <variablelist>
          <varlistentry>
            <term>Programme d'installation</term>
            <listitem>
              <para>
              Utilise <literal>dracut</literal> et Agama au lieu de <literal>linuxrc</literal> et YaST.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Serveur DHCP</term>
            <listitem>
              <para>
              L'utilisation de DHCP ISC est abandonnée (fin de service 2022). Pour un serveur DHCP, utilisez plutôt Kea ou dnsmasq.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Paramètres de démarrage</term>
            <listitem>
              <para>
              Utilise le paramètre <literal>root=live:</literal> pour charger l'image du programme d'installation Agama et le paramètre facultatif <literal>inst.install_url=</literal> pour le dépôt d'installation non par défaut, au lieu du paramètre <literal>install=</literal>.
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>
        Le choix du chargeur de démarrage (GRUB 2, pxelinux, etc.) reste flexible et ne dépend pas de la version.
      </para>
      </section>
      <section xml:id="sles-pxe-server-different-possible-setups">
        <title>Différentes configurations et étapes possibles</title>
        <para>
        Cet article présente les étapes de configuration obligatoires et les configurations facultatives ou alternatives. Ne suivez que les sections pertinentes pour votre déploiement et ignorez les alternatives qui ne s'appliquent pas à votre déploiement.
      </para>
        <variablelist>
          <varlistentry>
            <term>Obligatoire</term>
            <listitem>
              <para>
              Les tâches telles que l'installation des composants, la préparation de l'image du programme d'installation, la configuration de GRUB 2 et la validation du serveur doivent être effectuées dans toutes les configurations.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Méthode de distribution des fichiers</term>
            <listitem>
              <para>
              Un serveur HTTP (recommandé avec Agama) comme <literal>nginx</literal> et/ou un serveur TFTP comme <literal>tftp</literal> ou <literal>dnsmasq</literal>.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Serveur DHCP</term>
            <listitem>
              <para>
              Choisissez Kea ou dnsmasq.
            </para>
              <note>
                <title>limites et caractéristiques de la méthode choisie</title>
                <itemizedlist>
                  <listitem>
                    <para>
                    Utilisez <emphasis role="strong">Kea</emphasis>, le nouveau serveur DHCP d'ISC, comme remplacement moderne de DHCP ISC. Pour plus d'informations sur Kea, reportez-vous au document <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/kea/"/>. Pour l'avis de fin de service de DHCP ISC, reportez-vous au document <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/dhcp/"/>. Kea est un serveur DHCP et nécessite un logiciel de serveur TFTP séparé. Le serveur DHCP Kea prend en charge les options de démarrage TFTP/PXE via IPv4 et IPv6 ainsi que le démarrage HTTP via IPv4. Le démarrage HTTP via IPv6 nécessite que le serveur DHCPv6 puisse renvoyer au client la valeur <literal>Vendor Class Option</literal> (voir <literal>RFC3315, Section 22.16</literal>), censée être utilisée <quote>par un client pour identifier le fournisseur,</quote> et n'est actuellement pas pris en charge.
                  </para>
                  </listitem>
                  <listitem>
                    <para><emphasis role="strong">dnsmasq</emphasis> en tant que combinaison d'un serveur DNS, d'un serveur DHCP et d'un serveur TFTP. Vous pouvez l'utiliser pour servir le chargeur de démarrage, le kernel Linux, l'unité RAM initiale (et d'autres fichiers) via TFTP. Pour plus d'informations sur dnsmasq, reportez-vous au document <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://thekelleys.org.uk/dnsmasq/doc.html"/>. Le serveur DHCP dnsmasq prend en charge les options de démarrage TFTP/PXE via IPv4 et IPv6 ainsi que le démarrage HTTP via IPv4. Le démarrage HTTP via IPv6 nécessite que le serveur DHCPv6 puisse renvoyer au client la valeur <literal>Vendor Class Option</literal> (voir <literal>RFC3315, Section 22.16</literal>), censée être utilisée <quote>par un client pour identifier le fournisseur,</quote> et n'est actuellement pas pris en charge.
                  </para>
                  </listitem>
                </itemizedlist>
              </note>
            </listitem>
          </varlistentry>
        </variablelist>
        <figure xml:id="sles-pxe-server-setup-workflow">
          <title>Exemple de flux de travail pour la configuration d'un serveur PXE</title>
          <mediaobject>
            <imageobject role="html">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg"/>
            </imageobject>
            <imageobject role="fo">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg" width="85%"/>
            </imageobject>
            <textobject role="description">
              <phrase>Diagramme de flux de travail pour la mise en place d'un serveur de démarrage PXE</phrase>
            </textobject>
          </mediaobject>
        </figure>
      </section>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-prepare-network">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Préparation du réseau pour les services de démarrage PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Ce module décrit les exigences en matière d'infrastructure réseau pour le déploiement des services de démarrage PXE sur <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-network-configuration-introduction">
      <title>Introduction</title>
      <para>
      Un serveur PXE comprend trois serveurs : un serveur DHCP qui fournit l'adresse et l'emplacement du fichier de démarrage (chargeur de démarrage) et un serveur TFTP et/ou HTTP pour récupérer les fichiers. En outre, il peut y avoir un serveur DNS, un serveur NTP et un routeur prenant en charge IPv6 ; ceux-ci sont généralement séparés du serveur PXE dans un réseau de production. Un serveur PXE exécutant <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> peut également nécessiter une configuration spécifique de l'interface réseau, l'ajout de certaines règles persistantes au pare-feu et certaines autorisations dans <systemitem>SELinux</systemitem>. Cette section présente un exemple de réseau avec des plages d'adresses IP appropriées et les règles nécessaires pour le pare-feu et SELinux.
    </para>
    </section>
    <section xml:id="sles-pxe-server-network-configuration">
      <title>Hypothèses et exemple de configuration du réseau</title>
      <para>
      Dans cet article, nous partons des hypothèses suivantes :
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Le serveur PXE est en cours d'exécution sur l'interface réseau <literal>eno1</literal> avec la configuration réseau suivante :
        </para>
          <table frame="all">
            <title>Exemple de configuration de réseau PXE</title>
            <tgroup cols="4">
              <colspec colname="c1"/>
              <colspec colname="c2"/>
              <colspec colname="c3"/>
              <colspec colname="c4"/>
              <thead>
                <row>
                  <entry/>
                  <entry>IPv4</entry>
                  <entry>IPv6</entry>
                  <entry>Nom DNS</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>Réseau PXE</entry>
                  <entry>192.168.1.0/24</entry>
                  <entry>2001:db8:0:1::/64</entry>
                  <entry>example.net</entry>
                </row>
                <row>
                  <entry>Serveur PXE</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry>pxe.example.net</entry>
                </row>
                <row>
                  <entry>Passerelle PXE</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Serveur DNS</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Serveur NTP</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
              </tbody>
            </tgroup>
          </table>
        </listitem>
        <listitem>
          <para>
          Par défaut, les serveurs routeur, NTP et DNS sont externes et s'exécutent sur une autre machine. Cet article fournit quelques conseils, mais ne couvre pas leur configuration complète.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-firewall-selinux">
      <title>Configuration de l'interface réseau, du pare-feu et de <systemitem>SELinux</systemitem> pour les services PXE</title>
      <para>
      Configurez l'interface réseau et le pare-feu pour autoriser les services réseau requis par le serveur PXE. Ajustez les paramètres <systemitem>SELinux</systemitem> pour permettre les tests d'installation et définir des stratégies locales persistantes.
    </para>
      <procedure>
        <step>
          <para>
          Vérifiez l'interface réseau PXE et assignez-la à la zone firewalld appropriée.
        </para>
          <substeps>
            <step>
              <para>
              Vérifiez les zones actuellement actives et les interfaces qui leur sont assignées :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --get-active-zones</command></screen>
            </step>
            <step>
              <para>
              Si <literal>eno1</literal> n'est pas assigné à la zone <literal>public</literal>, faites-le :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --change-interface=eno1</command></screen>
            </step>
            <step>
              <para>
              Faites en sorte que l'assignation de l'interface persiste après les redémarrages :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-interface=eno1</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service DNS.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service DNS pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=dns</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=dns</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service NTP.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service NTP pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=ntp</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=ntp</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service DHCP (IPv4).
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service DHCP pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=dhcp</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=dhcp</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service DHCPv6.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service DHCPv6 pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=dhcpv6</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=dhcpv6</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service TFTP.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service TFTP pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=tftp</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=tftp</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service HTTP.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service HTTP pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=http</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=http</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configurez le pare-feu pour l'accès au service HTTPS.
        </para>
          <substeps>
            <step>
              <para>
              Autorisez le service HTTPS pour la session en cours :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --zone=public --add-service=https</command></screen>
            </step>
            <step>
              <para>
              Rendez la modification permanente :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --zone=public --add-service=https</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Désactivez temporairement <systemitem>SELinux</systemitem> pour les tests de configuration.
        </para>
          <substeps>
            <step>
              <para>
              Définissez <systemitem>SELinux</systemitem> sur le mode permissif :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>setenforce 0</command></screen>
            </step>
            <step>
              <para>
              Vérifiez le statut de <systemitem>SELinux</systemitem> :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>sestatus</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Générez et installez des modules de stratégie <systemitem>SELinux</systemitem> locaux pour les services liés à PXE.
        </para>
          <substeps>
            <step>
              <para>
              Créez et installez un module pour <literal>nginx</literal> :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>if test `ausearch -c 'nginx' --raw | wc -l` -gt 0 ; then</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  ausearch -c 'nginx' --raw | audit2allow -a -M local-nginx</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  semodule -i local-nginx.pp</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>fi</command></screen>
            </step>
            <step>
              <para>
              Créez et installez un module pour <literal>dnsmasq</literal> :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>if test `ausearch -c 'dnsmasq' --raw | wc -l` -gt 0 ; then</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  ausearch -c 'dnsmasq' --raw | audit2allow -a -M local-dnsmasq</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  semodule -i local-dnsmasq.pp</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>fi</command></screen>
            </step>
            <step>
              <para>
              Créez et installez un module pour <literal>in.tftpd</literal> :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>if test `ausearch -c 'in.tftpd' --raw | wc -l` -gt 0 ; then</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  ausearch -c 'in.tftpd' --raw | audit2allow -a -M local-tftpd</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>  semodule -i local-tftpd.pp</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>fi</command></screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Réactivez le mode d'application de <systemitem>SELinux</systemitem>.
        </para>
          <substeps>
            <step>
              <para>
              Réglez <systemitem>SELinux</systemitem> sur le mode d'application :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>setenforce 1</command></screen>
            </step>
            <step>
              <para>
              Vérifiez le statut de <systemitem>SELinux</systemitem> :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>sestatus</command></screen>
            </step>
          </substeps>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-firewall-selinux-summary">
      <title>Résumé</title>
      <para>
      Cette procédure a permis de s'assurer que l'interface réseau du serveur PXE, le pare-feu et la stratégie <systemitem>SELinux</systemitem> étaient correctement configurés pour un fonctionnement sûr et opérationnel.
    </para>
      <itemizedlist>
        <listitem>
          <para>
          L'interface de service PXE (<filename>eno1</filename> dans cet exemple) a été vérifiée et assignée à la zone firewalld <literal>public</literal>.
        </para>
        </listitem>
        <listitem>
          <para>
          Les services de pare-feu requis pour le fonctionnement de PXE, notamment <literal>dns</literal>, <literal>ntp</literal>, <literal>dhcp</literal>, <literal>dhcpv6</literal>, <literal>tftp</literal>, <literal>http</literal>, et <literal>https</literal>, ont été ouverts.
        </para>
        </listitem>
        <listitem>
          <para>
          <systemitem>SELinux</systemitem> a été temporairement mis en mode <literal>permissive</literal> afin de faciliter les tests de service et d'enregistrer les refus AVC.
        </para>
        </listitem>
        <listitem>
          <para>
          Les commandes <command>ausearch</command> et <command>audit2allow</command> ont été utilisées pour générer et installer des modules de stratégie SELinux personnalisés pour des services tels que <systemitem>nginx</systemitem>, <systemitem>dnsmasq</systemitem> et <systemitem>in.tftpd</systemitem>.
        </para>
        </listitem>
        <listitem>
          <para>
          <systemitem>SELinux</systemitem> a été restauré en mode <literal>enforcing</literal> pour sécuriser le système en vue de son utilisation en production.
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Une fois ces étapes terminées, le serveur PXE est configuré de manière sécurisée et prêt à servir des machines clientes sur le réseau en utilisant IPv4 ou IPv6.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-install-components">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Installation des composants requis pour le serveur PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment installer les paquets nécessaires à la prise en charge du démarrage PXE dans <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, y compris les composants GRUB 2, DHCP, TFTP et/ou HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-install-components-intro">
      <title>Introduction</title>
      <para>
      Pour configurer un serveur de démarrage PXE sous <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, vous devez installer plusieurs services et outils. En fonction de votre configuration, vous pouvez avoir besoin des éléments suivants :
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>dnsmasq</package> fournit une combinaison d'un serveur DNS, d'un serveur TFTP et d'un serveur DHCP (DHCPv4 et DHCPv6) avec une prise en charge limitée des annonces de routeur (RA) IPv6. Il fournit les éléments suivants :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Serveur DHCP dnsmasq : prend en charge la distribution conditionnelle d'options DHCP en fonction de la demande et de l'architecture du client pour :
            </para>
              <itemizedlist>
                <listitem>
                  <para>
                  les demandes de démarrage PXE à l'aide de DHCPv4 et DHCPv6 ;
                </para>
                </listitem>
                <listitem>
                  <para>
                  les demandes de démarrage HTTP à l'aide de DHCPv4.
                </para>
                  <note>
                    <title>limites de dnsmasq pour le démarrage HTTP via DHCPv6</title>
                    <para>
                    À l'heure actuelle, dnsmasq ne prend pas en charge l'envoi de l'option DHCPv6 <literal>vendor-class</literal> requise.
                  </para>
                  </note>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
              Serveur TFTP dnsmasq : fournit les fichiers du chargeur de démarrage, le kernel Linux et l'unité RAM initiale via TFTP pendant le démarrage PXE.
            </para>
            </listitem>
            <listitem>
              <para>
              Serveur DNS dnsmasq : fournit une résolution récursive des noms de domaine et des adresses IP pour les micrologiciels clients et <filename>/etc/resolv.conf</filename> dans le programme d'installation/système d'exploitation.
            </para>
            </listitem>
            <listitem>
              <para>
              Annonces de routeur IPv6 dnsmasq : prennent en charge l'envoi d'annonces de routeur (RA) IPv6 lorsque le serveur PXE fait également office de routeur (configurabilité limitée à un <quote>modèle RA commun</quote>).
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Le paquet <package>kea</package> est un serveur DHCP et un successeur au serveur DHCP ISC. Il prend en charge la distribution conditionnelle d'options DHCP en fonction de la demande et de l'architecture du client pour :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              les demandes de démarrage PXE à l'aide de DHCPv4 et DHCPv6 ;
            </para>
            </listitem>
            <listitem>
              <para>
              les demandes de démarrage HTTP à l'aide de DHCPv4.
            </para>
              <note>
                <title>limites de Kea pour le démarrage HTTP via DHCPv6</title>
                <para>
                À l'heure actuelle, Kea ne prend pas en charge l'envoi de l'option DHCPv6 <literal>vendor-class</literal> requise. Pour plus d'informations, reportez-vous au document <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://kea.readthedocs.io/en/latest/arm/dhcp6-srv.html#id4"/>.
              </para>
              </note>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Un serveur TFTP distribue les fichiers du chargeur de démarrage, le kernel Linux et l'unité RAM initiale via TFTP, tandis que le démarrage PXE avec Kea est fourni par le paquet <package>tftp</package> et n'est pas nécessaire pour le démarrage HTTP. Si vous utilisez <package>dnsmasq</package>, vous n'avez pas besoin du paquet <package>tftp</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Un serveur Web tel que le paquet <package>nginx</package> fournit les images du programme d'installation via HTTP.
        </para>
          <note>
            <title>nécessité des serveurs HTTP</title>
            <para>
            Un serveur HTTP/HTTPS comme nginx est presque toujours requis. Son utilisation s'étend au-delà du démarrage HTTP. En particulier, vous pouvez en avoir besoin dans les cas suivants :
          </para>
            <itemizedlist>
              <listitem>
                <para>
                Il s'agit d'une exigence de base pour le démarrage HTTP.
              </para>
              </listitem>
              <listitem>
                <para>
                Il est recommandé pour la fourniture de <filename>squashfs.img</filename>. Vous pouvez utiliser <literal>root=live:tftp://.../squashfs.img</literal> dans la ligne de commande de démarrage.
              </para>
              </listitem>
              <listitem>
                <para>
                Il est également recommandé pour la fourniture de RPM à Agama dans le paramètre de ligne de commande de démarrage <literal>inst.install_url=http://.../install/</literal> sur un fichier <filename>SLES-16.0-Full-*.inline.iso</filename>, ainsi qu'avec des profils d'installation et d'autres fichiers pour une installation sans surveillance.
              </para>
              </listitem>
            </itemizedlist>
          </note>
        </listitem>
        <listitem>
          <para>
          Les paquets du chargeur d'amorçage GRUB 2 permettent le démarrage du réseau pour les architectures et les méthodes prises en charge. Par exemple, l'architecture AMD64/Intel 64 propose deux méthodes de démarrage du réseau : BIOS et UEFI. En outre, UEFI prend généralement en charge le démarrage PXE (TFTP) et HTTP. D'autres chargeurs de démarrage, tels que pxelinux, ne prennent pas en charge UEFI et le démarrage HTTP.
        </para>
        </listitem>
        <listitem>
          <para>
          Un daemon d'annonce de routeur pour IPv6, tel que le paquet <package>radvd</package>, peut éventuellement être fourni. Il est nécessaire sous <phrase><phrase os="sles">SLES</phrase></phrase> s'il sert également de routeur pour un réseau de programme d'installation afin d'effectuer les tâches suivantes :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configurer le routage sur un réseau pour les clients de démarrage PXE ou HTTP.
            </para>
            </listitem>
            <listitem>
              <para>
              Activer l'utilisation de DHCPv6 sur un réseau pour les clients de démarrage PXE ou HTTP.
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Un système exécutant <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> avec des privilèges administratifs, enregistré auprès du SUSE Customer Center et configuré avec un accès aux dépôts en ligne appropriés à l'aide de SUSEConnect.
        </para>
        </listitem>
        <listitem>
          <para>
          Des modules SLE activés : module Server Applications, module Legacy et module Base System.
        </para>
        </listitem>
        <listitem>
          <para>
          Un accès aux dépôts de modules SLE pour les services de réseau et les chargeurs de démarrage.
        </para>
        </listitem>
        <listitem>
          <para>
          Une connexion Internet opérationnelle pour récupérer les paquets.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-exec">
      <title>Installation des paquets</title>
      <para>
      Procédez comme suit pour installer les paquets de base nécessaires au serveur de démarrage PXE.
    </para>
      <procedure>
        <title>Installation des paquets nécessaires pour un serveur de démarrage PXE</title>
        <step>
          <para>
          Installez le chargeur de démarrage GRUB 2 et le serveur HTTP nginx en tant qu'exigences communes.
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install grub2 nginx</command></screen>
        </step>
        <step>
          <para>
          Exécutez l'une des commandes suivantes pour installer les paquets essentiels à votre approche :
        </para>
          <stepalternatives>
            <step>
              <para><package>kea</package> pour le serveur DHCP, <package>tftp</package> pour le serveur TFTP
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install kea tftp</command></screen>
            </step>
            <step>
              <para><package>dnsmasq</package> en tant que fournisseur commun pour les serveurs DHCP, DNS et TFTP
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install dnsmasq</command></screen>
            </step>
          </stepalternatives>
          <note>
            <title>limites des serveurs DHCP fournis par Kea et dnsmasq</title>
            <para>
            Le démarrage HTTP via IPv6 n'est <emphasis>actuellement</emphasis> pas pris en charge par les serveurs DHCP fournis par les paquets <package>kea</package> et <package>dnsmasq</package>. Il ne permet pas de renvoyer l'option <literal>vendor-class</literal> au client HTTP, comme l'exige la spécification UEFI.
          </para>
          </note>
        </step>
        <step>
          <para>
          Vous pouvez éventuellement installer des cibles GRUB 2 supplémentaires spécifiques à l'architecture si vous prévoyez de prendre en charge d'autres plates-formes.
        </para>
          <stepalternatives>
            <step>
              <para>
              Pour l'architecture AMD64/Intel 64 :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install grub2-x86_64-efi grub2-i386-pc</command></screen>
            </step>
            <step>
              <para>
              Pour l'architecture AArch64 :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install grub2-aarch64-efi</command></screen>
            </step>
            <step>
              <para>
              Pour l'architecture ppc64le :
            </para>
              <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install grub2-ppc64le-ieee1275</command></screen>
            </step>
          </stepalternatives>
          <note>
            <title>mode de fourniture de paquets GRUB 2 par le serveur PXE à des clients dont l'architecture est différente de celle de la machine serveur</title>
            <para>
            Les paquets <package>noarch.rpm</package> spécifiques à l'architecture de GRUB 2 sont inclus dans le sous-répertoire <filename>noarch</filename> du média/dépôt d'installation, quelle que soit l'architecture de la machine sur laquelle le serveur PXE est configuré. En d'autres termes, vous pouvez installer les paquets <package>grub2-arm64-efi</package> et <package>grub2-powerpc-ieee1275</package> sur un serveur PXE s'exécutant sur une machine AMD64/Intel 64, afin de prendre en charge les clients dotés d'autres architectures.
          </para>
          </note>
        </step>
        <step>
          <para>
          Vous pouvez éventuellement installer le paquet <package>shim</package> si vous avez besoin du mode UEFI Secure Boot pour AMD64/Intel 64 ou AArch64, mais que vous ne souhaitez pas utiliser les fichiers de l'image ISO du support d'installation.
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install shim</command></screen>
        </step>
        <step>
          <para>
          Vous pouvez éventuellement installer le daemon d'annonce de routeur <package>radvd</package> si vous souhaitez utiliser le serveur PXE comme routeur (non recommandé pour les réseaux de production).
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install radvd</command></screen>
        </step>
        <step>
          <para>
          Installez l'utilitaire <package>rsync</package> pour copier ou synchroniser facilement l'image ISO et l'arborescence Annuaire.
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install rsync</command></screen>
        </step>
        <step>
          <para>
          Assurez-vous que les services sont installés, mais qu'ils n'ont pas encore démarré. La configuration sera abordée dans des sections ultérieures.
        </para>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Création des répertoires NetBoot de GRUB 2 pour le serveur PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section décrit comment créer des répertoires NetBoot de GRUB 2 pour les serveurs PXE à l'aide de <command>grub2-mknetdir</command>, qui génère des répertoires spécifiques à l'architecture pour les systèmes AMD64/Intel 64 (UEFI et BIOS), AArch64 et ppc64le. Pour la prise en charge du mode UEFI Secure Boot, les administrateurs doivent copier les fichiers EFI signés à partir du support d'installation ou utiliser le paquet <package>shim</package> pour remplacer les fichiers par défaut non signés du chargeur de démarrage.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-introduction">
      <title>Introduction</title>
      <para>
      Cette section décrit comment configurer les répertoires NetBoot de GRUB 2 pour le déploiement d'un serveur PXE sur plusieurs architectures. La commande <command>grub2-mknetdir</command> crée des répertoires spécifiques à l'architecture sous <filename>/srv/tftpboot/boot/grub2/</filename> pour différentes plateformes. Par exemple, les systèmes AMD64/Intel 64 génèrent à la fois des répertoires UEFI (<filename>x86_64-efi</filename>) et du BIOS hérité (<filename>i386-pc</filename>), tandis que les systèmes AArch64 et ppc64le créent leurs répertoires UEFI respectifs (<filename>arm64-efi</filename> et <filename>powerpc-ieee1275</filename>).
    </para>
      <para>
      Pour la prise en charge du mode UEFI Secure Boot, qui n'est pas assurée par les fichiers <filename>core.efi</filename> par défaut non signés, les administrateurs peuvent soit copier des fichiers EFI signés à partir du support d'installation, soit installer le paquet <package>shim</package> et copier manuellement les fichiers de chargeur de démarrage requis (<filename>shim.efi</filename>, <filename>grub.efi</filename>, <filename>MokManager.efi</filename>) dans les répertoires d'architecture appropriés, en veillant à une résolution correcte des liens symboliques afin de conserver tous les fichiers dans le répertoire racine TFTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-requirements">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Assurez-vous d'avoir installé les paquets suivants : <package>grub2</package>, <package>tftp</package> et tout autre paquet GRUB 2 spécifique à l'architecture, tel que <package>grub2-x86_64-efi</package> et <package>grub2-i386-pc</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Assurez-vous que le support d'installation (ISO) est disponible pour le montage ou que le paquet <package>shim</package> est installé sur le système. Vous pouvez télécharger le support d'installation (ISO) pour votre architecture cible à partir du SUSE Customer Center.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-executing">
      <title>Préparation des répertoires NetBoot et du mode UEFI Secure Boot</title>
      <para>
      Cette procédure crée la structure de répertoire GRUB 2 requise pour le démarrage réseau PXE et configure éventuellement la prise en charge du mode UEFI Secure Boot sur plusieurs architectures.
    </para>
      <procedure>
        <step>
          <para>
          Créez une structure de répertoire NetBoot de GRUB 2.
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>grub2-mknetdir --net-directory=/srv/tftpboot
--subdir=/boot/grub2</command></screen>
          <para>
          Cela crée des répertoires spécifiques à l'architecture :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              AMD64/Intel 64 : <filename>/srv/tftpboot/boot/grub2/x86_64-efi</filename> et <filename>/srv/tftpboot/boot/grub2/i386-pc </filename>
            </para>
            </listitem>
            <listitem>
              <para>
              AArch64 : <filename>/srv/tftpboot/boot/grub2/arm64-efi</filename>
            </para>
            </listitem>
            <listitem>
              <para>
              ppc64le : <filename>/srv/tftpboot/boot/grub2/powerpc-ieee1275</filename>
            </para>
            </listitem>
          </itemizedlist>
          <warning>
            <para>
            N'écrasez pas manuellement le fichier <filename>grub.cfg</filename> créé par <command>grub2-mknetdir</command>.
          </para>
          </warning>
        </step>
        <step>
          <para>
          Copiez sur le serveur TFTP les autres répertoires indépendants de l'architecture, tels que <filename>fonts/</filename> et <filename>locale/</filename>, qui sont disponibles sous le répertoire <filename>/srv/tftpboot/boot/grub2/</filename>.
        </para>
        </step>
        <step>
          <para>
          Vous pouvez également utiliser le fichier <filename>/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/core.efi</filename> installé par la commande <command>grub2-mknetdir</command> pour les architectures AMD64/Intel 64 ou AArch64 pour UEFI PXE. Cependant, ils ne sont <emphasis>pas signés</emphasis> et ne prennent pas en charge UEFI Secure Boot. Pour activer éventuellement UEFI Secure Boot pour les architectures AMD64/Intel 64 et AArch64 prises en charge, effectuez l'une des étapes suivantes :
        </para>
          <stepalternatives>
            <step>
              <para>
              Copiez les fichiers nécessaires à partir de l'image ISO du support d'installation :
            </para>
              <substeps>
                <step>
                  <para>
                  Montez l'image ISO.
                </para>
                  <screen><prompt>&gt; </prompt><command>sudo</command> <command>mount -o loop /PATH/TO/SLES.ISO /mnt</command></screen>
                </step>
                <step>
                  <para>
                  Copiez les fichiers EFI.
                </para>
                  <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v /mnt/EFI/BOOT/*.efi
/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/</command><co xml:id="copy-efi-files"/></screen>
                  <calloutlist>
                    <callout arearefs="copy-efi-files">
                      <para>
                      Remplacez <filename><replaceable>ARCH</replaceable>-efi</filename> par <filename>x86_64-efi</filename> ou <filename>arm64-efi</filename>, les architectures prises en charge pour UEFI Secure Boot.
                    </para>
                    </callout>
                  </calloutlist>
                </step>
                <step>
                  <para>
                  Testez l'image ISO du support d'installation.
                </para>
                  <screen><prompt>&gt; </prompt><command>sudo</command> <command>umount /mnt</command></screen>
                </step>
              </substeps>
            </step>
            <step>
              <para>
              Utilisez le paquet <package>shim</package> si vous ne souhaitez pas utiliser les fichiers de l'image ISO du support d'installation :
            </para>
              <substeps>
                <step>
                  <para>
                  Si ce n'est déjà fait, installez le paquet <package>shim</package>.
                </para>
                  <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install shim</command></screen>
                </step>
                <step>
                  <para>
                  Copiez les fichiers signés du chargeur de démarrage pour l'architecture requise :
                </para>
                  <substeps>
                    <step>
                      <para>
                      Copiez le fichier <filename>shim.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Pour l'architecture AMD64/Intel 64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/x86_64/shim.efi /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command></screen>
                        </step>
                        <step>
                          <para>
                          Pour l'architecture AArch64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/aarch64/shim.efi /srv/tftpboot/boot/grub2/arm64-efi/bootaa64.efi</command></screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copiez le fichier <filename>grub.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Pour l'architecture AMD64/Intel 64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/x86_64/grub.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command></screen>
                        </step>
                        <step>
                          <para>
                          Pour l'architecture AArch64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/aarch64/grub.efi /srv/tftpboot/boot/grub2/arm64-efi/</command></screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copiez le fichier <filename>MokManager.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Pour l'architecture AMD64/Intel 64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/x86_64/MokManager.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command></screen>
                        </step>
                        <step>
                          <para>
                          Pour l'architecture AArch64 :
                        </para>
                          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v -p -L /usr/share/efi/aarch64/MokManager.efi /srv/tftpboot/boot/grub2/arm64-efi/</command></screen>
                        </step>
                      </stepalternatives>
                    </step>
                  </substeps>
                  <note>
                    <para>
                    L'indicateur <literal>-L</literal> résout les liens symboliques pour s'assurer que les fichiers restent à la racine TFTP.
                  </para>
                  </note>
                </step>
              </substeps>
            </step>
          </stepalternatives>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-prepare-installer">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Préparation du contenu de l'image du programme d'installation</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section décrit comment extraire les fichiers du programme d'installation à partir du support d'installation de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> et comment les organiser pour les environnements de démarrage PXE. Il couvre à la fois les images <literal>.install.iso</literal> et les paquets RPM, avec des instructions spécifiques pour différents types d'installation et architectures.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-prepare-installer-intro">
      <title>Introduction</title>
      <para><phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> fournit des fichiers de programme d'installation dans plusieurs formats afin de prendre en charge différents scénarios de démarrage PXE. Le programme d'installation Agama nécessite trois fichiers essentiels : l'image du kernel Linux (<filename>linux</filename>), l'unité RAM initiale (<filename>initrd</filename>) et le système de fichiers racine compressé (<filename>squashfs.img</filename>). Ces fichiers doivent être extraits à partir du support d'installation et organisés dans une structure de répertoires accessible via TFTP et HTTP.
    </para>
      <para>
      Cette section couvre les méthodes de préparation à la fois des images <literal>.install.iso</literal> et des paquets RPM, afin d'assurer la compatibilité avec les différents types d'installation et architectures pris en charge par <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>Support d'installation de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> tel que disponible dans le SUSE Customer Center. Choix possibles :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Image ISO en ligne : programme d'installation uniquement pour les installations réseau (<filename>SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              Image ISO complète : programme d'installation avec dépôt d'installation (<filename>SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              Paquets RPM : <package>tftpboot-agama-installer-SUSE_SLE_16_PXE-<replaceable>ARCH</replaceable></package>
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Un point de montage temporaire, tel que <filename>/mnt</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Espace disque suffisant sous <filename>/srv/tftpboot</filename> et <filename>/srv/install</filename> pour la méthode d'installation choisie.
        </para>
        </listitem>
        <listitem>
          <para>
          Privilèges administratifs permettant de créer des répertoires et de copier des fichiers.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-iso">
      <title>Préparation des fichiers du programme d'installation à partir d'images ISO</title>
      <para>
      Les images ISO constituent une méthode simple pour extraire les fichiers du programme d'installation. Les procédures suivantes couvrent à la fois les types Image ISO en ligne et Image ISO complète pour différentes architectures.
    </para>
      <section xml:id="sles-pxe-server-prepare-installer-iso-online">
        <title>Utilisation d'images ISO en ligne</title>
        <para>
        Les images ISO en ligne ne contiennent que les composants du programme d'installation, ce qui nécessite un accès réseau aux dépôts d'installation lors de l'installation du système. Cela correspond à l'entrée du menu de démarrage <literal>SLES-16.0 Online Installation</literal> dans GRUB.
       </para>
        <procedure xml:id="proc-prepare-online-iso-x86-aarch64">
          <title>Extraction de fichiers à partir d'une image ISO en ligne (x86_64 et aarch64)</title>
          <step>
            <para>
            Créez la structure de répertoires pour les fichiers du programme d'installation :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Montez l'images ISO en ligne :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command></screen>
          </step>
          <step>
            <para>
            Copiez les fichiers du kernel Linux et initrd :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Copiez le système de fichiers racine compressé :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Montez l'image ISO :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>umount /mnt</command></screen>
          </step>
        </procedure>
        <procedure xml:id="proc-prepare-online-iso-ppc64le">
          <title>Extraction de fichiers à partir d'une image ISO en ligne (ppc64le)</title>
          <step>
            <para>
            Créez la structure de répertoire :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command></screen>
          </step>
          <step>
            <para>
            Montez l'image ISO :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-ppc64le-<replaceable>BUILD</replaceable>.install.iso /mnt</command></screen>
          </step>
          <step>
            <para>
            Copiez les fichiers du kernel Linux et initrd (notez la structure de chemin différente pour ppc64le) :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/ppc64le/linux /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/ppc64le/initrd /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command></screen>
          </step>
          <step>
            <para>
            Copiez le système de fichiers racine compressé :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command></screen>
          </step>
          <step>
            <para>
            Montez l'image ISO :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>umount /mnt</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-prepare-installer-iso-full">
        <title>Utilisation d'images ISO complètes</title>
        <para>
        Les images ISO complètes comprennent à la fois le programme d'installation et les dépôts d'installation, ce qui permet des installations locales sans dépendances réseau externes. Cela correspond à l'entrée du menu de démarrage <literal>SLES-16.0 Local Installation</literal> dans GRUB avec le paramètre supplémentaire <literal>inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch}</literal>.
      </para>
        <procedure xml:id="proc-prepare-full-iso">
          <title>Extraction de fichiers à partir d'une image ISO complète</title>
          <step>
            <para>
            Créez des répertoires à la fois pour les fichiers du programme d'installation et pour le dépôt d'installation :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/install/SLES-16.0</command></screen>
          </step>
          <step>
            <para>
            Montez l'image ISO complète :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mount -oro,loop /srv/install/iso/SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command></screen>
          </step>
          <step>
            <para>
            Copiez les fichiers du kernel Linux et initrd (ajustez les chemins pour ppc64le comme indiqué dans les procédures précédentes) :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Copiez le système de fichiers racine compressé :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Copier le dépôt d'installation pour l'accès au serveur HTTP local :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>rsync -avP /mnt/install/ /srv/install/SLES-16.0/<replaceable>ARCH</replaceable>/</command></screen>
          </step>
          <step>
            <para>
            Montez l'image ISO :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>umount /mnt</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-rpm">
      <title>Préparation des fichiers du programme d'installation à partir de paquets RPM</title>
      <para>
      Les paquets RPM constituent une méthode alternative pour obtenir les fichiers du programme d'installation en ligne.
    </para>
      <procedure xml:id="proc-prepare-rpm-packages">
        <title>Installation et utilisation des paquets RPM tftpboot</title>
        <step>
          <para>
          Installez les paquets requis :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper in tftpboot-agama-installer-SUSE_SLE_16-<replaceable>ARCH</replaceable></command></screen>
        </step>
        <step>
          <para>
          Copiez les fichiers linux, initrd et squashfs.img dans tftpboot :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cd
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/linux .</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/initrd .</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/squashfs.img .</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-dir-structure">
      <title>Structure de répertoires recommandée</title>
      <para>
      Organisez les fichiers extraits selon la disposition de répertoires suivante afin de garantir la cohérence et la facilité de maintenance. Cette structure prend en charge plusieurs types d'installation et architectures.
    </para>
      <example xml:id="ex-pxe-directory-layout">
        <title>Disposition complète des répertoires du serveur PXE</title>
        <screen>/srv/tftpboot/
├── boot/
│   ├── grub2/
│   │   ├── x86_64-efi/
│   │   │   ├── bootx64.efi
│   │   │   └── grub.cfg
│   │   ├── i386-pc/
│   │   │   └── core.0
│   │   ├── arm64-efi/
│   │   │   └── bootaa64.efi
│   │   └── powerpc-ieee1275/
│   │       └── core.elf
│   └── images/
│       └── SLES-16.0/
│           ├── x86_64/
│           │   ├── linux <co xml:id="co-kernel"/>
│           │   ├── initrd <co xml:id="co-initrd"/>
│           │   └── squashfs.img <co xml:id="co-squashfs"/>
│           ├── aarch64/
│           └── ppc64le/
/srv/install/
└── SLES-16.0/
    ├── x86_64/ <co xml:id="co-install-repo"/>
    ├── aarch64/
    └── ppc64le/</screen>
      </example>
      <calloutlist>
        <callout arearefs="co-kernel">
          <para>
          Image du kernel Linux extraite du support d'installation
        </para>
        </callout>
        <callout arearefs="co-initrd">
          <para>
          Image de l'unité RAM initiale
        </para>
        </callout>
        <callout arearefs="co-squashfs">
          <para>
          Système de fichiers racine compressé pour le programme d'installation Agama
        </para>
        </callout>
        <callout arearefs="co-install-repo">
          <para>
          Dépôt d'installation à partir du répertoire <filename>install</filename> de l'image ISO complète (facultatif)
        </para>
        </callout>
      </calloutlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-verify">
      <title>Vérification de l'installation</title>
      <para>
      Après avoir extrait et organisé les fichiers du programme d'installation, vérifiez que tous les composants requis sont présents et accessibles.
    </para>
      <procedure xml:id="proc-verify-installer-files">
        <title>Étapes de vérification</title>
        <step>
          <para>
          Vérifiez que les fichiers essentiels sont présents :
        </para>
          <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/*</command></screen>
        </step>
        <step>
          <para>
          Veillez à ce que les autorisations d'accès aux fichiers soient correctes :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 0755 {} \;</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>find /srv/tftpboot/boot/images/ -type f -exec chmod 0644 {} \;</command></screen>
        </step>
      </procedure>
      <important>
        <title>accessibilité des fichiers</title>
        <para>
        Assurez-vous que tous les fichiers extraits sont lisibles par les services TFTP et HTTP. Les clients PXE accéderont aux fichiers au cours du processus de démarrage. Il est donc essentiel de disposer d'autorisations et d'une configuration de service adéquates pour que les déploiements réussissent.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-next">
      <title>Étapes suivantes</title>
      <para>
      Une fois les fichiers du programme d'installation correctement préparés et organisés, vous pouvez poursuivre avec les tâches suivantes :
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurer GRUB 2 pour le démarrage PXE avec des entrées de menu faisant référence à ces fichiers
        </para>
        </listitem>
        <listitem>
          <para>
          Configurer les services HTTP et TFTP pour desservir le contenu extrait
        </para>
        </listitem>
        <listitem>
          <para>
          Configurer DHCP pour diriger les clients PXE vers les chargeurs de démarrage appropriés
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Les fichiers extraits seront référencés dans la configuration GRUB 2 à l'aide de chemins tels que <literal>root=live:http://pxe.example.net/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/squashfs.img</literal>.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-configure-grub2">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration de GRUB 2 pour le démarrage PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section décrit comment configurer le chargeur de démarrage GRUB 2 pour un démarrage basé sur PXE sous <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Elle couvre la création de la structure de répertoires de démarrage du réseau, la configuration de chargeurs de démarrage spécifiques à l'architecture et l'implémentation d'un système de configuration flexible qui prend en charge plusieurs architectures et scénarios d'installation.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-grub2-intro">
      <title>Introduction</title>
      <para>
      GRUB 2 fait office de chargeur de démarrage réseau pour les clients PXE, en chargeant les fichiers du noyau Linux et initrd pour lancer le programme d'installation Agama. Cette section montre comment créer une configuration GRUB 2 sophistiquée qui détecte automatiquement l'architecture du client, gère la sélection de l'interface réseau et fournit un menu de démarrage unifié prenant en charge plusieurs types d'installation et architectures cibles.
    </para>
      <para>
      L'approche de la configuration utilise une conception modulaire avec des fichiers séparés pour la détection de l'architecture, les définitions de variables et les entrées du menu de démarrage. Cela permet de prendre en charge des configurations spécifiques aux machines et des profils d'installation automatisés, tout en maintenant la cohérence entre les différentes plates-formes matérielles.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Assurez-vous que la structure du répertoire de démarrage du réseau GRUB 2 est en place, comme décrit dans les sections précédentes.
        </para>
        </listitem>
        <listitem>
          <para>
          Assurez-vous que les fichiers du programme d'installation sont correctement organisés comme décrit dans les sections précédentes.
        </para>
        </listitem>
        <listitem>
          <para>
          Les paquets GRUB 2 pour toutes les architectures cibles doivent être installés : <package>grub2-x86_64-efi</package>, <package>grub2-i386-pc</package>, <package>grub2-aarch64-efi</package> et <package>grub2-ppc64le-ieee1275</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Le paquet <package>shim</package> pour la prise en charge du mode UEFI Secure Boot (facultatif).
        </para>
        </listitem>
        <listitem>
          <para>
          Un accès administratif à <filename>/srv/tftpboot</filename> ou à la racine PXE équivalente.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-main-config">
      <title>Création de la configuration GRUB 2</title>
      <para>
      Le fichier de configuration GRUB 2 gère trois tâches principales : la détection de l'architecture du client, la gestion des interfaces réseau et le chargement d'autres fichiers de configuration. Cette approche modulaire permet de s'adapter à différents scénarios de déploiement.
    </para>
      <procedure xml:id="proc-create-main-grub-config">
        <title>Configuration du principal fichier <filename>grub.cfg</filename></title>
        <step>
          <para>
          Créez le fichier de configuration GRUB 2 principal à l'emplacement <filename>/srv/tftpboot/boot/grub2/grub.cfg</filename> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Architecture detection and mapping
if [ "$grub_cpu" == "i386" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "x86_64" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "arm64" ]; then
  set arch='aarch64'
elif [ "$grub_cpu" == "powerpc" ]; then
  set arch='ppc64le'
fi

if [ "X$arch" == "X" ]; then
  echo "ERROR: No architecture found for ${grub_cpu}"
  exit
else
  echo "Running on $arch CPU architecture"
fi
export arch


# Network interface configuration for PXE-selected NIC
# - dracut based images on SLE-16:
set ipcfg="ifname=pxe0:${net_default_mac} ip=pxe0:dhcp"
export ipcfg
# - linuxrc installer on SLE-15:
set ifcfg="ifcfg=${net_default_mac}=dhcp"
export ifcfg

# Define typical serial console kernel parameter
#set sconsole="console=tty0 console=ttyS0,115200n8"
#export sconsole

# Load machine-specific configuration if available
if [ -s "${config}/${net_default_mac}/grub.cfg" ]; then
  ## Source a host specific configuration of grub menu:
  source "${config}/${net_default_mac}/grub.cfg"
else
  ## Source default grub boot menu:
  source "${prefix}/menu.cfg"
fi
EOF
</screen>
        </step>
      </procedure>
      <variablelist>
        <title>Éléments clés de la configuration</title>
        <varlistentry>
          <term>Détection de l'architecture</term>
          <listitem>
            <para>
            Associe les types de processeur de GRUB 2 aux architectures de distribution, ce qui permet de créer des entrées de menu unifiées fonctionnant sur différentes plates-formes matérielles.
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Gestion de l'interface réseau</term>
          <listitem>
            <para>
            Définit une variable <varname>${ipcfg}</varname> utilisant la variable grub2 <varname>${net_default_mac}</varname> pour activer DHCP uniquement sur l'interface de démarrage PXE nommée <literal>pxe0</literal>, évitant ainsi les problèmes de sondage du réseau sur les systèmes multi-interfaces.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Définitions des utilitaires</term>
          <listitem>
            <para>
            Définit une variable type <varname>${sconsole}</varname> avec des paramètres de console série.
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Configuration spécifique à la machine</term>
          <listitem>
            <para>
            Charge les fichiers de configuration facultatifs par machine en fonction de l'adresse MAC, ce qui permet de personnaliser les paramètres de démarrage par machine et d'automatiser les profils d'installation.
          </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-menu">
      <title>Création du menu de démarrage unifié</title>
      <para>
      Le menu de démarrage utilise les variables de la configuration principale pour fournir des entrées de menu indépendantes de l'architecture qui s'adaptent automatiquement aux différentes plates-formes matérielles et aux différents types d'installation.
    </para>
      <procedure xml:id="proc-create-grub-menu">
        <title>Configuration du fichier menu.cfg</title>
        <step>
          <para>
          Créez un menu de démarrage unifié dans <filename>/srv/tftpboot/boot/grub2/menu.cfg</filename> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/grub2/menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'SLES-16.0 Online Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}

menuentry 'SLES-16.0 Local Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <note>
        <title>flexibilité de l'entrée de menu</title>
        <para>
        Les entrées de menu utilisent des variables qui sont automatiquement remplies en fonction de l'architecture et de la configuration du client. La variable <varname>${arch}</varname> permet de s'assurer que les bons fichiers sont chargés.
       </para>
        <para>
        La variable facultative <varname>${ipcfg}</varname> permet de configurer uniquement l'interface réseau sélectionnée par PXE.
       </para>
        <para>
        La variable facultative <varname>${sconsole}</varname> permet d'activer une console série sur le système du programme d'installation.
       </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-machine-specific">
      <title>Configurations spécifiques à la machine</title>
      <para>
      Pour les déploiements avancés, vous pouvez créer des fichiers de configuration spécifiques à la machine qui remplacent les paramètres par défaut ou fournissent des paramètres d'installation automatisés.
    </para>
      <procedure xml:id="proc-machine-specific-config">
        <title>Création d'une configuration spécifique à la machine</title>
        <step>
          <para>
          Créez un répertoire pour les configurations spécifiques à la machine :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot/boot/config</command></screen>
        </step>
        <step>
          <para>
          Pour une machine avec une adresse MAC <literal>aa:bb:cc:dd:ee:ff</literal>, créez une configuration spécifique :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff</command></screen>
        </step>
        <step>
          <para>
          Créez le fichier <filename>grub.cfg</filename> spécifique à la machine :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
# Machine-specific configuration for aa:bb:cc:dd:ee:ff
set default='SLES-16.0 Full Installation'

# Activate the menu-entry after 5sec timeout
set timeout=5

# Use know predictable network interface name
set ipcfg="ip=eno1:dhcp"

# Set the autoinstall variable for this machine
set autoinstall="inst.auto=http://pxe.example.net/install/profiles/aa:bb:cc:dd:ee:ff/sles16.json"
export autoinstall

# Load the default menu
source "/boot/grub2/menu.cfg"
EOF
</screen>
          <para>
          Vous pouvez éventuellement fournir une entrée de menu propre dans le fichier <filename>grub.cfg</filename> spécifique à l'hôte (par exemple, généré pour une tentative de démarrage spécifique) :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
set default='SLES-16.0 Auto-Installation'
set timeout=5

menuentry 'SLES-16.0 Auto-Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} inst.auto=http://pxe.example.net/install/profiles/${net_default_mac}/sles16.json ip=eno1:dhcp
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <example xml:id="ex-machine-specific-parameters">
        <title>Paramètres courants spécifiques à la machine</title>
        <variablelist>
          <varlistentry>
            <term>
              <varname>default</varname>
            </term>
            <listitem>
              <para>
              Spécifie l'entrée de menu pour démarrer automatiquement.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>timeout</varname>
            </term>
            <listitem>
              <para>
              Définit le timeout de démarrage en secondes.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>ipcfg</varname>
            </term>
            <listitem>
              <para>
              Remplace la configuration de l'interface réseau pour un matériel spécifique.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>autoinstall</varname>
            </term>
            <listitem>
              <para>
              Fournit des URL de profil d'installation automatisé spécifiques à la machine
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </example>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-verify">
      <title>Vérification de la configuration GRUB 2</title>
      <para>
      Après avoir créé les fichiers de configuration, vérifiez que la configuration est correcte et que tous les fichiers requis sont en place.
    </para>
      <procedure xml:id="proc-verify-grub-config">
        <title>Étapes de vérification</title>
        <step>
          <para>
          Vérifiez la structure de répertoires GRUB 2 :
        </para>
          <screen><prompt>&gt; </prompt><command>find /srv/tftpboot/boot/grub2 -type f -name "*.cfg" -o -name "*.efi" -o -name "core.*"</command></screen>
        </step>
        <step>
          <para>
          Vérifiez la syntaxe du fichier de configuration en la testant à l'aide des outils GRUB 2 :
        </para>
          <screen><prompt>&gt; </prompt><command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command></screen> <screen><prompt>&gt; </prompt><command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command></screen>
        </step>
        <step>
          <para>
          Veillez à ce que les autorisations d'accès aux fichiers soient correctes :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>chmod -R 644 /srv/tftpboot/boot/grub2/*.cfg</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>find /srv/tftpboot/boot/grub2 -type d -exec chmod 0755 {} \;</command></screen>
        </step>
      </procedure>
      <important>
        <title>test de la configuration</title>
        <para>
        Testez la configuration GRUB 2 avec des clients PXE réels pour vous assurer de la détection de l'architecture et le menu fonctionnent correctement. La variable <varname>${net_default_mac}</varname> n'est disponible que dans les scénarios de démarrage réseau réels.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-troubleshooting">
      <title>Dépannage de la configuration GRUB 2</title>
      <para>
      Problèmes courants et leurs solutions lors de l'utilisation de configurations PXE GRUB 2. Chaque problème comprend des étapes de diagnostic et des commandes spécifiques pour résoudre le problème.
    </para>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-arch">
        <title>Échec de la détection de l'architecture</title>
        <para>
        Lorsque GRUB 2 ne détecte pas l'architecture correcte, les clients risquent de démarrer avec des fichiers binaires incorrects ou de ne rien pouvoir charger.
      </para>
        <procedure xml:id="proc-debug-arch-detection">
          <title>Débogage de la détection de l'architecture</title>
          <step>
            <para>
            Ajoutez une sortie de débogage à la configuration GRUB 2 pour afficher les valeurs détectées :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Debug architecture detection
echo "Detected grub_cpu: ${grub_cpu}"
echo "Mapped arch: ${arch}"
sleep 3
EOF</screen>
          </step>
          <step>
            <para>
            Testez la syntaxe de la configuration :
          </para>
            <screen><prompt>&gt; </prompt><command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Si l'assignation de l'architecture est incomplète, étendez la logique de détection :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '/elif \[ "$grub_cpu" == "powerpc" \]/a\\nelif [ "$grub_cpu" == "riscv64" ]; then\n  set arch='\''riscv64'\''\\' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que les répertoires spécifiques à l'architecture existent :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/grub2/</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-network">
        <title>Interface réseau introuvable</title>
        <para>
        Certaines implémentations de microprogrammes peuvent ne pas définir correctement la variable <varname>${net_default_mac}</varname>, ce qui entraîne des échecs de configuration du réseau.
      </para>
        <procedure xml:id="proc-debug-network-interface">
          <title>Diagnostic des problèmes liés à l'interface réseau</title>
          <step>
            <para>
            Ajoutez une sortie de débogage pour vérifier les variables réseau :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '/set ipcfg=/i\\necho "Default MAC: ${net_default_mac}"\necho "Network variables set"\nsleep 2' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Créez une configuration réseau de secours :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>

# Fallback network configuration if net_default_mac is empty
if [ "X${net_default_mac}" == "X" ]; then
  set ipcfg="ip=dhcp"
  set ifcfg="ifcfg=*=dhcp"
  echo "WARNING: Using fallback network configuration"
  sleep 2
fi
EOF
</screen>
          </step>
          <step>
            <para>
            Testez la configuration réseau avec une interface spécifique :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>echo 'set ipcfg="ip=eno1:dhcp"' &gt; /srv/tftpboot/boot/config/test-network.cfg</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les noms des interfaces réseau sur le système cible :
          </para>
            <screen><prompt>&gt; </prompt><command>ip link show</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-file-paths">
        <title>Chemins d'accès aux fichiers introuvables</title>
        <para>
        Des chemins d'accès incorrects empêchent GRUB 2 de charger les fichiers de kernel Linux et initrd, ce qui provoque des échecs de démarrage.
      </para>
        <procedure xml:id="proc-debug-file-paths">
          <title>Vérification de l'accessibilité des chemins des fichiers</title>
          <step>
            <para>
            Vérifiez si les fichiers du programme d'installation existent aux emplacements prévus :
          </para>
            <screen><prompt>&gt; </prompt><command>find /srv/tftpboot/boot/images -name "linux" -o -name "initrd" -o -name "squashfs.img"</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'accès TFTP aux fichiers de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>tftp localhost -c get /boot/grub2/grub.cfg /tmp/test-grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Testez l'accès HTTP aux fichiers du programme d'installation :
          </para>
            <screen><prompt>&gt; </prompt><command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/linux</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les autorisations et la propriété des fichiers :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/images/SLES-16.0/*/</command></screen>
          </step>
          <step>
            <para>
            Corrigez les autorisations si nécessaire :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>chmod -R 644 /srv/tftpboot/boot/images/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 755 {} \;</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que les liens symboliques ne sont pas rompus :
          </para>
            <screen><prompt>&gt; </prompt><command>find /srv/tftpboot/boot/images/ -type l -exec ls -la {} \;</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-efi">
        <title>Échecs des démarrages EFI</title>
        <para>
        Des problèmes liés à EFI et Secure Boot peuvent empêcher l'initialisation correcte du chargeur de démarrage ou provoquer des échecs d'authentification.
      </para>
        <procedure xml:id="proc-debug-efi-boot">
          <title>Diagnostic des problèmes liés au démarrage EFI</title>
          <step>
            <para>
            Vérifiez que les fichiers Secure Boot sont présents :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que les fichiers shim (bootx64.efi ou shim.efi), grub.efi et MokManager.efi sont correctement copiés :
          </para>
            <screen><prompt>&gt; </prompt><command>file /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'intégrité du fichier EFI :
          </para>
            <screen><prompt>&gt; </prompt><command>sha256sum /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command></screen>
          </step>
          <step>
            <para>
            Testez si les fichiers sont accessibles via TFTP :
          </para>
            <screen><prompt>&gt; </prompt><command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-shim.efi</command></screen>
          </step>
          <step>
            <para>
            Pour les systèmes aarch64, vérifiez les fichiers EFI ARM64 :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/grub2/arm64-efi/*.efi</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que la configuration DHCP fournit les bons chemins d'accès au chargeur de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -n "bootx64.efi\|shim.efi\|bootaa64.efi"
/etc/dnsmasq.d/dhcp.conf /etc/kea/kea-dhcp?.conf /etc/dhcpd?.conf</command></screen>
          </step>
          <step>
            <para>
            Si des fichiers sont manquants, recopiez-les à partir de l'image ISO montée dans /mnt ou à partir des fichiers du paquet shim :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -v /mnt/EFI/BOOT/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp -pL /usr/share/efi/x86_64/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-menu">
        <title>Non-chargement des entrées de menu</title>
        <para>
        Lorsque GRUB 2 se charge, mais que les entrées de menu échouent ou affichent des erreurs, le problème est souvent lié à l'expansion des variables ou aux références de fichiers.
      </para>
        <procedure xml:id="proc-debug-menu-entries">
          <title>Débogage des problèmes liés aux entrées de menu</title>
          <step>
            <para>
            Testez la syntaxe de la configuration de menu :
          </para>
            <screen><prompt>&gt; </prompt><command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command></screen>
          </step>
          <step>
            <para>
            Ajoutez une sortie de débogage aux entrées de menu :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '/linux_kernel.*{images}/i\\necho "Loading: ${images}/SLES-16.0/${arch}/linux"\necho "Architecture: ${arch}"' /srv/tftpboot/boot/grub2/menu.cfg</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que l'expansion des variables fonctionne correctement :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/grub2/debug-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Debug Variables' {
  echo "arch = ${arch}"
  echo "images = ${images}"
  echo "ipcfg = ${ipcfg}"
  sleep 5
}
EOF
</screen>
          </step>
          <step>
            <para>
            Effectuez un test avec une entrée de menu simplifiée :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/grub2/simple-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Simple Test' {
  linux /boot/images/SLES-16.0/x86_64/linux
  initrd /boot/images/SLES-16.0/x86_64/initrd
}
EOF
</screen>
          </step>
          <step>
            <para>
            Chargez temporairement le menu de test :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i 's|source "${prefix}/menu.cfg"|source "${prefix}/simple-menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Restaurez le menu d'origine après le test :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i 's|source "${prefix}/simple-menu.cfg"|source "${prefix}/menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-logging">
        <title>Activation de la journalisation détaillée</title>
        <para>
        Pour les problèmes persistants, activez la journalisation complète afin de capturer des informations détaillées sur le processus de démarrage.
      </para>
        <procedure xml:id="proc-enable-grub-logging">
          <title>Configuration de la journalisation de débogage de GRUB 2</title>
          <step>
            <para>
            Créez une version de débogage de la configuration principale :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp /srv/tftpboot/boot/grub2/grub.cfg /srv/tftpboot/boot/grub2/grub.cfg.backup</command></screen>
          </step>
          <step>
            <para>
            Ajoutez une sortie de débogage complète :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /srv/tftpboot/boot/grub2/debug.cfg &lt;&lt; 'EOF'</command>
# Debug configuration for GRUB troubleshooting
set debug=all
set pager=1

echo "=== GRUB Debug Information ==="
echo "grub_cpu: ${grub_cpu}"
echo "grub_platform: ${grub_platform}"
echo "net_default_mac: ${net_default_mac}"
echo "net_default_server: ${net_default_server}"
echo "============================="
sleep 5
EOF
</screen>
          </step>
          <step>
            <para>
            Incluez la configuration de débogage dans le fichier principal :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '1i\source "${prefix}/debug.cfg"' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux TFTP pendant les tentatives de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo journalctl -f -u tftp.socket</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux DHCP pour les requêtes PXE :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo journalctl -f -u dhcpd</command></screen>
          </step>
          <step>
            <para>
            Désactivez le mode de débogage après le dépannage :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '/source "${prefix}\/debug.cfg"/d' /srv/tftpboot/boot/grub2/grub.cfg</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Une fois GRUB 2 correctement configuré, vous pouvez passer aux tâches suivantes :
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurer les services HTTP et TFTP pour desservir les fichiers de démarrage et le contenu du programme d'installation.
        </para>
        </listitem>
        <listitem>
          <para>
          Configurer les services DHCP pour diriger les clients PXE vers les chargeurs de démarrage appropriés.
        </para>
        </listitem>
        <listitem>
          <para>
          Tester le processus complet de démarrage PXE sur le matériel cible.
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Le système de configuration flexible GRUB 2 fournit une base pour des scénarios de déploiement PXE sophistiqués, prenant en charge de multiples architectures et types d'installation par le biais d'une interface unifiée.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-configure-tftp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration de TFTP pour le démarrage PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer les services TFTP pour desservir les chargeurs de démarrage GRUB 2 et le contenu de démarrage PXE pour les installations <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Elle couvre le serveur traditionnel <systemitem>in.tftpd</systemitem> et la fonctionnalité TFTP intégrée fournie par <systemitem>dnsmasq</systemitem>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-tftp-intro">
      <title>Introduction</title>
      <para>
      TFTP fournit des fichiers de chargeur de démarrage aux clients PXE pendant le processus de démarrage du réseau. <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> prend en charge deux implémentations de serveur TFTP : le serveur traditionnel <systemitem>in.tftpd</systemitem> du paquet <package>tftp</package> et la fonctionnalité TFTP intégrée dans <systemitem>dnsmasq</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>tftp</package> ou le paquet <package>dnsmasq</package> est installé.
        </para>
        </listitem>
        <listitem>
          <para>
          Les fichiers de démarrage PXE sont organisés sous <filename>/srv/tftpboot</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-intftpd">
      <title>Configuration du serveur in.tftpd</title>
      <para>
      Le serveur <systemitem>in.tftpd</systemitem> utilise le fichier de configuration <filename>/etc/sysconfig/tftp</filename> pour définir le répertoire racine TFTP et les options du serveur.
    </para>
      <procedure xml:id="proc-configure-intftpd">
        <title>Configuration du serveur TFTP in.tftpd</title>
        <step>
          <para>
          Vous pouvez éventuellement activer la journalisation verbeuse en définissant les options TFTP :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command></screen>
          <para>
          L'option <option>-v</option> active la journalisation verbeuse afin de consigner les noms des fichiers récupérés via TFTP.
        </para>
        </step>
        <step>
          <para>
          Activez et démarrez le service TFTP :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now tftp.service</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-dnsmasq">
      <title>Configuration du serveur TFTP dnsmasq</title>
      <para><systemitem>dnsmasq</systemitem> fournit un serveur TFTP intégré qui peut être activé et configuré pour utiliser le répertoire <filename>/srv/tftpboot</filename>.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-tftp">
        <title>Configuration de la fonctionnalité TFTP de dnsmasq</title>
        <step>
          <para>
          Créez le fichier de configuration TFTP :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/dnsmasq.d/tftp.conf &lt;&lt; 'EOF'</command>
enable-tftp
tftp-root=/srv/tftpboot
EOF
</screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now dnsmasq</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-verify">
      <title>Vérification de la configuration TFTP</title>
      <para>
      Testez la fonctionnalité du serveur TFTP pour vous assurer qu'il peut fournir des fichiers aux clients PXE.
    </para>
      <procedure xml:id="proc-verify-tftp">
        <title>Test de la fonctionnalité du serveur TFTP</title>
        <step>
          <para>
          Créez un fichier de test :
        </para>
          <screen><prompt>&gt; </prompt><command>echo "test file" | sudo tee /srv/tftpboot/test.txt</command></screen>
        </step>
        <step>
          <para>
          Récupérez le fichier de test via TFTP :
        </para>
          <screen><prompt>&gt; </prompt><command>tftp localhost -c get test.txt /tmp/tftp-test.txt</command></screen>
        </step>
        <step>
          <para>
          Vérifiez que le fichier a bien été récupéré :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /tmp/tftp-test.txt</command></screen>
        </step>
        <step>
          <para>
          Nettoyez les fichiers de test :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>rm /srv/tftpboot/test.txt /tmp/tftp-test.txt</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-troubleshooting">
      <title>Dépannage de la configuration TFTP</title>
      <para>
      Problèmes courants lors de la configuration des services TFTP pour les environnements de démarrage PXE.
    </para>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-service-conflicts">
        <title>Conflits de services sur le port 69</title>
        <para>
        <systemitem>in.tftpd</systemitem> et <systemitem>dnsmasq</systemitem> utilisent tous deux le port UDP 69 pour les services TFTP et ne peuvent pas s'exécuter simultanément.
      </para>
        <procedure xml:id="proc-resolve-tftp-conflicts">
          <title>Résolution des conflits de services TFTP</title>
          <step>
            <para>
            Vérifiez quels sont les services en cours d'exécution :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status tftp.service dnsmasq</command></screen>
          </step>
          <step>
            <para>
            Vérifiez ce qui utilise le port 69 :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :69</command></screen>
          </step>
          <step>
            <para>
            Arrêtez le service en conflit (exemple pour dnsmasq) :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl stop dnsmasq</command></screen>
          </step>
          <step>
            <para>
            Démarrez votre service TFTP préféré :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl start tftp.service</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-directory">
        <title>Problèmes liés au répertoire TFTP</title>
        <para>
        Des problèmes d'accès au répertoire racine TFTP peuvent empêcher la distribution des fichiers.
      </para>
        <procedure xml:id="proc-debug-tftp-directory">
          <title>Vérification de la configuration du répertoire TFTP</title>
          <step>
            <para>
            Vérifiez la configuration du répertoire TFTP pour in.tftpd :
          </para>
            <screen><prompt>&gt; </prompt><command>grep TFTP_DIRECTORY /etc/sysconfig/tftp</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration du répertoire TFTP pour dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>grep tftp-root /etc/dnsmasq.d/tftp.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez si le répertoire existe :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/</command></screen>
          </step>
          <step>
            <para>
            S'il est manquant, créez le répertoire :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/tftpboot</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-verbose">
        <title>Activation de la journalisation TFTP</title>
        <para>
        La journalisation verbeuse permet d'identifier les problèmes d'accès aux fichiers lors des transferts TFTP.
      </para>
        <procedure xml:id="proc-enable-tftp-verbose">
          <title>Activation de la journalisation TFTP verbeuse</title>
          <step>
            <para>
            Vérifiez les options TFTP actuelles :
          </para>
            <screen><prompt>&gt; </prompt><command>grep TFTP_OPTIONS /etc/sysconfig/tftp</command></screen>
          </step>
          <step>
            <para>
            Activez la journalisation verbeuse :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command></screen>
          </step>
          <step>
            <para>
            Redémarrez le service TFTP :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart tftp.service</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux TFTP :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u tftp.service -f</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Une fois TFTP configuré, vous pouvez passer à la configuration des services HTTP pour desservir les fichiers du programme d'installation et les services DHCP de manière à diriger les clients PXE vers les chargeurs de démarrage appropriés.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-configure-nginx">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration de nginx pour la distribution HTTP</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer nginx pour qu'il desserve le contenu du démarrage PXE via HTTP, de manière à permettre aux clients de charger des fichiers du programme d'installation, tels que les images du kernel Linux, initrd et squashfs, à partir d'un emplacement central. La distribution HTTP offre de meilleures performances que TFTP pour les fichiers volumineux et est requise pour les installations de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> à l'aide d'Agama.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-nginx-intro">
      <title>Introduction</title>
      <para>
      nginx sert de serveur HTTP pour les environnements de démarrage PXE et permet d'accéder aux fichiers du programme d'installation par le biais d'une distribution basée sur le Web. Le serveur HTTP expose le répertoire de démarrage TFTP et les dépôts d'installation, ce qui permet aux clients PXE de télécharger les images du kernel Linux, les fichiers initrd et les composants du programme d'installation Agama via HTTP plutôt que via le protocole TFTP, qui est plus lent.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>nginx</package> est installé.
        </para>
        </listitem>
        <listitem>
          <para>
          Les fichiers de démarrage PXE sont organisés sous <filename>/srv/tftpboot/boot</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Les dépôts d'installation sont disponibles sous <filename>/srv/install</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour modifier la configuration nginx.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-setup">
      <title>Configuration de nginx pour le démarrage PXE</title>
      <para>
      La configuration de nginx définit des alias d'emplacement qui exposent le répertoire de démarrage TFTP et les dépôts d'installation par le biais d'URL HTTP.
    </para>
      <procedure xml:id="proc-configure-nginx">
        <title>Configuration du serveur HTTP nginx</title>
        <step>
          <para>
          Éditez le fichier de configuration nginx :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>vim /etc/nginx/nginx.conf</command></screen>
        </step>
        <step>
          <para>
          Configurez le bloc du serveur HTTP dans la section <literal>http</literal> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/nginx/nginx.conf &lt;&lt; 'EOF'</command>
http {

    include             mime.types;
    default_type        application/octet-stream;

    charset             utf-8;
    sendfile            on;
    keepalive_timeout   65;

    server {
        listen          80  default_server;
        listen     [::]:80  default_server;

        location / {
            root   /srv/www/htdocs/;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /srv/www/htdocs/;
        }

        # Expose TFTP boot directory for HTTP boot
        location /boot {
            alias      /srv/tftpboot/boot;
            autoindex  on;
        }

        # Expose installation repositories and profiles
        location /install {
            alias      /srv/install;
            autoindex  on;
        }
    }
}

events {
    worker_connections  1024;
}
EOF
</screen>
        </step>
        <step>
          <para>
          Testez la syntaxe de la configuration nginx :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>nginx -t</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service nginx :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now nginx.service</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-verify">
      <title>Vérification de la configuration nginx</title>
      <para>
      Testez la fonctionnalité du serveur HTTP pour vous assurer qu'il peut desservir les fichiers de démarrage PXE et le contenu de l'installation aux clients.
    </para>
      <procedure xml:id="proc-verify-nginx">
        <title>Test du serveur HTTP nginx</title>
        <step>
          <para>
          Testez l'accès HTTP aux fichiers de démarrage :
        </para>
          <screen><prompt>&gt; </prompt><command>curl -I http://localhost/boot/</command></screen>
        </step>
        <step>
          <para>
          Testez l'accès au répertoire d'installation :
        </para>
          <screen><prompt>&gt; </prompt><command>curl -I http://localhost/install/</command></screen>
        </step>
        <step>
          <para>
          Vérifiez qu'un fichier spécifique du programme d'installation est accessible :
        </para>
          <screen><prompt>&gt; </prompt><command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-troubleshooting">
      <title>Dépannage de la configuration nginx</title>
      <para>
      Problèmes courants lors de la configuration de nginx pour la distribution HTTP au démarrage PXE.
    </para>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-config">
        <title>Erreurs de syntaxe de la configuration</title>
        <para>
        Une syntaxe de configuration nginx incorrecte empêche le service de démarrer ou de se recharger correctement.
      </para>
        <procedure xml:id="proc-debug-nginx-config">
          <title>Résolution des problèmes liés à la configuration nginx</title>
          <step>
            <para>
            Testez la syntaxe de la configuration :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>nginx -t</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut du service nginx si le démarrage échoue :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status nginx.service</command></screen>
          </step>
          <step>
            <para>
            Affichez les journaux d'erreurs détaillés :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u nginx.service -f</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le fichier journal des erreurs de nginx :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/nginx/error.log</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-permissions">
        <title>Problèmes liés à l'accès aux fichiers et aux autorisations</title>
        <para>
        nginx peut ne pas parvenir à desservir des fichiers en raison d'autorisations incorrectes ou de répertoires manquants.
      </para>
        <procedure xml:id="proc-debug-nginx-permissions">
          <title>Résolution des problèmes liés à l'accès aux fichiers</title>
          <step>
            <para>
            Vérifiez que le répertoire de démarrage existe et qu'il est accessible :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/</command></screen>
          </step>
          <step>
            <para>
            Vérifiez si le répertoire d'installation existe :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/install/</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que nginx peut lire les répertoires :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo -u nginx ls /srv/tftpboot/boot/</command></screen>
          </step>
          <step>
            <para>
            Créez les répertoires manquants le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /srv/install</command></screen>
          </step>
          <step>
            <para>
            Définissez les autorisations appropriées :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>chmod -R 755 /srv/tftpboot/boot /srv/install</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-port">
        <title>Conflits de liaison de port</title>
        <para>
        nginx peut ne pas parvenir à démarrer si un autre service utilise le port 80.
      </para>
        <procedure xml:id="proc-debug-nginx-port">
          <title>Résolution des conflits de port</title>
          <step>
            <para>
            Vérifiez ce qui utilise le port 80 :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -tlnp | grep :80</command></screen>
          </step>
          <step>
            <para>
            Arrêtez les services en conflit le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl stop apache2</command></screen>
          </step>
          <step>
            <para>
            Redémarrez le service nginx :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl start nginx.service</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que nginx écoute sur le port 80 :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -tlnp | grep :80</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Une fois nginx configuré pour la distribution HTTP, vous pouvez passer à la configuration des services DHCP de manière à diriger les clients PXE vers les chargeurs de démarrage et les ressources HTTP appropriés.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-configure-dns">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration d'un serveur DNS à l'aide de dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer les services DNS à l'aide de dnsmasq afin d'assurer la résolution des noms d'hôte pour les clients PXE qui accèdent aux ressources d'installation de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. La configuration DNS permet aux clients d'utiliser des noms d'hôtes au lieu d'adresses IP dans les URL de démarrage et les configurations DHCP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-dns-intro">
      <title>Introduction</title>
      <para>
      Les services DNS permettent aux clients PXE de résoudre les noms d'hôtes dans les URL de démarrage et les sources d'installation. Bien que la configuration complète d'un serveur DNS dépasse le cadre de ce document, cette section présente une configuration DNS de base utilisant dnsmasq qui permet aux clients de résoudre le nom d'hôte du serveur PXE (<replaceable>PXE.EXAMPLE.NET</replaceable>) en adresses IP.
    </para>
      <para>
      Sans configuration DNS, les URL de démarrage doivent utiliser directement des adresses IP, telles que <literal>http://192.168.1.200/</literal> ou <literal>http://[2001:db8:0:1::200]/</literal>. Certaines implémentations de microprogrammes BIOS/UEFI ne prennent pas en charge les noms d'hôtes dans les URL TFTP DHCP et requièrent des adresses IP telles que <literal>tftp://[2001:db8:0:1::200]/</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-requirements">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>dnsmasq</package> est installé.
        </para>
        </listitem>
        <listitem>
          <para>
          Des adresses IP statiques sont configurées pour le serveur PXE.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services DNS.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-setup">
      <title>Configuration de services DNS dnsmasq</title>
      <para>
      La configuration DNS dnsmasq assure la résolution des noms d'hôtes locaux et utilise des serveurs de noms en amont pour les requêtes externes.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dns">
        <title>Configuration d'un serveur DNS dnsmasq</title>
        <step>
          <para>
          Créez le fichier de configuration DNS pour dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/dnsmasq.d/dns.conf &lt;&lt; 'EOF'</command>
# DNS configuration file for dnsmasq

# Log DNS queries
log-queries

# DNS cache behavior
cache-size=10000
local-ttl=60
neg-ttl=10

# Never forward A or AAAA queries for plain names to upstream name servers
domain-needed

# Add local domain to simple names in /etc/hosts and DHCP
expand-hosts

# Specifies DNS domain and networks including local forward and reverse declarations
domain=<replaceable>EXAMPLE.NET</replaceable>,192.168.1.0/24,local
domain=<replaceable>EXAMPLE.NET</replaceable>,2001:db8:0:1::/64,local
EOF
</screen>
        </step>
        <step>
          <para>
          Ajoutez des entrées de noms d'hôtes au fichier des hôtes (hosts) du système :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /etc/hosts &lt;&lt; 'EOF'</command>
192.168.1.200 <replaceable>PXE.EXAMPLE.NET</replaceable>
2001:db8:0:1::200 <replaceable>PXE.EXAMPLE.NET</replaceable>
EOF
</screen>
        </step>
        <step>
          <para>
          Testez la configuration dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>dnsmasq --test</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now dnsmasq</command></screen>
        </step>
      </procedure>
      <note>
        <title>comportement du transfert DNS</title>
        <para>
        Par défaut, dnsmasq utilise les serveurs de noms de <filename>/etc/resolv.conf</filename> comme redirecteurs et fournit des enregistrements à partir de <filename>/etc/hosts</filename>. Cela permet au serveur PXE de résoudre les noms d'hôtes externes tout en fournissant une résolution locale pour les services liés à PXE.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-verify">
      <title>Vérification de la configuration DNS</title>
      <para>
      Testez la fonctionnalité du serveur DNS pour vous assurer que la résolution du nom d'hôte fonctionne pour les clients PXE.
    </para>
      <procedure xml:id="proc-verify-dns">
        <title>Test de la fonctionnalité du serveur DNS</title>
        <step>
          <para>
          Testez la résolution du nom d'hôte IPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost</command></screen>
        </step>
        <step>
          <para>
          Testez la résolution du nom d'hôte IPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost | grep 2001:db8</command></screen>
        </step>
        <step>
          <para>
          Testez la recherche DNS inversée pour IPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>nslookup 192.168.1.200 localhost</command></screen>
        </step>
        <step>
          <para>
          Vérifiez que le transfert DNS externe fonctionne toujours :
        </para>
          <screen><prompt>&gt; </prompt><command>nslookup google.com localhost</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-troubleshooting">
      <title>Dépannage de la configuration DNS</title>
      <para>
      Problèmes courants lors de la configuration de dnsmasq pour les services DNS dans les environnements PXE.
    </para>
      <section xml:id="sles-pxe-server-dns-troubleshoot-config">
        <title>Problèmes de configuration et de service</title>
        <para>
        dnsmasq peut ne pas démarrer en raison d'erreurs de configuration ou de conflits de ports.
      </para>
        <procedure xml:id="proc-debug-dns-config">
          <title>Résolution des problèmes de configuration DNS</title>
          <step>
            <para>
            Testez la syntaxe de la configuration dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>dnsmasq --test</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut du service dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status dnsmasq</command></screen>
          </step>
          <step>
            <para>
            Vérifiez ce qui utilise le port DNS 53 :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :53</command></screen>
          </step>
          <step>
            <para>
            Consultez les journaux dnsmasq pour vérifier s'il y a des erreurs :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq -f</command></screen>
          </step>
          <step>
            <para>
            Arrêtez les services DNS en conflit le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl stop systemd-resolved</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-resolution">
        <title>Échecs de la résolution de nom d'hôte</title>
        <para>
        Les requêtes DNS peuvent échouer en raison d'une configuration incorrecte ou d'entrées de noms d'hôtes manquantes.
      </para>
        <procedure xml:id="proc-debug-dns-resolution">
          <title>Diagnostic des problèmes de résolution DNS</title>
          <step>
            <para>
            Vérifiez si les entrées de noms d'hôtes existent dans le fichier hosts :
          </para>
            <screen><prompt>&gt; </prompt><command>grep <replaceable>PXE.EXAMPLE.NET</replaceable> /etc/hosts</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration du domaine dans dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>grep domain= /etc/dnsmasq.d/dns.conf</command></screen>
          </step>
          <step>
            <para>
            Testez une requête DNS avec sortie verbeuse :
          </para>
            <screen><prompt>&gt; </prompt><command>dig @localhost <replaceable>PXE.EXAMPLE.NET</replaceable></command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux de requêtes dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq | grep "query"</command></screen>
          </step>
          <step>
            <para>
            Redémarrez dnsmasq pour recharger la configuration :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dnsmasq</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-forwarding">
        <title>Problèmes de transfert DNS</title>
        <para>
        Les requêtes DNS externes peuvent échouer si la configuration du serveur de noms en amont est incorrecte.
      </para>
        <procedure xml:id="proc-debug-dns-forwarding">
          <title>Dépannage des problèmes de transfert DNS</title>
          <step>
            <para>
            Vérifiez la configuration du serveur de noms en amont :
          </para>
            <screen><prompt>&gt; </prompt><command>cat /etc/resolv.conf</command></screen>
          </step>
          <step>
            <para>
            Testez une requête directe auprès du serveur de noms en amont :
          </para>
            <screen><prompt>&gt; </prompt><command>nslookup google.com 8.8.8.8</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration du transfert dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -E "server=|no-resolv" /etc/dnsmasq.d/dns.conf</command></screen>
          </step>
          <step>
            <para>
            Ajoutez un serveur de noms spécifique en amont le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>echo "server=8.8.8.8" &gt;&gt; /etc/dnsmasq.d/dns.conf</command></screen>
          </step>
          <step>
            <para>
            Redémarrez le service dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dnsmasq</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Une fois les services DNS configurés, les clients PXE peuvent résoudre les noms d'hôtes dans les URL de démarrage et les sources d'installation. Vous pouvez procéder à la configuration des services DHCP qui font référence au serveur DNS pour la configuration du client.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-configure-ntp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration d'un serveur NTP à l'aide de <systemitem>chrony</systemitem></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer les services NTP à l'aide de <systemitem>chrony</systemitem> afin d'assurer une synchronisation horaire précise pour les clients PXE pendant les installations de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Une synchronisation horaire correcte est essentielle pour la validation des certificats et la journalisation système lors d'installations basées sur le réseau.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-ntp-intro">
      <title>Introduction</title>
      <para>
      Les services NTP assurent une synchronisation horaire précise dans l'ensemble de l'infrastructure réseau. Pour les environnements de démarrage PXE, la synchronisation horaire est cruciale pour la validation des certificats lors des connexions HTTPS, l'horodatage correct des journaux et les opérations système coordonnées. Cette section présente la configuration de base du serveur NTP à l'aide de <systemitem>chrony</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>chrony</package> est installé.
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install chrony</command></screen>
        </listitem>
        <listitem>
          <para>
          La connectivité réseau est assurée vers les serveurs NTP en amont.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services NTP.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-setup">
      <title>Configuration du service NTP <systemitem>chrony</systemitem></title>
      <para>
      Le service <systemitem>chrony</systemitem> fournit une fonctionnalité NTP avec une synchronisation horaire automatique avec les serveurs en amont et des fonctionnalités d'heure locale pour les clients du réseau.
    </para>
      <procedure xml:id="proc-configure-chrony">
        <title>Configuration du serveur NTP <systemitem>chrony</systemitem></title>
        <step>
          <para>
          Activez et démarrez le service <systemitem>chrony</systemitem> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now chronyd.service</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-verify">
      <title>Vérification de la configuration NTP</title>
      <para>
      Testez la fonctionnalité du service NTP pour vous assurer que la synchronisation horaire fonctionne correctement.
    </para>
      <procedure xml:id="proc-verify-ntp">
        <title>Test de la fonctionnalité du serveur NTP</title>
        <step>
          <para>
          Vérifiez le statut du service <systemitem>chrony</systemitem> :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status chronyd.service</command></screen>
        </step>
        <step>
          <para>
          Affichez le statut actuel de la synchronisation horaire :
        </para>
          <screen><prompt>&gt; </prompt><command>chronyc tracking</command></screen>
        </step>
        <step>
          <para>
          Listez les sources NTP configurées :
        </para>
          <screen><prompt>&gt; </prompt><command>chronyc sources</command></screen>
        </step>
        <step>
          <para>
          Vérifiez les statistiques du serveur NTP :
        </para>
          <screen><prompt>&gt; </prompt><command>chronyc sourcestats</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-troubleshooting">
      <title>Dépannage de la configuration NTP</title>
      <para>
      Problèmes courants lors de la configuration de <systemitem>chrony</systemitem> pour les services NTP dans les environnements PXE.
    </para>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-service">
        <title>Problème de démarrage du service</title>
        <para>Le service <systemitem>chrony</systemitem> peut ne pas démarrer en raison d'erreurs de configuration ou de problèmes de connectivité réseau.
      </para>
        <procedure xml:id="proc-debug-ntp-service">
          <title>Résolution des problèmes du service NTP</title>
          <step>
            <para>
            Vérifiez le statut du service <systemitem>chrony</systemitem> et ses journaux :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status chronyd.service</command></screen>
          </step>
          <step>
            <para>
            Affichez les journaux détaillés du service :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u chronyd.service -f</command></screen>
          </step>
          <step>
            <para>
            Testez la configuration <systemitem>chrony</systemitem> :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>chronyd -Q</command></screen>
          </step>
          <step>
            <para>
            Redémarrez le service le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart chronyd.service</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-sync">
        <title>Échecs de synchronisation horaire</title>
        <para>
        La synchronisation horaire peut échouer en raison de problèmes de réseau ou d'une mauvaise configuration du serveur.
      </para>
        <procedure xml:id="proc-debug-ntp-sync">
          <title>Diagnostic des problèmes de synchronisation horaire</title>
          <step>
            <para>
            Vérifiez le statut actuel de la synchronisation :
          </para>
            <screen><prompt>&gt; </prompt><command>chronyc tracking</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la connectivité de la source NTP :
          </para>
            <screen><prompt>&gt; </prompt><command>chronyc sources -v</command></screen>
          </step>
          <step>
            <para>
            Forcez une synchronisation immédiate :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>chronyc makestep</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'heure système par rapport à l'horloge matérielle :
          </para>
            <screen><prompt>&gt; </prompt><command>timedatectl status</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la connectivité réseau vers les serveurs NTP :
          </para>
            <screen><prompt>&gt; </prompt><command>chronyc activity</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-firewall">
        <title>Pare-feu et problèmes de réseau</title>
        <para>
        Le trafic NTP peut être bloqué par des règles de pare-feu, ce qui empêche la synchronisation horaire.
      </para>
        <procedure xml:id="proc-debug-ntp-firewall">
          <title>Résolution des problèmes de connectivité réseau NTP</title>
          <step>
            <para>
            Vérifiez si le port NTP est ouvert dans le pare-feu :
          </para>
            <screen><prompt>&gt; </prompt><command>firewall-cmd --list-services | grep ntp</command></screen>
          </step>
          <step>
            <para>
            Ajoutez le service NTP au pare-feu le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --permanent --add-service=ntp</command></screen>
          </step>
          <step>
            <para>
            Rechargez la configuration du pare-feu :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd --reload</command></screen>
          </step>
          <step>
            <para>
            Testez manuellement la connectivité NTP :
          </para>
            <screen><prompt>&gt; </prompt><command>ntpdate -q pool.ntp.org</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'utilisation du port <systemitem>chrony</systemitem> :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :123</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Si les services NTP sont configurés, le serveur et les clients PXE maintiendront une synchronisation horaire précise. Cela garantit une validation correcte des certificats et une coordination des opérations système lors d'installations basées sur le réseau.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-ipv6-router">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration des annonces de routeur IPv6</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section décrit comment configurer la fonctionnalité d'annonces de routeur IPv6 afin de fournir des annonces de routeur adéquates aux clients PXE. Les annonces de routeur IPv6 permettent la configuration du routage IPv6 et la configuration automatique des adresses DHCPv6 avec état pour les installations <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-ipv6-router-intro">
      <title>Introduction</title>
      <para>
      Les annonces de routeur (RA) IPv6 fournissent des informations essentielles sur la configuration du réseau aux clients PXE, notamment les paramètres de routage IPv6 et de configuration automatique de l'adresse DHCPv6. Cette section suppose qu'un routeur IPv6 est configuré pour fournir des annonces de routeur adéquates afin de configurer le routage IPv6 vers le réseau et la route par défaut, et d'activer la configuration automatique de l'adresse DHCPv6 avec état à l'aide de <literal>AdvManagedFlag on</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>radvd</package> est installé.
        </para>
        </listitem>
        <listitem>
          <para>
          Configuration du réseau IPv6 sur l'interface du serveur
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services d'annonces de routeur.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-setup">
      <title>Configuration de <systemitem>radvd</systemitem> pour les annonces de routeur IPv6</title>
      <para>
      Le service <systemitem>radvd</systemitem> fournit une fonctionnalité d'annonce de routeur IPv6 utilisant la configuration définie dans <filename>/etc/radvd.conf</filename>.
    </para>
      <procedure xml:id="proc-configure-radvd">
        <title>Configuration des annonces de routeur IPv6 <systemitem>radvd</systemitem></title>
        <step>
          <para>
          Configurez le service <systemitem>radvd</systemitem> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/radvd.conf &lt;&lt; 'EOF'</command>
interface eno1
{
    # radvd options
    IgnoreIfMissing on;                 # Do not fail and exit when interface is missed
    AdvSendAdvert on;                   # Sending RAs on the interface is not disabled

    # Configuration settings

    AdvManagedFlag on;                  # Request IPv6 address and dns options via DHCPv6
    AdvOtherConfigFlag off;             # Request only dns info via DHCPv6, IP via SLAAC

    AdvDefaultLifetime 1800;            # Add default route via this router for 1800sec

    prefix 2001:db8:0:1::/64            # Add direct route for this local network/prefix
    {
        AdvAutonomous           off;    # Assign IPv6 address via SLAAC
        AdvValidLifetime        7200;
        AdvPreferredLifetime    3600;
    };
};
EOF
</screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service <systemitem>radvd</systemitem> :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now radvd</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-verify">
      <title>Vérification des annonces de routeur IPv6</title>
      <para>
      Testez la fonctionnalité d'annonces de routeur IPv6 (IPv6 RA) pour garantir sa bonne configuration et son fonctionnement correct.
    </para>
      <procedure xml:id="proc-verify-radvd">
        <title>Test des annonces de routeur IPv6</title>
        <step>
          <para>
          Vérifiez le statut du service <systemitem>radvd</systemitem> :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
        </step>
        <step>
          <para>
          Passez en revue et vérifiez les paramètres IPv6 RA à l'aide de <command>ravdump</command> :
        </para>
          <screen><prompt>&gt; </prompt><command>radvdump</command></screen>
          <para>
          L'utilitaire <command>radvdump</command> affiche les paramètres IPv6 RA envoyés par le routeur IPv6 toutes les quelques minutes.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-forwarding">
      <title>Configuration du transfert IP pour la fonctionnalité de routeur</title>
      <para>
      Si le serveur PXE fait également office de routeur, le transfert IP doit être activé pour permettre au système de remplir un rôle de routeur.
    </para>
      <procedure xml:id="proc-enable-ip-forwarding">
        <title>Activation du transfert IP sur le serveur PXE</title>
        <step>
          <para>
          Créez le fichier de configuration réseau :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/sysctl.d/90-network.conf &lt;&lt; 'EOF'</command>
# This machine is a router
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Accept host autoconf on router uplink
net.ipv6.conf.uplink.accept_ra = 2
EOF
</screen>
        </step>
        <step>
          <para>
          Appliquez les paramètres de configuration réseau :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>sysctl -p /etc/sysctl.d/90-network.conf</command></screen>
        </step>
      </procedure>
      <note>
        <title>considérations relatives à la configuration du routeur</title>
        <para>
        Par défaut, un routeur ne traite pas les annonces de routeur IPv6 pour la configuration automatique de l'hôte. Pour accepter les annonces de routeur IPv6 sur une interface de liaison montante de routeur, le paramètre sysctl <literal>accept_ra = 2</literal> est requis. Consultez la section Configuration du réseau du Guide d'administration pour plus de détails sur la configuration du routeur, y compris les réglages du pare-feu et les autres étapes nécessaires.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-troubleshooting">
      <title>Dépannage des annonces de routeur IPv6</title>
      <para>
      Problèmes courants lors de la configuration des annonces de routeur IPv6 pour les environnements PXE.
    </para>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-service">
        <title>Problèmes liés au service <systemitem>radvd</systemitem></title>
        <para>
        Le service <systemitem>radvd</systemitem> peut ne pas démarrer en raison d'erreurs de configuration ou de problèmes d'interface.
      </para>
        <procedure xml:id="proc-debug-radvd-service">
          <title>Résolution des problèmes liés au service <systemitem>radvd</systemitem></title>
          <step>
            <para>
            Vérifiez le statut du service <systemitem>radvd</systemitem> et ses journaux :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
          </step>
          <step>
            <para>
            Affichez les journaux détaillés du service :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u radvd -f</command></screen>
          </step>
          <step>
            <para>
            Testez la syntaxe de la configuration <systemitem>radvd</systemitem> :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>radvd -C /etc/radvd.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez si l'interface spécifiée existe :
          </para>
            <screen><prompt>&gt; </prompt><command>ip link show eno1</command></screen>
          </step>
          <step>
            <para>
            Redémarrez le service après avoir corrigé la configuration :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart radvd</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-forwarding">
        <title>Problèmes liés à la configuration du transfert IP</title>
        <para>
        Des paramètres de transfert IP incorrects peuvent empêcher le bon déroulement de la fonctionnalité de routeur.
      </para>
        <procedure xml:id="proc-debug-ip-forwarding">
          <title>Diagnostic des problèmes liés au transfert IP</title>
          <step>
            <para>
            Vérifiez le statut actuel du transfert IP :
          </para>
            <screen><prompt>&gt; </prompt><command>sysctl net.ipv4.conf.all.forwarding</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut du transfert IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>sysctl net.ipv6.conf.all.forwarding</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le fichier de configuration sysctl :
          </para>
            <screen><prompt>&gt; </prompt><command>cat /etc/sysctl.d/90-network.conf</command></screen>
          </step>
          <step>
            <para>
            Appliquez la configuration si les valeurs sont incorrectes :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sysctl -p /etc/sysctl.d/90-network.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le paramètre accept_ra sur l'interface de liaison montante :
          </para>
            <screen><prompt>&gt; </prompt><command>sysctl net.ipv6.conf.uplink.accept_ra</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-ra">
        <title>Problèmes liés à la réception des annonces de routeur</title>
        <para>
        Les clients peuvent ne pas recevoir ou traiter correctement les annonces de routeur IPv6.
      </para>
        <procedure xml:id="proc-debug-ra-reception">
          <title>Dépannage des problèmes liés à la réception des annonces de routeur</title>
          <step>
            <para>
            Surveillez les annonces des routeurs à l'aide de <command>ravdump</command> :
          </para>
            <screen><prompt>&gt; </prompt><command>radvdump -d</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration de l'interface IPv6 sur les clients :
          </para>
            <screen><prompt>&gt; </prompt><command>ip -6 addr show</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la table de routage IPv6 sur les clients :
          </para>
            <screen><prompt>&gt; </prompt><command>ip -6 route show</command></screen>
          </step>
          <step>
            <para>
            Testez la connectivité IPv6 avec le routeur :
          </para>
            <screen><prompt>&gt; </prompt><command>ping6 2001:db8:0:1::1</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les règles de pare-feu pour ICMPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>firewall-cmd --list-protocols | grep ipv6-icmp</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Si l'annonce de routeur IPv6 est configurée, les clients PXE peuvent recevoir une configuration réseau IPv6 correcte. Cela active la fonctionnalité DHCPv6 et la connectivité IPv6 pour les installations basées sur le réseau.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-dhcp-dnsmasq">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration d'un serveur DHCP à l'aide de dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer les services DHCP à l'aide de dnsmasq afin de fournir les informations de configuration réseau et de démarrage PXE pour les installations <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Le serveur DHCP dnsmasq utilise la configuration basée sur les balises pour prendre en charge les clients PXE IPv4 et IPv6 avec des fonctionnalités de démarrage UEFI et BIOS.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-intro">
      <title>Introduction</title>
      <para>
      Le serveur DHCP dnsmasq fournit des informations sur la configuration réseau et le fichier de démarrage aux clients PXE à l'aide d'un système basé sur les balises afin d'établir une correspondance avec les types de clients et de fournir les chargeurs de démarrage appropriés. Cette configuration prend en charge les correspondances PXEClient et HTTPClient qui fonctionnent pour DHCPv4 et DHCPv6, permettant le démarrage via les systèmes UEFI et BIOS sur de multiples architectures.
    </para>
      <important>
        <title>limites HTTPClient dans dnsmasq</title>
        <para>
        Les versions 2.90 et antérieures de dnsmasq ne prennent pas en charge l'envoi de l'option de classe de fournisseur (vendor-class) 6:16 aux clients DHCPv6 pour les configurations HTTPClient. Pour une prise en charge complète de HTTPClient, envisagez d'utiliser des serveurs DHCP Kea ou ISC.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Le paquet <package>dnsmasq</package> est installé.
        </para>
        </listitem>
        <listitem>
          <para>
          Les fichiers de démarrage PXE sont correctement organisés sous <filename>/srv/tftpboot</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          L'interface réseau est configurée pour le service DHCP.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services DHCP.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-setup">
      <title>Configuration des services DHCP dnsmasq</title>
      <para>
      La configuration DHCP dnsmasq comprend la mise en correspondance des types de clients, les plages réseau et les affectations de fichiers de démarrage pour les réseaux IPv4 et IPv6.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dhcp">
        <title>Configuration d'un serveur DHCP dnsmasq</title>
        <step>
          <para>
          Créez le fichier de configuration DHCP pour dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>
# DHCP configuration file for dnsmasq

# Log DHCP processing
log-dhcp

# This is the only DHCP server, don't ignore unknown clients/send NAK
dhcp-authoritative

# Disable re-use of the DHCPv4 servername and filename fields as extra
# option space, which may confuse old or broken clients
dhcp-no-override

# IPv4 PXE/HTTP boot client matches (no enterprise number)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,HTTPClient:Arch:00019

# IPv6 PXE/HTTP boot client matches (enterprise:343 intel)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,enterprise:343,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,enterprise:343,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,enterprise:343,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,enterprise:343,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,enterprise:343,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,enterprise:343,HTTPClient:Arch:00019
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez la plage et les options DHCP IPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 range and options
dhcp-range=set:net0v4,192.168.1.100,192.168.1.199,255.255.255.0,1h
dhcp-option=tag:net0v4,option:domain-search,example.net
dhcp-option=tag:net0v4,option:dns-server,192.168.1.200
dhcp-option=tag:net0v4,option:ntp-server,192.168.1.1
dhcp-option=tag:net0v4,option:router,192.168.1.1
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez les options de démarrage PXE IPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 PXEClient boot
dhcp-boot=tag:net0v4,tag:tftp_bios_x86_pc,/boot/grub2/i386-pc/core.0,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_x86_64,/boot/grub2/x86_64-efi/bootx64.efi,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_ieee_ppc_64,/boot/grub2/powerpc-ieee1275/core.elf,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_arm_64,/boot/grub2/arm64-efi/bootaa64.efi,192.168.1.200

# IPv4 HTTPClient boot
dhcp-option-force=tag:net0v4,tag:http_uefi_x86_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_x86_64,http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option-force=tag:net0v4,tag:http_uefi_arm_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_arm_64,http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez la plage et les options DHCP IPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 range and options
dhcp-range=set:net0v6,2001:db8:0:1:d::,2001:db8:0:1:d::ffff,64,1h
dhcp-option=tag:net0v6,option6:domain-search,example.net
dhcp-option=tag:net0v6,option6:dns-server,[2001:db8:0:1::200]
dhcp-option=tag:net0v6,option6:sntp-server,[2001:db8:0:1::1]
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez les options de démarrage PXE IPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 PXEClient boot
dhcp-option=tag:net0v6,tag:tftp_bios_x86_pc,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0
dhcp-option=tag:net0v6,tag:tftp_uefi_x86_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option=tag:net0v6,tag:tftp_ieee_ppc_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf
dhcp-option=tag:net0v6,tag:tftp_uefi_arm_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi

# IPv6 HTTPClient boot
# Note: dnsmasq &lt;= 2.90 does not support sending vendor-class option6:16 back to client
EOF
</screen>
        </step>
        <step>
          <para>
          Testez la configuration dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>dnsmasq --test</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now dnsmasq</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-verify">
      <title>Vérification de la configuration DHCP</title>
      <para>
      Testez la fonctionnalité de serveur DHCP pour vous assurer que la configuration réseau est correcte et que le fichier de démarrage adéquat est distribué aux clients PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-dnsmasq">
        <title>Test du serveur DHCP dnsmasq</title>
        <step>
          <para>
          Vérifiez le statut du service dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dnsmasq</command></screen>
        </step>
        <step>
          <para>
          Vérifiez la liaison de port DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :67</command></screen>
        </step>
        <step>
          <para>
          Surveillez les assignations de baux DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq -f</command></screen>
        </step>
        <step>
          <para>
          Vérifiez les baux DHCP actifs :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /var/lib/dhcp/dhcpd.leases</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshooting">
      <title>Dépannage de la configuration DHCP dnsmasq</title>
      <para>
      Problèmes courants lors de la configuration de dnsmasq pour les services DHCP dans les environnements PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-service">
        <title>Problèmes liés à la configuration et au démarrage de services</title>
        <para>
        dnsmasq peut ne pas démarrer en raison d'erreurs de configuration ou de conflits de ports avec d'autres services DHCP.
      </para>
        <procedure xml:id="proc-debug-dnsmasq-dhcp-service">
          <title>Résolution des problèmes de service DHCP dnsmasq</title>
          <step>
            <para>
            Testez la syntaxe de la configuration dnsmasq :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>dnsmasq --test</command></screen>
          </step>
          <step>
            <para>
            Recherchez les éventuels conflits de ports DHCP :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :67</command></screen>
          </step>
          <step>
            <para>
            Arrêtez les services DHCP conflictuels :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl stop dhcpd</command></screen>
          </step>
          <step>
            <para>
            Affichez les journaux détaillés du service :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq -f</command></screen>
          </step>
          <step>
            <para>
            Redémarrez dnsmasq après avoir résolu les conflits :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dnsmasq</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-leases">
        <title>Problèmes liés aux assignations de baux DHCP</title>
        <para>
        Les clients peuvent ne pas recevoir d'adresses IP en raison de problèmes de configuration de plage ou de connectivité réseau.
      </para>
        <procedure xml:id="proc-debug-dhcp-leases">
          <title>Diagnostic des problèmes liés aux baux DHCP</title>
          <step>
            <para>
            Vérifiez la configuration de la plage DHCP :
          </para>
            <screen><prompt>&gt; </prompt><command>grep dhcp-range /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
          <step>
            <para>
            Surveillez les demandes DHCP en temps réel :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq -f | grep DHCP</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut de l'interface réseau :
          </para>
            <screen><prompt>&gt; </prompt><command>ip addr show</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le paramètre DHCP faisant autorité :
          </para>
            <screen><prompt>&gt; </prompt><command>grep dhcp-authoritative /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
          <step>
            <para>
            Testez la réponse DHCP avec dhcping :
          </para>
            <screen><prompt>&gt; </prompt><command>dhcping -s 192.168.1.200</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-pxe">
        <title>Problèmes liés à la distribution du fichier de démarrage PXE</title>
        <para>
        Les clients PXE peuvent recevoir des adresses IP mais ne pas démarrer en raison d'une configuration incorrecte du fichier de démarrage ou de problèmes liés à la correspondance des types de clients.
      </para>
        <procedure xml:id="proc-debug-pxe-boot">
          <title>Dépannage de la configuration du démarrage PXE</title>
          <step>
            <para>
            Vérifiez la correspondance de la classe de fournisseur du client :
          </para>
            <screen><prompt>&gt; </prompt><command>grep dhcp-vendorclass /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les chemins d'accès au fichier de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>grep dhcp-boot /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
          <step>
            <para>
            Testez l'accès TFTP aux fichiers de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux DHCP spécifiques à PXE :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq | grep -E "PXE|HTTP"</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'assignation des balises dans les journaux :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq | grep "tags:"</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-ipv6">
        <title>Problèmes liés à la configuration DHCP IPv6</title>
        <para>
        Les clients DHCP IPv6 nécessitent une configuration correcte des annonces de routeur et peuvent avoir des exigences d'adressage différentes de celles d'IPv4.
      </para>
        <procedure xml:id="proc-debug-ipv6-dhcp">
          <title>Résolution des problèmes liés à DHCP IPv6</title>
          <step>
            <para>
            Vérifiez la configuration de la plage DHCP IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "2001:db8" /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut des annonces de routeur IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
          </step>
          <step>
            <para>
            Surveillez les requêtes DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq | grep "DHCPv6"</command></screen>
          </step>
          <step>
            <para>
            Testez la connectivité IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>ping6 2001:db8:0:1::200</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration de l'option IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep option6 /etc/dnsmasq.d/dhcp.conf</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Avec les services DHCP dnsmasq configurés, les clients PXE peuvent recevoir des informations sur la configuration réseau et le fichier de démarrage à la fois pour les environnements IPv4 et IPv6. Le système basé sur les balises permet une assignation flexible des fichiers de démarrage en fonction de l'architecture du client et des exigences de la méthode de démarrage.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-dhcp-kea">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration d'un serveur DHCP à l'aide de Kea</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer les services DHCP à l'aide de Kea afin de fournir les informations de configuration réseau et de démarrage PXE pour les installations <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Kea est un serveur DHCP moderne qui prend en charge à la fois IPv4 et IPv6 avec une mise en correspondance de la classe du client pour les scénarios de démarrage PXE et HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-kea-intro">
      <title>Introduction</title>
      <para>
      Kea est le serveur DHCP moderne développé par ISC pour succéder au serveur DHCP ISC hérité. Il assure une prise en charge robuste à la fois de DHCPv4 et de DHCPv6 avec des fonctionnalités de classification des clients qui permettent de distribuer un fichier de démarrage approprié en fonction de l'architecture et de la méthode de démarrage de ces derniers. Kea utilise des fichiers de configuration basés sur JSON et prend en charge des fonctionnalités avancées telles que l'identification de la classe du fournisseur pour le démarrage HTTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Les paquets DHCP Kea <package>kea-dhcp4</package> et <package>kea-dhcp6</package> sont installés.
        </para>
        </listitem>
        <listitem>
          <para>
          Les fichiers de démarrage PXE sont correctement organisés sous <filename>/srv/tftpboot</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          L'interface réseau est configurée pour le service DHCP.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services DHCP.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv4">
      <title>Configuration du serveur DHCPv4 Kea</title>
      <para>
      La configuration DHCPv4 Kea utilise des classes de clients pour mettre en correspondance les types de clients PXE et HTTP et fournir des fichiers de démarrage appropriés pour différentes architectures.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv4">
        <title>Configuration du serveur DHCPv4 Kea</title>
        <step>
          <para>
          Configurez le serveur DHCPv4 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/kea/kea-dhcp4.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea4-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp4.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 3150,
    "valid-lifetime": 3600,
    "option-data": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00000'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/i386-pc/core.0"
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00007'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/x86_64-efi/bootx64.efi"
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:0000e'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/powerpc-ieee1275/core.elf"
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00011'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/arm64-efi/bootaa64.efi"
      },
      {
        "name": "httpclients#00016",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00016'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      },
      {
        "name": "httpclients#00019",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00019'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      }
    ],
    "subnet4": [
      {
        "id": 1,
        "subnet": "192.168.1.0/24",
        "pools": [
          {
            "pool": "192.168.1.100 - 192.168.1.199"
          }
        ],
        "option-data": [
          {
            "name": "routers",
            "data": "192.168.1.1"
          },
          {
            "name": "ntp-servers",
            "data": "192.168.1.1"
          },
          {
            "name": "domain-name-servers",
            "data": "192.168.1.200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp4",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp4.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Créez le répertoire pour les journaux de Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>mkdir -p /var/log/kea</command></screen>
        </step>
        <step>
          <para>
          Testez la configuration DHCPv4 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service DHCPv4 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now kea-dhcp4</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv6">
      <title>Configuration du serveur DHCPv6 Kea</title>
      <para>
      La configuration DHCPv6 Kea assure l'assignation d'adresses IPv6 et la fourniture des informations sur le fichier de démarrage à l'aide de la mise en correspondance de la classe de fournisseur pour différentes architectures de clients.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv6">
        <title>Configuration du serveur DHCPv6 Kea</title>
        <step>
          <para>
          Configurez le serveur DHCPv6 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/kea/kea-dhcp6.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp6": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea6-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp6.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 2880,
    "preferred-lifetime": 3600,
    "valid-lifetime": 7200,
    "option-data": [],
    "option-def": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00000'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0"
          }
        ]
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00007'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi"
          }
        ]
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:0000e'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf"
          }
        ]
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00011'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi"
          }
        ]
      }
    ],
    "subnet6": [
      {
        "id": 1,
        "subnet": "2001:db8:0:1::/64",
        "interface": "eno1",
        "pools": [
          {
            "pool": "2001:db8:0:1:d::/112"
          }
        ],
        "option-data": [
          {
            "name": "sntp-servers",
            "data": "2001:db8:0:1::1"
          },
          {
            "name": "dns-servers",
            "data": "2001:db8:0:1::200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp6.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Testez la configuration DHCPv6 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service DHCPv6 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now kea-dhcp6</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-verify">
      <title>Vérification de la configuration DHCP Kea</title>
      <para>
      Testez la fonctionnalité du serveur DHCP Kea pour vous assurer que la configuration réseau est correcte et que le fichier de démarrage adéquat est distribué aux clients PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-kea">
        <title>Test des serveurs DHCP Kea.</title>
        <step>
          <para>
          Vérifiez le statut du service DHCPv4 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status kea-dhcp4</command></screen>
        </step>
        <step>
          <para>
          Vérifiez le statut du service DHCPv6 Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status kea-dhcp6</command></screen>
        </step>
        <step>
          <para>
          Vérifiez la liaison de port DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>ss -ulnp | grep -E ":67|:547"</command></screen>
        </step>
        <step>
          <para>
          Surveillez les journaux DHCPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>tail -f /var/log/kea/dhcp4.log</command></screen>
        </step>
        <step>
          <para>
          Surveillez les journaux DHCPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>tail -f /var/log/kea/dhcp6.log</command></screen>
        </step>
        <step>
          <para>
          Vérifiez les baux DHCP actifs :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /var/lib/kea/dhcp4.leases</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-troubleshooting">
      <title>Dépannage de la configuration DHCP Kea</title>
      <para>
      Problèmes courants lors de la configuration des serveurs DHCP Kea pour les environnements de démarrage PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-config">
        <title>Problèmes de configuration et de service</title>
        <para>
        Les services Kea peuvent ne pas démarrer en raison d'erreurs de configuration JSON ou de problèmes d'interface réseau.
      </para>
        <procedure xml:id="proc-debug-kea-config">
          <title>Résolution des problèmes de configuration Kea</title>
          <step>
            <para>
            Testez la syntaxe de la configuration DHCPv4 :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Testez la syntaxe de la configuration DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command></screen>
          </step>
          <step>
            <para>
            Recherchez les éventuelles erreurs de syntaxe JSON :
          </para>
            <screen><prompt>&gt; </prompt><command>python3 -m json.tool /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration de l'interface réseau :
          </para>
            <screen><prompt>&gt; </prompt><command>ip addr show eno1</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les journaux du service Kea :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u kea-dhcp4 -f</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-leases">
        <title>Problèmes liés aux assignations de baux DHCP</title>
        <para>
        Les clients peuvent ne pas recevoir d'adresses IP en raison de problèmes de configuration de sous-réseau ou d'épuisement du pool.
      </para>
        <procedure xml:id="proc-debug-kea-leases">
          <title>Diagnostic des problèmes liés aux baux Kea</title>
          <step>
            <para>
            Vérifiez la configuration du sous-réseau et du pool :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 10 "subnet4\|pools" /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Surveillez les assignations de baux en temps réel :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/kea/dhcp4.log | grep -E "ALLOC|DISCOVER"</command></screen>
          </step>
          <step>
            <para>
            Recherchez les éventuels conflits dans la base de données des baux :
          </para>
            <screen><prompt>&gt; </prompt><command>cat /var/lib/kea/dhcp4.leases | tail -20</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la liaison de l'interface :
          </para>
            <screen><prompt>&gt; </prompt><command>grep interfaces /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Effacez la base de données des baux le cas échéant :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl stop kea-dhcp4</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>mv /var/lib/kea/dhcp4.leases /var/lib/kea/dhcp4.leases.backup</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl start kea-dhcp4</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-pxe">
        <title>Problèmes de mise en correspondance de la classe des clients PXE</title>
        <para>
        Les clients PXE peuvent recevoir des adresses IP mais ne pas obtenir le bon fichier de démarrage en raison de problèmes de configuration de la classe des clients.
      </para>
        <procedure xml:id="proc-debug-kea-pxe">
          <title>Dépannage de la classification des clients Kea</title>
          <step>
            <para>
            Vérifiez les définitions de classes des clients :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 5 "client-classes" /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Surveillez la mise en correspondance de la classe des clients dans les journaux :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/kea/dhcp4.log | grep -i class</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les modèles d'identificateur de classe de client :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "PXEClient\|HTTPClient" /etc/kea/kea-dhcp4.conf</command></screen>
          </step>
          <step>
            <para>
            Testez l'accessibilité du fichier de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>curl -I http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi</command></screen>
          </step>
          <step>
            <para>
            Activez la journalisation de débogage pour une analyse détaillée du client :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i 's/"debuglevel": 0/"debuglevel": 99/' /etc/kea/kea-dhcp4.conf</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart kea-dhcp4</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-ipv6">
        <title>Problèmes spécifiques à DHCPv6</title>
        <para>
        Les clients DHCP IPv6 nécessitent une configuration correcte des annonces de routeur et gèrent l'option de classe de fournisseur différemment des clients IPv4.
      </para>
        <procedure xml:id="proc-debug-kea-ipv6">
          <title>Résolution des problèmes DHCPv6 Kea</title>
          <step>
            <para>
            Vérifiez la configuration de sous-réseau DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 10 "subnet6" /etc/kea/kea-dhcp6.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut des annonces de routeur IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la correspondance de la classe de fournisseur DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/kea/dhcp6.log | grep "option\[16\]"</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le format de l'option bootfile-url IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "bootfile-url" /etc/kea/kea-dhcp6.conf</command></screen>
          </step>
          <step>
            <para>
            Testez la connectivité IPv6 vers le serveur de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>ping6 2001:db8:0:1::200</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Avec les services DHCP Kea configurés, les clients PXE peuvent recevoir des informations complètes sur la configuration réseau et le fichier de démarrage à la fois pour les environnements IPv4 et IPv6. Le système de classification des clients permet une assignation précise des fichiers de démarrage en fonction de l'architecture du client et prend en charge à la fois les méthodes traditionnelles de démarrage PXE et les méthodes modernes de démarrage HTTP.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-dhcp-isc">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configuration d'un serveur DHCP avec DHCP ISC</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section explique comment configurer le serveur DHCP ISC afin de fournir les informations de configuration réseau et de démarrage PXE pour les installations <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 15. Le paquet dhcp-server ISC n'est plus disponible sous <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. DHCP ISC utilise la mise en correspondance des classes et des sous-classes pour prendre en charge les scénarios de démarrage PXE et HTTP dans différentes architectures de clients.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-isc-intro">
      <title>Introduction</title>
      <para>
      DHCP ISC est le serveur DHCP traditionnel qui fournit les informations sur la configuration réseau et le fichier de démarrage aux clients PXE à l'aide d'un système de classes et de sous-classes. Bien qu'ISC ait déclaré ce serveur en fin de vie à partir de 2022, il reste largement utilisé dans les déploiements existants et offre une prise en charge solide des scénarios de démarrage PXE et HTTP avec identification de la classe du fournisseur.
    </para>
      <important>
        <title>statut de fin de vie de DHCP ISC</title>
        <para>
        DHCP ISC a été déclaré en fin de vie par ISC en 2022. Pour les nouveaux déploiements, envisagez d'utiliser Kea ou dnsmasq à la place. Cette configuration est fournie pour assurer la compatibilité avec les installations DHCP ISC existantes.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Les paquets DHCP ISC <package>dhcp-server</package> sont installés.
        </para>
        </listitem>
        <listitem>
          <para>
          Les fichiers de démarrage PXE sont correctement organisés sous <filename>/srv/tftpboot</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          L'interface réseau est configurée pour le service DHCP.
        </para>
        </listitem>
        <listitem>
          <para>
          Des privilèges administratifs sont disponibles pour configurer les services DHCP.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv4">
      <title>Configuration du serveur DHCPv4 ISC</title>
      <para>
      La configuration DHCPv4 ISC utilise des déclarations de classes et de sous-classes pour mettre en correspondance les types de clients PXE et HTTP et fournir des fichiers de démarrage appropriés pour différentes architectures.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv4">
        <title>Configuration du serveur DHCPv4 Kea</title>
        <step>
          <para>
          Configurez le serveur DHCPv4 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/dhcpd.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first read
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
#
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# default lease time
default-lease-time              3600;
max-lease-time                  7200;

##
## PXE / HTTP boot option declarations
##
class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        match substring (option vendor-class-identifier, 0, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        match substring (option vendor-class-identifier, 0, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet 192.168.1.0 netmask 255.255.255.0 {
        authoritative;

        range  dynamic-bootp            192.168.1.100 192.168.1.199;

        option subnet-mask              255.255.255.0;

        option routers                  192.168.1.1;
        option ntp-servers              192.168.1.1;
        option domain-name-servers      192.168.1.200;
        option domain-name              "example.net";
        option domain-search            "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez l'interface DHCP dans sysconfig :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>echo 'DHCPD_INTERFACE="eno1"' &gt; /etc/sysconfig/dhcpd</command></screen>
        </step>
        <step>
          <para>
          Testez la configuration DHCPv4 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>dhcpd -t -cf /etc/dhcpd.conf</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service DHCPv4 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now dhcpd</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv6">
      <title>Configuration du serveur DHCPv6 ISC</title>
      <para>
      La configuration DHCPv6 ISC assure l'assignation d'adresses IPv6 et la fourniture des informations sur le fichier de démarrage à l'aide de la mise en correspondance de la classe de fournisseur avec la gestion adéquate des options DHCPv6.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv6">
        <title>Configuration du serveur DHCPv6 ISC</title>
        <step>
          <para>
          Configurez le serveur DHCPv6 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>cat &gt; /etc/dhcpd6.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd6.conf
#
# Sample DHCPv6 configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD6_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# IPv6 address valid lifetime
#  (at the end the address is no longer usable by the client)
#  (set to 30 days, the usual IPv6 default)
default-lease-time 7200;

# IPv6 address preferred lifetime
#  (at the end the address is deprecated, i.e., the client should use
#   other addresses for new connections)
#  (set to 7 days, the	usual IPv6 default)
preferred-lifetime 3600;

##
## PXE / HTTP boot option declarations
##

# The dhcp6 option 16 is in fact an:
#   { uint32 enterprise-number, array of { uint16 len, string tag} vendor-class-data }
# this declaration is using the whole option data as string for substring match:
option dhcp6.vendor-class-as-string code 16 = string;

# this declaration is using the enterprise-number with 1st tag length and string:
option dhcp6.vendor-class-en-len-tag code 16 = {integer 32, integer 16, string};

class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        # note: +6 to skip the enterprise-number+len until the PXEClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        # note: +6 to skip the enterprise-number+len until the HTTPClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet6 2001:db8:0:1::/64 {
       authoritative;

       range6  2001:db8:0:1:d:: 2001:db8:0:1:d::ffff;

       option dhcp6.sntp-servers       2001:db8:0:1::1;
       option dhcp6.name-servers       2001:db8:0:1::200;
       option dhcp6.domain-search      "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configurez l'interface DHCPv6 dans sysconfig :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>echo 'DHCPD6_INTERFACE="eno1"' &gt;&gt; /etc/sysconfig/dhcpd</command></screen>
        </step>
        <step>
          <para>
          Testez la configuration DHCPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command></screen>
        </step>
        <step>
          <para>
          Activez et démarrez le service DHCPv6 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl enable --now dhcpd6</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-verify">
      <title>Vérification de la configuration DHCP ISC</title>
      <para>
      Testez la fonctionnalité du serveur DHCP ISC pour vous assurer que la configuration réseau est correcte et que le fichier de démarrage adéquat est distribué aux clients PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-isc">
        <title>Test des serveurs DHCP ISC</title>
        <step>
          <para>
          Vérifiez le statut du service DHCPv4 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dhcpd</command></screen>
        </step>
        <step>
          <para>
          Vérifiez le statut du service DHCPv6 ISC :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dhcpd6</command></screen>
        </step>
        <step>
          <para>
          Vérifiez la liaison de port DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>ss -ulnp | grep -E ":67|:547"</command></screen>
        </step>
        <step>
          <para>
          Surveillez les journaux DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd -f</command></screen>
        </step>
        <step>
          <para>
          Vérifiez les baux DHCP actifs :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /var/lib/dhcp/dhcpd.leases</command></screen>
        </step>
        <step>
          <para>
          Surveillez l'activité DHCPv6 :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd6 -f</command></screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-troubleshooting">
      <title>Dépannage de la configuration DHCP ISC</title>
      <para>
      Problèmes courants lors de la configuration des serveurs DHCP ISC pour les environnements de démarrage PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-config">
        <title>Problèmes de configuration et de service</title>
        <para>
        Les services DHCP ISC peuvent ne pas démarrer en raison d'erreurs de syntaxe de la configuration ou de problèmes de liaison d'interface.
      </para>
        <procedure xml:id="proc-debug-isc-config">
          <title>Résolution des problèmes de configuration DHCP ISC</title>
          <step>
            <para>
            Testez la syntaxe de la configuration DHCPv4 :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>dhcpd -t -cf /etc/dhcpd.conf</command></screen>
          </step>
          <step>
            <para>
            Testez la syntaxe de la configuration DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la configuration de l'interface :
          </para>
            <screen><prompt>&gt; </prompt><command>cat /etc/sysconfig/dhcpd</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le statut de l'interface réseau :
          </para>
            <screen><prompt>&gt; </prompt><command>ip addr show eno1</command></screen>
          </step>
          <step>
            <para>
            Recherchez les éventuels conflits de ports :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :67</command></screen>
          </step>
          <step>
            <para>
            Affichez les journaux détaillés du service :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd -xe</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-leases">
        <title>Problèmes liés aux assignations de baux DHCP</title>
        <para>
        Les clients peuvent ne pas recevoir d'adresses IP en raison de problèmes d'autorisation ou de configuration de sous-réseau.
      </para>
        <procedure xml:id="proc-debug-isc-leases">
          <title>Diagnostic des problèmes liés aux baux DHCP ISC</title>
          <step>
            <para>
            Vérifiez la configuration du sous-réseau et de la plage :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 10 "subnet\|range" /etc/dhcpd.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le paramètre faisant autorité :
          </para>
            <screen><prompt>&gt; </prompt><command>grep authoritative /etc/dhcpd.conf</command></screen>
          </step>
          <step>
            <para>
            Surveillez les assignations de baux en temps réel :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/messages | grep dhcpd</command></screen>
          </step>
          <step>
            <para>
            Recherchez les éventuelles erreurs dans la base de données des baux :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -20 /var/lib/dhcp/dhcpd.leases</command></screen>
          </step>
          <step>
            <para>
            Testez la réponse DHCP manuellement :
          </para>
            <screen><prompt>&gt; </prompt><command>dhcping -s 192.168.1.200 -h aa:bb:cc:dd:ee:ff</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-classes">
        <title>Problèmes de mise en correspondance des classes et sous-classes</title>
        <para>
        Les clients PXE peuvent recevoir des adresses IP mais ne pas obtenir les fichiers de démarrage appropriés en raison de problèmes de configuration de la mise en correspondance des classes.
      </para>
        <procedure xml:id="proc-debug-isc-classes">
          <title>Dépannage de la mise en correspondance des classes DHCP ISC</title>
          <step>
            <para>
            Vérifiez les définitions de classe :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 3 "class.*clients" /etc/dhcpd.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les entrées de sous-classe :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 5 "subclass" /etc/dhcpd.conf</command></screen>
          </step>
          <step>
            <para>
            Surveillez l'identification des classes de fournisseurs :
          </para>
            <screen><prompt>&gt; </prompt><command>tail -f /var/log/messages | grep -E "PXEClient|HTTPClient"</command></screen>
          </step>
          <step>
            <para>
            Testez l'accessibilité du fichier de démarrage :
          </para>
            <screen><prompt>&gt; </prompt><command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command></screen>
          </step>
          <step>
            <para>
            Activez la journalisation détaillée :
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command> <command>sed -i '1i\log-facility local7;' /etc/dhcpd.conf</command></screen> <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dhcpd</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-ipv6">
        <title>Problèmes liés à l'option de classe de fournisseur DHCPv6</title>
        <para>
        Les clients DHCP IPv6 présentent une gestion complexe de l'option de classe fournisseur qui peut nécessiter une configuration spécifique pour une prise en charge correcte du démarrage PXE.
      </para>
        <procedure xml:id="proc-debug-isc-ipv6">
          <title>Résolution des problèmes DHCPv6 ISC</title>
          <step>
            <para>
            Vérifiez les définitions des options DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -A 3 "option dhcp6" /etc/dhcpd6.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez l'analyse des chaînes de classes de fournisseurs :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "substring.*6.*20\|21" /etc/dhcpd6.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la correspondance de la classe de fournisseur DHCPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd6 | grep -i vendor</command></screen>
          </step>
          <step>
            <para>
            Vérifiez le format de l'option bootfile-url IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "bootfile-url" /etc/dhcpd6.conf</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la dépendance des annonces de routeur :
          </para>
            <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
          </step>
          <step>
            <para>
            Testez la connectivité IPv6 :
          </para>
            <screen><prompt>&gt; </prompt><command>ping6 2001:db8:0:1::200</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-next-steps">
      <title>Étapes suivantes</title>
      <para>
      Lorsque les services DHCP ISC sont configurés, les clients PXE peuvent recevoir des informations sur la configuration réseau et le fichier de démarrage à l'aide du système traditionnel de classes et de sous-classes. Bien que DHCP ISC soit en fin de vie, cette configuration assure la compatibilité pour les déploiements existants qui nécessitent des fonctionnalités de démarrage PXE et HTTP sur plusieurs architectures de clients.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="fr" version="5.2" xml:id="sles-pxe-server-validate">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Validation de la configuration du serveur PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Cette section décrit comment valider et tester la configuration complète du serveur PXE afin de s'assurer que tous les composants fonctionnent correctement pour les installations réseau de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Il couvre la vérification des services, les tests de connectivité du réseau et la validation du démarrage PXE de bout en bout.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-validate-intro">
      <title>Introduction</title>
      <para>
      Après avoir configuré tous les composants du serveur PXE, y compris les services TFTP, HTTP, DNS, DHCP et de chargeur de démarrage GRUB 2, il est essentiel de valider le bon fonctionnement de l'ensemble du système. Cette validation garantit que les clients PXE peuvent démarrer avec succès dans le programme d'installation Agama et effectuer des installations basées sur le réseau de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-validate-reqs">
      <title>Configuration requise</title>
      <itemizedlist>
        <listitem>
          <para>
          Tous les composants du serveur PXE sont configurés et opérationnels.
        </para>
        </listitem>
        <listitem>
          <para>
          Des systèmes clients de test capables d'effectuer des démarrages PXE sont disponibles.
        </para>
        </listitem>
        <listitem>
          <para>
          Une connectivité réseau est assurée entre le serveur PXE et les clients.
        </para>
        </listitem>
        <listitem>
          <para>
          Un accès administratif est disponible pour surveiller les services du serveur.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-validate-services">
      <title>Validation des services du serveur PXE</title>
      <para>
      Vérifiez que tous les services essentiels du serveur PXE sont en cours d'exécution et sont correctement configurés avant de les tester avec les clients PXE.
    </para>
      <procedure xml:id="proc-validate-services">
        <title>Vérification du statut du service du serveur PXE</title>
        <step>
          <para>
          Vérifiez le statut du service TFTP :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status tftp.socket</command></screen>
          <para>
          Résultat attendu : le service doit être actif et écouter sur le port 69.
        </para>
        </step>
        <step>
          <para>
          Vérifiez le service HTTP nginx :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status nginx</command></screen>
          <para>
          Résultat attendu : le service doit être actif et écouter sur le port 80.
        </para>
        </step>
        <step>
          <para>
          Vérifiez le service DNS (si vous utilisez dnsmasq) :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dnsmasq</command></screen>
          <para>
          Résultat attendu : le service doit être actif et écouter sur le port 53.
        </para>
        </step>
        <step>
          <para>
          Vérifiez le statut du service DHCP (choisissez le service approprié) :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dhcpd</command></screen>
          <para>
          Pour DHCP dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status dnsmasq</command></screen>
          <para>
          Pour DHCP Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status kea-dhcp4 kea-dhcp6</command></screen>
          <para>
          Résultat attendu : le service DHCP doit être actif et écouter sur les ports appropriés.
        </para>
        </step>
        <step>
          <para>
          Vérifiez les annonces de routeur IPv6 (si configurées) :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status radvd</command></screen>
          <para>
          Résultat attendu : le service doit être actif pour les environnements IPv6.
        </para>
        </step>
        <step>
          <para>
          Vérifiez le service NTP :
        </para>
          <screen><prompt>&gt; </prompt><command>systemctl status chronyd</command></screen>
          <para>
          Résultat attendu : le service doit être actif et synchronisé.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-network">
      <title>Test de la connectivité réseau et de l'accès aux fichiers</title>
      <para>
      Vérifiez que les clients PXE peuvent accéder aux fichiers de démarrage et au contenu de l'installation sur le réseau à l'aide des protocoles TFTP et HTTP.
    </para>
      <procedure xml:id="proc-validate-network">
        <title>Test de l'accès aux fichiers du réseau</title>
        <step>
          <para>
          Testez l'accès TFTP aux fichiers de chargeur de démarrage :
        </para>
          <screen><prompt>&gt; </prompt><command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-bootx64.efi</command></screen>
          <para>
          Vérifiez que le fichier a bien été récupéré :
        </para>
          <screen><prompt>&gt; </prompt><command>file /tmp/test-bootx64.efi</command></screen>
          <para>
          Nettoyez les fichiers de test :
        </para>
          <screen><prompt>&gt; </prompt><command>rm /tmp/test-bootx64.efi</command></screen>
        </step>
        <step>
          <para>
          Testez l'accès HTTP à la configuration GRUB 2 :
        </para>
          <screen><prompt>&gt; </prompt><command>curl -I http://localhost/boot/grub2/grub.cfg</command></screen>
          <para>
          Résultat attendu : réponse HTTP 200 OK.
        </para>
        </step>
        <step>
          <para>
          Vérifiez l'accès HTTP aux fichiers du programme d'installation :
        </para>
          <screen><prompt>&gt; </prompt><command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command></screen>
          <para>
          Résultat attendu : réponse HTTP 200 OK avec une longueur de contenu appropriée.
        </para>
        </step>
        <step>
          <para>
          Testez la résolution DNS (si le DNS local est configuré) :
        </para>
          <screen><prompt>&gt; </prompt><command>nslookup pxe.example.net localhost</command></screen>
          <para>
          Résultat attendu : résolution correcte des enregistrements A et AAAA.
        </para>
        </step>
        <step>
          <para>
          Vérifiez la navigation dans les répertoires pour les emplacements d'autoindex :
        </para>
          <screen><prompt>&gt; </prompt><command>curl http://localhost/boot/</command></screen>
          <para>
          Résultat attendu : liste de répertoires montrant les fichiers de démarrage.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-dhcp">
      <title>Validation de la fonctionnalité DHCP</title>
      <para>
      Testez les réponses du serveur DHCP et vérifiez que les informations de démarrage appropriées sont fournies aux différents types de clients.
    </para>
      <procedure xml:id="proc-validate-dhcp">
        <title>Test des réponses du serveur DHCP</title>
        <step>
          <para>
          Vérifiez la liaison de port DHCP :
        </para>
          <screen><prompt>&gt; </prompt><command>ss -ulnp | grep -E ":67|:547"</command></screen>
          <para>
          Résultat attendu : services DHCP écoutant sur les ports 67 (IPv4) et 547 (IPv6).
        </para>
        </step>
        <step>
          <para>
          Surveillez les demandes DHCP en temps réel :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd -f</command></screen>
          <para>
          Ou pour dnsmasq :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -u dnsmasq -f</command></screen>
          <para>
          Laissez cette commande s'exécuter pour observer l'activité DHCP pendant le test.
        </para>
        </step>
        <step>
          <para>
          Testez la réponse DHCP à l'aide de dhcping (si disponible) :
        </para>
          <screen><prompt>&gt; </prompt><command>dhcping -s 192.168.1.200</command></screen>
          <para>
          Résultat attendu : réponse DHCP réussie du serveur.
        </para>
        </step>
        <step>
          <para>
          Vérifiez les baux DHCP actifs :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /var/lib/dhcp/dhcpd.leases</command></screen>
          <para>
          Ou pour Kea :
        </para>
          <screen><prompt>&gt; </prompt><command>cat /var/lib/kea/dhcp4.leases</command></screen>
          <para>
          Résultat attendu : entrées de baux pour les clients tests.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-pxe-boot">
      <title>Test de démarrage PXE de bout en bout</title>
      <para>
      Effectuez des tests complets de démarrage PXE avec des systèmes clients réels pour valider l'ensemble du processus de démarrage, depuis DHCP jusqu'au démarrage du programme d'installation Agama.
    </para>
      <procedure xml:id="proc-validate-pxe-boot">
        <title>Test du processus complet de démarrage PXE</title>
        <step>
          <para>
          Préparez un système client de test :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configurez le BIOS/UEFI pour permettre le démarrage réseau.
            </para>
            </listitem>
            <listitem>
              <para>
              Définissez le démarrage réseau comme première priorité de démarrage.
            </para>
            </listitem>
            <listitem>
              <para>
              Connectez le client au même réseau que le serveur PXE.
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Surveillez les journaux du serveur PXE pendant le démarrage du client :
        </para>
          <screen><prompt>&gt; </prompt><command>journalctl -f | grep -E "dhcp|tftp|nginx"</command></screen>
        </step>
        <step>
          <para>
          Démarrez le client de test et observez la séquence suivante :
        </para>
          <orderedlist>
            <listitem>
              <para>
              Le client devrait recevoir une adresse IP via DHCP.
            </para>
            </listitem>
            <listitem>
              <para>
              Le client devrait télécharger le chargeur de démarrage via TFTP.
            </para>
            </listitem>
            <listitem>
              <para>
              Le menu GRUB 2 devrait apparaître avec les options d'installation.
            </para>
            </listitem>
            <listitem>
              <para>
              Le kernel Linux et l'unité RAM initiale (initrd) devraient se charger via HTTP.
            </para>
            </listitem>
            <listitem>
              <para>
              Le programme d'installation Agama devrait démarrer correctement.
            </para>
            </listitem>
          </orderedlist>
        </step>
        <step>
          <para>
          Vérifiez la détection de l'architecture du client en testant différents types de clients :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Systèmes BIOS x86_64 hérités (devraient obtenir le fichier core.0)
            </para>
            </listitem>
            <listitem>
              <para>
              Systèmes UEFI x86_64 (devraient obtenir le fichier bootx64.efi)
            </para>
            </listitem>
            <listitem>
              <para>
              Systèmes UEFI aarch64 (devraient obtenir le fichier bootaa64.efi)
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Testez le démarrage PXE IPv6 (si IPv6 est configuré) :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Activez la configuration réseau IPv6 uniquement sur le client de test.
            </para>
            </listitem>
            <listitem>
              <para>
              Vérifiez l'assignation d'adresses DHCPv6.
            </para>
            </listitem>
            <listitem>
              <para>
              Vérifiez la distribution de bootfile-url IPv6.
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-installation">
      <title>Validation des fonctionnalités du programme d'installation Agama</title>
      <para>
      Vérifiez que le programme d'installation Agama démarre correctement et qu'il peut accéder aux sources d'installation pour effectuer les installations de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
      <procedure xml:id="proc-validate-agama">
        <title>Test du démarrage du programme d'installation Agama</title>
        <step>
          <para>
          Vérifiez l'accessibilité de l'interface Web d'Agama :
        </para>
          <para>
          Lors du démarrage du client, notez l'adresse IP assignée et l'accès :
        </para>
          <screen>http://<replaceable>CLIENT_IP_ADDRESS</replaceable></screen>
          <para>
          Résultat attendu : l'interface Web Agama devrait se charger correctement.
        </para>
        </step>
        <step>
          <para>
          Vérifiez les journaux du programme d'installation Agama sur le client :
        </para>
          <para>
          Basculez vers la console (Alt+F2) et exécutez :
        </para>
          <screen><prompt role="root"># </prompt><command>journalctl -u agama-web-server -f</command></screen>
          <para>
          Résultat attendu : aucune erreur critique ne doit se produire au démarrage d'Agama.
        </para>
        </step>
        <step>
          <para>
          Vérifiez l'accessibilité de la source d'installation :
        </para>
          <para>
          Pour les installations ISO complètes, vérifiez l'accès au dépôt :
        </para>
          <screen><prompt role="root"># </prompt><command>curl -I http://192.168.1.200/install/SLES-16.0/x86_64/</command></screen>
          <para>
          Résultat attendu : réponse HTTP 200 OK avec la liste du dépôt.
        </para>
        </step>
        <step>
          <para>
          Testez la fonctionnalité d'installation de paquet :
        </para>
          <para>
          Dans l'interface Agama, vérifiez que :
        </para>
          <itemizedlist>
            <listitem>
              <para>
              le système peut détecter les disques disponibles ;
            </para>
            </listitem>
            <listitem>
              <para>
              la configuration réseau est conservée ;
            </para>
            </listitem>
            <listitem>
              <para>
              le dépôt de paquets est accessible ;
            </para>
            </listitem>
            <listitem>
              <para>
              l'installation peut se poursuivre jusqu'à son terme.
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-troubleshooting">
      <title>Dépannage des échecs de validation</title>
      <para>
      Problèmes courants lors de la validation du serveur PXE et leurs étapes de résolution.
    </para>
      <section xml:id="sles-pxe-server-validate-troubleshoot-dhcp">
        <title>Échecs de l'assignation DHCP</title>
        <para>
        Les clients ne reçoivent pas d'adresses IP pendant le démarrage PXE.
      </para>
        <procedure xml:id="proc-troubleshoot-dhcp-validation">
          <title>Résolution des problèmes de validation DHCP</title>
          <step>
            <para>
            Recherchez les éventuels conflits de service DHCP :
          </para>
            <screen><prompt>&gt; </prompt><command>ss -ulnp | grep :67</command></screen>
          </step>
          <step>
            <para>
            Vérifiez que l'interface réseau est opérationnelle :
          </para>
            <screen><prompt>&gt; </prompt><command>ip addr show eno1</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la disponibilité de la plage DHCP :
          </para>
            <screen><prompt>&gt; </prompt><command>nmap -sn 192.168.1.100-199</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux DHCP pour repérer les éventuelles erreurs :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u dhcpd | tail -50</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-boot">
        <title>Échecs de distribution des fichiers de démarrage</title>
        <para>
        Les clients reçoivent des adresses IP, mais ne parviennent pas à télécharger les fichiers de démarrage.
      </para>
        <procedure xml:id="proc-troubleshoot-boot-validation">
          <title>Résolution des problèmes liés aux fichiers de démarrage</title>
          <step>
            <para>
            Vérifiez l'accessibilité du service TFTP :
          </para>
            <screen><prompt>&gt; </prompt><command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command></screen>
          </step>
          <step>
            <para>
            Vérifiez les autorisations des fichiers :
          </para>
            <screen><prompt>&gt; </prompt><command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/</command></screen>
          </step>
          <step>
            <para>
            Surveillez les journaux d'accès TFTP :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -u tftp.socket -f</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la détection de l'architecture des clients :
          </para>
            <screen><prompt>&gt; </prompt><command>grep -E "PXEClient|HTTPClient" /var/log/messages</command></screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-installer">
        <title>Échecs du démarrage du programme d'installation Agama</title>
        <para>
        Les fichiers de démarrage se chargent correctement, mais le programme d'installation Agama ne démarre pas.
      </para>
        <procedure xml:id="proc-troubleshoot-installer-validation">
          <title>Résolution des problèmes de démarrage d'Agama</title>
          <step>
            <para>
            Vérifiez l'accès HTTP aux fichiers du programme d'installation :
          </para>
            <screen><prompt>&gt; </prompt><command>curl -I http://192.168.1.200/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la syntaxe des paramètres du kernel Linux dans la configuration GRUB 2 :
          </para>
            <screen><prompt>&gt; </prompt><command>grep "root=live:" /srv/tftpboot/boot/grub2/menu.cfg</command></screen>
          </step>
          <step>
            <para>
            Surveillez le processus de démarrage des clients :
          </para>
            <screen><prompt>&gt; </prompt><command>journalctl -f | grep -E "kernel|initrd|agama"</command></screen>
          </step>
          <step>
            <para>
            Vérifiez la persistance de la configuration réseau :
          </para>
            <screen><prompt role="root"># </prompt><command>ip addr show</command></screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-validate-checklist">
      <title>Liste de contrôle pour la validation du serveur PXE</title>
      <para>
      Cette liste de contrôle vous permet de vérifier systématiquement tous les aspects de la configuration de votre serveur PXE.
    </para>
      <table xml:id="table-pxe-validation-checklist">
        <title>Liste de contrôle pour la validation du serveur PXE</title>
        <tgroup cols="3">
          <colspec colnum="1" colname="col1" colwidth="30*"/>
          <colspec colnum="2" colname="col2" colwidth="50*"/>
          <colspec colnum="3" colname="col3" colwidth="20*"/>
          <thead>
            <row>
              <entry>Composant</entry>
              <entry>Étape de validation</entry>
              <entry>Statut</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>TFTP Service</entry>
              <entry>Service actif, écoute sur le port 69, fichiers accessibles</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Service HTTP</entry>
              <entry>nginx actif, écoute sur le port 80, fichiers du programme d'installation accessibles</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Service DNS</entry>
              <entry>Résolution du nom d'hôte opérationnelle, écoute sur le port 53</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Service DHCP</entry>
              <entry>Assignation d'adresses IP opérationnelle, options de démarrage distribuées</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Configuration GRUB 2</entry>
              <entry>Le menu se charge ; la détection de l'architecture fonctionne</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Prise en charge d'IPv6</entry>
              <entry>Annonces de routeur actives, DHCPv6 opérationnel</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Démarrage PXE</entry>
              <entry>Le client démarre correctement et reçoit un chargeur de démarrage correct</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Programme d'installation Agama</entry>
              <entry>Le programme d'installation démarre ; l'interface Web est accessible</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Source d'installation</entry>
              <entry>Dépôt accessible, paquets installables</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Persistance du réseau</entry>
              <entry>Maintien de la configuration réseau pendant l'installation</entry>
              <entry>☐</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section xml:id="sles-pxe-server-validate-conclusion">
      <title>Conclusion de la validation</title>
      <para>
      Un serveur PXE correctement validé devrait présenter une fonctionnalité correcte de bout en bout, depuis le démarrage du réseau du client jusqu'au démarrage du programme d'installation Agama. Tous les services devraient fonctionner sans erreur et les clients devraient être en mesure d'effectuer des installations de <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> sur le réseau. Des tests de validation réguliers garantissent la fiabilité continue de l'infrastructure PXE pour les déploiements automatisés.
    </para>
    </section>
  </section>
  <section version="5.2" xml:id="legal-disclaimer">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">Mentions légales</title>
    </info>
    <para> Copyright © 2006–<?dbtimestamp format="Y"?> SUSE LLC et contributeurs. Tous droits réservés. </para>
    <para>
    Il est autorisé de copier, distribuer et/ou modifier ce document conformément aux conditions de la licence « GNU Free Documentation License » version 1.2 ou (à votre discrétion) 1.3, avec la section permanente qu'est cette mention de copyright et la licence. Une copie de la version de licence 1.2 est incluse dans la section intitulée <quote>GNU Free Documentation License</quote>.
  </para>
    <para>
    Pour les marques commerciales SUSE, consultez le site Web <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.suse.com/company/legal/"/>. Toutes les autres marques de fabricants tiers sont la propriété de leur détenteur respectif. Les symboles de marque (®, ™, etc.) désignent des marques de SUSE et de ses sociétés affiliées. Des astérisques (*) désignent des marques commerciales de fabricants tiers.
  </para>
    <para>
    Toutes les informations de cet ouvrage ont été regroupées avec le plus grand soin. Cela ne garantit cependant pas sa complète exactitude. Ni SUSE LLC, ni les sociétés affiliées, ni les auteurs, ni les traducteurs ne peuvent être tenus responsables des erreurs possibles ou des conséquences qu'elles peuvent entraîner.
  </para>
  </section>
  <appendix xmlns:its="http://www.w3.org/2005/11/its" version="5.2" role="legal" its:translate="no" xml:id="doc-gfdl-license">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">GNU Free Documentation License</title>
    </info>
    <para>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </para>
    <bridgehead renderas="sect4">
    0. PREAMBLE
  </bridgehead>
    <para>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </para>
    <para>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </para>
    <para>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </para>
    <bridgehead renderas="sect4">
    1. APPLICABILITY AND DEFINITIONS
  </bridgehead>
    <para>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </para>
    <para>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </para>
    <para>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </para>
    <para>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </para>
    <para>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </para>
    <para>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </para>
    <para>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </para>
    <para>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </para>
    <para>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </para>
    <para>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </para>
    <bridgehead renderas="sect4">
    2. VERBATIM COPYING
  </bridgehead>
    <para>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </para>
    <para>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </para>
    <bridgehead renderas="sect4">
    3. COPYING IN QUANTITY
  </bridgehead>
    <para>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </para>
    <para>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </para>
    <para>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </para>
    <para>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </para>
    <bridgehead renderas="sect4">
    4. MODIFICATIONS
  </bridgehead>
    <para>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </para>
    <orderedlist numeration="upperalpha" spacing="normal">
      <listitem>
        <para>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </para>
      </listitem>
      <listitem>
        <para>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the copyright notices of the Document.
   </para>
      </listitem>
      <listitem>
        <para>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </para>
      </listitem>
      <listitem>
        <para>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </para>
      </listitem>
      <listitem>
        <para>
    Include an unaltered copy of this License.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </para>
      </listitem>
      <listitem>
        <para>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </para>
      </listitem>
      <listitem>
        <para>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve any Warranty Disclaimers.
   </para>
      </listitem>
    </orderedlist>
    <para>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </para>
    <para>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </para>
    <para>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </para>
    <para>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </para>
    <bridgehead renderas="sect4">
    5. COMBINING DOCUMENTS
  </bridgehead>
    <para>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </para>
    <para>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </para>
    <para>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </para>
    <bridgehead renderas="sect4">
    6. COLLECTIONS OF DOCUMENTS
  </bridgehead>
    <para>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </para>
    <para>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </para>
    <bridgehead renderas="sect4">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </bridgehead>
    <para>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </para>
    <para>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </para>
    <bridgehead renderas="sect4">
    8. TRANSLATION
  </bridgehead>
    <para>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </para>
    <para>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </para>
    <bridgehead renderas="sect4">
    9. TERMINATION
  </bridgehead>
    <para>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </para>
    <bridgehead renderas="sect4">
    10. FUTURE REVISIONS OF THIS LICENSE
  </bridgehead>
    <para>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.gnu.org/copyleft/"/>.
 </para>
    <para>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </para>
    <bridgehead renderas="sect4">
    ADDENDUM: How to use this License for your documents
  </bridgehead>
    <screen>Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</screen>
    <para>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the “with...Texts.” line with this:
 </para>
    <screen>with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</screen>
    <para>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </para>
    <para>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
</para>
  </appendix>
</article>