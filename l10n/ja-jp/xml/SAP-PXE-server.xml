<?xml version='1.0' encoding='UTF-8'?><article xmlns="http://docbook.org/ns/docbook" version="5.2" xml:id="sles-pxe-server-setup" xml:lang="ja">
  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude"><phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase>&#xA0;<phrase><phrase os="sles4sap">16.0</phrase></phrase>でのPXEブートサーバの設定</title>
    <revhistory xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="rh-sles-pxe-server-setup">
      <revision>
        <date>2025-11-04</date>
        <revdescription>
          <para>
              初期バージョン
            </para>
        </revdescription>
      </revision>
    </revhistory>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="architecture">
      <phrase>AMD64/Intel 64</phrase>
      <phrase>AArch64</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="productname" its:translate="no">
      <productname version="16.0">
        <phrase>
          <phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase>
        </phrase>
      </productname>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="title" its:translate="yes"><phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>でのPXEブートサーバの設定</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="description" its:translate="yes">GRUB 2、nginx、Agamaインストーライメージを使用したPXEブートサーバの設定方法</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="social-descr" its:translate="yes">GRUB 2とAgamaを使用したPXEブートサーバの設定</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="category" its:translate="no">
      <phrase>Deployment &amp; Upgrade</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="task" its:translate="no">
      <phrase>Configuration</phrase>
      <phrase>Installation</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="series" its:translate="no">Products &amp; Solutions</meta>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <dm:bugtracker>
        <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
        <dm:component>Documentation</dm:component>
        <dm:product>SUSE Linux Enterprise Server 16.0</dm:product>
        <dm:assignee>souvik.sarkar@suse.com</dm:assignee>
      </dm:bugtracker>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <variablelist>
        <varlistentry>
          <term>概要</term>
          <listitem>
            <para>
                UEFIセキュアブートとAgama インストーラをサポートするPXEブートサーバを設定します。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>目的</term>
          <listitem>
            <para>
                ネットワーク経由で複数の<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>システムのインストールを自動化し、効率化します。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>所要時間</term>
          <listitem>
            <para>
                システム管理者やネットワーク管理者の場合、この記事の理解に通常30～45分ほどを要します。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>目標</term>
          <listitem>
            <para>
                複数のアーキテクチャをAgamaインストーラで起動できる、機能するPXEサーバの構築。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>要件</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>
                    管理者特権を持つ<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>システム
                  </para>
              </listitem>
              <listitem>
                <para>
                    ISOイメージを取得するためのインターネット接続
                  </para>
              </listitem>
              <listitem>
                <para>
                    PXEサーバの静的IP設定
                  </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </abstract>
  </info>
  <section role="concept" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-introduction">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion"><phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase>&#xA0;<phrase><phrase os="sles4sap">16.0</phrase></phrase>におけるPXEブートの概要</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        PXEブートにより、ローカルストレージなしで、マシンをネットワーク経由でインストールまたはランタイム環境にブートできます。このセクションでは <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase> AgamaとライブインストーライメージにおけるPXEの仕組みについて、GRUB 2に焦点を当てて説明します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-what-is">
      <title>PXEブートとは</title>
      <para>
      PXE (Preboot Execution Environment)は、DHCPおよびTFTPまたはHTTPを使用して、システムがネットワークサーバからブートローダとOSインストーラを取得できるようにする方法です。物理メディアやプリインストールされたオペレーティングシステムがないマシンのプロビジョニングに広く使用されています。
    </para>
    </section>
    <section xml:id="sles-pxe-server-benefits">
      <title>PXEブートの利点</title>
      <para>
      PXEブートは、ローカルインストールメディアや手動セットアップの必要性をなくし、プロビジョニングを簡素化します。PXEブートにより、以下が可能になります。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          ネットワークを介した多数のシステムの無人インストール
        </para>
        </listitem>
        <listitem>
          <para>
          インストーラのバージョンとブート設定の集中管理
        </para>
        </listitem>
        <listitem>
          <para>
          UEFIセキュアブートを含む、多様なアーキテクチャとファームウェアタイプのサポート
        </para>
        </listitem>
        <listitem>
          <para>
          GRUB 2メニューを使用したインストーラまたはインストールパラメータの動的選択
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-how-it-works">
      <title><phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase>&#xA0;<phrase><phrase os="sles4sap">16.0</phrase></phrase>におけるPXEブートの仕組み</title>
      <para>
      <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>のPXEブートは、ブートローダとしてGRUB 2を使用し、インストールインタフェースとしてAgamaインストーラを使用します。ブートローダとインストーラファイルは、HTTPまたはTFTPを使用してネットワーク経由で提供され、GRUB 2がカーネル、initrd、ライブイメージを取得します。PXEクライアントは、AMD64/Intel64、AArch64、ppc64le、s390xなどのアーキテクチャに応じて、さまざまなファームウェア(BIOSやUEFIなどの最も一般的なものを含む)、ブートローダ実行ファイル、またはイメージ形式を使用できます。さらに、IPv4とIPv6の両方のネットワークで動作する必要があります。
    </para>
      <para>
      ブートローダは、<literal>root=live:</literal>などのカーネルパラメータを渡し、ライブISOイメージからsquashfsベースのルートファイルシステムをロードし、AgamaインタフェースをローカルでまたはリモートWeb UI用のWeb サービスとして起動します。
    </para>
      <section xml:id="sles-pxe-server-backward-compatibility-with-sle-15">
        <title><phrase><phrase os="sles4sap">SLES for SAP</phrase></phrase> 15.xとの後方互換性</title>
        <para>
        この記事の情報は、主に <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> 16.0以降に適用されます。Agamaインストーラと統合し、ライブインストールイメージに依存するPXEブートワークフローに焦点を当てています。この記事の文脈と範囲において、 <phrase><phrase os="sles4sap">SLES for SAP</phrase></phrase> 16.0以降のバージョンは<phrase><phrase os="sles4sap">SLES for SAP</phrase></phrase> 15.xとは以下の点で異なります。
      </para>
        <variablelist>
          <varlistentry>
            <term>インストーラ</term>
            <listitem>
              <para>
              <literal>linuxrc</literal>とYaSTの代わりに<literal>dracut</literal>とAgamaを使用します。
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>DHCPサーバ</term>
            <listitem>
              <para>
              ISC DHCPの使用は廃止されました(EOL 2022)。DHCPサーバには、代わりにKeaまたはdnsmasqを使用します。
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>ブートパラメータ</term>
            <listitem>
              <para>
              <literal>root=live:</literal>パラメータを使用してagamaインストーライメージをロードし、<literal>install=</literal>パラメータの代わりに、オプションの<literal>inst.install_url=</literal>を使用してデフォルト以外のインストールリポジトリを指定します。
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>
        ブートローダの選択(GRUB 2、pxelinuxなど)は柔軟性を保ち、バージョンに依存しません。
      </para>
      </section>
      <section xml:id="sles-pxe-server-different-possible-setups">
        <title>さまざまなセットアップと手順</title>
        <para>
        この記事は、必須のセットアップ手順と、オプションまたは代替の設定で構成されています。自身の展開に関連するセクションにのみ従い、展開に該当しない代替セクションはスキップしてください。
      </para>
        <variablelist>
          <varlistentry>
            <term>必須</term>
            <listitem>
              <para>
              コンポーネントのインストール、インストーライメージの準備、GRUB 2の設定、サーバの検証などのタスクは、すべてのセットアップで完了する必要があります。
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>ファイル配信方法</term>
            <listitem>
              <para>
              <literal>nginx</literal>などのHTTPサーバ(Agamaで推奨)、および/または<literal>tftp</literal> や<literal>dnsmasq</literal>などのTFTPサーバ。
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>DHCPサーバ</term>
            <listitem>
              <para>
              Keaまたはdnsmasqのいずれかを選択します。
            </para>
              <note>
                <title>選択した方法の制限事項と機能</title>
                <itemizedlist>
                  <listitem>
                    <para>
                    ISC DHCPの最新の代替として、ISCの新しいDHCPサーバである<emphasis role="strong">Kea</emphasis>を使用します。Keaの詳細については、<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/kea/"></link>を参照してください。ISC DHCP EOL通知については、<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/dhcp/"></link>を参照してください。KeaはDHCPサーバであり、別途TFTPサーバソフトウェアが必要です。Kea DHCPサーバは、IPv4およびIPv6経由のTFTP/PXEブートと、IPv4経由のHTTPブートのオプションをサポートしています。IPv6経由のHTTPブートでは、DHCPv6サーバが、<quote>クライアントがベンダを識別するために</quote>使用すると想定される<literal>Vendor Class Option</literal> (<literal>RFC3315, Section 22.16</literal>を参照)をクライアントに返送できることが必要ですが、これは現在サポートされていません。
                  </para>
                  </listitem>
                  <listitem>
                    <para>DNSサーバ、DHCPサーバ、TFTPサーバの組み合わせである<emphasis role="strong">dnsmasq</emphasis>を使用します。dnsmasqは、ブートローダ、カーネル、initrd (およびその他のファイル)をTFTP経由で提供するために使用できます。dnsmasqの詳細については、<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://thekelleys.org.uk/dnsmasq/doc.html"></link>を参照してください。dnsmasq DHCPサーバは、IPv4およびIPv6経由のTFTP/PXEブートと、IPv4経由のHTTPブートのオプションをサポートしています。IPv6経由のHTTPブートでは、DHCPv6サーバが、<quote>クライアントがベンダを識別するために</quote>使用すると想定される<literal>Vendor Class Option</literal>(<literal>RFC3315, Section 22.16</literal>を参照)をクライアントに返送できることが必要ですが、これは現在サポートされていません。
                  </para>
                  </listitem>
                </itemizedlist>
              </note>
            </listitem>
          </varlistentry>
        </variablelist>
        <figure xml:id="sles-pxe-server-setup-workflow">
          <title>PXEサーバセットアップワークフローの例</title>
          <mediaobject>
            <imageobject role="html">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg"/>
            </imageobject>
            <imageobject role="fo">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg" width="85%"/>
            </imageobject>
            <textobject role="description">
              <phrase>PXEブートサーバ設定のワークフロー図</phrase>
            </textobject>
          </mediaobject>
        </figure>
      </section>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-prepare-network">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">PXEブートサービス用のネットワークの準備</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このモジュールでは、PXEブートサービスを<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>上で展開するためのネットワークインフラストラクチャ要件について説明します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-network-configuration-introduction">
      <title>概要</title>
      <para>
      PXEサーバは、アドレスとブートファイル(ブートローダ)の場所を提供するDHCPサーバと、ファイルを取得するためのTFTPサーバおよび/またはHTTPサーバの3つのサーバで構成されています。さらに、DNSサーバ、NTPサーバ、IPv6をサポートするルータが存在する場合もあります。通常、運用ネットワークではこれらはPXEサーバとは別個に存在します。<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>を実行するPXEサーバでは、特定のネットワークインタフェースの設定、ファイアウォールへの特定の永続ルールの追加、および<systemitem>SELinux</systemitem>でのいくつかの権限が必要になる場合もあります。このセクションでは、適切なIP範囲と、ファイアウォールとSELinuxに必要なルールを持つサンプルネットワークを示します。
    </para>
    </section>
    <section xml:id="sles-pxe-server-network-configuration">
      <title>前提条件とサンプルネットワーク設定</title>
      <para>
      この記事では以下のように仮定しています。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          PXEサーバは、以下のネットワーク設定で、<literal>eno1</literal>ネットワークインタフェース上で実行されています。
        </para>
          <table frame="all">
            <title>サンプルPXEネットワーク設定</title>
            <tgroup cols="4">
              <colspec colname="c1"/>
              <colspec colname="c2"/>
              <colspec colname="c3"/>
              <colspec colname="c4"/>
              <thead>
                <row>
                  <entry/>
                  <entry>IPv4</entry>
                  <entry>IPv6</entry>
                  <entry>DNS名</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>PXEネットワーク</entry>
                  <entry>192.168.1.0/24</entry>
                  <entry>2001:db8:0:1::/64</entry>
                  <entry>example.net</entry>
                </row>
                <row>
                  <entry>PXEサーバ</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry>pxe.example.net</entry>
                </row>
                <row>
                  <entry>PXEゲートウェイ</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
                <row>
                  <entry>DNSサーバ</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry/>
                </row>
                <row>
                  <entry>NTPサーバ</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
              </tbody>
            </tgroup>
          </table>
        </listitem>
        <listitem>
          <para>
          デフォルトでは、ルータ、NTP、DNSサーバは外部にあり、別のマシンで実行されています。この記事では、いくつかのヒントを提供しますが、完全な設定をカバーするものではありません。
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-firewall-selinux">
      <title>PXEサービス用のネットワークインタフェース、ファイアウォール、<systemitem>SELinux</systemitem>の設定</title>
      <para>
      PXEサーバが必要とするネットワークサービスを許可するように、ネットワークインタフェースとファイアウォールを設定します。<systemitem>SELinux</systemitem>設定を調整して、インストールテストを有効にし、永続的なローカルポリシーを定義します。
    </para>
      <procedure>
        <step>
          <para>
          PXEネットワークインタフェースを確認し、適切なfirewalldゾーンに割り当てます。
        </para>
          <substeps>
            <step>
              <para>
              現在アクティブなゾーンと割り当てられたインタフェースを確認します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --get-active-zones</command>
              </screen>
            </step>
            <step>
              <para>
              <literal>public</literal>ゾーンに<literal>eno1</literal>が割り当てられていない場合は、割り当てます。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --change-interface=eno1</command>
              </screen>
            </step>
            <step>
              <para>
              インタフェースの割り当てを、再起動しても永続化するようにします。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-interface=eno1</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          DNSサービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでDNSサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dns</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dns</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          NTPサービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでNTPサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=ntp</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=ntp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          DHCP (IPv4)サービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでDHCPサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcp</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          DHCPv6サービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでDHCPv6サービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          TFTPサービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでTFTPサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=tftp</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=tftp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          HTTPサービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでHTTPサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=http</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=http</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          HTTPSサービスへのアクセス用にファイアウォールを設定します。
        </para>
          <substeps>
            <step>
              <para>
              現在のセッションでHTTPSサービスを許可します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=https</command>
              </screen>
            </step>
            <step>
              <para>
              変更を永続化します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=https</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          セットアップテストのため、<systemitem>SELinux</systemitem>を一時的に無効にします。
        </para>
          <substeps>
            <step>
              <para>
              <systemitem>SELinux</systemitem>を許容モードに設定します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 0</command>
              </screen>
            </step>
            <step>
              <para>
              <systemitem>SELinux</systemitem>ステータスをチェックします。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          PXE関連サービス用のローカル<systemitem>SELinux</systemitem>ポリシーモジュールを生成し、インストールします。
        </para>
          <substeps>
            <step>
              <para>
              <literal>nginx</literal>用のモジュールを作成し、インストールします。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'nginx' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'nginx' --raw | audit2allow -a -M local-nginx</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-nginx.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              <literal>dnsmasq</literal>用のモジュールを作成し、インストールします。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'dnsmasq' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'dnsmasq' --raw | audit2allow -a -M local-dnsmasq</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-dnsmasq.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              <literal>in.tftpd</literal>用のモジュールを作成し、インストールします。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'in.tftpd' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'in.tftpd' --raw | audit2allow -a -M local-tftpd</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-tftpd.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          <systemitem>SELinux</systemitem>強制モードを再度有効化します。
        </para>
          <substeps>
            <step>
              <para>
              <systemitem>SELinux</systemitem>を強制モードに設定します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 1</command>
              </screen>
            </step>
            <step>
              <para>
              <systemitem>SELinux</systemitem>のステータスを確認します。
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-firewall-selinux-summary">
      <title>まとめ</title>
      <para>
      この手順により、PXEサーバのネットワークインタフェース、ファイアウォール、および<systemitem>SELinux</systemitem>ポリシーが、安全かつ機能的に動作するように正しく設定されていることが確認されました。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          PXEサービングインタフェース(この例では<filename>eno1</filename>)を確認し、<literal>public</literal> firewalldゾーンに割り当てました。
        </para>
        </listitem>
        <listitem>
          <para>
          <literal>dns</literal> 、<literal>ntp</literal> 、<literal>dhcp</literal> 、<literal>dhcpv6</literal> 、<literal>tftp</literal> 、<literal>http</literal> 、<literal>https</literal>を含む、PXE操作に必要なファイアウォールサービスを開きました。
        </para>
        </listitem>
        <listitem>
          <para>
          サービステストを容易にし、AVC拒否のログを記録するため、<systemitem>SELinux</systemitem>を一時的に<literal>permissive</literal>モードに設定しました。
        </para>
        </listitem>
        <listitem>
          <para>
          <command>ausearch</command>と<command>audit2allow</command>を使用して、<systemitem>nginx</systemitem>、<systemitem>dnsmasq</systemitem>、<systemitem>in.tftpd</systemitem>などのサービス用のカスタムSELinuxポリシーモジュールを生成し、インストールしました。
        </para>
        </listitem>
        <listitem>
          <para>
          <systemitem>SELinux</systemitem>を<literal>enforcing</literal>モードに復元し、運用システムの安全を確保しました。
        </para>
        </listitem>
      </itemizedlist>
      <para>
      これらの手順が完了すると、PXEサーバは安全に設定され、IPv4またはIPv6を使用してネットワーク経由でクライアントマシンにサービスを提供する準備が整います。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-install-components">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">必要なPXEサーバコンポーネントのインストール</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>で、PXEブートをサポートするために必要なパッケージ(GRUB 2、DHCP、TFTP、および/またはHTTPコンポーネントを含む)をインストールする方法について説明します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-install-components-intro">
      <title>概要</title>
      <para>
      <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>でPXEブートサーバを設定するには、いくつかのサービスとツールをインストールする必要があります。セットアップによっては、以下のものが必要になる場合があります。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          <package>dnsmasq</package>パッケージは、DNSサーバ、TFTPサーバ、DHCPサーバ(DHCPv4およびDHCPv6)の組み合わせを提供し、IPv6ルータ広告(RA)を限定的にサポートします。以下のものを提供します。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              dnsmasq DHCPサーバ:以下の要求とクライアントのアーキテクチャに応じて、DHCPオプションの条件付き配信をサポートします。
            </para>
              <itemizedlist>
                <listitem>
                  <para>
                  DHCPv4およびDHCPv6を使用したPXEブート要求
                </para>
                </listitem>
                <listitem>
                  <para>
                  DHCPv4を使用したHTTPブート要求
                </para>
                  <note>
                    <title>DHCPv6経由のHTTPブートにおけるdnsmasqの制限事項</title>
                    <para>
                    現在、dnsmasqは必要な<literal>vendor-class</literal> DHCPv6オプションの送信をサポートしていません。
                  </para>
                  </note>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
              dnsmasq TFTPサーバ:PXEブート中にTFTP経由でブートローダファイル、カーネル、initrdを配信します。
            </para>
            </listitem>
            <listitem>
              <para>
              dnsmasq DNSサーバ:インストーラ/OS内のクライアントファームウェアと<filename>/etc/resolv.conf</filename>のドメイン名とIPアドレスの再帰的解決を提供します。
            </para>
            </listitem>
            <listitem>
              <para>
              dnsmasq IPv6 RA:PXEサーバがルータとしても動作している場合、IPv6 RAの送信をサポートします(設定可能なのは<quote>一般的なRAパターン</quote>に制限されます)。
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          <package>kea</package>パッケージはDHCPサーバで、ISC DHCPサーバの後継です。以下の要求とクライアントのアーキテクチャに応じて、DHCPオプションの条件付き配信をサポートします。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              DHCPv4およびDHCPv6を使用したPXEブート要求
            </para>
            </listitem>
            <listitem>
              <para>
              DHCPv4を使用したHTTPブート要求
            </para>
              <note>
                <title>DHCPv6経由のHTTPブートにおけるKeaの制限事項</title>
                <para>
                現在、Keaは必要な<literal>vendor-class</literal> DHCPv6オプションの送信をサポートしていません。詳細については、<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://kea.readthedocs.io/en/latest/arm/dhcp6-srv.html#id4"></link>を参照してください。
              </para>
              </note>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          TFTPサーバは、ブートローダファイル、カーネル、およびinitrdをTFTP経由で配信します。一方、keaによるPXEブートは<package>tftp</package>パッケージで提供され、HTTPブートには必要ありません。<package>dnsmasq</package> を使用している場合、<package>tftp</package>パッケージは必要ありません。
        </para>
        </listitem>
        <listitem>
          <para>
          HTTP経由でインストーライメージを提供するための<package>nginx</package>パッケージのような Webサーバ。
        </para>
          <note>
            <title>HTTPサーバの必要性</title>
            <para>
            nginxのようなHTTP/HTTPSサーバはほぼ常に必要です。その用途はHTTPブートだけにとどまりません。特に、以下のようなシナリオで必要になることがあります。
          </para>
            <itemizedlist>
              <listitem>
                <para>
                HTTPブートの基本要件です。
              </para>
              </listitem>
              <listitem>
                <para>
                <filename>squashfs.img</filename>を提供するために推奨されます。ブートコマンドラインで<literal>root=live:tftp://.../squashfs.img</literal>を使用できます。
              </para>
              </listitem>
              <listitem>
                <para>
                また、<filename>SLES-16.0-Full-*.inline.iso</filename>の<literal>inst.install_url=http://.../install/</literal>ブートコマンドラインパラメータで、無人インストール用のインストールプロファイルやその他のファイルとともにRPMを Agamaに提供する場合にも推奨されます。
              </para>
              </listitem>
            </itemizedlist>
          </note>
        </listitem>
        <listitem>
          <para>
          GRUB 2ブートローダパッケージは、サポートされているアーキテクチャと方法でネットワークブートを提供します。たとえば、AMD64/Intel 64アーキテクチャは、ネットワークブートに2つの方法を提供しています。BIOSとUEFI。さらに、UEFIは通常、PXE (TFTP)とHTTPブートをサポートしています。pxelinuxのような他のブートローダはUEFIとHTTPブートをサポートしていません。
        </para>
        </listitem>
        <listitem>
          <para>
          オプションで、IPv6用のルータ広告デーモン(<package>radvd</package>パッケージなど)。これは、<phrase><phrase os="sles4sap">SLES for SAP</phrase></phrase>がインストーラネットワークのルータとしても動作する場合に、以下を実行する場合に必要です。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              PXEまたはHTTPブートクライアントのネットワーク上でルーティングを設定する。
            </para>
            </listitem>
            <listitem>
              <para>
              PXEまたはHTTPブートクライアントのネットワーク上でDHCPv6の使用を有効にする。
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>を管理者特権で実行し、SUSEカスタマーセンターに登録され、SUSEConnectを使用して適切なオンラインリポジトリにアクセスできるように設定されているシステム。
        </para>
        </listitem>
        <listitem>
          <para>
          有効なSLEモジュール:Server Applications Module、レガシモジュール、およびBase System Module。
        </para>
        </listitem>
        <listitem>
          <para>
          ネットワークサービスおよびブートローダ用SLEモジュールリポジトリへのアクセス。
        </para>
        </listitem>
        <listitem>
          <para>
          パッケージを取得するための機能しているインターネット接続。
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-exec">
      <title>パッケージのインストール</title>
      <para>
      以下の手順で、PXEブートサーバに必要なコアパッケージをインストールします。
    </para>
      <procedure>
        <title>PXEブートサーバに必要なパッケージのインストール</title>
        <step>
          <para>
          共通の要件として、GRUB 2ブートローダとnginx HTTPサーバをインストールします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install grub2 nginx</command>
          </screen>
        </step>
        <step>
          <para>
          以下のいずれかのコマンドを実行して、ご使用のアプローチに不可欠なパッケージをインストールします。
        </para>
          <stepalternatives>
            <step>
              <para>DHCPサーバの場合は <package>kea</package>、TFTPサーバの場合は<package>tftp</package>
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install kea tftp</command>
              </screen>
            </step>
            <step>
              <para>DHCP、DNS、およびTFTPサーバの共通プロバイダとして<package>dnsmasq</package>
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install dnsmasq</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>Keaとdnsmasqが提供するDHCPサーバの制限事項</title>
            <para>
            IPv6経由のHTTPブートは、<package>kea</package>と<package>dnsmasq</package>パッケージが提供するDHCPサーバでは<emphasis>現在</emphasis>サポートされていません。UEFI仕様で要求されているように、HTTPクライアントに<literal>vendor-class</literal>オプションを返送することもサポートされていません。
          </para>
          </note>
        </step>
        <step>
          <para>
          オプションで、他のプラットフォームをサポートする予定であれば、追加のアーキテクチャ固有のGRUB 2ターゲットをインストールします。
        </para>
          <stepalternatives>
            <step>
              <para>
              AMD64/Intel 64アーキテクチャの場合:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-x86_64-efi grub2-i386-pc</command>
              </screen>
            </step>
            <step>
              <para>
              AArch64アーキテクチャの場合:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-aarch64-efi</command>
              </screen>
            </step>
            <step>
              <para>
              ppc64leアーキテクチャの場合:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-ppc64le-ieee1275</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>PXEサーバがサーバマシンのアーキテクチャとは異なるクライアントにGRUB 2パッケージを配信する方法</title>
            <para>
            GRUB 2のアーキテクチャ固有の<package>noarch.rpm</package>パッケージは、PXEサーバが設定されているマシンのアーキテクチャに関係なく、インストールメディア/リポジトリの<filename>noarch</filename>サブディレクトリに含まれています。つまり、他のアーキテクチャのクライアントをサポートするために、AMD64/Intel64マシンで動作するPXEサーバに<package>grub2-arm64-efi</package> パッケージと<package>grub2-powerpc-ieee1275</package>パッケージをインストールすることができます。
          </para>
          </note>
        </step>
        <step>
          <para>
          AMD64/Intel 64またはAArch64用のUEFIセキュアブートが必要で、インストールメディアISOのファイルを使用しない場合は、オプションで<package>shim</package>パッケージをインストールできます。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install shim</command>
          </screen>
        </step>
        <step>
          <para>
          オプションで、PXEサーバをルータとして使用する場合は、ルータ広告デーモン<package>radvd</package>をインストールします(運用ネットワークでは推奨されません)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install radvd</command>
          </screen>
        </step>
        <step>
          <para>
          ISOとディレクトリツリーを簡単にコピーまたは同期できるように、<package>rsync</package>ユーティリティをインストールします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install rsync</command>
          </screen>
        </step>
        <step>
          <para>
          サービスがインストールされているが、まだ開始されていないことを確認します。設定については以降のセクションで説明します。
        </para>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">PXEサーバ用のGRUB 2 NetBootディレクトリの作成</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<command>grub2-mknetdir</command>を使用して、PXEサーバ用のGRUB 2 NetBootディレクトリを作成する方法について説明します。このコマンドは、AMD64/Intel 64 (UEFIとBIOS)、 AArch64、およびppc64leシステム用のアーキテクチャ固有のディレクトリを生成します。UEFIセキュアブートをサポートするには、管理者はインストールメディアから署名付きEFIファイルをコピーするか、<package>shim</package>パッケージを使用してデフォルトの署名なしブートローダファイルを置き換える必要があります。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-introduction">
      <title>概要</title>
      <para>
      このセクションでは、複数のアーキテクチャでPXEサーバを展開するためにGRUB 2 NetBootディレクトリを設定する方法について説明します。<command>grub2-mknetdir</command>コマンドは、プラットフォームごとに<filename>/srv/tftpboot/boot/grub2/</filename>の下に、アーキテクチャ固有のディレクトリを作成します。たとえば、AMD64/Intel 64システムは、UEFI (<filename>x86_64-efi</filename>)とレガシBIOS (<filename>i386-pc</filename>)の両方のディレクトリを生成し、AArch64とppc64leシステムはそれぞれのUEFIディレクトリ (<filename>arm64-efi</filename>と<filename>powerpc-ieee1275</filename>)を作成します。
    </para>
      <para>
      デフォルトの署名なしの<filename>core.efi</filename>ファイルでは提供されないUEFIセキュアブートをサポートするには、管理者は、インストールメディアから署名付きEFIファイルをコピーするか、<package>shim</package>パッケージをインストールして、必要なブートローダファイル (<filename>shim.efi</filename>、<filename>grub.efi</filename>、<filename>MokManager.efi</filename>)を適切なアーキテクチャディレクトリに手動でコピーします。これにより、適切なシンボリックリンク解決が確保され、すべてのファイルをTFTPルートディレクトリ内に保持することができます。
    </para>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-requirements">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          次のパッケージ(<package>grub2</package>、<package>tftp</package>)、および他のアーキテクチャ固有のGRUB 2 パッケージ(<package>grub2-x86_64-efi</package>や<package>grub2-i386-pc</package>など)がインストールされていることを確認します。
        </para>
        </listitem>
        <listitem>
          <para>
          インストールメディア(ISO)がマウント可能であるか、<package>shim</package>パッケージがシステムにインストールされていることを確認します。ターゲットアーキテクチャ用のインストールメディア(ISO)は、SUSEカスタマーセンターからダウンロードできます。
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-executing">
      <title>NetBootディレクトリとUEFIセキュアブートの準備</title>
      <para>
      この手順では、PXEネットワークブートに必要なGRUB 2ディレクトリ構造を作成し、オプションで複数のアーキテクチャにわたる UEFIセキュアブートのサポートを設定します。
    </para>
      <procedure>
        <step>
          <para>
          GRUB 2 NetBootディレクトリ構造を作成します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>grub2-mknetdir --net-directory=/srv/tftpboot
--subdir=/boot/grub2</command>
          </screen>
          <para>
          これにより、アーキテクチャ固有のディレクトリが作成されます。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              AMD64/Intel 64: <filename>/srv/tftpboot/boot/grub2/x86_64-efi</filename>と<filename>/srv/tftpboot/boot/grub2/i386-pc </filename>
            </para>
            </listitem>
            <listitem>
              <para>
              AArch64: <filename>/srv/tftpboot/boot/grub2/arm64-efi</filename>
            </para>
            </listitem>
            <listitem>
              <para>
              ppc64le: <filename>/srv/tftpboot/boot/grub2/powerpc-ieee1275</filename>
            </para>
            </listitem>
          </itemizedlist>
          <warning>
            <para>
            <command>grub2-mknetdir</command>によって作成された<filename>grub.cfg</filename>ファイルを手動で上書きしないでください。
          </para>
          </warning>
        </step>
        <step>
          <para>
          <filename>/srv/tftpboot/boot/grub2/</filename>ディレクトリの下にある<filename>fonts/</filename>や<filename>locale/</filename>など、その他のアーキテクチャに依存しないディレクトリをTFTPサーバにコピーします。
        </para>
        </step>
        <step>
          <para>
          AMD64/Intel 64またはAArch64アーキテクチャでは、<command>grub2-mknetdir</command>コマンドでインストールされた<filename>/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/core.efi</filename>ファイルをUEFI PXEにも使用できます。ただし、これらは<emphasis>署名されておらず</emphasis>、UEFIセキュアブートをサポートしていません。サポートされているAMD64/Intel 64およびAArch64アーキテクチャで、UEFIセキュアブートをオプションで有効にするには、以下の手順のいずれかを実行します。
        </para>
          <stepalternatives>
            <step>
              <para>
              インストールメディアISOから必要なファイルをコピーします。
            </para>
              <substeps>
                <step>
                  <para>
                  ISOイメージをマウントします。
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>mount -o loop /PATH/TO/SLES.ISO /mnt</command>
                  </screen>
                </step>
                <step>
                  <para>
                  EFIファイルをコピーします。
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>cp -v /mnt/EFI/BOOT/*.efi
/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/</command>
                    <co xml:id="copy-efi-files"/>
                  </screen>
                  <calloutlist>
                    <callout arearefs="copy-efi-files">
                      <para>
                      <filename><replaceable>ARCH</replaceable>-efi</filename>を<filename>x86_64-efi</filename>または<filename>arm64-efi</filename>(UEFIセキュアブートでサポートされているアーキテクチャ)に置き換えます。
                    </para>
                    </callout>
                  </calloutlist>
                </step>
                <step>
                  <para>
                  インストールメディアISOをアンマウントします。
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>umount /mnt</command>
                  </screen>
                </step>
              </substeps>
            </step>
            <step>
              <para>
              インストールメディアISOのファイルを使用しない場合は、<package>shim</package>パッケージを使用します。
            </para>
              <substeps>
                <step>
                  <para>
                  まだインストールしていない場合は、<package>shim</package>パッケージをインストールします。
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>zypper install shim</command>
                  </screen>
                </step>
                <step>
                  <para>
                  必要なアーキテクチャの署名済みブートローダファイルをコピーします。
                </para>
                  <substeps>
                    <step>
                      <para>
                      <filename>shim.efi</filename>ファイルをコピーします。
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          AMD64/Intel 64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/shim.efi /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          AArch64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/shim.efi /srv/tftpboot/boot/grub2/arm64-efi/bootaa64.efi</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      <filename>grub.efi</filename>ファイルをコピーします。
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          AMD64/Intel 64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/grub.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          AArch64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/grub.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      <filename>MokManager.efi</filename>ファイルをコピーします。
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          AMD64/Intel 64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/MokManager.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          AArch64アーキテクチャの場合:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/MokManager.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                  </substeps>
                  <note>
                    <para>
                    <literal>-L</literal>フラグは、シンボリックリンクを解決して、ファイルがTFTPルート内に留まるようにします。
                  </para>
                  </note>
                </step>
              </substeps>
            </step>
          </stepalternatives>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-prepare-installer">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">インストーライメージコンテンツの準備</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、PXEブート環境用に<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールメディアからインストーラファイルを抽出して整理する方法を説明します。このセクションは、<literal>.install.iso</literal>イメージとRPMパッケージの両方をカバーし、異なるアーキテクチャやインストールタイプに関する具体的な手順を示します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-prepare-installer-intro">
      <title>概要</title>
      <para><phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>は、さまざまなPXEブートシナリオをサポートする複数の形式のインストーラファイルを提供します。Agamaインストーラは、カーネルイメージ(<filename>linux</filename>)、初期RAMディスク(<filename>initrd</filename>)、圧縮されたルートファイルシステム(<filename>squashfs.img</filename>)の3つの必須ファイルを必要とします。これらのファイルは、インストールメディアから抽出し、TFTPやHTTP経由でアクセス可能なディレクトリ構造に整理する必要があります。
    </para>
      <para>
      このセクションでは、<literal>.install.iso</literal>イメージとRPMパッケージの両方の準備方法について説明し、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>でサポートされるさまざまなアーキテクチャとインストールタイプとの互換性を確保します。
    </para>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>SUSEカスタマーセンターで入手可能な<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールメディア。以下の項目を選択することができます。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              オンラインISO:ネットワークインストール用のインストーラのみ(<filename>SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              フルISO:インストールリポジトリ付きのインストーラ(<filename>SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              RPMパッケージ: <package>tftpboot-agama-installer-SUSE_SLE_16_PXE-<replaceable>ARCH</replaceable></package>
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          一時的なマウントポイント(<filename>/mnt</filename>など)
        </para>
        </listitem>
        <listitem>
          <para>
          選択したインストール方法に応じて、<filename>/srv/tftpboot</filename>および<filename>/srv/install</filename>の下の十分なディスク容量
        </para>
        </listitem>
        <listitem>
          <para>
          ディレクトリの作成やファイルのコピーのための管理者特権。
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-iso">
      <title>ISOイメージからのインストーラファイルの準備</title>
      <para>
      ISOイメージは、インストーラファイルを抽出するための簡単な方法を提供します。以下の手順は、異なるアーキテクチャのオンラインとフルISOタイプの両方をカバーします。
    </para>
      <section xml:id="sles-pxe-server-prepare-installer-iso-online">
        <title>オンラインISOイメージの使用</title>
        <para>
        オンラインISOイメージにはインストーラコンポーネントのみが含まれており、システムインストール時にインストールリポジトリへのネットワークアクセスが必要です。これはGRUBの<literal>SLES-16.0 Online Installation</literal>ブートメニューエントリに対応しています。
       </para>
        <procedure xml:id="proc-prepare-online-iso-x86-aarch64">
          <title>オンライン ISO (x86_64とaarch64)からのファイルの抽出</title>
          <step>
            <para>
            インストールファイルのディレクトリ構造を作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            オンラインISOイメージをマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            カーネルファイルとInitrdファイルをコピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            圧縮されたルートファイルシステムをコピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            ISOイメージをアンマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
        <procedure xml:id="proc-prepare-online-iso-ppc64le">
          <title>オンライン ISO (ppc64le)からのファイルの抽出</title>
          <step>
            <para>
            次のディレクトリ構造を作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            ISOイメージをマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-ppc64le-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            カーネルファイルとinitrdファイルをコピーします(ppc64leの場合、パス構造が異なることに注意してください)。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/linux /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/initrd /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            圧縮されたルートファイルシステムをコピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            ISOイメージをアンマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-prepare-installer-iso-full">
        <title>フルISOイメージの使用</title>
        <para>
        フルISOイメージには、インストーラとインストールリポジトリの両方が含まれており、外部ネットワークに依存することなくローカルにインストー ルすることができます。これは、<literal>inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch}</literal>パラメータが追加されたgrubの<literal>SLES-16.0 Local Installation</literal>ブートメニューエントリに対応します。
      </para>
        <procedure xml:id="proc-prepare-full-iso">
          <title>フルISOからのファイルの抽出</title>
          <step>
            <para>
            インストーラファイルとインストールリポジトリの両方のディレクトリを作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install/SLES-16.0</command>
            </screen>
          </step>
          <step>
            <para>
            フルISOイメージをマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            カーネルファイルとinitrdファイルをコピーします(前の手順で示したようにppc64le用にパスを調整してください)。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            圧縮されたルートファイルシステムをコピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            ローカルHTTPサーバアクセス用のインストールリポジトリをコピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>rsync -avP /mnt/install/ /srv/install/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            ISOイメージをアンマウントします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-rpm">
      <title>RPMパッケージからのインストーラファイルの準備</title>
      <para>
      RPMパッケージは、オンラインインストーラファイルを入手するための代替方法を提供します。
    </para>
      <procedure xml:id="proc-prepare-rpm-packages">
        <title>tftpboot RPMパッケージのインストールと使用</title>
        <step>
          <para>
          必要なパッケージをインストールします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper in tftpboot-agama-installer-SUSE_SLE_16-<replaceable>ARCH</replaceable></command>
          </screen>
        </step>
        <step>
          <para>
          linux、initrd、squashfs.imgを tftpbootにコピーします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cd
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/linux .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/initrd .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/squashfs.img .</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-dir-structure">
      <title>推奨ディレクトリ構造</title>
      <para>
      抽出したファイルは、一貫性と保守の容易さを確保するために、以下のディレクトリレイアウトに従って整理します。この構造は、複数のアーキテクチャとインストールタイプをサポートします。
    </para>
      <example xml:id="ex-pxe-directory-layout">
        <title>完全なPXEサーバのディレクトリレイアウト</title>
        <screen>/srv/tftpboot/
├── boot/
│   ├── grub2/
│   │   ├── x86_64-efi/
│   │   │   ├── bootx64.efi
│   │   │   └── grub.cfg
│   │   ├── i386-pc/
│   │   │   └── core.0
│   │   ├── arm64-efi/
│   │   │   └── bootaa64.efi
│   │   └── powerpc-ieee1275/
│   │       └── core.elf
│   └── images/
│       └── SLES-16.0/
│           ├── x86_64/
│           │   ├── linux <co xml:id="co-kernel"/>
│           │   ├── initrd <co xml:id="co-initrd"/>
│           │   └── squashfs.img <co xml:id="co-squashfs"/>
│           ├── aarch64/
│           └── ppc64le/
/srv/install/
└── SLES-16.0/
    ├── x86_64/ <co xml:id="co-install-repo"/>
    ├── aarch64/
    └── ppc64le/</screen>
      </example>
      <calloutlist>
        <callout arearefs="co-kernel">
          <para>
          インストールメディアから抽出したカーネルイメージ
        </para>
        </callout>
        <callout arearefs="co-initrd">
          <para>
          初期RAMディスクイメージ
        </para>
        </callout>
        <callout arearefs="co-squashfs">
          <para>
          Agamaインストーラ用の圧縮されたルートファイルシステム
        </para>
        </callout>
        <callout arearefs="co-install-repo">
          <para>
          フルISOの<filename>install</filename>ディレクトリからのインストールリポジトリ(オプション)
        </para>
        </callout>
      </calloutlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-verify">
      <title>インストールの検証</title>
      <para>
      インストーラファイルを抽出して整理した後、必要なコンポーネントがすべて存在し、アクセス可能であることを検証します。
    </para>
      <procedure xml:id="proc-verify-installer-files">
        <title>検証手順</title>
        <step>
          <para>
          必要なファイルがあるか確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/*</command>
          </screen>
        </step>
        <step>
          <para>
          適切なファイルアクセス権があることを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 0755 {} \;</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type f -exec chmod 0644 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>ファイルアクセシビリティ</title>
        <para>
        抽出されたすべてのファイルが、TFTPおよびHTTPサービスで読み取り可能であることを確認します。ファイルは、ブートプロセス中にPXEクライアントによってアクセスされるため、適切な権限とサービス設定が、展開を成功させるために不可欠です。
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-next">
      <title>次のステップ</title>
      <para>
      インストーラファイルが適切に準備され、整理されていれば、以下の手順に進むことができます。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          これらのファイルを参照するメニューエントリを使用したPXEブート用GRUB 2の設定
        </para>
        </listitem>
        <listitem>
          <para>
          抽出したコンテンツを提供するためのHTTPとTFTPサービスの設定
        </para>
        </listitem>
        <listitem>
          <para>
          PXEクライアントを適切なブートローダに誘導するためのDHCPの設定
        </para>
        </listitem>
      </itemizedlist>
      <para>
      抽出されたファイルは、<literal>root=live:http://pxe.example.net/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/squashfs.img</literal>のようなパスを使用してGRUB 2設定で参照されます。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-configure-grub2">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">PXEブート用のGRUB 2の設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>でPXEベースのブート用にGRUB 2ブートローダを設定する方法について説明します。ネットワークブートディレクトリ構造の作成、アーキテクチャ固有のブートローダの設定、複数のアーキテクチャとインストールシナリオをサポートする柔軟な設定システムの実装について説明します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-grub2-intro">
      <title>概要</title>
      <para>
      GRUB 2はPXEクライアントのネットワークブートローダとして機能し、カーネルファイルとinitrdファイルをロードしてAgamaインストーラを起動します。このセクションでは、クライアントアーキテクチャを自動的に検出し、ネットワークインタフェースの選択を管理し、複数のインストールタイプとターゲットアーキテクチャをサポートする統合ブートメニューを提供する、洗練されたGRUB 2設定を作成する方法を示します。
    </para>
      <para>
      設定アプローチは、アーキテクチャの検出、変数定義、ブートメニューエントリのための個別のファイルを持つモジュラー設計を使用しています。これにより、異なるハードウェアプラットフォーム間で一貫性を維持しながら、マシン固有の設定や自動インストールプロファイルのサポートが可能になります。
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          前のセクションで説明したように、GRUB 2のネットワークブートディレクトリ構造が整っていることを確認します。
        </para>
        </listitem>
        <listitem>
          <para>
          前のセクションで説明したように、インストーラファイルが適切に整理されていることを確認します。
        </para>
        </listitem>
        <listitem>
          <para>
          すべてのターゲットアーキテクチャ用のGRUB 2パッケージ(<package>grub2-x86_64-efi</package>、<package>grub2-i386-pc</package>、<package>grub2-aarch64-efi</package>、および <package>grub2-ppc64le-ieee1275</package>)をインストールする必要があります。
        </para>
        </listitem>
        <listitem>
          <para>
          UEFIセキュアブートサポート用の<package>shim</package>パッケージ(オプション)。
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot</filename>または同等のPXEルートへの管理アクセス。
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-main-config">
      <title>GRUB 2設定の作成</title>
      <para>
      GRUB 2設定ファイルは、クライアントのアーキテクチャの検出、ネットワークインタフェースの管理、他の設定ファイルのロードという3つの主要なタスクを処理します。このモジュラー方式は、さまざまな展開シナリオに柔軟に対応できます。
    </para>
      <procedure xml:id="proc-create-main-grub-config">
        <title>主な<filename>grub.cfg</filename>ファイルの設定</title>
        <step>
          <para>
          メインのGRUB 2設定ファイルを<filename>/srv/tftpboot/boot/grub2/grub.cfg</filename>に作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Architecture detection and mapping
if [ "$grub_cpu" == "i386" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "x86_64" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "arm64" ]; then
  set arch='aarch64'
elif [ "$grub_cpu" == "powerpc" ]; then
  set arch='ppc64le'
fi

if [ "X$arch" == "X" ]; then
  echo "ERROR: No architecture found for ${grub_cpu}"
  exit
else
  echo "Running on $arch CPU architecture"
fi
export arch


# Network interface configuration for PXE-selected NIC
# - dracut based images on SLE-16:
set ipcfg="ifname=pxe0:${net_default_mac} ip=pxe0:dhcp"
export ipcfg
# - linuxrc installer on SLE-15:
set ifcfg="ifcfg=${net_default_mac}=dhcp"
export ifcfg

# Define typical serial console kernel parameter
#set sconsole="console=tty0 console=ttyS0,115200n8"
#export sconsole

# Load machine-specific configuration if available
if [ -s "${config}/${net_default_mac}/grub.cfg" ]; then
  ## Source a host specific configuration of grub menu:
  source "${config}/${net_default_mac}/grub.cfg"
else
  ## Source default grub boot menu:
  source "${prefix}/menu.cfg"
fi
EOF
</screen>
        </step>
      </procedure>
      <variablelist>
        <title>主な設定要素</title>
        <varlistentry>
          <term>アーキテクチャの検出</term>
          <listitem>
            <para>
            GRUB 2のCPUタイプをディストリビューションアーキテクチャにマッピングし、異なるハードウェアプラットフォームで動作する統合メニューエントリを可能にします。
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>ネットワークインタフェース管理</term>
          <listitem>
            <para>
            <literal>pxe0</literal>というPXEブートインタフェース上でのみdhcpを有効にするために、 grub2変数<varname>${net_default_mac}</varname>を使用して<varname>${ipcfg}</varname> 変数を定義し、 マルチインタフェースシステムでのネットワークプロービングの問題を回避します。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>ユーティリティ定義</term>
          <listitem>
            <para>
            シリアルコンソールパラメータを指定して、一般的な<varname>${sconsole}</varname>変数を定義します。
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>マシン固有の設定</term>
          <listitem>
            <para>
            MACアドレスに基づいてオプションのマシンごとの設定ファイルをロードし、カスタマイズされたマシンごとのブートパラメータと自動インストールプロファイルを可能にします。
          </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-menu">
      <title>統合ブートメニューの作成</title>
      <para>
      ブートメニューは、異なるハードウェアプラットフォームやインストールタイプに自動的に適応する、アーキテクチャに依存しないメニューエントリを提供するために、メイン設定からの変数を使用します。
    </para>
      <procedure xml:id="proc-create-grub-menu">
        <title>menu.cfgファイルの設定</title>
        <step>
          <para>
          <filename>/srv/tftpboot/boot/grub2/menu.cfg</filename>に統合ブートメニューを作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'SLES-16.0 Online Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}

menuentry 'SLES-16.0 Local Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <note>
        <title>メニューエントリの柔軟性</title>
        <para>
        メニューエントリは、クライアントのアーキテクチャと設定に基づいて自動的に入力される変数を使用します。<varname>${arch}</varname>変数は、正しいファイルがロードされることを保証します。
       </para>
        <para>
        オプションの<varname>${ipcfg}</varname>変数を指定すると、PXEで選択されたネットワークインタフェースのみが設定されます。
       </para>
        <para>
        オプションの<varname>${sconsole}</varname>変数は、インストーラシステムでシリアルコンソールを有効にします。
       </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-machine-specific">
      <title>マシン固有の設定</title>
      <para>
      高度な展開では、デフォルト設定を上書きしたり、自動化されたインストールパラメータを提供するマシン固有の設定ファイルを作成できます。
    </para>
      <procedure xml:id="proc-machine-specific-config">
        <title>マシン固有の設定の作成</title>
        <step>
          <para>
          マシン固有の設定用のディレクトリを作成します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config</command>
          </screen>
        </step>
        <step>
          <para>
          MACアドレスが<literal>aa:bb:cc:dd:ee:ff</literal>のマシンの場合、固有の設定を作成します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff</command>
          </screen>
        </step>
        <step>
          <para>
          マシン固有の<filename>grub.cfg</filename>を作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
# Machine-specific configuration for aa:bb:cc:dd:ee:ff
set default='SLES-16.0 Full Installation'

# Activate the menu-entry after 5sec timeout
set timeout=5

# Use know predictable network interface name
set ipcfg="ip=eno1:dhcp"

# Set the autoinstall variable for this machine
set autoinstall="inst.auto=http://pxe.example.net/install/profiles/aa:bb:cc:dd:ee:ff/sles16.json"
export autoinstall

# Load the default menu
source "/boot/grub2/menu.cfg"
EOF
</screen>
          <para>
          または、ホスト固有の<filename>grub.cfg</filename>に独自のメニューエントリを提供します(例: 特定のブート試行用に生成)。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
set default='SLES-16.0 Auto-Installation'
set timeout=5

menuentry 'SLES-16.0 Auto-Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} inst.auto=http://pxe.example.net/install/profiles/${net_default_mac}/sles16.json ip=eno1:dhcp
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <example xml:id="ex-machine-specific-parameters">
        <title>マシン固有の共通パラメータ</title>
        <variablelist>
          <varlistentry>
            <term>
              <varname>default</varname>
            </term>
            <listitem>
              <para>
              自動的にブートするメニューエントリを指定します
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>timeout</varname>
            </term>
            <listitem>
              <para>
              ブートタイムアウトを秒単位で設定します
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>ipcfg</varname>
            </term>
            <listitem>
              <para>
              特定のハードウェアのネットワークインタフェース設定を上書きします
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>autoinstall</varname>
            </term>
            <listitem>
              <para>
              マシン固有の自動インストールプロファイルのURLを提供します。
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </example>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-verify">
      <title>GRUB 2設定の検証</title>
      <para>
      設定ファイルを作成したら、セットアップが正しく、必要なファイルがすべて揃っていることを検証します。
    </para>
      <procedure xml:id="proc-verify-grub-config">
        <title>検証手順</title>
        <step>
          <para>
          GRUB 2のディレクトリ構造を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>find /srv/tftpboot/boot/grub2 -type f -name "*.cfg" -o -name "*.efi" -o -name "core.*"</command>
          </screen>
        </step>
        <step>
          <para>
          GRUB 2ツールでテストして、設定ファイルの構文を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
          </screen>
        </step>
        <step>
          <para>
          適切なファイルアクセス権があることを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>chmod -R 644 /srv/tftpboot/boot/grub2/*.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/grub2 -type d -exec chmod 0755 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>設定テスト</title>
        <para>
        実際のPXEクライアントでGRUB 2設定をテストし、適切なアーキテクチャ検出とメニュー機能を確認します。<varname>${net_default_mac}</varname>変数は、実際のネットワークブートシナリオでのみ使用可能です。
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-troubleshooting">
      <title>GRUB 2設定のトラブルシューティング</title>
      <para>
      GRUB 2 PXE設定で発生するよくある問題とその解決策。それぞれの問題には、問題を解決するための診断手順と具体的なコマンドが記載されています。
    </para>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-arch">
        <title>アーキテクチャの検出の失敗</title>
        <para>
        GRUB 2が正しいアーキテクチャを検出できない場合、クライアントは正しくないバイナリで起動したり、完全にロードに失敗したりすることがあります。
      </para>
        <procedure xml:id="proc-debug-arch-detection">
          <title>アーキテクチャ検出のデバッグ</title>
          <step>
            <para>
            GRUB 2設定にデバッグ出力を追加して、検出された値を確認します。
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Debug architecture detection
echo "Detected grub_cpu: ${grub_cpu}"
echo "Mapped arch: ${arch}"
sleep 3
EOF</screen>
          </step>
          <step>
            <para>
            設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            アーキテクチャのマッピングが不完全な場合は、検出ロジックを拡張します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/elif \[ "$grub_cpu" == "powerpc" \]/a\\nelif [ "$grub_cpu" == "riscv64" ]; then\n  set arch='\''riscv64'\''\\' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            アーキテクチャ固有のディレクトリが存在することを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-network">
        <title>ネットワークインタフェースが見つからない</title>
        <para>
        ファームウェアの実装によっては、<varname>${net_default_mac}</varname>変数が正しく設定されず、ネットワーク設定に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-network-interface">
          <title>ネットワークインタフェースの問題の診断</title>
          <step>
            <para>
            ネットワーク変数をチェックするためのデバッグ出力を追加します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/set ipcfg=/i\\necho "Default MAC: ${net_default_mac}"\necho "Network variables set"\nsleep 2' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            フォールバックネットワーク設定を作成します。
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>

# Fallback network configuration if net_default_mac is empty
if [ "X${net_default_mac}" == "X" ]; then
  set ipcfg="ip=dhcp"
  set ifcfg="ifcfg=*=dhcp"
  echo "WARNING: Using fallback network configuration"
  sleep 2
fi
EOF
</screen>
          </step>
          <step>
            <para>
            特定のインタフェースでネットワーク設定をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo 'set ipcfg="ip=eno1:dhcp"' &gt; /srv/tftpboot/boot/config/test-network.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            ターゲットシステムのネットワークインタフェース名を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-file-paths">
        <title>ファイルパスが見つからない</title>
        <para>
        ファイルパスが正しくないと、GRUB 2がカーネルファイルとinitrdファイルをロードできず、ブートに失敗します。
      </para>
        <procedure xml:id="proc-debug-file-paths">
          <title>ファイルパスのアクセシビリティの確認</title>
          <step>
            <para>
            インストーラファイルが想定される場所に存在するかどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images -name "linux" -o -name "initrd" -o -name "squashfs.img"</command>
            </screen>
          </step>
          <step>
            <para>
            ブートファイルへのTFTPアクセスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/grub.cfg /tmp/test-grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            インストーラファイルへのHTTPアクセスをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/linux</command>
            </screen>
          </step>
          <step>
            <para>
            ファイルアクセス権と所有権を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/*/</command>
            </screen>
          </step>
          <step>
            <para>
            必要に応じて権限を修正します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 644 /srv/tftpboot/boot/images/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 755 {} \;</command>
            </screen>
          </step>
          <step>
            <para>
            シンボリックリンクが壊れていないことを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images/ -type l -exec ls -la {} \;</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-efi">
        <title>EFIブートの失敗</title>
        <para>
        EFIおよびセキュアブートの問題により、ブートローダが正しく初期化されなかったり、認証に失敗したりすることがあります。
      </para>
        <procedure xml:id="proc-debug-efi-boot">
          <title>EFIブートの問題の診断</title>
          <step>
            <para>
            セキュアブートファイルが存在することを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            shim (bootx64.efiまたはshim.efi)、grub.efi、MokManager.efiファイルが正しくコピーされていることを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>file /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            EFIファイルの整合性を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sha256sum /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            ファイルがTFTP経由でアクセス可能かどうかをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-shim.efi</command>
            </screen>
          </step>
          <step>
            <para>
            aarch64システムの場合、ARM64 EFIファイルを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/arm64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            DHCP設定で正しいブートローダのパスが提供されていることを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -n "bootx64.efi\|shim.efi\|bootaa64.efi"
/etc/dnsmasq.d/dhcp.conf /etc/kea/kea-dhcp?.conf /etc/dhcpd?.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ファイルがない場合は、/mntにマウントされたISOまたはshimパッケージファイルから再度コピーします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -v /mnt/EFI/BOOT/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -pL /usr/share/efi/x86_64/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-menu">
        <title>メニューエントリがロードされない</title>
        <para>
        GRUB 2がロードされたが、メニューエントリが失敗したり、エラーが表示されたりする場合、問題は変数展開やファイル参照に関連していることが多いです。
      </para>
        <procedure xml:id="proc-debug-menu-entries">
          <title>メニューエントリに関する問題のデバッグ</title>
          <step>
            <para>
            メニュー設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            メニューエントリにデバッグ出力を追加します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/linux_kernel.*{images}/i\\necho "Loading: ${images}/SLES-16.0/${arch}/linux"\necho "Architecture: ${arch}"' /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            変数展開が正しく機能していることを確認します。
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Debug Variables' {
  echo "arch = ${arch}"
  echo "images = ${images}"
  echo "ipcfg = ${ipcfg}"
  sleep 5
}
EOF
</screen>
          </step>
          <step>
            <para>
            簡略化したメニューエントリでテストします。
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/simple-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Simple Test' {
  linux /boot/images/SLES-16.0/x86_64/linux
  initrd /boot/images/SLES-16.0/x86_64/initrd
}
EOF
</screen>
          </step>
          <step>
            <para>
            テストメニューを一時的にロードします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/menu.cfg"|source "${prefix}/simple-menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            テスト後、元のメニューを復元します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/simple-menu.cfg"|source "${prefix}/menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-logging">
        <title>詳細ログの有効化</title>
        <para>
        永続的な問題については、包括的なログを有効にして、ブートプロセスに関する詳細な情報を取得します。
      </para>
        <procedure xml:id="proc-enable-grub-logging">
          <title>GRUB 2のデバッグログの設定</title>
          <step>
            <para>
            メイン設定のデバッグバージョンを作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /srv/tftpboot/boot/grub2/grub.cfg /srv/tftpboot/boot/grub2/grub.cfg.backup</command>
            </screen>
          </step>
          <step>
            <para>
            包括的なデバッグ出力を追加します。
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug.cfg &lt;&lt; 'EOF'</command>
# Debug configuration for GRUB troubleshooting
set debug=all
set pager=1

echo "=== GRUB Debug Information ==="
echo "grub_cpu: ${grub_cpu}"
echo "grub_platform: ${grub_platform}"
echo "net_default_mac: ${net_default_mac}"
echo "net_default_server: ${net_default_server}"
echo "============================="
sleep 5
EOF
</screen>
          </step>
          <step>
            <para>
            デバッグ設定をメインファイルに含めます。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\source "${prefix}/debug.cfg"' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            ブート試行中のTFTPログを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u tftp.socket</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPログでPXE要求を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            トラブルシューティングの後、デバッグモードを無効にします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/source "${prefix}\/debug.cfg"/d' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-next-steps">
      <title>次のステップ</title>
      <para>
      GRUB 2を適切に設定したら、以下の手順に進むことができます。
    </para>
      <itemizedlist>
        <listitem>
          <para>
          ブートファイルとインストーラコンテンツを提供するためのHTTPとTFTPサービスの設定
        </para>
        </listitem>
        <listitem>
          <para>
          PXEクライアントを適切なブートローダに誘導するためのDHCPサービスの設定
        </para>
        </listitem>
        <listitem>
          <para>
          ターゲットハードウェア上での完全なPXEブートプロセスのテスト
        </para>
        </listitem>
      </itemizedlist>
      <para>
      柔軟なGRUB 2設定システムは、洗練されたPXE展開シナリオの基盤を提供し、統一されたインタフェースを通じて複数のアーキテクチャとインストールタイプをサポートします。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-configure-tftp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">PXEブート用TFTPの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストール向けにGRUB 2ブートローダとPXEブートコンテンツを提供するようにTFTPサービスを設定する方法を説明します。従来の<systemitem>in.tftpd</systemitem>サーバと、<systemitem>dnsmasq</systemitem>が提供する統合TFTP機能について説明します。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-tftp-intro">
      <title>概要</title>
      <para>
      TFTPは、ネットワークブートプロセス中にPXEクライアントにブートローダファイルを提供します。<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>は、<package>tftp</package>パッケージに含まれる従来の<systemitem>in.tftpd</systemitem>サーバと、<systemitem>dnsmasq</systemitem>に統合されたTFTP機能の2つのTFTPサーバ実装をサポートしています。
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>tftp</package>パッケージまたは<package>dnsmasq</package>パッケージのいずれか
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot</filename>下に整理されたPXEブートファイル
        </para>
        </listitem>
        <listitem>
          <para>
          サービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-intftpd">
      <title>in.tftpdサーバの設定</title>
      <para>
      <systemitem>in.tftpd</systemitem>サーバは、設定ファイル<filename>/etc/sysconfig/tftp</filename>を使用して、TFTPルートディレクトリおよびサーバオプションを定義します。
    </para>
      <procedure xml:id="proc-configure-intftpd">
        <title>in.tftpd TFTPサーバの設定</title>
        <step>
          <para>
          オプションで、TFTPオプションを設定して詳細ログを有効にします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
          </screen>
          <para>
          <option>-v</option>オプションを使用すると、TFTP経由で取得されたファイル名を確認するための詳細ログが有効になります。
        </para>
        </step>
        <step>
          <para>
          TFTPサービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now tftp.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-dnsmasq">
      <title>dnsmasq TFTPサーバの設定</title>
      <para><systemitem>dnsmasq</systemitem>は、<filename>/srv/tftpboot</filename>ディレクトリを使用するように有効化および設定できる、組み込みのTFTPサーバを提供します。
    </para>
      <procedure xml:id="proc-configure-dnsmasq-tftp">
        <title>dnsmasq TFTP機能の設定</title>
        <step>
          <para>
          TFTP設定ファイルを作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/tftp.conf &lt;&lt; 'EOF'</command>
enable-tftp
tftp-root=/srv/tftpboot
EOF
</screen>
        </step>
        <step>
          <para>
          dnsmasqサービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-verify">
      <title>TFTP設定の検証</title>
      <para>
      TFTPサーバの機能をテストし、PXEクライアントにファイルを提供できることを確認します。
    </para>
      <procedure xml:id="proc-verify-tftp">
        <title>TFTPサーバ機能のテスト</title>
        <step>
          <para>
          テストファイルを作成します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>echo "test file" | sudo tee /srv/tftpboot/test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          TFTP経由でテストファイルを取得します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          ファイルが正常に取得されたことを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          テストファイルをクリーンアップします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>rm /srv/tftpboot/test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-troubleshooting">
      <title>TFTP設定のトラブルシューティング</title>
      <para>
      PXEブート環境でTFTPサービスを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-service-conflicts">
        <title>ポート69でのサービスの競合</title>
        <para>
        <systemitem>in.tftpd</systemitem>と<systemitem>dnsmasq</systemitem>の両方がTFTPサービスにUDPポート69を使用するため、同時に実行できません。
      </para>
        <procedure xml:id="proc-resolve-tftp-conflicts">
          <title>TFTPサービスの競合の解決</title>
          <step>
            <para>
            実行中のサービスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status tftp.service dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            ポート69を使用しているサービスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :69</command>
            </screen>
          </step>
          <step>
            <para>
            競合するサービスを停止します(dnsmasqの例)。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            優先するTFTPサービスを開始します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start tftp.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-directory">
        <title>TFTPディレクトリの問題</title>
        <para>
        TFTPルートディレクトリへのアクセスに問題があると、ファイル提供が妨げられることがあります。
      </para>
        <procedure xml:id="proc-debug-tftp-directory">
          <title>TFTPディレクトリ設定の確認</title>
          <step>
            <para>
            in.tftpdのTFTPディレクトリ設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_DIRECTORY /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqのTFTPディレクトリ設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep tftp-root /etc/dnsmasq.d/tftp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ディレクトリが存在するかどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/</command>
            </screen>
          </step>
          <step>
            <para>
            ディレクトリが存在しない場合は、ディレクトリを作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-verbose">
        <title>TFTPログの有効化</title>
        <para>
        詳細ログは、TFTP転送でのファイルアクセスの問題を特定するのに役立ちます。
      </para>
        <procedure xml:id="proc-enable-tftp-verbose">
          <title>TFTP詳細ログの有効化</title>
          <step>
            <para>
            現在のTFTPオプションを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_OPTIONS /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            詳細ログを有効にします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            TFTPサービスを再起動します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart tftp.service</command>
            </screen>
          </step>
          <step>
            <para>
            TFTPログを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.service -f</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-next-steps">
      <title>次のステップ</title>
      <para>
      TFTPを設定したら、インストーラファイルを提供するHTTPサービスと、PXEクライアントを適切なブートローダに誘導するためのDHCPサービスの設定に進むことができます。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-configure-nginx">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">HTTP配信用のnginxの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、PXEブートコンテンツをHTTP経由で提供するようにnginxを設定して、クライアントがカーネル、initrd、squashfsイメージなどのインストーラファイルを中央の場所からロードできるようにする方法を説明します。HTTP配信は、大きなファイルの場合に、TFTPよりも優れたパフォーマンスを提供し、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase> Agamaのインストールに必要です。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-nginx-intro">
      <title>概要</title>
      <para>
      nginxはPXEブート環境のHTTPサーバとして機能し、Webベースの配信を通じてインストーラファイルへのアクセスを提供します。HTTPサーバはTFTPブートディレクトリとインストールリポジトリを公開し、PXEクライアントがカーネルイメージ、initrdファイル、Agamaインストーラコンポーネントを低速のTFTPプロトコルではなくHTTP経由でダウンロードできるようにします。
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>nginx</package>パッケージ
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot/boot</filename>下に整理されたPXEブートファイル
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/install</filename>で利用可能なインストールリポジトリ
        </para>
        </listitem>
        <listitem>
          <para>
          nginxの設定を変更するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-setup">
      <title>PXEブート用のnginxの設定</title>
      <para>
      nginx設定は、HTTP URL経由で TFTPブートディレクトリとインストールリポジトリを公開するロケーションエイリアスを定義します。
    </para>
      <procedure xml:id="proc-configure-nginx">
        <title>nginx HTTPサーバの設定</title>
        <step>
          <para>
          nginx設定ファイルを編集します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>vim /etc/nginx/nginx.conf</command>
          </screen>
        </step>
        <step>
          <para>
          <literal>http</literal>セクションで、HTTPサーバブロックを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/nginx/nginx.conf &lt;&lt; 'EOF'</command>
http {

    include             mime.types;
    default_type        application/octet-stream;

    charset             utf-8;
    sendfile            on;
    keepalive_timeout   65;

    server {
        listen          80  default_server;
        listen     [::]:80  default_server;

        location / {
            root   /srv/www/htdocs/;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /srv/www/htdocs/;
        }

        # Expose TFTP boot directory for HTTP boot
        location /boot {
            alias      /srv/tftpboot/boot;
            autoindex  on;
        }

        # Expose installation repositories and profiles
        location /install {
            alias      /srv/install;
            autoindex  on;
        }
    }
}

events {
    worker_connections  1024;
}
EOF
</screen>
        </step>
        <step>
          <para>
          nginx設定構文をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>nginx -t</command>
          </screen>
        </step>
        <step>
          <para>
          nginxサービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now nginx.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-verify">
      <title>nginxx設定の検証</title>
      <para>
      HTTPサーバの機能をテストし、PXEブートファイルとインストールコンテンツをクライアントに提供できることを確認します。
    </para>
      <procedure xml:id="proc-verify-nginx">
        <title>nginx HTTPサーバのテスト</title>
        <step>
          <para>
          ブートファイルへのHTTPアクセスをテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/</command>
          </screen>
        </step>
        <step>
          <para>
          インストールディレクトリへのアクセスをテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/install/</command>
          </screen>
        </step>
        <step>
          <para>
          特定のインストーラファイルにアクセスできることを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-troubleshooting">
      <title>nginx設定のトラブルシューティング</title>
      <para>
      PXEブートHTTP配信用にnginxを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-config">
        <title>設定構文エラー</title>
        <para>
        nginxの設定構文が正しくないため、サービスが正しく開始または再ロードされません。
      </para>
        <procedure xml:id="proc-debug-nginx-config">
          <title>nginx設定問題の解決</title>
          <step>
            <para>
            設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>nginx -t</command>
            </screen>
          </step>
          <step>
            <para>
            起動に失敗した場合は、nginxサービスのステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なエラーログを表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u nginx.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            nginxのエラーログファイルを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/nginx/error.log</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-permissions">
        <title>ファイルアクセスと権限の問題</title>
        <para>
        nginxは権限が正しくないか、ディレクトリが見つからないためにファイルの提供に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-nginx-permissions">
          <title>ファイルアクセスの問題の解決</title>
          <step>
            <para>
            ブートディレクトリが存在し、アクセス可能かどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            インストールディレクトリが存在するかどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/install/</command>
            </screen>
          </step>
          <step>
            <para>
            nginxがディレクトリを読み込めることを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo -u nginx ls /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            必要であれば、不足しているディレクトリを作成します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install</command>
            </screen>
          </step>
          <step>
            <para>
            適切な権限を設定します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 755 /srv/tftpboot/boot /srv/install</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-port">
        <title>ポートバインディングの競合</title>
        <para>
        他のサービスがポート80を使用している場合、nginxの起動に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-nginx-port">
          <title>ポートの競合の解決</title>
          <step>
            <para>
            ポート80を使用しているサービスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
          <step>
            <para>
            必要であれば、競合するサービスを停止します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop apache2</command>
            </screen>
          </step>
          <step>
            <para>
            nginxサービスを開始します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            nginxがポート80でリスンしていることを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-next-steps">
      <title>次のステップ</title>
      <para>
      nginxをHTTP配信用に設定したら、PXEクライアントを適切なブートローダとHTTPリソースに誘導するためのDHCP サービスの設定に進むことができます。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-configure-dns">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">dnsmasqを使用したDNSサーバの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールリソースにアクセスするPXEクライアントにホスト名解決を提供するために、dnsmasqを使用してDNSサービスを設定する方法を説明します。DNS設定により、クライアントはブートURLやDHCP設定でIPアドレスの代わりにホスト名を使用できるようになります。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-dns-intro">
      <title>概要</title>
      <para>
      DNSサービスにより、PXEクライアントはブートURLやインストールソース内のホスト名を解決できます。DNSサーバの完全な設定はこのドキュメントの範囲外ですが、このセクションでは、クライアントがPXEサーバのホスト名(<replaceable>PXE.EXAMPLE.NET</replaceable>)をIPアドレスに解決できるようにする、dnsmasqを使用した基本的なDNS設定について説明します。
    </para>
      <para>
      DNS設定がない場合、ブートURLは<literal>http://192.168.1.200/</literal>や<literal>http://[2001:db8:0:1::200]/</literal>のようなIPアドレスを直接使用する必要があります。BIOS/UEFIファームウェアの実装によっては、DHCP TFTP URLのホスト名をサポートしておらず、<literal>tftp://[2001:db8:0:1::200]/</literal>のようなIPアドレスを必要とするものもあります。
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-requirements">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>dnsmasq</package>パッケージ
        </para>
        </listitem>
        <listitem>
          <para>
          PXEサーバ用に設定された静的IPアドレス
        </para>
        </listitem>
        <listitem>
          <para>
          DNSサービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-setup">
      <title>dnsmasq DNSサービスの設定</title>
      <para>
      dnsmasq DNS設定はローカルホストの名前解決を提供し、外部クエリにはアップストリームネームサーバを使用します。
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dns">
        <title>dnsmasq DNSサーバの設定</title>
        <step>
          <para>
          dnsmasq用のDNS設定ファイルを作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dns.conf &lt;&lt; 'EOF'</command>
# DNS configuration file for dnsmasq

# Log DNS queries
log-queries

# DNS cache behavior
cache-size=10000
local-ttl=60
neg-ttl=10

# Never forward A or AAAA queries for plain names to upstream name servers
domain-needed

# Add local domain to simple names in /etc/hosts and DHCP
expand-hosts

# Specifies DNS domain and networks including local forward and reverse declarations
domain=<replaceable>EXAMPLE.NET</replaceable>,192.168.1.0/24,local
domain=<replaceable>EXAMPLE.NET</replaceable>,2001:db8:0:1::/64,local
EOF
</screen>
        </step>
        <step>
          <para>
          システムのhostsファイルにホスト名のエントリを追加します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/hosts &lt;&lt; 'EOF'</command>
192.168.1.200 <replaceable>PXE.EXAMPLE.NET</replaceable>
2001:db8:0:1::200 <replaceable>PXE.EXAMPLE.NET</replaceable>
EOF
</screen>
        </step>
        <step>
          <para>
          dnsmasqの設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          dnsmasqサービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>DNS転送の動作</title>
        <para>
        デフォルトでは、dnsmasqは<filename>/etc/resolv.conf</filename>のネームサーバをフォワーダとして使用し、<filename>/etc/hosts</filename>からレコードを提供します。これにより、PXEサーバは、外部ホスト名を解決しながら、PXE関連サービスにローカル解決を提供できます。
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-verify">
      <title>DNS設定の検証</title>
      <para>
      DNSサーバの機能をテストし、PXEクライアントのホスト名解決が機能することを確認します。
    </para>
      <procedure xml:id="proc-verify-dns">
        <title>DNSサーバ機能のテスト</title>
        <step>
          <para>
          IPv4ホスト名解決をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost</command>
          </screen>
        </step>
        <step>
          <para>
          IPv6ホスト名解決をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost | grep 2001:db8</command>
          </screen>
        </step>
        <step>
          <para>
          IPv4のDNS逆引きをテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup 192.168.1.200 localhost</command>
          </screen>
        </step>
        <step>
          <para>
          外部DNS転送がまだ機能していることを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup google.com localhost</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-troubleshooting">
      <title>DNS設定のトラブルシューティング</title>
      <para>
      PXE環境でDNSサービス用にdnsmasqを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-dns-troubleshoot-config">
        <title>設定とサービスの問題</title>
        <para>
        dnsmasqは、設定エラーやポートの競合が原因で起動に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-dns-config">
          <title>DNS設定の問題の解決</title>
          <step>
            <para>
            dnsmasq設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqサービスの状態を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            DNSポート53を使用しているサービスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :53</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqのログでエラーを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            必要であれば、競合するDNSサービスを停止します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop systemd-resolved</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-resolution">
        <title>ホスト名解決の失敗</title>
        <para>
        DNSクエリは、誤った設定やホスト名エントリの欠落が原因で失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-dns-resolution">
          <title>DNS解決の問題の診断</title>
          <step>
            <para>
            hostsファイルにホスト名のエントリが存在するかどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep <replaceable>PXE.EXAMPLE.NET</replaceable> /etc/hosts</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqでドメイン設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep domain= /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            詳細出力でDNSクエリをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dig @localhost <replaceable>PXE.EXAMPLE.NET</replaceable></command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqのクエリログを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "query"</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqを再起動して設定を再ロードします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-forwarding">
        <title>DNS転送の問題</title>
        <para>
        アップストリームネームサーバの設定が正しくない場合、外部DNSクエリが失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-dns-forwarding">
          <title>DNS転送に関する問題のトラブルシューティング</title>
          <step>
            <para>
            アップストリームネームサーバの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/resolv.conf</command>
            </screen>
          </step>
          <step>
            <para>
            アップストリームネームサーバへの直接クエリをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nslookup google.com 8.8.8.8</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqの転送設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "server=|no-resolv" /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            必要に応じて、特定のアップストリームネームサーバを追加します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo "server=8.8.8.8" &gt;&gt; /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            dnsmasqサービスを再起動します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-next-steps">
      <title>次のステップ</title>
      <para>
      DNSサービスが設定されたので、PXEクライアントはブートURLやインストールソース内のホスト名を解決できるようになりました。クライアント設定のためにDNSサーバを参照するDHCPサービスの設定に進むことができます。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-configure-ntp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion"><systemitem>chrony</systemitem>を使用したNTPサーバの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>のインストール中にPXEクライアントに正確な時刻同期を提供するために、<systemitem>chrony</systemitem>を使用してNTPサービスを設定する方法を説明します。適切な時刻同期は、ネットワークベースのインストール時の証明書の検証とシステムログに不可欠です。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-ntp-intro">
      <title>概要</title>
      <para>
      NTPサービスは、ネットワークインフラストラクチャ全体の正確な時刻同期を保証します。PXEブート環境では、HTTPS接続時の証明書の検証、適切なログのタイムスタンプ、および調整されたシステム操作のために、時刻の同期は極めて重要です。このセクションでは、<systemitem>chrony</systemitem>を使用した基本的なNTPサーバの設定について説明します。
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>chrony</package>パッケージ
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install chrony</command>
          </screen>
        </listitem>
        <listitem>
          <para>
          アップストリームNTPサーバへのネットワーク接続
        </para>
        </listitem>
        <listitem>
          <para>
          NTPサービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-setup">
      <title><systemitem>chrony</systemitem> NTPサービスの設定</title>
      <para>
      <systemitem>chrony</systemitem>サービスは、アップストリームサーバへの自動時刻同期と、ネットワーククライアントへのローカル時刻提供機能を備えたNTP機能を提供します。
    </para>
      <procedure xml:id="proc-configure-chrony">
        <title><systemitem>chrony</systemitem> NTPサーバの設定</title>
        <step>
          <para>
          <systemitem>chrony</systemitem>サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now chronyd.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-verify">
      <title>NTP設定の検証</title>
      <para>
      NTPサービスの機能をテストし、時刻同期が正しく機能することを確認します。
    </para>
      <procedure xml:id="proc-verify-ntp">
        <title>NTPサーバ機能のテスト</title>
        <step>
          <para>
          <systemitem>chrony</systemitem>サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd.service</command>
          </screen>
        </step>
        <step>
          <para>
          現在の時刻同期ステータスを表示します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc tracking</command>
          </screen>
        </step>
        <step>
          <para>
          設定されたNTPソースを一覧表示します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sources</command>
          </screen>
        </step>
        <step>
          <para>
          NTPサーバ統計情報を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sourcestats</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-troubleshooting">
      <title>NTP設定のトラブルシューティング</title>
      <para>
      PXE環境でNTPサービス用に<systemitem>chrony</systemitem>を設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-service">
        <title>サービスの起動の問題</title>
        <para><systemitem>chrony</systemitem>サービスが設定エラーやネットワーク接続の問題により起動できないことがあります。
      </para>
        <procedure xml:id="proc-debug-ntp-service">
          <title>NTPサービスの問題の解決</title>
          <step>
            <para>
            <systemitem>chrony</systemitem>サービスの状態とログを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status chronyd.service</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なサービスログを表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u chronyd.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            <systemitem>chrony</systemitem>設定をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyd -Q</command>
            </screen>
          </step>
          <step>
            <para>
            必要に応じてサービスを再起動します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart chronyd.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-sync">
        <title>時刻同期の失敗</title>
        <para>
        ネットワークの問題やサーバの設定が正しくないために、時刻同期に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-ntp-sync">
          <title>時刻同期の問題の診断</title>
          <step>
            <para>
            現在の時刻同期ステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc tracking</command>
            </screen>
          </step>
          <step>
            <para>
            NTPソースの接続性を表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc sources -v</command>
            </screen>
          </step>
          <step>
            <para>
            即時同期を強制実行します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyc makestep</command>
            </screen>
          </step>
          <step>
            <para>
            システムの時刻をハードウェアクロックと照合します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>timedatectl status</command>
            </screen>
          </step>
          <step>
            <para>
            NTPサーバへのネットワーク接続を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc activity</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-firewall">
        <title>ファイアウォールとネットワークの問題</title>
        <para>
        NTPトラフィックがファイアウォールルールによってブロックされ、時刻同期が妨げられることがあります。
      </para>
        <procedure xml:id="proc-debug-ntp-firewall">
          <title>NTPネットワーク接続の解決</title>
          <step>
            <para>
            ファイアウォールでNTPポートが開いているか確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-services | grep ntp</command>
            </screen>
          </step>
          <step>
            <para>
            必要に応じてNTPサービスをファイアウォールに追加します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --permanent --add-service=ntp</command>
            </screen>
          </step>
          <step>
            <para>
            ファイアウォール設定を再ロードします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --reload</command>
            </screen>
          </step>
          <step>
            <para>
            NTP接続を手動でテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ntpdate -q pool.ntp.org</command>
            </screen>
          </step>
          <step>
            <para>
            <systemitem>chrony</systemitem>ポートの使用状況を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :123</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-next-steps">
      <title>次のステップ</title>
      <para>
      NTPサービスが設定されたら、PXEサーバとクライアントは正確な時刻同期を維持します。これにより、ネットワークベースのインストール時に、適切な証明書の検証および調整されたシステム運用が確保されます。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-ipv6-router">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">IPv6ルータ広告の設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、PXEクライアントに適切なルータ広告を提供するために、IPv6ルータ広告機能を設定する方法について説明します。IPv6 RAは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールにおいて、IPv6ルーティング設定とステートフルDHCPv6アドレスの自動設定を可能にします。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-ipv6-router-intro">
      <title>概要</title>
      <para>
      IPv6ルータ広告(RA)は、IPv6ルーティングやDHCPv6アドレス自動設定など、PXEクライアントに不可欠なネットワーク設定情報を提供します。このセクションでは、IPv6ルータが、ネットワークとデフォルトルートへのIPv6ルーティングを設定するための適切なルータ広告を提供し、<literal>AdvManagedFlag on</literal>を使用してステートフルDHCPv6アドレス自動設定を有効にするように設定されていることを前提としています。
    </para>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>radvd</package>パッケージ
        </para>
        </listitem>
        <listitem>
          <para>
          サーバインタフェースのIPv6ネットワーク設定
        </para>
        </listitem>
        <listitem>
          <para>
          ルータ広告サービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-setup">
      <title>IPv6ルータ広告のための<systemitem>radvd</systemitem>の設定</title>
      <para>
      <systemitem>radvd</systemitem>サービスは、<filename>/etc/radvd.conf</filename>で定義された設定を使用してIPv6ルータ広告機能を提供します。
    </para>
      <procedure xml:id="proc-configure-radvd">
        <title><systemitem>radvd</systemitem> IPv6ルータ広告の設定</title>
        <step>
          <para>
          <systemitem>radvd</systemitem>サービスを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/radvd.conf &lt;&lt; 'EOF'</command>
interface eno1
{
    # radvd options
    IgnoreIfMissing on;                 # Do not fail and exit when interface is missed
    AdvSendAdvert on;                   # Sending RAs on the interface is not disabled

    # Configuration settings

    AdvManagedFlag on;                  # Request IPv6 address and dns options via DHCPv6
    AdvOtherConfigFlag off;             # Request only dns info via DHCPv6, IP via SLAAC

    AdvDefaultLifetime 1800;            # Add default route via this router for 1800sec

    prefix 2001:db8:0:1::/64            # Add direct route for this local network/prefix
    {
        AdvAutonomous           off;    # Assign IPv6 address via SLAAC
        AdvValidLifetime        7200;
        AdvPreferredLifetime    3600;
    };
};
EOF
</screen>
        </step>
        <step>
          <para>
          <systemitem>radvd</systemitem>サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now radvd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-verify">
      <title>IPv6ルータ広告の確認</title>
      <para>
      IPv6 RAの機能をテストし、適切な設定と動作を確認します。
    </para>
      <procedure xml:id="proc-verify-radvd">
        <title>IPv6ルータ広告のテスト</title>
        <step>
          <para>
          <systemitem>radvd</systemitem>サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
        </step>
        <step>
          <para>
          <command>ravdump</command>を使用してIPv6 RA設定を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>radvdump</command>
          </screen>
          <para>
          <command>radvdump</command>ユーティリティは、数分ごとにIPv6ルータから送信されるIPv6 RA設定を表示します。
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-forwarding">
      <title>ルータ機能のためのIP転送の設定</title>
      <para>
      PXEサーバがルータとしても機能する場合は、システムがルータの役割で機能できるように、IP転送を有効にする必要があります。
    </para>
      <procedure xml:id="proc-enable-ip-forwarding">
        <title>PXEサーバでIP転送を有効にする</title>
        <step>
          <para>
          ネットワーク設定ファイルを作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/sysctl.d/90-network.conf &lt;&lt; 'EOF'</command>
# This machine is a router
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Accept host autoconf on router uplink
net.ipv6.conf.uplink.accept_ra = 2
EOF
</screen>
        </step>
        <step>
          <para>
          ネットワーク設定を適用します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>ルータ設定に関する考慮事項</title>
        <para>
        ルータはデフォルトで、ホスト自動設定のためのIPv6 RAを処理しません。ルータのアップリンクインタフェースでIPv6 RAを受け入れるには、<literal>accept_ra = 2</literal> sysctl設定が必要です。ファイアウォールの調整やその他の必要な手順など、ルータ設定の詳細については、『管理ガイド』の「ネットワーク設定」セクションを参照してください。
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-troubleshooting">
      <title>IPv6ルータ広告のトラブルシューティング</title>
      <para>
      PXE環境でIPv6ルータ広告を設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-service">
        <title><systemitem>radvd</systemitem>サービスの問題</title>
        <para>
        設定エラーやインタフェースの問題により、<systemitem>radvd</systemitem>サービスが開始できないことがあります。
      </para>
        <procedure xml:id="proc-debug-radvd-service">
          <title><systemitem>radvd</systemitem>サービスの問題の解決</title>
          <step>
            <para>
            <systemitem>radvd</systemitem>サービスの状態とログを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なサービスログを表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u radvd -f</command>
            </screen>
          </step>
          <step>
            <para>
            <systemitem>radvd</systemitem>設定の構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>radvd -C /etc/radvd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            指定されたインタフェースが存在するかどうかを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            設定を修正した後、サービスを再起動します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart radvd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-forwarding">
        <title>IP転送設定の問題</title>
        <para>
        IP転送設定が正しくないと、ルータが正しく機能しなくなることがあります。
      </para>
        <procedure xml:id="proc-debug-ip-forwarding">
          <title>IP転送の問題の診断</title>
          <step>
            <para>
            現在のIP転送ステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv4.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6の転送ステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            sysctl設定ファイルを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            値が正しくない場合は設定を適用します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            アップリンクインタフェースのaccept_ra設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.uplink.accept_ra</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-ra">
        <title>ルータ広告の受信に関する問題</title>
        <para>
        クライアントがIPv6ルータ広告を正しく受信または処理できない場合があります。
      </para>
        <procedure xml:id="proc-debug-ra-reception">
          <title>RA受信に関する問題のトラブルシューティング</title>
          <step>
            <para>
            <command>ravdump</command>を使用してルータ広告を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>radvdump -d</command>
            </screen>
          </step>
          <step>
            <para>
            クライアントのIPv6インタフェースの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 addr show</command>
            </screen>
          </step>
          <step>
            <para>
            クライアントのIPv6ルーティングテーブルを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 route show</command>
            </screen>
          </step>
          <step>
            <para>
            ルータへのIPv6接続をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::1</command>
            </screen>
          </step>
          <step>
            <para>
            ICMPv6のファイアウォールルールを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-protocols | grep ipv6-icmp</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-next-steps">
      <title>次のステップ</title>
      <para>
      IPv6ルータ広告が設定されると、PXEクライアントは適切なIPv6ネットワーク設定を受け取ることができます。これにより、ネットワークベースのインストールでDHCPv6機能とIPv6接続が有効になります。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-dhcp-dnsmasq">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">dnsmasqを使用したDHCPサーバの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールにネットワーク設定とPXEブート情報を提供するために、dnsmasqを使用してDHCPサービスを設定する方法を説明します。dnsmasq DHCPサーバは、タグベースの設定を使用して、UEFIとBIOSブート機能を持つIPv4とIPv6の両方のPXEクライアントをサポートします。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-intro">
      <title>概要</title>
      <para>
      dnsmasq DHCPサーバは、タグベースのシステムを使用してPXEクライアントにネットワーク設定とブートファイル情報を提供し、クライアントのタイプを照合し、適切なブートローダを提供します。この設定は、DHCPv4とDHCPv6で動作するPXEClientとHTTPClientの両方の一致をサポートし、複数のアーキテクチャにわたるUEFIとBIOSシステム経由でのブートを可能にします。
    </para>
      <important>
        <title>dnsmasqにおけるHTTPClientの制限事項</title>
        <para>
        dnsmasqバージョン2.90以前では、HTTPClient設定のDHCPv6クライアントへのvendor-class option6:16の返送をサポートしていません。HTTPClientを完全にサポートするには、KeaまたはISC DHCPサーバの使用を検討してください。
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストール済みの<package>dnsmasq</package>パッケージ
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot</filename>下に適切に整理されたPXEブートファイル
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービス用に設定されたネットワークインタフェース
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-setup">
      <title>dnsmasq DHCPサービスの設定</title>
      <para>
      dnsmasq DHCP設定には、IPv4とIPv6の両方のネットワークに対するクライアントタイプの一致、ネットワーク範囲、ブートファイルの割り当てが含まれます。
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dhcp">
        <title>dnsmasq DHCPサーバの設定</title>
        <step>
          <para>
          dnsmasq用のDHCP設定ファイルを作成します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>
# DHCP configuration file for dnsmasq

# Log DHCP processing
log-dhcp

# This is the only DHCP server, don't ignore unknown clients/send NAK
dhcp-authoritative

# Disable re-use of the DHCPv4 servername and filename fields as extra
# option space, which may confuse old or broken clients
dhcp-no-override

# IPv4 PXE/HTTP boot client matches (no enterprise number)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,HTTPClient:Arch:00019

# IPv6 PXE/HTTP boot client matches (enterprise:343 intel)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,enterprise:343,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,enterprise:343,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,enterprise:343,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,enterprise:343,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,enterprise:343,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,enterprise:343,HTTPClient:Arch:00019
EOF
</screen>
        </step>
        <step>
          <para>
          IPv4 DHCPの範囲とオプションを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 range and options
dhcp-range=set:net0v4,192.168.1.100,192.168.1.199,255.255.255.0,1h
dhcp-option=tag:net0v4,option:domain-search,example.net
dhcp-option=tag:net0v4,option:dns-server,192.168.1.200
dhcp-option=tag:net0v4,option:ntp-server,192.168.1.1
dhcp-option=tag:net0v4,option:router,192.168.1.1
EOF
</screen>
        </step>
        <step>
          <para>
          IPv4 PXEブートオプションを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 PXEClient boot
dhcp-boot=tag:net0v4,tag:tftp_bios_x86_pc,/boot/grub2/i386-pc/core.0,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_x86_64,/boot/grub2/x86_64-efi/bootx64.efi,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_ieee_ppc_64,/boot/grub2/powerpc-ieee1275/core.elf,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_arm_64,/boot/grub2/arm64-efi/bootaa64.efi,192.168.1.200

# IPv4 HTTPClient boot
dhcp-option-force=tag:net0v4,tag:http_uefi_x86_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_x86_64,http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option-force=tag:net0v4,tag:http_uefi_arm_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_arm_64,http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi
EOF
</screen>
        </step>
        <step>
          <para>
          IPv6 DHCPの範囲とオプションを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 range and options
dhcp-range=set:net0v6,2001:db8:0:1:d::,2001:db8:0:1:d::ffff,64,1h
dhcp-option=tag:net0v6,option6:domain-search,example.net
dhcp-option=tag:net0v6,option6:dns-server,[2001:db8:0:1::200]
dhcp-option=tag:net0v6,option6:sntp-server,[2001:db8:0:1::1]
EOF
</screen>
        </step>
        <step>
          <para>
          IPv6 PXEブートオプションを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 PXEClient boot
dhcp-option=tag:net0v6,tag:tftp_bios_x86_pc,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0
dhcp-option=tag:net0v6,tag:tftp_uefi_x86_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option=tag:net0v6,tag:tftp_ieee_ppc_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf
dhcp-option=tag:net0v6,tag:tftp_uefi_arm_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi

# IPv6 HTTPClient boot
# Note: dnsmasq &lt;= 2.90 does not support sending vendor-class option6:16 back to client
EOF
</screen>
        </step>
        <step>
          <para>
          dnsmasqの設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          dnsmasqサービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-verify">
      <title>DHCP設定の検証</title>
      <para>
      DHCPサーバの機能をテストし、適切なネットワーク設定とPXEクライアントへのブートファイル配信を確認します。
    </para>
      <procedure xml:id="proc-verify-dhcp-dnsmasq">
        <title>dnsmasq DHCPサーバのテスト</title>
        <step>
          <para>
          dnsmasqサービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPポートバインディングを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep :67</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPリースの割り当てを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
        </step>
        <step>
          <para>
          アクティブなDHCPリースを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshooting">
      <title>dnsmasq DHCP設定のトラブルシューティング</title>
      <para>
      PXE環境でDHCPサービス用にdnsmasqを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-service">
        <title>サービスの起動と設定に関する問題</title>
        <para>
        dnsmasqは、設定エラーや他のDHCPサービスとのポートの競合が原因で起動に失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-dnsmasq-dhcp-service">
          <title>dnsmasq DHCPサービスの問題の解決</title>
          <step>
            <para>
            dnsmasq設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPポートの競合を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            競合するDHCPサービスを停止します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なサービスログを表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            競合の解決後にdnsmasqを再起動します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-leases">
        <title>DHCPリース割り当ての問題</title>
        <para>
        クライアントは、範囲設定やネットワーク接続の問題により、IPアドレスを受信できないことがあります。
      </para>
        <procedure xml:id="proc-debug-dhcp-leases">
          <title>DHCPリースの問題の診断</title>
          <step>
            <para>
            DHCP範囲設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-range /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            DHCP要求をリアルタイムで監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f | grep DHCP</command>
            </screen>
          </step>
          <step>
            <para>
            ネットワークインタフェースのステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
          <step>
            <para>
            DHCP権限設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-authoritative /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            dhcpingでDHCP応答をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-pxe">
        <title>PXEブートファイルの配信に関する問題</title>
        <para>
        PXEクライアントは、ブートファイルの設定が正しくないか、クライアントタイプの一致に問題があるため、IPアドレスを受信できてもブートに失敗することがあります。
      </para>
        <procedure xml:id="proc-debug-pxe-boot">
          <title>PXEブート設定のトラブルシューティング</title>
          <step>
            <para>
            クライアントのベンダクラスの一致を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-vendorclass /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ブートファイルのパスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-boot /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ブートファイルへのTFTPアクセスをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            PXE固有のDHCPログを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep -E "PXE|HTTP"</command>
            </screen>
          </step>
          <step>
            <para>
            ログでタグの割り当てを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "tags:"</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-ipv6">
        <title>IPv6 DHCP設定の問題</title>
        <para>
        IPv6 DHCPクライアントは適切なルータ広告設定を必要とし、IPv4とは異なるアドレス指定要件がある場合があります。
      </para>
        <procedure xml:id="proc-debug-ipv6-dhcp">
          <title>IPv6 DHCPの問題の解決</title>
          <step>
            <para>
            IPv6 DHCP範囲設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "2001:db8" /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6ルータ広告ステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPv6要求を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "DHCPv6"</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6接続をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6オプションの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep option6 /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-next-steps">
      <title>次のステップ</title>
      <para>
      dnsmasq DHCPサービスを設定すると、PXEクライアントはIPv4とIPv6の両方の環境のネットワーク設定とブートファイル情報を受信できます。タグベースのシステムは、クライアントのアーキテクチャとブート方法の要件に基づき、柔軟なブートファイル割り当てを提供します。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-dhcp-kea">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Keaを使用したDHCPサーバの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>インストールにネットワーク設定とPXEブート情報を提供するために、Keaを使用してDHCPサービスを設定する方法を説明します。Keaは、PXEおよびHTTPブートシナリオにおいて、クライアントクラス一致機能を備え、IPv4とIPv6の両方をサポートする最新のDHCPサーバです。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-kea-intro">
      <title>概要</title>
      <para>
      Keaは、レガシISC DHCPサーバの後継としてISCが開発した最新のDHCPサーバです。クライアントのアーキテクチャとブート方法に基づいて適切なブートファイルの配信を可能にするクライアント分類機能を備え、DHCPv4とDHCPv6の両方を堅牢にサポートします。KeaはJSONベースの設定ファイルを使用し、HTTPブートのベンダクラス識別のような高度な機能をサポートしています。
    </para>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストールされたKea DHCPパッケージ(<package>kea-dhcp4</package>と <package>kea-dhcp6</package>)
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot</filename>下に適切に整理されたPXEブートファイル
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービス用に設定されたネットワークインタフェース
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv4">
      <title>Kea DHCPv4サーバの設定</title>
      <para>
      Kea DHCPv4設定は、クライアントクラスを使用してPXEとHTTPクライアントのタイプを照合し、さまざまなアーキテクチャに適したブートファイルを提供します。
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv4">
        <title>Kea DHCPv4サーバの設定</title>
        <step>
          <para>
          Kea DHCPv4サーバを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp4.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea4-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp4.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 3150,
    "valid-lifetime": 3600,
    "option-data": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00000'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/i386-pc/core.0"
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00007'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/x86_64-efi/bootx64.efi"
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:0000e'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/powerpc-ieee1275/core.elf"
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00011'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/arm64-efi/bootaa64.efi"
      },
      {
        "name": "httpclients#00016",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00016'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      },
      {
        "name": "httpclients#00019",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00019'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      }
    ],
    "subnet4": [
      {
        "id": 1,
        "subnet": "192.168.1.0/24",
        "pools": [
          {
            "pool": "192.168.1.100 - 192.168.1.199"
          }
        ],
        "option-data": [
          {
            "name": "routers",
            "data": "192.168.1.1"
          },
          {
            "name": "ntp-servers",
            "data": "192.168.1.1"
          },
          {
            "name": "domain-name-servers",
            "data": "192.168.1.200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp4",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp4.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Keaログディレクトリを作成します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /var/log/kea</command>
          </screen>
        </step>
        <step>
          <para>
          Kea DHCPv4設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Kea DHCPv4サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp4</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv6">
      <title>Kea DHCPv6サーバの設定</title>
      <para>
      Kea DHCPv6設定は、異なるクライアントアーキテクチャのベンダクラスの一致を使用して、IPv6アドレス割り当てと、ブートファイル情報を提供します。
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv6">
        <title>Kea DHCPv6サーバの設定</title>
        <step>
          <para>
          Kea DHCPv6サーバを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp6.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp6": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea6-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp6.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 2880,
    "preferred-lifetime": 3600,
    "valid-lifetime": 7200,
    "option-data": [],
    "option-def": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00000'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0"
          }
        ]
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00007'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi"
          }
        ]
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:0000e'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf"
          }
        ]
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00011'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi"
          }
        ]
      }
    ],
    "subnet6": [
      {
        "id": 1,
        "subnet": "2001:db8:0:1::/64",
        "interface": "eno1",
        "pools": [
          {
            "pool": "2001:db8:0:1:d::/112"
          }
        ],
        "option-data": [
          {
            "name": "sntp-servers",
            "data": "2001:db8:0:1::1"
          },
          {
            "name": "dns-servers",
            "data": "2001:db8:0:1::200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp6.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Kea DHCPv6設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Kea DHCPv6サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-verify">
      <title>Kea DHCP設定の検証</title>
      <para>
      Kea DHCPサーバの機能をテストし、適切なネットワーク設定とPXEクライアントへのブートファイル配信を確認します。
    </para>
      <procedure xml:id="proc-verify-dhcp-kea">
        <title>Kea DHCPサーバのテスト</title>
        <step>
          <para>
          Kea DHCPv4サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4</command>
          </screen>
        </step>
        <step>
          <para>
          Kea DHCPv6サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp6</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPポートバインディングを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPv4のログを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp4.log</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPv6のログを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp6.log</command>
          </screen>
        </step>
        <step>
          <para>
          アクティブなDHCPリースを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-troubleshooting">
      <title>Kea DHCP設定のトラブルシューティング</title>
      <para>
      PXEブート環境でKea DHCPサーバを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-config">
        <title>設定とサービスの問題</title>
        <para>
        JSON設定エラーやネットワークインタフェースの問題により、Keaサービスが開始できないことがあります。
      </para>
        <procedure xml:id="proc-debug-kea-config">
          <title>Kea設定問題の解決</title>
          <step>
            <para>
            DHCPv4設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPv6設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            JSONの構文エラーを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>python3 -m json.tool /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ネットワークインタフェースの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Keaサービスログを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u kea-dhcp4 -f</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-leases">
        <title>DHCPリース割り当ての問題</title>
        <para>
        クライアントは、サブネット設定やプール枯渇の問題により、IPアドレスを受信できないことがあります。
      </para>
        <procedure xml:id="proc-debug-kea-leases">
          <title>Keaリースの問題の診断</title>
          <step>
            <para>
            サブネットとプールの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet4\|pools" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            リースの割り当てをリアルタイムで監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -E "ALLOC|DISCOVER"</command>
            </screen>
          </step>
          <step>
            <para>
            リースデータベースの競合を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /var/lib/kea/dhcp4.leases | tail -20</command>
            </screen>
          </step>
          <step>
            <para>
            インタフェースバインディングを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep interfaces /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            必要に応じてリースデータベースをクリアします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop kea-dhcp4</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mv /var/lib/kea/dhcp4.leases /var/lib/kea/dhcp4.leases.backup</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-pxe">
        <title>PXEクライアントクラスの一致の問題</title>
        <para>
        PXEクライアントは、クライアントクラスの設定の問題により、IPアドレスを受信できても正しいブートファイルを取得できないことがあります。
      </para>
        <procedure xml:id="proc-debug-kea-pxe">
          <title>Keaクライアント分類のトラブルシューティング</title>
          <step>
            <para>
            クライアントクラスの定義を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "client-classes" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            クライアントクラスの一致をログで監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -i class</command>
            </screen>
          </step>
          <step>
            <para>
            ベンダクラス識別子のパターンを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "PXEClient\|HTTPClient" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ブートファイルのアクセシビリティをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なクライアント分析のためにデバッグログを有効にします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/"debuglevel": 0/"debuglevel": 99/' /etc/kea/kea-dhcp4.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-ipv6">
        <title>DHCPv6固有の問題</title>
        <para>
        IPv6 DHCPクライアントは適切なルータ広告設定を必要とし、IPv4とは異なるベンダクラスオプション処理を行います。
      </para>
        <procedure xml:id="proc-debug-kea-ipv6">
          <title>Kea DHCPv6の問題の解決</title>
          <step>
            <para>
            DHCPv6サブネット設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet6" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6ルータ広告ステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPv6ベンダクラスの一致を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp6.log | grep "option\[16\]"</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6 bootfile-urlオプションの形式を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ブートサーバへのIPv6接続をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-next-steps">
      <title>次のステップ</title>
      <para>
      Kea DHCPサービスを設定すると、PXEクライアントはIPv4とIPv6の両方の環境の包括的なネットワーク設定とブートファイル情報を受信できます。クライアント分類システムは、クライアントアーキテクチャに基づいた正確なブートファイル割り当てを提供し、従来のPXEブート方法と最新のHTTPブート方法の両方をサポートします。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-dhcp-isc">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">ISC DHCPを使用したDHCPサーバの設定</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> 15インストールにネットワーク設定とPXEブート情報を提供するために、ISC DHCPサーバを設定する方法を説明します。ISC dhcp-serverパッケージは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase><phrase><phrase os="sles4sap"> 16.0</phrase></phrase>では利用できなくなりました。ISC DHCPはクラスとサブクラスの一致を使用して、異なるクライアントアーキテクチャのPXEとHTTPブートシナリオをサポートします。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-isc-intro">
      <title>概要</title>
      <para>
      ISC DHCPは、従来のDHCPサーバで、クラスとサブクラスのシステムを使用して、PXEクライアントにネットワーク設定とブートファイル情報を提供します。ISCは2022年時点でこのサーバのサービス終了を宣言していますが、既存の展開では依然として広く使用されており、ベンダクラス識別によるPXEおよびHTTPブートシナリオに対する堅牢なサポートを提供しています。
    </para>
      <important>
        <title>ISC DHCPサービス終了ステータス</title>
        <para>
        ISC DHCPは、ISCによって2022年にサービス終了が宣言されています。新規展開の場合は、代わりにKeaまたはdnsmasqの使用を検討してください。この設定は、既存のISC DHCPインストール環境との互換性のために提供されています。
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          インストールされたISC DHCPパッケージ(<package>dhcp-server</package>)
        </para>
        </listitem>
        <listitem>
          <para>
          <filename>/srv/tftpboot</filename>下に適切に整理されたPXEブートファイル
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービス用に設定されたネットワークインタフェース
        </para>
        </listitem>
        <listitem>
          <para>
          DHCPサービスを設定するための管理者特権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv4">
      <title>ISC DHCPv4サーバの設定</title>
      <para>
      ISC DHCPv4設定は、クラスとサブクラス宣言を使用してPXEとHTTPクライアントのタイプを照合し、さまざまなアーキテクチャに適したブートファイルを提供します。
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv4">
        <title>ISC DHCPv4サーバの設定</title>
        <step>
          <para>
          ISC DHCPv4サーバを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first read
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
#
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# default lease time
default-lease-time              3600;
max-lease-time                  7200;

##
## PXE / HTTP boot option declarations
##
class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        match substring (option vendor-class-identifier, 0, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        match substring (option vendor-class-identifier, 0, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet 192.168.1.0 netmask 255.255.255.0 {
        authoritative;

        range  dynamic-bootp            192.168.1.100 192.168.1.199;

        option subnet-mask              255.255.255.0;

        option routers                  192.168.1.1;
        option ntp-servers              192.168.1.1;
        option domain-name-servers      192.168.1.200;
        option domain-name              "example.net";
        option domain-search            "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          sysconfigでDHCPインタフェースを設定します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD_INTERFACE="eno1"' &gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPv4設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -t -cf /etc/dhcpd.conf</command>
          </screen>
        </step>
        <step>
          <para>
          ISC DHCPv4サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv6">
      <title>ISC DHCPv6サーバの設定</title>
      <para>
      ISC DHCPv6設定は、ベンダクラスの一致と適切なDHCPv6オプション処理を使用して、IPv6アドレス割り当てと、ブートファイル情報を提供します。
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv6">
        <title>ISC DHCPv6サーバの設定</title>
        <step>
          <para>
          ISC DHCPv6サーバを設定します。
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd6.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd6.conf
#
# Sample DHCPv6 configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD6_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# IPv6 address valid lifetime
#  (at the end the address is no longer usable by the client)
#  (set to 30 days, the usual IPv6 default)
default-lease-time 7200;

# IPv6 address preferred lifetime
#  (at the end the address is deprecated, i.e., the client should use
#   other addresses for new connections)
#  (set to 7 days, the	usual IPv6 default)
preferred-lifetime 3600;

##
## PXE / HTTP boot option declarations
##

# The dhcp6 option 16 is in fact an:
#   { uint32 enterprise-number, array of { uint16 len, string tag} vendor-class-data }
# this declaration is using the whole option data as string for substring match:
option dhcp6.vendor-class-as-string code 16 = string;

# this declaration is using the enterprise-number with 1st tag length and string:
option dhcp6.vendor-class-en-len-tag code 16 = {integer 32, integer 16, string};

class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        # note: +6 to skip the enterprise-number+len until the PXEClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        # note: +6 to skip the enterprise-number+len until the HTTPClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet6 2001:db8:0:1::/64 {
       authoritative;

       range6  2001:db8:0:1:d:: 2001:db8:0:1:d::ffff;

       option dhcp6.sntp-servers       2001:db8:0:1::1;
       option dhcp6.name-servers       2001:db8:0:1::200;
       option dhcp6.domain-search      "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          sysconfigでDHCPv6インタフェースを設定します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD6_INTERFACE="eno1"' &gt;&gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPv6設定をテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          ISC DHCPv6サービスを有効にして開始します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-verify">
      <title>ISC DHCP設定の検証</title>
      <para>
      ISC DHCPサーバの機能をテストし、適切なネットワーク設定とPXEクライアントへのブートファイル配信を確認します。
    </para>
      <procedure xml:id="proc-verify-dhcp-isc">
        <title>ISC DHCPサーバのテスト</title>
        <step>
          <para>
          ISC DHCPv4サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          ISC DHCPv6サービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd6</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPポートバインディングを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPログを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
        </step>
        <step>
          <para>
          アクティブなDHCPリースを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
        <step>
          <para>
          DHCPv6アクティビティを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd6 -f</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-troubleshooting">
      <title>ISC DHCP設定のトラブルシューティング</title>
      <para>
      PXEブート環境でISC DHCPサーバを設定する際によくある問題。
    </para>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-config">
        <title>設定とサービスの問題</title>
        <para>
        設定構文エラーやインタフェースバインディングの問題により、ISC DHCPサービスが開始できないことがあります。
      </para>
        <procedure xml:id="proc-debug-isc-config">
          <title>ISC DHCP設定問題の解決</title>
          <step>
            <para>
            DHCPv4設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -t -cf /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPv6設定構文をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            インタフェースの設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysconfig/dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            ネットワークインタフェースのステータスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            ポートの競合を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            詳細なサービスログを表示します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd -xe</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-leases">
        <title>DHCPリース割り当ての問題</title>
        <para>
        クライアントは、サブネット設定や認証の問題により、IPアドレスを受信できないことがあります。
      </para>
        <procedure xml:id="proc-debug-isc-leases">
          <title>ISC DHCPリースの問題の診断</title>
          <step>
            <para>
            サブネットと範囲の設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet\|range" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            権限設定を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep authoritative /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            リースの割り当てをリアルタイムで監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            リースデータベースにエラーがないか確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -20 /var/lib/dhcp/dhcpd.leases</command>
            </screen>
          </step>
          <step>
            <para>
            DHCP応答を手動でテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200 -h aa:bb:cc:dd:ee:ff</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-classes">
        <title>クラスとサブクラスの一致に関する問題</title>
        <para>
        PXEクライアントは、クラス一致設定の問題により、IPアドレスを受信できても正しいブートファイルを取得できないことがあります。
      </para>
        <procedure xml:id="proc-debug-isc-classes">
          <title>ISC DHCPクラスの一致に関するトラブルシューティング</title>
          <step>
            <para>
            クラス定義を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "class.*clients" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            サブクラスのエントリを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "subclass" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ベンダのクラス識別を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep -E "PXEClient|HTTPClient"</command>
            </screen>
          </step>
          <step>
            <para>
            ブートファイルのアクセシビリティをテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            詳細ログを有効にします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\log-facility local7;' /etc/dhcpd.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dhcpd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-ipv6">
        <title>DHCPv6ベンダクラスオプションの問題</title>
        <para>
        IPv6 DHCPクライアントには複雑なベンダクラスオプションの処理があり、適切なPXEブートサポートのために特別な設定が必要になる場合があります。
      </para>
        <procedure xml:id="proc-debug-isc-ipv6">
          <title>ISC DHCPv6の問題の解決</title>
          <step>
            <para>
            DHCPv6オプション定義を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "option dhcp6" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ベンダクラスの文字列解析を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "substring.*6.*20\|21" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPv6ベンダクラスの一致を監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd6 | grep -i vendor</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6 bootfile-url形式を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            ルータ広告の依存関係を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            IPv6接続をテストします。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-next-steps">
      <title>次のステップ</title>
      <para>
      ISC DHCPサービスを設定すると、PXEクライアントは、従来のクラスとサブクラスシステムを使用して、ネットワーク設定とブートファイル情報を受信できます。ISC DHCPはサポート終了となりましたが、この設定は、複数のクライアントアーキテクチャにわたってPXEおよびHTTPブート機能を必要とする既存の展開環境との互換性を提供します。
    </para>
    </section>
  </section>
  <section role="task" xml:lang="ja" version="5.2" xml:id="sles-pxe-server-validate">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">PXEサーバのセットアップの検証</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        このセクションでは、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>ネットワークインストールで、すべてのコンポーネントが正しく動作していることを確認するために、PXEサーバセットアップ全体を検証し、テストする方法を説明します。サービス検証、ネットワーク接続性テスト、エンドツーエンドのPXEブート検証をカバーしています。
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-validate-intro">
      <title>概要</title>
      <para>
      TFTP、HTTP、DNS、DHCP、GRUB 2ブートローダサービスなど、すべてのPXEサーバコンポーネントを設定した後、システム全体が正しく機能することを検証することが重要です。この検証により、PXEクライアントがAgamaインストーラで正常に起動し、<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase><phrase><phrase os="sles4sap"> 16.0</phrase></phrase>のネットワークベースのインストールを実行できることが保証されます。
    </para>
    </section>
    <section xml:id="sles-pxe-server-validate-reqs">
      <title>要件</title>
      <itemizedlist>
        <listitem>
          <para>
          すべてのPXEサーバコンポーネントが設定され、実行されていること
        </para>
        </listitem>
        <listitem>
          <para>
          PXEブート可能なテストクライアントシステム
        </para>
        </listitem>
        <listitem>
          <para>
          PXEサーバとクライアント間のネットワーク接続
        </para>
        </listitem>
        <listitem>
          <para>
          サーバサービスを監視するための管理アクセス権
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-validate-services">
      <title>PXEサーバサービスの検証</title>
      <para>
      PXEクライアントでテストする前に、すべての必須PXEサーバサービスが実行され、適切に設定されていることを確認します。
    </para>
      <procedure xml:id="proc-validate-services">
        <title>PXEサーバのサービス状態の確認</title>
        <step>
          <para>
          TFTPサービスの状態を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status tftp.socket</command>
          </screen>
          <para>
          予想される結果:サービスはアクティブで、ポート69でリスンしている必要があります。
        </para>
        </step>
        <step>
          <para>
          nginx HTTPサービスを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status nginx</command>
          </screen>
          <para>
          予想される結果:サービスはアクティブで、ポート80でリスンしている必要があります。
        </para>
        </step>
        <step>
          <para>
          DNSサービスを確認します(dnsmasqを使用している場合)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          予想される結果:サービスはアクティブで、ポート53でリスンしている必要があります。
        </para>
        </step>
        <step>
          <para>
          DHCPサービスの状態を確認します(適切なサービスを選択してください)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
          <para>
          dnsmasq DHCPの場合:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          Kea DHCPの場合:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4 kea-dhcp6</command>
          </screen>
          <para>
          予想される結果:DHCPサービスはアクティブで、適切なポートでリスンしている必要があります。
        </para>
        </step>
        <step>
          <para>
          IPv6ルータ広告を確認します(設定されている場合)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
          <para>
          予想される結果:IPv6環境でサービスがアクティブである必要があります。
        </para>
        </step>
        <step>
          <para>
          NTPサービスを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd</command>
          </screen>
          <para>
          予想される結果:サービスはアクティブで、同期されている必要があります。
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-network">
      <title>ネットワーク接続およびファイルアクセスのテスト</title>
      <para>
      PXEクライアントが、TFTPとHTTPの両方のプロトコルを使用して、ネットワーク経由でブートファイルとインストールコンテンツにアクセスできることを検証します。
    </para>
      <procedure xml:id="proc-validate-network">
        <title>ネットワークファイルアクセスのテスト</title>
        <step>
          <para>
          ブートローダファイルへのTFTPアクセスをテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          ファイルが取得されたことを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>file /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          テストファイルをクリーンアップします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>rm /tmp/test-bootx64.efi</command>
          </screen>
        </step>
        <step>
          <para>
          GRUB 2設定へのHTTPアクセスをテストします。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/grub2/grub.cfg</command>
          </screen>
          <para>
          予想される結果:HTTP 200 OK応答。
        </para>
        </step>
        <step>
          <para>
          インストーラファイルへのHTTPアクセスを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
          <para>
          予想される結果:適切なコンテンツ長を持つHTTP 200 OK応答。
        </para>
        </step>
        <step>
          <para>
          DNS解決をテストします(ローカルDNSが設定されている場合)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup pxe.example.net localhost</command>
          </screen>
          <para>
          予想される結果:適切なAレコードとAAAAレコードの解決。
        </para>
        </step>
        <step>
          <para>
          自動インデックスの場所のディレクトリ参照を確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl http://localhost/boot/</command>
          </screen>
          <para>
          予想される結果:ブートファイルを表示するディレクトリ一覧。
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-dhcp">
      <title>DHCP機能の検証</title>
      <para>
      DHCPサーバの応答をテストし、さまざまなクライアントタイプに適したブート情報が提供されていることを確認します。
    </para>
      <procedure xml:id="proc-validate-dhcp">
        <title>DHCPサーバ応答のテスト</title>
        <step>
          <para>
          DHCPポートバインディングを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
          <para>
          予想される結果:DHCPサービスがポート67 (IPv4)および547 (IPv6)でリスンしています。
        </para>
        </step>
        <step>
          <para>
          DHCP要求をリアルタイムで監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
          <para>
          またはdnsmasqの場合:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
          <para>
          テスト中にDHCPアクティビティを監視するために、このコマンドを実行したままにしておきます。
        </para>
        </step>
        <step>
          <para>
          dhcpingを使用してDHCP応答をテストします(利用可能な場合)。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>dhcping -s 192.168.1.200</command>
          </screen>
          <para>
          予想される結果:サーバからのDHCP応答に成功します。
        </para>
        </step>
        <step>
          <para>
          アクティブなDHCPリースを確認します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
          <para>
          または、Keaの場合:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
          <para>
          予想される結果:テストクライアントのリースエントリ。
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-pxe-boot">
      <title>エンドツーエンドのPXEブートテスト</title>
      <para>
      実際のクライアントシステムで完全なPXEブートテストを行い、DHCPからAgamaインストーラ起動までのブートプロセス全体を検証します。
    </para>
      <procedure xml:id="proc-validate-pxe-boot">
        <title>PXEブートプロセス全体のテスト</title>
        <step>
          <para>
          テストクライアントシステムを準備します。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              BIOS/UEFIを設定してネットワークブートを有効にする
            </para>
            </listitem>
            <listitem>
              <para>
              ネットワークブートを最初のブート優先度として設定する
            </para>
            </listitem>
            <listitem>
              <para>
              クライアントをPXEサーバと同じネットワークに接続する
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          クライアントのブート中にPXEサーバのログを監視します。
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -f | grep -E "dhcp|tftp|nginx"</command>
          </screen>
        </step>
        <step>
          <para>
          テストクライアントを起動し、以下のシーケンスを確認します。
        </para>
          <orderedlist>
            <listitem>
              <para>
              クライアントはDHCP経由でIPアドレスを受信する
            </para>
            </listitem>
            <listitem>
              <para>
              クライアントはTFTP経由でブートローダをダウンロードする
            </para>
            </listitem>
            <listitem>
              <para>
              GRUB 2のメニューが表示され、インストールオプションが表示される
            </para>
            </listitem>
            <listitem>
              <para>
              カーネルとinitrdがHTTP経由でロードされる
            </para>
            </listitem>
            <listitem>
              <para>
              Agamaインストーラが正常に起動する
            </para>
            </listitem>
          </orderedlist>
        </step>
        <step>
          <para>
          さまざまなクライアントタイプをテストして、クライアントアーキテクチャの検出を確認します。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              レガシBIOS x86_64システム(core.0を取得する必要があります)
            </para>
            </listitem>
            <listitem>
              <para>
              UEFI x86_64システム(bootx64.efiを取得する必要があります)
            </para>
            </listitem>
            <listitem>
              <para>
              UEFI aarch64システム(bootaa64.efiを取得する必要があります)
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          IPv6 PXEブートをテストします(IPv6が設定されている場合)。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              テストクライアントでIPv6のみのネットワーク設定を有効にする
            </para>
            </listitem>
            <listitem>
              <para>
              DHCPv6アドレス割り当てを確認する
            </para>
            </listitem>
            <listitem>
              <para>
              IPv6 bootfile-urlの配信を確認する
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-installation">
      <title>Agamaインストーラの機能の検証</title>
      <para>
      Agamaインストーラが正しく起動し、 <phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>のインストールを完了するためにインストールソースにアクセスできることを確認します。
    </para>
      <procedure xml:id="proc-validate-agama">
        <title>Agamaインストーラの起動テスト</title>
        <step>
          <para>
          Agama Webインタフェースのアクセシビリティを確認します。
        </para>
          <para>
          クライアントのブート中に、割り当てられたIPアドレスをメモして、アクセスします。
        </para>
          <screen>http://<replaceable>CLIENT_IP_ADDRESS</replaceable></screen>
          <para>
          予想される結果:Agama Webインタフェースが正常にロードされるはずです。
        </para>
        </step>
        <step>
          <para>
          クライアントのAgamaインストーラのログを確認します。
        </para>
          <para>
          コンソールに切り替え(Alt+F2)、次のコマンドを実行します。
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>journalctl -u agama-web-server -f</command>
          </screen>
          <para>
          予想される結果:Agamaの起動時に致命的なエラーはありません。
        </para>
        </step>
        <step>
          <para>
          インストールソースへのアクセシビリティを確認します。
        </para>
          <para>
          フルISOインストールの場合は、リポジトリへのアクセスを確認します。
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>curl -I http://192.168.1.200/install/SLES-16.0/x86_64/</command>
          </screen>
          <para>
          予想される結果:ディレクトリ一覧を含むHTTP 200 OK応答。
        </para>
        </step>
        <step>
          <para>
          パッケージインストール機能をテストします。
        </para>
          <para>
          Agamaインタフェースで次のことを確認します。
        </para>
          <itemizedlist>
            <listitem>
              <para>
              システムが利用可能なディスクを検出できること
            </para>
            </listitem>
            <listitem>
              <para>
              ネットワーク設定が保持されていること
            </para>
            </listitem>
            <listitem>
              <para>
              パッケージリポジトリにアクセスできること
            </para>
            </listitem>
            <listitem>
              <para>
              インストールを完了まで進められること
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-troubleshooting">
      <title>検証失敗のトラブルシューティング</title>
      <para>
      PXEサーバの検証中によくある問題とその解決手順。
    </para>
      <section xml:id="sles-pxe-server-validate-troubleshoot-dhcp">
        <title>DHCP割り当ての失敗</title>
        <para>
        PXEブート中にクライアントがIPアドレスを受信できません。
      </para>
        <procedure xml:id="proc-troubleshoot-dhcp-validation">
          <title>DHCP検証問題の解決</title>
          <step>
            <para>
            DHCPサービスの競合を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            ネットワークインタフェースが起動していることを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            DHCP範囲の可用性を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nmap -sn 192.168.1.100-199</command>
            </screen>
          </step>
          <step>
            <para>
            DHCPログでエラーを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd | tail -50</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-boot">
        <title>ブートファイルの配信失敗</title>
        <para>
        クライアントはIPアドレスを受信するが、ブートファイルのダウンロードに失敗します。
      </para>
        <procedure xml:id="proc-troubleshoot-boot-validation">
          <title>ブートファイルの問題の解決</title>
          <step>
            <para>
            TFTPサービスへのアクセシビリティを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            ファイルアクセス権を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
          <step>
            <para>
            TFTPアクセスログを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.socket -f</command>
            </screen>
          </step>
          <step>
            <para>
            クライアントアーキテクチャの検出を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "PXEClient|HTTPClient" /var/log/messages</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-installer">
        <title>Agamaインストーラの起動失敗</title>
        <para>
        ブートファイルは正常にロードされますが、Agamaインストーラが起動に失敗します。
      </para>
        <procedure xml:id="proc-troubleshoot-installer-validation">
          <title>Agamaの起動に関する問題の解決</title>
          <step>
            <para>
            インストーラファイルへのHTTPアクセスを確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
            </screen>
          </step>
          <step>
            <para>
            GRUB 2設定のカーネルパラメータ構文を確認します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "root=live:" /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            クライアントのブートプロセスを監視します。
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -f | grep -E "kernel|initrd|agama"</command>
            </screen>
          </step>
          <step>
            <para>
            ネットワーク設定の永続性を確認します。
          </para>
            <screen>
              <prompt role="root"># </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-validate-checklist">
      <title>PXEサーバ検証チェックリスト</title>
      <para>
      このチェックリストを使用して、PXEサーバ設定のあらゆる側面を体系的に検証してください。
    </para>
      <table xml:id="table-pxe-validation-checklist">
        <title>PXEサーバ検証チェックリスト</title>
        <tgroup cols="3">
          <colspec colnum="1" colname="col1" colwidth="30*"/>
          <colspec colnum="2" colname="col2" colwidth="50*"/>
          <colspec colnum="3" colname="col3" colwidth="20*"/>
          <thead>
            <row>
              <entry>コンポーネント</entry>
              <entry>検証手順</entry>
              <entry>Status</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>TFTP Service</entry>
              <entry>サービスがアクティブ、ポート69がリスン中、ファイルにアクセス可能</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>HTTPサービス</entry>
              <entry>nginxがアクティブ、ポート80がリスン中、インストーラファイルにアクセス可能</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>DNSサービス</entry>
              <entry>ホスト名解決が機能している、ポート53がリスン中</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>DHCPサービス</entry>
              <entry>IP割り当てが機能している、ブートオプションが配信されている</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>GRUB 2設定</entry>
              <entry>メニューがロードされている、アーキテクチャ検出が機能している</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>IPv6のサポート</entry>
              <entry>ルータ広告がアクティブ、DHCPv6が機能している</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>PXEブート</entry>
              <entry>クライアントが正常に起動し、正しいブートローダを受信</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Agamaインストーラ</entry>
              <entry>インストーラが起動、Webインタフェースにアクセスできる</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>インストールソース</entry>
              <entry>リポジトリにアクセスできる、パッケージがインストール可能</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>ネットワークの永続性</entry>
              <entry>インストール時にネットワーク設定が維持される</entry>
              <entry>☐</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section xml:id="sles-pxe-server-validate-conclusion">
      <title>検証の結論</title>
      <para>
      適切に検証されたPXEサーバは、クライアントのネットワークブートからAgamaインストーラの起動まで、エンドツーエンドで正常に機能することを実証する必要があります。すべてのサービスがエラーなく動作し、クライアントがネットワーク経由で<phrase><phrase os="sles4sap">SUSE Linux Enterprise Server for SAP applications</phrase></phrase> <phrase><phrase os="sles4sap">16.0</phrase></phrase>のインストールを完了できる必要があります。定期的な検証テストにより、自動展開用のPXEインフラストラクチャの継続的な信頼性が確保されます。
    </para>
    </section>
  </section>
  <section version="5.2" xml:id="legal-disclaimer">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">法的事項</title>
    </info>
    <para> Copyright© 2006–<?dbtimestamp format="Y"?> SUSE LLC and contributors. All rights reserved.</para>
    <para>
    この文書は、GNUフリー文書ライセンスのバージョン1.2または(オプションとして)バージョン1.3の条項に従って、複製、頒布、および/または改変が許可されています。ただし、この著作権表示およびライセンスは変更せずに記載すること。ライセンスバージョン1.2のコピーは、<quote>GNU Free Documentation License</quote>セクションに含まれています。
  </para>
    <para>
    SUSEの商標については、<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.suse.com/company/legal/"></link>を参照してください。その他の第三者のすべての商標は、各社の所有に帰属します。商標記号(®、™など)は、SUSEおよび関連会社の商標を示します。アスタリスク(*)は、第三者の商標を示します。
  </para>
    <para>
    本書のすべての情報は、細心の注意を払って編集されています。しかし、このことは正確性を完全に保証するものではありません。SUSE LLC、その関係者、著者、翻訳者のいずれも誤りまたはその結果に対して一切責任を負いかねます。
  </para>
  </section>
  <appendix xmlns:its="http://www.w3.org/2005/11/its" version="5.2" role="legal" its:translate="no" xml:id="doc-gfdl-license">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">GNU Free Documentation License</title>
    </info>
    <para>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </para>
    <bridgehead renderas="sect4">
    0. PREAMBLE
  </bridgehead>
    <para>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </para>
    <para>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </para>
    <para>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </para>
    <bridgehead renderas="sect4">
    1. APPLICABILITY AND DEFINITIONS
  </bridgehead>
    <para>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </para>
    <para>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </para>
    <para>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </para>
    <para>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </para>
    <para>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </para>
    <para>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </para>
    <para>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </para>
    <para>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </para>
    <para>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </para>
    <para>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </para>
    <bridgehead renderas="sect4">
    2. VERBATIM COPYING
  </bridgehead>
    <para>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </para>
    <para>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </para>
    <bridgehead renderas="sect4">
    3. COPYING IN QUANTITY
  </bridgehead>
    <para>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </para>
    <para>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </para>
    <para>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </para>
    <para>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </para>
    <bridgehead renderas="sect4">
    4. MODIFICATIONS
  </bridgehead>
    <para>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </para>
    <orderedlist numeration="upperalpha" spacing="normal">
      <listitem>
        <para>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </para>
      </listitem>
      <listitem>
        <para>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the copyright notices of the Document.
   </para>
      </listitem>
      <listitem>
        <para>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </para>
      </listitem>
      <listitem>
        <para>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </para>
      </listitem>
      <listitem>
        <para>
    Include an unaltered copy of this License.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </para>
      </listitem>
      <listitem>
        <para>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </para>
      </listitem>
      <listitem>
        <para>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve any Warranty Disclaimers.
   </para>
      </listitem>
    </orderedlist>
    <para>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </para>
    <para>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </para>
    <para>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </para>
    <para>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </para>
    <bridgehead renderas="sect4">
    5. COMBINING DOCUMENTS
  </bridgehead>
    <para>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </para>
    <para>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </para>
    <para>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </para>
    <bridgehead renderas="sect4">
    6. COLLECTIONS OF DOCUMENTS
  </bridgehead>
    <para>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </para>
    <para>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </para>
    <bridgehead renderas="sect4">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </bridgehead>
    <para>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </para>
    <para>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </para>
    <bridgehead renderas="sect4">
    8. TRANSLATION
  </bridgehead>
    <para>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </para>
    <para>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </para>
    <bridgehead renderas="sect4">
    9. TERMINATION
  </bridgehead>
    <para>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </para>
    <bridgehead renderas="sect4">
    10. FUTURE REVISIONS OF THIS LICENSE
  </bridgehead>
    <para>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.gnu.org/copyleft/"></link>.
 </para>
    <para>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </para>
    <bridgehead renderas="sect4">
    ADDENDUM: How to use this License for your documents
  </bridgehead>
    <screen>Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</screen>
    <para>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the &#x201C;with...Texts.&#x201D; line with this:
 </para>
    <screen>with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</screen>
    <para>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </para>
    <para>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
</para>
  </appendix>
</article>
