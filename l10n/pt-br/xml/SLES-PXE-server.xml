<?xml version='1.0' encoding='UTF-8'?><article xmlns="http://docbook.org/ns/docbook" version="5.2" xml:id="sles-pxe-server-setup" xml:lang="pt-br">
  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">Configurando um servidor de inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase>&#xA0;<phrase><phrase os="sles">16.0</phrase></phrase></title>
    <revhistory xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="rh-sles-pxe-server-setup">
      <revision>
        <date>04-11-2025</date>
        <revdescription>
          <para>
              Versão inicial
            </para>
        </revdescription>
      </revision>
    </revhistory>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="architecture">
      <phrase>AMD64/Intel 64</phrase>
      <phrase>AArch64</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="productname" its:translate="no">
      <productname version="16.0">
        <phrase>
          <phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase>
        </phrase>
      </productname>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="title" its:translate="yes">Configurando um servidor de inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase></meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="description" its:translate="yes">Como configurar um servidor de inicialização PXE usando imagens do instalador GRUB 2, nginx e Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="social-descr" its:translate="yes">Configurar servidor de inic. PXE com GRUB 2 e Agama</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="category" its:translate="no">
      <phrase>Deployment &amp; Upgrade</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="task" its:translate="no">
      <phrase>Configuration</phrase>
      <phrase>Installation</phrase>
    </meta> <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="series" its:translate="no">Products &amp; Solutions</meta>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <dm:bugtracker>
        <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
        <dm:component>Documentation</dm:component>
        <dm:product>SUSE Linux Enterprise Server 16.0</dm:product>
        <dm:assignee>souvik.sarkar@suse.com</dm:assignee>
      </dm:bugtracker>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <variablelist>
        <varlistentry>
          <term>O QUE É?</term>
          <listitem>
            <para>
                Configure um servidor de inicialização PXE com suporte para o Boot Seguro UEFI e o instalador Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>POR QUÊ?</term>
          <listitem>
            <para>
                Automatize e simplifique a instalação de vários sistemas <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> na rede.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>DEDICAÇÃO</term>
          <listitem>
            <para>
                Para um administrador de sistema ou de rede, a leitura e a compreensão deste artigo costumam levar de 30 a 45 minutos.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>META</term>
          <listitem>
            <para>
                Um servidor PXE funcional que pode inicializar várias arquiteturas no instalador Agama.
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>REQUISITOS</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>
                    Um sistema <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> com privilégios administrativos
                  </para>
              </listitem>
              <listitem>
                <para>
                    Conexão com a Internet para buscar as imagens ISO
                  </para>
              </listitem>
              <listitem>
                <para>
                    Configuração de IP estático para o servidor PXE
                  </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </abstract>
  </info>
  <section role="concept" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-introduction">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Visão geral da inicialização PXE com o <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase>&#xA0;<phrase><phrase os="sles">16.0</phrase></phrase></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        A inicialização PXE permite que as máquinas sejam inicializadas por rede em um ambiente de instalação ou de runtime sem armazenamento local. Esta seção explica como funciona o PXE nas imagens do Agama e do instalador ativo do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> com foco no GRUB 2.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-what-is">
      <title>O que é a inicialização PXE?</title>
      <para>
      O Ambiente de Pré-execução (PXE, Preboot Execution Environment) é um método que permite que os sistemas recuperem carregadores de boot e instaladores de sistema operacional de um servidor de rede usando DHCP e TFTP ou HTTP. Ele é amplamente utilizado para provisionamento de máquinas sem mídia física ou de sistemas operacionais pré-instalados.
    </para>
    </section>
    <section xml:id="sles-pxe-server-benefits">
      <title>Benefícios da inicialização PXE</title>
      <para>
      A inicialização PXE simplifica o provisionamento porque elimina a necessidade de mídia de instalação local ou configuração manual. Ela possibilita o seguinte:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Instalação autônoma de muitos sistemas pela rede
        </para>
        </listitem>
        <listitem>
          <para>
          Gerenciamento centralizado das versões do instalador e das configurações de boot
        </para>
        </listitem>
        <listitem>
          <para>
          Suporte a várias arquiteturas e tipos de firmware, incluindo Boot Seguro UEFI
        </para>
        </listitem>
        <listitem>
          <para>
          Seleção dinâmica de instaladores ou parâmetros de instalação usando os menus do GRUB 2
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-how-it-works">
      <title>Como funciona a inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase>&#xA0;<phrase><phrase os="sles">16.0</phrase></phrase></title>
      <para>
      A inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> usa o GRUB 2 como carregador de boot e o instalador Agama como interface de instalação. Os carregadores de boot e os arquivos do instalador são fornecidos pela rede usando HTTP ou TFTP, e o GRUB 2 busca o kernel, o initrd e a imagem ativa. Os clientes PXE podem usar uma variedade de formatos de firmware (incluindo os mais comuns, como BIOS ou UEFI), de executável de carregador de boot ou de imagem, conforme exigido pelas arquiteturas, como AMD64/Intel 64, AArch64, ppc64le e s390x. Além disso, eles devem funcionar em redes tanto IPv4 quanto IPv6.
    </para>
      <para>
      O carregador de boot passa parâmetros do kernel, como <literal>root=live:</literal>, para carregar o sistema de arquivos raiz baseado em squashfs de uma imagem ISO ativa, iniciando a interface do Agama localmente ou como um serviço Web para uma interface de usuário Web remota.
    </para>
      <section xml:id="sles-pxe-server-backward-compatibility-with-sle-15">
        <title>Compatibilidade retroativa com o <phrase><phrase os="sles">SLES</phrase></phrase> 15.x</title>
        <para>
        As informações neste artigo são voltadas principalmente ao <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 16.0 e versões mais recentes. O foco é nos fluxos de trabalho de inicialização PXE que se integram ao instalador Agama e dependem das imagens de instalação ativas. No contexto e no escopo deste artigo, o <phrase><phrase os="sles">SLES</phrase></phrase> 16.0, e versões mais recentes, é diferente do <phrase><phrase os="sles">SLES</phrase></phrase> 15.x das seguintes maneiras:
      </para>
        <variablelist>
          <varlistentry>
            <term>Instalador</term>
            <listitem>
              <para>
              Usa o <literal>dracut</literal> e o Agama em vez do <literal>linuxrc</literal> e do YaST.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Servidor DHCP</term>
            <listitem>
              <para>
              O uso do ISC DHCP foi descontinuado (EOL 2022). Como alternativa para um servidor DHCP, use Kea ou dnsmasq.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Parâmetros de boot</term>
            <listitem>
              <para>
              Use o parâmetro <literal>root=live:</literal> para carregar a imagem do instalador Agama e o <literal>inst.install_url=</literal> opcional para o repositório de instalação não padrão, em vez do parâmetro <literal>install=</literal>.
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>
        A escolha do carregador de boot (GRUB 2, pxelinux etc.) permanece flexível e não depende da versão.
      </para>
      </section>
      <section xml:id="sles-pxe-server-different-possible-setups">
        <title>Diferentes configurações e etapas possíveis</title>
        <para>
        Este artigo consiste nas etapas de configuração obrigatórias e nas configurações opcionais ou alternativas. Siga apenas as seções relevantes à sua implantação e ignore todas as alternativas irrelevantes.
      </para>
        <variablelist>
          <varlistentry>
            <term>Obrigatória</term>
            <listitem>
              <para>
              As tarefas, como instalar componentes, preparar a imagem do instalador, configurar o GRUB 2 e validar o servidor, devem ser realizadas em todas as configurações.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Método de entrega de arquivo</term>
            <listitem>
              <para>
              Um servidor HTTP (recomendado com o Agama), como <literal>nginx</literal>, e/ou um servidor TFTP, como <literal>tftp</literal> ou <literal>dnsmasq</literal>.
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Servidor DHCP</term>
            <listitem>
              <para>
              Escolha entre Kea ou dnsmasq.
            </para>
              <note>
                <title>Limitações e recursos do método de sua escolha</title>
                <itemizedlist>
                  <listitem>
                    <para>
                    Use o <emphasis role="strong">Kea</emphasis>, o novo servidor DHCP da ISC, como o substituto moderno do ISC DHCP. Para obter mais informações sobre o Kea, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/kea/"></link>. Para conferir o aviso sobre o fim do serviço do ISC DHCP, acesse <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.isc.org/dhcp/"></link>. Kea é um servidor DHCP que requer um software de servidor TFTP separado. O servidor DHCP Kea suporta as opções de inicialização TFTP/PXE por IPv4 e IPv6, além da inicialização HTTP por IPv4. Para a inicialização HTTP por IPv6, o servidor DHCPv6 deve ser capaz de enviar a <literal>Vendor Class Option</literal> (consulte <literal>RFC3315, Section 22.16</literal>), supostamente para uso <quote>por um cliente para identificar o fornecedor,</quote> de volta ao cliente, e não há suporte a isso no momento.
                  </para>
                  </listitem>
                  <listitem>
                    <para><emphasis role="strong">dnsmasq</emphasis> como uma combinação dos servidores DNS, DHCP e TFTP. Você pode usá-lo para transmitir o carregador de boot, o kernel, o initrd (e outros arquivos) por TFTP. Para obter mais informações sobre o dnsmasq, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://thekelleys.org.uk/dnsmasq/doc.html"></link>. O servidor DHCP dnsmasq suporta as opções de inicialização TFTP/PXE por IPv4 e IPv6, além da inicialização HTTP por IPv4. Para a inicialização HTTP por IPv6, o servidor DHCPv6 deve ser capaz de enviar a <literal>Vendor Class Option</literal> (consulte <literal>RFC3315, Section 22.16</literal>), supostamente para uso <quote>por um cliente para identificar o fornecedor,</quote> de volta ao cliente, e não há suporte a isso no momento.
                  </para>
                  </listitem>
                </itemizedlist>
              </note>
            </listitem>
          </varlistentry>
        </variablelist>
        <figure xml:id="sles-pxe-server-setup-workflow">
          <title>Fluxo de trabalho para configuração do servidor PXE de amostra</title>
          <mediaobject>
            <imageobject role="html">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg"/>
            </imageobject>
            <imageobject role="fo">
              <imagedata fileref="sles-pxe-server-setup-workflow.svg" width="85%"/>
            </imageobject>
            <textobject role="description">
              <phrase>Diagrama do fluxo de trabalho para configuração de um servidor de inicialização PXE</phrase>
            </textobject>
          </mediaobject>
        </figure>
      </section>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-prepare-network">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Preparando a rede para os serviços de inicialização PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Este módulo descreve os requisitos de infraestrutura de rede para implantar os serviços de inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-network-configuration-introduction">
      <title>Introdução</title>
      <para>
      O servidor PXE consiste em três servidores: um servidor DHCP que fornece o endereço e o local do arquivo de inicialização (carregador de boot) e um servidor TFTP e/ou HTTP para recuperar os arquivos. Além disso, pode haver um servidor DNS, um servidor NTP e um roteador com suporte a IPv6. Geralmente, eles são separados do servidor PXE em uma rede de produção. Um servidor PXE que executa o <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> também pode precisar de uma configuração de interface de rede específica, determinadas regras persistentes adicionadas ao firewall e algumas permissões no <systemitem>SELinux</systemitem>. Esta seção ilustra uma rede de amostra com intervalos de IPs adequados e as regras necessárias para o firewall e o SELinux.
    </para>
    </section>
    <section xml:id="sles-pxe-server-network-configuration">
      <title>Suposições e configuração de rede de amostra</title>
      <para>
      Neste artigo, consideramos o seguinte:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          O servidor PXE está em execução na interface de rede <literal>eno1</literal> com a seguinte configuração de rede:
        </para>
          <table frame="all">
            <title>Configuração de rede PXE de amostra</title>
            <tgroup cols="4">
              <colspec colname="c1"/>
              <colspec colname="c2"/>
              <colspec colname="c3"/>
              <colspec colname="c4"/>
              <thead>
                <row>
                  <entry/>
                  <entry>IPv4</entry>
                  <entry>IPv6</entry>
                  <entry>Nome DNS</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>Rede PXE</entry>
                  <entry>192.168.1.0/24</entry>
                  <entry>2001:db8:0:1::/64</entry>
                  <entry>example.net</entry>
                </row>
                <row>
                  <entry>Servidor PXE</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry>pxe.example.net</entry>
                </row>
                <row>
                  <entry>Gateway PXE</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Servidor DNS</entry>
                  <entry>192.168.1.200</entry>
                  <entry>2001:db8:0:1::200</entry>
                  <entry/>
                </row>
                <row>
                  <entry>Servidor NTP</entry>
                  <entry>192.168.1.1</entry>
                  <entry>2001:db8:0:1::1</entry>
                  <entry/>
                </row>
              </tbody>
            </tgroup>
          </table>
        </listitem>
        <listitem>
          <para>
          Por padrão, o roteador e os servidores NTP e DNS são externos e executados em outra máquina. Este artigo apresenta algumas dicas, mas não aborda a configuração completa.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-firewall-selinux">
      <title>Configurar interface de rede, firewall e <systemitem>SELinux</systemitem> para serviços PXE</title>
      <para>
      Configure a interface de rede e o firewall para permitir os serviços de rede exigidos pelo servidor PXE. Ajuste as configurações do <systemitem>SELinux</systemitem> para permitir testes de instalação e definir políticas locais persistentes.
    </para>
      <procedure>
        <step>
          <para>
          Verifique e atribua a interface de rede do PXE à zona do firewalld apropriada.
        </para>
          <substeps>
            <step>
              <para>
              Verifique as zonas que estão ativas e as respectivas interfaces atribuídas:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --get-active-zones</command>
              </screen>
            </step>
            <step>
              <para>
              Se <literal>eno1</literal> não foi atribuído à zona <literal>public</literal>, faça isso:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --change-interface=eno1</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a atribuição da interface persistente a reinicializações:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-interface=eno1</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço DNS.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço DNS na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dns</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dns</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço NTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço NTP na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=ntp</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=ntp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço DHCP (IPv4).
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço DHCP na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcp</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço DHCPv6.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço DHCPv6 na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=dhcpv6</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço TFTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço TFTP na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=tftp</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=tftp</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço HTTP.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço HTTP na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=http</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=http</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Configure o firewall para acesso ao serviço HTTPS.
        </para>
          <substeps>
            <step>
              <para>
              Permita o serviço HTTPS na sessão atual:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --zone=public --add-service=https</command>
              </screen>
            </step>
            <step>
              <para>
              Torne a mudança persistente:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>firewall-cmd --permanent --zone=public --add-service=https</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Desabilite temporariamente o <systemitem>SELinux</systemitem> para os testes de configuração.
        </para>
          <substeps>
            <step>
              <para>
              Defina o <systemitem>SELinux</systemitem> para o modo permissivo:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 0</command>
              </screen>
            </step>
            <step>
              <para>
              Verifique o status do <systemitem>SELinux</systemitem>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Gere e instale os módulos de políticas locais do <systemitem>SELinux</systemitem> para os serviços relacionados ao PXE.
        </para>
          <substeps>
            <step>
              <para>
              Crie e instale um módulo para <literal>nginx</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'nginx' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'nginx' --raw | audit2allow -a -M local-nginx</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-nginx.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              Crie e instale um módulo para <literal>dnsmasq</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'dnsmasq' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'dnsmasq' --raw | audit2allow -a -M local-dnsmasq</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-dnsmasq.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
            <step>
              <para>
              Crie e instale um módulo para <literal>in.tftpd</literal>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>if test `ausearch -c 'in.tftpd' --raw | wc -l` -gt 0 ; then</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  ausearch -c 'in.tftpd' --raw | audit2allow -a -M local-tftpd</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>  semodule -i local-tftpd.pp</command>
              </screen> <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>fi</command>
              </screen>
            </step>
          </substeps>
        </step>
        <step>
          <para>
          Habilite novamente o modo de imposição no <systemitem>SELinux</systemitem>.
        </para>
          <substeps>
            <step>
              <para>
              Defina o <systemitem>SELinux</systemitem> para o modo de imposição:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>setenforce 1</command>
              </screen>
            </step>
            <step>
              <para>
              Verifique o status do <systemitem>SELinux</systemitem>:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>sestatus</command>
              </screen>
            </step>
          </substeps>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-firewall-selinux-summary">
      <title>Resumo</title>
      <para>
      Este procedimento garantiu a configuração correta da interface de rede do servidor PXE, do firewall e da política do <systemitem>SELinux</systemitem> para uma operação segura e funcional.
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Verificou e atribuiu a interface de uso do PXE (<filename>eno1</filename>, neste exemplo) à zona <literal>public</literal> do firewalld.
        </para>
        </listitem>
        <listitem>
          <para>
          Abriu os serviços de firewall necessários à operação do PXE, incluindo <literal>dns</literal>, <literal>ntp</literal>, <literal>dhcp</literal>, <literal>dhcpv6</literal>, <literal>tftp</literal>, <literal>http</literal> e <literal>https</literal>.
        </para>
        </listitem>
        <listitem>
          <para>
          Definiu temporariamente o <systemitem>SELinux</systemitem> para o modo <literal>permissive</literal> para facilitar os testes de serviço e registrar negações do AVC.
        </para>
        </listitem>
        <listitem>
          <para>
          Usou <command>ausearch</command> e <command>audit2allow</command> para gerar e instalar módulos de políticas do SELinux personalizados para serviços como <systemitem>nginx</systemitem>, <systemitem>dnsmasq</systemitem> e <systemitem>in.tftpd</systemitem>.
        </para>
        </listitem>
        <listitem>
          <para>
          Restaurou o <systemitem>SELinux</systemitem> ao modo <literal>enforcing</literal> para proteger o sistema para uso em produção.
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Com essas etapas concluídas, o servidor PXE foi configurado de forma segura e está pronto para atender às máquinas clientes pela rede usando IPv4 ou IPv6.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-install-components">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Instalando os componentes necessários do servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como instalar os pacotes necessários para suportar a inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, incluindo os componentes GRUB 2, DHCP, TFTP e/ou HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-install-components-intro">
      <title>Introdução</title>
      <para>
      Para configurar um servidor de inicialização PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, você precisa instalar vários serviços e ferramentas. Dependendo da sua configuração, você pode precisar dos seguintes itens:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>dnsmasq</package> fornece uma combinação dos servidores DNS, TFTP e DHCP (DHCPv4 e DHCPv6) com suporte limitado a anúncio do roteador (RA, Router Advertising) IPv6. Ele oferece o seguinte:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Servidor DHCP dnsmasq: Suporta entrega condicional de opções DHCP dependendo da solicitação e da arquitetura do cliente para:
            </para>
              <itemizedlist>
                <listitem>
                  <para>
                  Solicitações de inicialização PXE por DHCPv4 e DHCPv6
                </para>
                </listitem>
                <listitem>
                  <para>
                  Solicitações de inicialização HTTP por DHCPv4
                </para>
                  <note>
                    <title>Limitações do dnsmasq para inicialização HTTP por DHCPv6</title>
                    <para>
                    Atualmente, o dnsmasq não suporta o envio da opção necessária <literal>vendor-class</literal> do DHCPv6.
                  </para>
                  </note>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
              Servidor TFTP dnsmasq: Entrega arquivos de carregador de boot, kernel e initrd por TFTP durante a inicialização PXE.
            </para>
            </listitem>
            <listitem>
              <para>
              Servidor DNS dnsmasq: Fornece uma resolução recursiva de nomes de domínio e endereços IP para o firmware do cliente e o <filename>/etc/resolv.conf</filename> no instalador/sistema operacional.
            </para>
            </listitem>
            <listitem>
              <para>
              RA IPv6 dnsmasq: Suporta o envio de RA IPv6 quando o servidor PXE também atua como roteador (capacidade de configuração limitada a um <quote>padrão de RA comum</quote>).
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          O pacote <package>kea</package> inclui um servidor DHCP e um sucessor do servidor SC DHCP. Ele suporta entrega condicional de opções DHCP dependendo da solicitação e da arquitetura do cliente para:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Solicitações de inicialização PXE por DHCPv4 e DHCPv6
            </para>
            </listitem>
            <listitem>
              <para>
              Solicitações de inicialização HTTP por DHCPv4
            </para>
              <note>
                <title>Limitações do KEA para inicialização HTTP por DHCPv6</title>
                <para>
                Atualmente, o Kea não suporta o envio da opção necessária <literal>vendor-class</literal> do DHCPv6. Para obter mais informações, consulte <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://kea.readthedocs.io/en/latest/arm/dhcp6-srv.html#id4"></link>.
              </para>
              </note>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Um servidor TFTP entrega os arquivos de carregador de boot, o kernel e o initrd por TFTP, enquanto a inicialização PXE com o Kea é fornecida pelo pacote <package>tftp</package> e não é necessária para inicialização HTTP. Se você usa o <package>dnsmasq</package>, não precisa do pacote <package>tftp</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Um servidor Web, como o pacote <package>nginx</package>, para transmitir as imagens do instalador por HTTP.
        </para>
          <note>
            <title>Necessidade de servidores HTTP</title>
            <para>
            Um servidor HTTP/HTTPS, como o nginx, é quase sempre necessário. Seu uso vai além de uma simples inicialização HTTP. Em particular, você pode precisar dele nos seguintes cenários:
          </para>
            <itemizedlist>
              <listitem>
                <para>
                Ele é um requisito básico para a inicialização HTTP.
              </para>
              </listitem>
              <listitem>
                <para>
                É recomendado para fornecer o <filename>squashfs.img</filename>. Você pode usar <literal>root=live:tftp://.../squashfs.img</literal> na linha de comando de inicialização.
              </para>
              </listitem>
              <listitem>
                <para>
                Ele também é recomendado para fornecer RPMs ao Agama no parâmetro de linha de comando de inicialização <literal>inst.install_url=http://.../install/</literal> em um <filename>SLES-16.0-Full-*.inline.iso</filename>, junto com perfis de instalação e outros arquivos para instalação autônoma.
              </para>
              </listitem>
            </itemizedlist>
          </note>
        </listitem>
        <listitem>
          <para>
          Os pacotes do carregador de boot GRUB 2 fornecem inicialização de rede para arquiteturas e métodos suportados. Por exemplo, a arquitetura AMD64/Intel 64 oferece dois métodos para inicialização de rede: BIOS e UEFI. Além disso, a UEFI geralmente suporta inicialização PXE (TFTP) e HTTP. Outros carregadores de boot, como o pxelinux, não suportam UEFI e inicialização HTTP.
        </para>
        </listitem>
        <listitem>
          <para>
          Opcionalmente, um daemon de anúncio do roteador para IPv6, como o pacote <package>radvd</package>. Ele será necessário no <phrase><phrase os="sles">SLES</phrase></phrase> se também atuar como roteador para uma rede de instalador para realizar o seguinte:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configurar o roteamento em uma rede para clientes de inicialização PXE ou HTTP.
            </para>
            </listitem>
            <listitem>
              <para>
              Habilitar o uso de DHCPv6 em uma rede para clientes de inicialização PXE ou HTTP.
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Um sistema que executa o <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> com privilégios administrativos, registrado no SUSE Customer Center e configurado com acesso aos repositórios online apropriados usando SUSEConnect.
        </para>
        </listitem>
        <listitem>
          <para>
          Módulos do SLE habilitados: Módulo Server Applications, Módulo Legacy e Módulo Base System.
        </para>
        </listitem>
        <listitem>
          <para>
          Acesso aos repositórios de módulos do SLE para serviços de rede e carregadores de boot.
        </para>
        </listitem>
        <listitem>
          <para>
          Conexão com a Internet ativa para buscar os pacotes.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-install-components-exec">
      <title>Instalando os pacotes</title>
      <para>
      Siga as etapas abaixo para instalar os pacotes principais necessários para o servidor de inicialização PXE.
    </para>
      <procedure>
        <title>Instalando os pacotes necessários para um servidor de inicialização PXE</title>
        <step>
          <para>
          Instale o carregador de boot GRUB 2 e o servidor HTTP nginx como requisitos comuns.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install grub2 nginx</command>
          </screen>
        </step>
        <step>
          <para>
          Execute qualquer um dos seguintes comandos para instalar os pacotes essenciais à sua abordagem:
        </para>
          <stepalternatives>
            <step>
              <para><package>kea</package> para o servidor DHCP, <package>tftp</package> para o servidor TFTP
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install kea tftp</command>
              </screen>
            </step>
            <step>
              <para><package>dnsmasq</package> como provedor comum para os servidores DHCP, DNS e TFTP
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install dnsmasq</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>Limitações de servidores DHCP fornecidos por Kea e dnsmasq</title>
            <para>
            A inicialização HTTP por IPv6 <emphasis>atualmente</emphasis> não é suportada por servidores DHCP fornecidos pelos pacotes <package>kea</package> e <package>dnsmasq</package>. Ela não suporta o envio da opção <literal>vendor-class</literal> de volta ao cliente HTTP, conforme exigido pela especificação UEFI.
          </para>
          </note>
        </step>
        <step>
          <para>
          Se preferir, instale destinos adicionais do GRUB 2 específicos da arquitetura, se você planeja oferecer suporte a outras plataformas.
        </para>
          <stepalternatives>
            <step>
              <para>
              Para a arquitetura AMD64/Intel 64:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-x86_64-efi grub2-i386-pc</command>
              </screen>
            </step>
            <step>
              <para>
              Para a arquitetura AArch64:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-aarch64-efi</command>
              </screen>
            </step>
            <step>
              <para>
              Para a arquitetura ppc64le:
            </para>
              <screen>
                <prompt>&gt; </prompt>
                <command>sudo</command>
                <command>zypper install grub2-ppc64le-ieee1275</command>
              </screen>
            </step>
          </stepalternatives>
          <note>
            <title>Como o servidor PXE entrega pacotes do GRUB 2 a clientes diferentes da arquitetura da máquina do servidor</title>
            <para>
            Os pacotes <package>noarch.rpm</package> específicos da arquitetura do GRUB 2 estão incluídos no subdiretório <filename>noarch</filename> da mídia/repositório de instalação, seja qual for a arquitetura da máquina em que o servidor PXE é configurado. Ou seja, você pode instalar os pacotes <package>grub2-arm64-efi</package> e <package>grub2-powerpc-ieee1275</package> em um servidor PXE executado em uma máquina AMD64/Intel 64, a fim de oferecer suporte a clientes com outras arquiteturas.
          </para>
          </note>
        </step>
        <step>
          <para>
          Você poderá instalar o pacote <package>shim</package> se precisar de Boot Seguro UEFI para AMD64/Intel 64 ou AArch64, mas não quiser usar os arquivos da mídia de instalação ISO.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install shim</command>
          </screen>
        </step>
        <step>
          <para>
          Se preferir, instale o daemon de anúncio do roteador <package>radvd</package> para usar o servidor PXE como roteador (não recomendado para redes de produção).
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install radvd</command>
          </screen>
        </step>
        <step>
          <para>
          Instale o utilitário <package>rsync</package> para copiar ou sincronizar de maneira oportuna a ISO e a árvore de diretórios.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install rsync</command>
          </screen>
        </step>
        <step>
          <para>
          Garanta que os serviços estejam instalados, mas ainda não tenham sido iniciados. A configuração será abordada em seções posteriores.
        </para>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Criando diretórios NetBoot do GRUB 2 para servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como criar diretórios NetBoot do GRUB 2 para servidores PXE usando o comando <command>grub2-mknetdir</command>, que gera diretórios específicos da arquitetura para sistemas AMD64/Intel 64 (UEFI e BIOS), AArch64 e ppc64le. Para suporte a Boot Seguro UEFI, os administradores devem copiar os arquivos EFI assinados da mídia de instalação ou usar o pacote <package>shim</package> para substituir os arquivos de carregador de boot padrão não assinados.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-introduction">
      <title>Introdução</title>
      <para>
      Esta seção descreve como configurar diretórios NetBoot do GRUB 2 para implantação do servidor PXE em várias arquiteturas. O comando <command>grub2-mknetdir</command> cria diretórios específicos da arquitetura em <filename>/srv/tftpboot/boot/grub2/</filename> para plataformas diferentes. Por exemplo, os sistemas AMD64/Intel 64 geram diretórios UEFI (<filename>x86_64-efi</filename>) e BIOS (<filename>i386-pc</filename>) antigos, enquanto os sistemas AArch64 e ppc64le criam seus respectivos diretórios UEFI (<filename>arm64-efi</filename> e <filename>powerpc-ieee1275</filename>).
    </para>
      <para>
      Para suporte a Boot Seguro UEFI, que não é fornecido pelos arquivos <filename>core.efi</filename> padrão não assinados, os administradores podem copiar os arquivos EFI assinados da mídia de instalação ou instalar o pacote <package>shim</package> e copiar manualmente os arquivos de carregador de boot necessários (<filename>shim.efi</filename>, <filename>grub.efi</filename>, <filename>MokManager.efi</filename>) para os diretórios de arquitetura apropriados, garantindo uma resolução de link simbólico adequada para manter todos os arquivos no diretório raiz do TFTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-requirements">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Garanta que você tenha instalado os seguintes pacotes: <package>grub2</package>, <package>tftp</package> e qualquer outro pacote do GRUB 2 específico da arquitetura, como <package>grub2-x86_64-efi</package> e <package>grub2-i386-pc</package>.
        </para>
        </listitem>
        <listitem>
          <para>
          Assegure que tenha a mídia de instalação (ISO) disponível para montagem ou o pacote <package>shim</package> instalado no sistema. Você pode baixar a mídia de instalação (ISO) para sua arquitetura de destino do SUSE Customer Center.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-netboot-directories-uefi-secure-boot-executing">
      <title>Preparando os diretórios NetBoot e o Boot Seguro UEFI</title>
      <para>
      Este procedimento cria a estrutura de diretórios do GRUB 2 necessária para inicialização de rede PXE e, opcionalmente, configura o suporte a Boot Seguro UEFI em várias arquiteturas.
    </para>
      <procedure>
        <step>
          <para>
          Crie uma estrutura de diretórios NetBoot do GRUB 2.
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>grub2-mknetdir --net-directory=/srv/tftpboot
--subdir=/boot/grub2</command>
          </screen>
          <para>
          Esse procedimento cria diretórios específicos da arquitetura:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              AMD64/Intel 64: <filename>/srv/tftpboot/boot/grub2/x86_64-efi</filename> e <filename>/srv/tftpboot/boot/grub2/i386-pc</filename>
            </para>
            </listitem>
            <listitem>
              <para>
              AArch64: <filename>/srv/tftpboot/boot/grub2/arm64-efi</filename>
            </para>
            </listitem>
            <listitem>
              <para>
              ppc64le: <filename>/srv/tftpboot/boot/grub2/powerpc-ieee1275</filename>
            </para>
            </listitem>
          </itemizedlist>
          <warning>
            <para>
            Não substitua manualmente o arquivo <filename>grub.cfg</filename> criado pelo <command>grub2-mknetdir</command>.
          </para>
          </warning>
        </step>
        <step>
          <para>
          Copie outros diretórios independentes da arquitetura, como <filename>fonts/</filename> e <filename>locale/</filename>, que estão disponíveis no diretório <filename>/srv/tftpboot/boot/grub2/</filename> para o servidor TFTP.
        </para>
        </step>
        <step>
          <para>
          Você também pode usar o arquivo <filename>/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/core.efi</filename> instalado pelo comando <command>grub2-mknetdir</command> para arquiteturas AMD64/Intel 64 ou AArch64 para PXE UEFI. No entanto, ele <emphasis>não é assinado</emphasis> e não suporta Boot Seguro UEFI. Opcionalmente, para habilitar o Boot Seguro UEFI para as arquiteturas AMD64/Intel 64 e AArch64 suportadas, siga qualquer uma destas etapas:
        </para>
          <stepalternatives>
            <step>
              <para>
              Copie os arquivos necessários da mídia de instalação ISO:
            </para>
              <substeps>
                <step>
                  <para>
                  Monte a imagem ISO:
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>mount -o loop /PATH/TO/SLES.ISO /mnt</command>
                  </screen>
                </step>
                <step>
                  <para>
                  Copie os arquivos EFI.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>cp -v /mnt/EFI/BOOT/*.efi
/srv/tftpboot/boot/grub2/<replaceable>ARCH</replaceable>-efi/</command>
                    <co xml:id="copy-efi-files"/>
                  </screen>
                  <calloutlist>
                    <callout arearefs="copy-efi-files">
                      <para>
                      Substitua <filename><replaceable>ARCH</replaceable>-efi</filename> por <filename>x86_64-efi</filename> ou <filename>arm64-efi</filename>, as arquiteturas suportadas para Boot Seguro UEFI.
                    </para>
                    </callout>
                  </calloutlist>
                </step>
                <step>
                  <para>
                  Desmonte a mídia de instalação ISO.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>umount /mnt</command>
                  </screen>
                </step>
              </substeps>
            </step>
            <step>
              <para>
              Use o pacote <package>shim</package> se você não quiser usar os arquivos da mídia de instalação ISO:
            </para>
              <substeps>
                <step>
                  <para>
                  Se ainda não foi instalado, instale o pacote <package>shim</package>.
                </para>
                  <screen>
                    <prompt>&gt; </prompt>
                    <command>sudo</command>
                    <command>zypper install shim</command>
                  </screen>
                </step>
                <step>
                  <para>
                  Copie os arquivos de carregador de boot assinados para a arquitetura necessária:
                </para>
                  <substeps>
                    <step>
                      <para>
                      Copie o arquivo <filename>shim.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para a arquitetura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/shim.efi /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para a arquitetura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/shim.efi /srv/tftpboot/boot/grub2/arm64-efi/bootaa64.efi</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copie o arquivo <filename>grub.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para a arquitetura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/grub.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para a arquitetura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/grub.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                    <step>
                      <para>
                      Copie o arquivo <filename>MokManager.efi</filename>.
                    </para>
                      <stepalternatives>
                        <step>
                          <para>
                          Para a arquitetura AMD64/Intel 64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/x86_64/MokManager.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
                          </screen>
                        </step>
                        <step>
                          <para>
                          Para a arquitetura AArch64:
                        </para>
                          <screen>
                            <prompt>&gt; </prompt>
                            <command>sudo</command>
                            <command>cp -v -p -L /usr/share/efi/aarch64/MokManager.efi /srv/tftpboot/boot/grub2/arm64-efi/</command>
                          </screen>
                        </step>
                      </stepalternatives>
                    </step>
                  </substeps>
                  <note>
                    <para>
                    O flag <literal>-L</literal> resolve links simbólicos para garantir que os arquivos permaneçam na raiz do TFTP.
                  </para>
                  </note>
                </step>
              </substeps>
            </step>
          </stepalternatives>
        </step>
      </procedure>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-prepare-installer">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Preparando o conteúdo da imagem do instalador</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção descreve como extrair e organizar arquivos do instalador da mídia de instalação do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> para ambientes de inicialização PXE. Ela aborda as imagens <literal>.install.iso</literal> e os pacotes RPM, com instruções específicas para diversas arquiteturas e tipos de instalação.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-prepare-installer-intro">
      <title>Introdução</title>
      <para>O <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> inclui arquivos do instalador em vários formatos para suportar diferentes cenários de inicialização PXE. O instalador Agama requer três arquivos essenciais: a imagem do kernel (<filename>linux</filename>), o disco RAM inicial (<filename>initrd</filename>) e o sistema de arquivos raiz compactado (<filename>squashfs.img</filename>). Esses arquivos devem ser extraídos da mídia de instalação e organizados em uma estrutura de diretórios acessível por TFTP e HTTP.
    </para>
      <para>
      Esta seção apresenta os métodos de preparação para as imagens <literal>.install.iso</literal> e os pacotes RPM, garantindo a compatibilidade com várias arquiteturas e tipos de instalação suportados pelo <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>Mídia de instalação do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>, conforme disponível no SUSE Customer Center. Escolha:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              ISO online: Somente instalador para instalações de rede (<filename>SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              ISO completa: Instalador com repositório de instalação (<filename>SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso</filename>)
            </para>
            </listitem>
            <listitem>
              <para>
              Pacotes RPM: <package>tftpboot-agama-installer-SUSE_SLE_16_PXE-<replaceable>ARCH</replaceable></package>
            </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
          Um ponto de montagem temporário, como <filename>/mnt</filename>.
        </para>
        </listitem>
        <listitem>
          <para>
          Espaço em disco suficiente em <filename>/srv/tftpboot</filename> e <filename>/srv/install</filename> para o método de instalação escolhido.
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para criar diretórios e copiar arquivos.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-iso">
      <title>Preparando arquivos do instalador com base em imagens ISO</title>
      <para>
      As imagens ISO oferecem um método simples para extrair arquivos do instalador. Os procedimentos a seguir abordam os tipos de ISO online e completa para diferentes arquiteturas.
    </para>
      <section xml:id="sles-pxe-server-prepare-installer-iso-online">
        <title>Usando imagens ISO online</title>
        <para>
        As imagens ISO online contêm apenas os componentes do instalador, exigindo acesso da rede aos repositórios de instalação durante a instalação do sistema. Isso corresponde à entrada do menu de inicialização do <literal>SLES-16.0 Online Installation</literal> no GRUB.
       </para>
        <procedure xml:id="proc-prepare-online-iso-x86-aarch64">
          <title>Extraindo arquivos da ISO online (x86_64 e aarch64)</title>
          <step>
            <para>
            Crie a estrutura de diretórios para os arquivos do instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Monte a imagem ISO online:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o kernel e os arquivos initrd:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o sistema de arquivos raiz compactado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte a imagem ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
        <procedure xml:id="proc-prepare-online-iso-ppc64le">
          <title>Extraindo arquivos da ISO online (ppc64le)</title>
          <step>
            <para>
            Crie a estrutura do diretório:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Monte a imagem ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Online-ppc64le-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o kernel e os arquivos initrd (observe a estrutura de caminho diferente para ppc64le):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/linux /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/ppc64le/initrd /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o sistema de arquivos raiz compactado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/ppc64le/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte a imagem ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-prepare-installer-iso-full">
        <title>Usando as imagens ISO completas</title>
        <para>
        As imagens ISO completas incluem tanto o instalador quanto os repositórios de instalação, permitindo instalações locais sem dependências da rede externa. Isso corresponde à entrada do menu de inicialização do <literal>SLES-16.0 Local Installation</literal> no GRUB com o parâmetro <literal>inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch}</literal> adicional.
      </para>
        <procedure xml:id="proc-prepare-full-iso">
          <title>Extraindo arquivos da ISO completa</title>
          <step>
            <para>
            Crie diretórios para os arquivos do instalador e o repositório de instalação:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install/SLES-16.0</command>
            </screen>
          </step>
          <step>
            <para>
            Monte a imagem ISO completa:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mount -oro,loop /srv/install/iso/SLES-16.0-Full-<replaceable>ARCH</replaceable>-<replaceable>BUILD</replaceable>.install.iso /mnt</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o kernel e os arquivos initrd (ajuste os caminhos para ppc64le conforme mostrado nos procedimentos anteriores):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/linux  /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/boot/<replaceable>ARCH</replaceable>/loader/initrd /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o sistema de arquivos raiz compactado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Copie o repositório de instalação para acesso ao servidor HTTP local:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>rsync -avP /mnt/install/ /srv/install/SLES-16.0/<replaceable>ARCH</replaceable>/</command>
            </screen>
          </step>
          <step>
            <para>
            Desmonte a imagem ISO:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>umount /mnt</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-rpm">
      <title>Preparando arquivos do instalador com base em pacotes RPM</title>
      <para>
      Os pacotes RPM oferecem um método alternativo para obter os arquivos do instalador online.
    </para>
      <procedure xml:id="proc-prepare-rpm-packages">
        <title>Instalando e usando os pacotes RPM tftpboot</title>
        <step>
          <para>
          Instale os pacotes obrigatórios:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper in tftpboot-agama-installer-SUSE_SLE_16-<replaceable>ARCH</replaceable></command>
          </screen>
        </step>
        <step>
          <para>
          Copie o linux,initrd,squashfs.img para tftpboot:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cd
/srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable></command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/linux .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/initrd .</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>cp -v /usr/share/tftpboot-installation/agama-installer-SUSE_SLE_16/<replaceable>ARCH</replaceable>/loader/squashfs.img .</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-dir-structure">
      <title>Estrutura de diretórios recomendada</title>
      <para>
      Organize os arquivos extraídos de acordo com o layout de diretório abaixo para garantir consistência e facilidade de manutenção. Esta estrutura suporta várias arquiteturas e tipos de instalação.
    </para>
      <example xml:id="ex-pxe-directory-layout">
        <title>Layout completo de diretório do servidor PXE</title>
        <screen>/srv/tftpboot/
├── boot/
│   ├── grub2/
│   │   ├── x86_64-efi/
│   │   │   ├── bootx64.efi
│   │   │   └── grub.cfg
│   │   ├── i386-pc/
│   │   │   └── core.0
│   │   ├── arm64-efi/
│   │   │   └── bootaa64.efi
│   │   └── powerpc-ieee1275/
│   │       └── core.elf
│   └── images/
│       └── SLES-16.0/
│           ├── x86_64/
│           │   ├── linux <co xml:id="co-kernel"/>
│           │   ├── initrd <co xml:id="co-initrd"/>
│           │   └── squashfs.img <co xml:id="co-squashfs"/>
│           ├── aarch64/
│           └── ppc64le/
/srv/install/
└── SLES-16.0/
    ├── x86_64/ <co xml:id="co-install-repo"/>
    ├── aarch64/
    └── ppc64le/</screen>
      </example>
      <calloutlist>
        <callout arearefs="co-kernel">
          <para>
          Imagem do kernel extraída da mídia de instalação
        </para>
        </callout>
        <callout arearefs="co-initrd">
          <para>
          Imagem de disco RAM inicial
        </para>
        </callout>
        <callout arearefs="co-squashfs">
          <para>
          Sistema de arquivos raiz compactado para instalador Agama
        </para>
        </callout>
        <callout arearefs="co-install-repo">
          <para>
          Repositório de instalação do diretório <filename>install</filename> com base na ISO completa (opcional)
        </para>
        </callout>
      </calloutlist>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-verify">
      <title>Verificando a instalação</title>
      <para>
      Depois de extrair e organizar os arquivos do instalador, verifique se todos os componentes necessários estão presentes e acessíveis.
    </para>
      <procedure xml:id="proc-verify-installer-files">
        <title>Etapas de verificação</title>
        <step>
          <para>
          Verifique se os arquivos essenciais estão presentes:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/*</command>
          </screen>
        </step>
        <step>
          <para>
          Garanta as permissões de arquivo apropriadas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 0755 {} \;</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/images/ -type f -exec chmod 0644 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>Acessibilidade dos arquivos</title>
        <para>
        Garanta que todos os arquivos extraídos possam ser lidos pelos serviços TFTP e HTTP. Os arquivos serão acessados pelos clientes PXE durante o processo de inicialização, portanto, as permissões e a configuração do serviço apropriadas são essenciais para o sucesso das implantações.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-prepare-installer-next">
      <title>Próximas etapas</title>
      <para>
      Com os arquivos do instalador devidamente preparados e organizados, você pode prosseguir para:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurar o GRUB 2 para inicialização PXE com entradas de menu que mencionam esses arquivos
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar os serviços HTTP e TFTP para transmitir o conteúdo extraído
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar o DHCP para direcionar os clientes PXE aos carregadores de boot apropriados
        </para>
        </listitem>
      </itemizedlist>
      <para>
      Os arquivos extraídos serão mencionados na configuração do GRUB 2 usando caminhos como <literal>root=live:http://pxe.example.net/boot/images/SLES-16.0/<replaceable>ARCH</replaceable>/squashfs.img</literal>.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-configure-grub2">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando o GRUB 2 para inicialização PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção descreve como configurar o carregador de boot GRUB 2 para inicialização baseada em PXE no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Ela aborda a criação da estrutura de diretórios de inicialização de rede, a configuração de carregadores de boot específicos da arquitetura e a implementação de um sistema de configuração flexível com suporte a várias arquiteturas e cenários de instalação.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-grub2-intro">
      <title>Introdução</title>
      <para>
      O GRUB 2 atua como carregador de boot de rede para clientes PXE, carregando o kernel e os arquivos initrd para iniciar o instalador Agama. Esta seção demonstra como criar uma configuração sofisticada do GRUB 2 que detecta automaticamente a arquitetura do cliente, gerencia a seleção da interface de rede e oferece um menu de inicialização unificado que suporta vários tipos de instalação e arquiteturas de destino.
    </para>
      <para>
      A abordagem de configuração usa um design modular com arquivos separados para detecção de arquitetura, definições de variáveis e entradas do menu de inicialização. Isso permite o suporte a configurações específicas da máquina e perfis de instalação automatizados, mantendo a consistência entre plataformas de hardware diferentes.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Garanta que a estrutura de diretórios de inicialização de rede do GRUB 2 já esteja pronta, conforme descrito nas seções anteriores.
        </para>
        </listitem>
        <listitem>
          <para>
          Certifique-se de que os arquivos do instalador estejam devidamente organizados, conforme descrito nas seções anteriores.
        </para>
        </listitem>
        <listitem>
          <para>
          Os pacotes GRUB 2 para todas as arquiteturas de destino devem ser instalados: <package>grub2-x86_64-efi</package>, <package>grub2-i386-pc</package>, <package>grub2-aarch64-efi</package> e <package>grub2-ppc64le-ieee1275</package>
        </para>
        </listitem>
        <listitem>
          <para>
          O pacote <package>shim</package> para suporte a Boot Seguro UEFI (opcional).
        </para>
        </listitem>
        <listitem>
          <para>
          Acesso administrativo ao <filename>/srv/tftpboot</filename> ou à raiz do PXE equivalente.
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-main-config">
      <title>Criando a configuração do GRUB 2</title>
      <para>
      O arquivo de configuração do GRUB 2 processa três tarefas principais: detectar a arquitetura do cliente, gerenciar as interfaces de rede e carregar outros arquivos de configuração. Esta abordagem modular oferece flexibilidade para diversos cenários de implantação.
    </para>
      <procedure xml:id="proc-create-main-grub-config">
        <title>Configurando o arquivo <filename>grub.cfg</filename> principal</title>
        <step>
          <para>
          Crie o arquivo de configuração principal do GRUB 2 em <filename>/srv/tftpboot/boot/grub2/grub.cfg</filename>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Architecture detection and mapping
if [ "$grub_cpu" == "i386" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "x86_64" ]; then
  set arch='x86_64'
elif [ "$grub_cpu" == "arm64" ]; then
  set arch='aarch64'
elif [ "$grub_cpu" == "powerpc" ]; then
  set arch='ppc64le'
fi

if [ "X$arch" == "X" ]; then
  echo "ERROR: No architecture found for ${grub_cpu}"
  exit
else
  echo "Running on $arch CPU architecture"
fi
export arch


# Network interface configuration for PXE-selected NIC
# - dracut based images on SLE-16:
set ipcfg="ifname=pxe0:${net_default_mac} ip=pxe0:dhcp"
export ipcfg
# - linuxrc installer on SLE-15:
set ifcfg="ifcfg=${net_default_mac}=dhcp"
export ifcfg

# Define typical serial console kernel parameter
#set sconsole="console=tty0 console=ttyS0,115200n8"
#export sconsole

# Load machine-specific configuration if available
if [ -s "${config}/${net_default_mac}/grub.cfg" ]; then
  ## Source a host specific configuration of grub menu:
  source "${config}/${net_default_mac}/grub.cfg"
else
  ## Source default grub boot menu:
  source "${prefix}/menu.cfg"
fi
EOF
</screen>
        </step>
      </procedure>
      <variablelist>
        <title>Principais elementos da configuração</title>
        <varlistentry>
          <term>Detecção de arquitetura</term>
          <listitem>
            <para>
            Mapeia os tipos de CPU do GRUB 2 para as arquiteturas de distribuição, permitindo entradas de menu unificadas que funcionam em plataformas de hardware diferentes
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Gerenciamento de interface de rede</term>
          <listitem>
            <para>
            Define uma variável <varname>${ipcfg}</varname> usando a variável grub2 <varname>${net_default_mac}</varname> para ativar o DHCP apenas na interface de inicialização PXE chamada <literal>pxe0</literal>, o que evita problemas de sondagem de rede em sistemas com várias interfaces.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Definições de utilitários</term>
          <listitem>
            <para>
            Define uma variável <varname>${sconsole}</varname> típica com parâmetros de console serial.
          </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Configuração específica da máquina</term>
          <listitem>
            <para>
            Carrega os arquivos de configuração opcionais por máquina com base no endereço MAC, permitindo parâmetros de inicialização personalizados por máquina e perfis de instalação automatizados
          </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-menu">
      <title>Criando o menu de inicialização unificado</title>
      <para>
      O menu de inicialização usa variáveis da configuração principal para fornecer entradas de menu independentes da arquitetura, que se adaptam automaticamente a diferentes plataformas de hardware e tipos de instalação.
    </para>
      <procedure xml:id="proc-create-grub-menu">
        <title>Configurando o arquivo menu.cfg</title>
        <step>
          <para>
          Crie o menu de inicialização unificado em <filename>/srv/tftpboot/boot/grub2/menu.cfg</filename>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'SLES-16.0 Online Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}

menuentry 'SLES-16.0 Local Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} ${ipcfg} ${sconsole} ${autoinstall}
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <note>
        <title>Flexibilidade de entrada de menu</title>
        <para>
        As entradas de menu usam variáveis que são automaticamente preenchidas com base na arquitetura e na configuração do cliente. A variável <varname>${arch}</varname> garante que os arquivos corretos sejam carregados.
       </para>
        <para>
        A variável <varname>${ipcfg}</varname> opcional faz com que apenas a interface de rede selecionada pelo PXE seja configurada.
       </para>
        <para>
        A variável <varname>${sconsole}</varname> opcional habilita um console serial no sistema do instalador.
       </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-machine-specific">
      <title>Configurações específicas da máquina</title>
      <para>
      Em implantações avançadas, você pode criar arquivos de configuração específicos da máquina para substituir as configurações padrão ou fornecer parâmetros de instalação automatizados.
    </para>
      <procedure xml:id="proc-machine-specific-config">
        <title>Criando uma configuração específica da máquina</title>
        <step>
          <para>
          Crie um diretório para configurações específicas da máquina:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config</command>
          </screen>
        </step>
        <step>
          <para>
          Para uma máquina com o endereço MAC <literal>aa:bb:cc:dd:ee:ff</literal>, crie uma configuração específica:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff</command>
          </screen>
        </step>
        <step>
          <para>
          Crie o <filename>grub.cfg</filename> específico da máquina:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
# Machine-specific configuration for aa:bb:cc:dd:ee:ff
set default='SLES-16.0 Full Installation'

# Activate the menu-entry after 5sec timeout
set timeout=5

# Use know predictable network interface name
set ipcfg="ip=eno1:dhcp"

# Set the autoinstall variable for this machine
set autoinstall="inst.auto=http://pxe.example.net/install/profiles/aa:bb:cc:dd:ee:ff/sles16.json"
export autoinstall

# Load the default menu
source "/boot/grub2/menu.cfg"
EOF
</screen>
          <para>
          Se preferir, forneça uma entrada de menu própria no <filename>grub.cfg</filename> específico do host (por exemplo, gerada para uma tentativa de inicialização específica):
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/config/aa:bb:cc:dd:ee:ff/grub.cfg &lt;&lt; 'EOF'</command>
set default='SLES-16.0 Auto-Installation'
set timeout=5

menuentry 'SLES-16.0 Auto-Installation' {
  linux  /boot/images/SLES-16.0/${arch}/linux showopts root=live:http://pxe.example.net/boot/images/SLES-16.0/${arch}/squashfs.img inst.install_url=http://pxe.example.net/install/SLES-16.0/${arch} inst.auto=http://pxe.example.net/install/profiles/${net_default_mac}/sles16.json ip=eno1:dhcp
  initrd /boot/images/SLES-16.0/${arch}/initrd
}
EOF
</screen>
        </step>
      </procedure>
      <example xml:id="ex-machine-specific-parameters">
        <title>Parâmetros comuns específicos da máquina</title>
        <variablelist>
          <varlistentry>
            <term>
              <varname>default</varname>
            </term>
            <listitem>
              <para>
              Especifica qual entrada de menu deve ser inicializada automaticamente
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>timeout</varname>
            </term>
            <listitem>
              <para>
              Define o tempo de espera de inicialização em segundos
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>ipcfg</varname>
            </term>
            <listitem>
              <para>
              Substitui a configuração da interface de rede para um hardware específico
            </para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <varname>autoinstall</varname>
            </term>
            <listitem>
              <para>
              Fornece URLs dos perfis de instalação automatizada específicos da máquina
            </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </example>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-verify">
      <title>Verificando a configuração do GRUB 2</title>
      <para>
      Depois de criar os arquivos de configuração, verifique se a configuração está correta e se todos os arquivos necessários estão disponíveis.
    </para>
      <procedure xml:id="proc-verify-grub-config">
        <title>Etapas de verificação</title>
        <step>
          <para>
          Verifique a estrutura de diretórios do GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>find /srv/tftpboot/boot/grub2 -type f -name "*.cfg" -o -name "*.efi" -o -name "core.*"</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique a sintaxe do arquivo de configuração fazendo um teste com as ferramentas do GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
          </screen>
        </step>
        <step>
          <para>
          Garanta as permissões de arquivo apropriadas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>chmod -R 644 /srv/tftpboot/boot/grub2/*.cfg</command>
          </screen> <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>find /srv/tftpboot/boot/grub2 -type d -exec chmod 0755 {} \;</command>
          </screen>
        </step>
      </procedure>
      <important>
        <title>Teste da configuração</title>
        <para>
        Teste a configuração do GRUB 2 com clientes PXE reais para garantir a detecção da arquitetura e a funcionalidade de menu apropriadas. A variável <varname>${net_default_mac}</varname> está disponível apenas durante cenários de inicialização de rede reais.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-troubleshooting">
      <title>Solucionando problemas da configuração do GRUB 2</title>
      <para>
      Problemas comuns e suas soluções ao trabalhar com configurações PXE do GRUB 2. Cada problema inclui as etapas de diagnóstico e os comandos específicos para resolvê-lo.
    </para>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-arch">
        <title>Falha na detecção de arquitetura</title>
        <para>
        Quando o GRUB 2 não consegue detectar a arquitetura correta, os clientes podem ser inicializados com binários incorretos ou nem ser carregados.
      </para>
        <procedure xml:id="proc-debug-arch-detection">
          <title>Depurando a detecção de arquitetura</title>
          <step>
            <para>
            Adicione a saída da depuração à configuração do GRUB 2 para ver os valores detectados:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>
# Debug architecture detection
echo "Detected grub_cpu: ${grub_cpu}"
echo "Mapped arch: ${arch}"
sleep 3
EOF</screen>
          </step>
          <step>
            <para>
            Teste a sintaxe da configuração:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Se o mapeamento da arquitetura estiver incompleto, estenda a lógica de detecção:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/elif \[ "$grub_cpu" == "powerpc" \]/a\\nelif [ "$grub_cpu" == "riscv64" ]; then\n  set arch='\''riscv64'\''\\' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se os diretórios específicos da arquitetura existem:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-network">
        <title>Interface de rede não encontrada</title>
        <para>
        Algumas implementações de firmware podem não definir a variável <varname>${net_default_mac}</varname> corretamente, causando falhas na configuração de rede.
      </para>
        <procedure xml:id="proc-debug-network-interface">
          <title>Diagnosticando problemas na interface de rede</title>
          <step>
            <para>
            Adicione a saída da depuração para verificar as variáveis de rede:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/set ipcfg=/i\\necho "Default MAC: ${net_default_mac}"\necho "Network variables set"\nsleep 2' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Crie uma configuração de rede de fallback:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /srv/tftpboot/boot/grub2/grub.cfg &lt;&lt; 'EOF'</command>

# Fallback network configuration if net_default_mac is empty
if [ "X${net_default_mac}" == "X" ]; then
  set ipcfg="ip=dhcp"
  set ifcfg="ifcfg=*=dhcp"
  echo "WARNING: Using fallback network configuration"
  sleep 2
fi
EOF
</screen>
          </step>
          <step>
            <para>
            Teste a configuração de rede com uma interface específica:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo 'set ipcfg="ip=eno1:dhcp"' &gt; /srv/tftpboot/boot/config/test-network.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique os nomes das interfaces de rede no sistema de destino:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-file-paths">
        <title>Caminhos de arquivo não encontrados</title>
        <para>
        Caminhos de arquivos incorretos impedem o GRUB 2 de carregar o kernel e os arquivos initrd, causando falhas na inicialização.
      </para>
        <procedure xml:id="proc-debug-file-paths">
          <title>Verificando a acessibilidade dos caminhos de arquivos</title>
          <step>
            <para>
            Verifique se os arquivos do instalador existem nos locais esperados:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images -name "linux" -o -name "initrd" -o -name "squashfs.img"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o acesso por TFTP aos arquivos de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/grub.cfg /tmp/test-grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Teste o acesso por HTTP aos arquivos do instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/linux</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique as permissões e a propriedade dos arquivos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/images/SLES-16.0/*/</command>
            </screen>
          </step>
          <step>
            <para>
            Corrija as permissões, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 644 /srv/tftpboot/boot/images/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>find /srv/tftpboot/boot/images/ -type d -exec chmod 755 {} \;</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se os links simbólicos não estão corrompidos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>find /srv/tftpboot/boot/images/ -type l -exec ls -la {} \;</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-efi">
        <title>Falhas na inicialização EFI</title>
        <para>
        Os problemas com EFI e Boot Seguro podem impedir a inicialização adequada do carregador de boot ou causar falhas na autenticação.
      </para>
        <procedure xml:id="proc-debug-efi-boot">
          <title>Diagnosticando problemas na inicialização EFI</title>
          <step>
            <para>
            Verifique se os arquivos do Boot Seguro estão presentes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se os arquivos shim (bootx64.efi ou shim.efi), grub.efi e MokManager.efi foram copiados de maneira apropriada:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>file /srv/tftpboot/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a integridade do arquivo EFI:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sha256sum /srv/tftpboot/boot/grub2/x86_64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Teste se os arquivos são acessíveis por TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-shim.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Para sistemas aarch64, verifique os arquivos EFI ARM64:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/arm64-efi/*.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se a configuração do DHCP fornece os caminhos corretos do carregador de boot:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -n "bootx64.efi\|shim.efi\|bootaa64.efi"
/etc/dnsmasq.d/dhcp.conf /etc/kea/kea-dhcp?.conf /etc/dhcpd?.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Se os arquivos estiverem ausentes, copie-os novamente da ISO montada em /mnt ou dos arquivos do pacote shim:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -v /mnt/EFI/BOOT/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp -pL /usr/share/efi/x86_64/*.efi /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-menu">
        <title>Entradas de menu não carregadas</title>
        <para>
        Quando o GRUB 2 faz o carregamento, mas as entradas de menu apresentam falham ou erros, o problema costuma estar relacionado à expansão de variáveis ou às referências de arquivos.
      </para>
        <procedure xml:id="proc-debug-menu-entries">
          <title>Depurando problemas de entradas de menu</title>
          <step>
            <para>
            Teste a sintaxe da configuração do menu:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grub2-script-check /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Adicione a saída da depuração às entradas de menu:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/linux_kernel.*{images}/i\\necho "Loading: ${images}/SLES-16.0/${arch}/linux"\necho "Architecture: ${arch}"' /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se a expansão da variável funciona corretamente:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Debug Variables' {
  echo "arch = ${arch}"
  echo "images = ${images}"
  echo "ipcfg = ${ipcfg}"
  sleep 5
}
EOF
</screen>
          </step>
          <step>
            <para>
            Faça o teste uma entrada de menu simplificada:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/simple-menu.cfg &lt;&lt; 'EOF'</command>
menuentry 'Simple Test' {
  linux /boot/images/SLES-16.0/x86_64/linux
  initrd /boot/images/SLES-16.0/x86_64/initrd
}
EOF
</screen>
          </step>
          <step>
            <para>
            Carregue o menu de teste temporariamente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/menu.cfg"|source "${prefix}/simple-menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Restaure o menu original após o teste:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's|source "${prefix}/simple-menu.cfg"|source "${prefix}/menu.cfg"|' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-grub2-troubleshoot-logging">
        <title>Habilitando o registro detalhado</title>
        <para>
        Para problemas persistentes, habilite o registro completo para capturar informações detalhadas sobre o processo de inicialização.
      </para>
        <procedure xml:id="proc-enable-grub-logging">
          <title>Configurando o registro de depuração do GRUB 2</title>
          <step>
            <para>
            Crie uma versão de depuração da configuração principal:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>cp /srv/tftpboot/boot/grub2/grub.cfg /srv/tftpboot/boot/grub2/grub.cfg.backup</command>
            </screen>
          </step>
          <step>
            <para>
            Adicione a saída de depuração completa:
          </para>
            <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /srv/tftpboot/boot/grub2/debug.cfg &lt;&lt; 'EOF'</command>
# Debug configuration for GRUB troubleshooting
set debug=all
set pager=1

echo "=== GRUB Debug Information ==="
echo "grub_cpu: ${grub_cpu}"
echo "grub_platform: ${grub_platform}"
echo "net_default_mac: ${net_default_mac}"
echo "net_default_server: ${net_default_server}"
echo "============================="
sleep 5
EOF
</screen>
          </step>
          <step>
            <para>
            Inclua a configuração de depuração no arquivo principal:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\source "${prefix}/debug.cfg"' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore os registros do TFTP durante as tentativas de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u tftp.socket</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore os registros do DHCP para solicitações de PXE:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo journalctl -f -u dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Desabilite o modo de depuração após a solução de problemas:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '/source "${prefix}\/debug.cfg"/d' /srv/tftpboot/boot/grub2/grub.cfg</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-grub2-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com o GRUB 2 devidamente configurado, você pode prosseguir para:
    </para>
      <itemizedlist>
        <listitem>
          <para>
          Configurar os serviços HTTP e TFTP para transmitir os arquivos de inicialização e o conteúdo do instalador
        </para>
        </listitem>
        <listitem>
          <para>
          Configurar os serviços DHCP para direcionar os clientes PXE aos carregadores de boot apropriados
        </para>
        </listitem>
        <listitem>
          <para>
          Testar o processo de inicialização PXE completo no hardware de destino
        </para>
        </listitem>
      </itemizedlist>
      <para>
      O sistema de configuração do GRUB 2 flexível oferece uma base para cenários sofisticados de implantação PXE, para suportar várias arquiteturas e tipos de instalação em uma interface unificada.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-configure-tftp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando o TFTP para inicialização PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar os serviços TFTP para transmitir os carregadores de boot GRUB 2 e o conteúdo de inicialização PXE para instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Ela aborda o servidor <systemitem>in.tftpd</systemitem> tradicional e a funcionalidade TFTP integrada fornecida por <systemitem>dnsmasq</systemitem>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-tftp-intro">
      <title>Introdução</title>
      <para>
      O TFTP transmite os arquivos do carregador de boot para os clientes PXE durante o processo de inicialização de rede. O <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> suporta duas implementações de servidor TFTP: o servidor <systemitem>in.tftpd</systemitem> tradicional do pacote <package>tftp</package>, e a funcionalidade TFTP integrada em <systemitem>dnsmasq</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>tftp</package> ou <package>dnsmasq</package> instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Arquivos de inicialização PXE organizados em <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-intftpd">
      <title>Configurando o servidor in.tftpd</title>
      <para>
      O servidor <systemitem>in.tftpd</systemitem> usa o arquivo de configuração <filename>/etc/sysconfig/tftp</filename> para definir o diretório raiz do TFTP e as opções de servidor.
    </para>
      <procedure xml:id="proc-configure-intftpd">
        <title>Configurando o servidor TFTP in.tftpd</title>
        <step>
          <para>
          Opcionalmente, habilite o registro detalhado definindo as opções de TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
          </screen>
          <para>
          A opção <option>-v</option> habilita o registro detalhado para ver os nomes de arquivo buscados por TFTP.
        </para>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now tftp.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-dnsmasq">
      <title>Configurando o servidor TFTP dnsmasq</title>
      <para>O <systemitem>dnsmasq</systemitem> oferece um servidor TFTP incorporado que pode ser habilitado e configurado para usar o diretório <filename>/srv/tftpboot</filename>.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-tftp">
        <title>Configurando a funcionalidade do TFTP dnsmasq</title>
        <step>
          <para>
          Crie o arquivo de configuração do TFTP:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/tftp.conf &lt;&lt; 'EOF'</command>
enable-tftp
tftp-root=/srv/tftpboot
EOF
</screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-verify">
      <title>Verificando a configuração do TFTP</title>
      <para>
      Teste a funcionalidade do servidor TFTP para garantir que ele possa transmitir arquivos aos clientes PXE.
    </para>
      <procedure xml:id="proc-verify-tftp">
        <title>Testando a funcionalidade do servidor TFTP</title>
        <step>
          <para>
          Crie um arquivo de teste:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>echo "test file" | sudo tee /srv/tftpboot/test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Recupere o arquivo de teste por TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique se o arquivo foi recuperado com êxito:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /tmp/tftp-test.txt</command>
          </screen>
        </step>
        <step>
          <para>
          Limpe os arquivos de teste:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>rm /srv/tftpboot/test.txt /tmp/tftp-test.txt</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-troubleshooting">
      <title>Solucionando problemas da configuração do TFTP</title>
      <para>
      Problemas comuns ao configurar serviços TFTP para ambientes de inicialização PXE.
    </para>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-service-conflicts">
        <title>Conflitos de serviços na porta 69</title>
        <para>
        Tanto o <systemitem>in.tftpd</systemitem> quanto o <systemitem>dnsmasq</systemitem> usam a porta UDP 69 para serviços TFTP e não podem ser executados simultaneamente.
      </para>
        <procedure xml:id="proc-resolve-tftp-conflicts">
          <title>Resolvendo conflitos de serviços TFTP</title>
          <step>
            <para>
            Verifique quais serviços estão em execução:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status tftp.service dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que serviço está usando a porta 69:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :69</command>
            </screen>
          </step>
          <step>
            <para>
            Pare o serviço em conflito (exemplo para dnsmasq):
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Inicie o serviço TFTP de sua preferência:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start tftp.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-directory">
        <title>Problemas do diretório TFTP</title>
        <para>
        Problemas ao acessar o sistema de arquivos raiz do TFTP que podem impedir a transmissão de arquivos.
      </para>
        <procedure xml:id="proc-debug-tftp-directory">
          <title>Verificando a configuração do diretório TFTP</title>
          <step>
            <para>
            Verifique a configuração do diretório TFTP para in.tftpd:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_DIRECTORY /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração do diretório TFTP para dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep tftp-root /etc/dnsmasq.d/tftp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se o diretório existe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/</command>
            </screen>
          </step>
          <step>
            <para>
            Crie o diretório se ainda não existir:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/tftpboot</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-tftp-troubleshoot-verbose">
        <title>Habilitando o registro do TFTP</title>
        <para>
        O registro detalhado ajuda a identificar problemas de acesso a arquivos com transferências por TFTP.
      </para>
        <procedure xml:id="proc-enable-tftp-verbose">
          <title>Habilitando o registro detalhado do TFTP</title>
          <step>
            <para>
            Verifique as opções atuais do TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep TFTP_OPTIONS /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite o registro detalhado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/^TFTP_OPTIONS=.*/TFTP_OPTIONS="-v"/' /etc/sysconfig/tftp</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie o serviço TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart tftp.service</command>
            </screen>
          </step>
          <step>
            <para>
            Monitores os registros do TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.service -f</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-tftp-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com o TFTP configurado, você pode prosseguir para a configuração dos serviços HTTP, para transmitir arquivos do instalador, e dos serviços DHCP, para direcionar os clientes PXE aos carregadores de boot apropriados.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-configure-nginx">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando o nginx para entrega por HTTP</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar o nginx para fornecer o conteúdo da inicialização PXE por HTTP, permitindo que os clientes carreguem os arquivos do instalador, como kernel, initrd e imagens squashfs, de um local central. A entrega por HTTP oferece um desempenho melhor do que o TFTP para arquivos grandes e é necessária para as instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> pelo Agama.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-nginx-intro">
      <title>Introdução</title>
      <para>
      O nginx atua como servidor HTTP para ambientes de inicialização PXE, fornecendo acesso aos arquivos do instalador por meio de entrega baseada na Web. O servidor HTTP expõe o diretório de inicialização e os repositórios de instalação do TFTP, permitindo que os clientes PXE baixem as imagens do kernel, os arquivos initrd e os componentes do instalador Agama por HTTP, em vez do protocolo TFTP mais lento.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>nginx</package> instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Arquivos de inicialização PXE organizados em <filename>/srv/tftpboot/boot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Repositórios de instalação disponíveis em <filename>/srv/install</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para modificar a configuração do nginx
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-setup">
      <title>Configurando o nginx para inicialização PXE</title>
      <para>
      A configuração do nginx define aliases de local que expõem o diretório de boot TFTP e os repositórios de instalação por meio de URLs HTTP.
    </para>
      <procedure xml:id="proc-configure-nginx">
        <title>Configurando o servidor HTTP nginx</title>
        <step>
          <para>
          Edite o arquivo de configuração do nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>vim /etc/nginx/nginx.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Configure o bloco do servidor HTTP na seção <literal>http</literal>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/nginx/nginx.conf &lt;&lt; 'EOF'</command>
http {

    include             mime.types;
    default_type        application/octet-stream;

    charset             utf-8;
    sendfile            on;
    keepalive_timeout   65;

    server {
        listen          80  default_server;
        listen     [::]:80  default_server;

        location / {
            root   /srv/www/htdocs/;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /srv/www/htdocs/;
        }

        # Expose TFTP boot directory for HTTP boot
        location /boot {
            alias      /srv/tftpboot/boot;
            autoindex  on;
        }

        # Expose installation repositories and profiles
        location /install {
            alias      /srv/install;
            autoindex  on;
        }
    }
}

events {
    worker_connections  1024;
}
EOF
</screen>
        </step>
        <step>
          <para>
          Teste a sintaxe da configuração do nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>nginx -t</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now nginx.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-verify">
      <title>Verificando a configuração do nginx</title>
      <para>
      Teste a funcionalidade do servidor HTTP para garantir que ele possa transmitir os arquivos de inicialização PXE e o conteúdo de instalação aos clientes.
    </para>
      <procedure xml:id="proc-verify-nginx">
        <title>Testando o servidor HTTP nginx</title>
        <step>
          <para>
          Teste o acesso por HTTP aos arquivos de inicialização:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/</command>
          </screen>
        </step>
        <step>
          <para>
          Teste o acesso ao diretório de instalação:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/install/</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique se um arquivo do instalador específico está acessível:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-troubleshooting">
      <title>Solucionando problemas da configuração do nginx</title>
      <para>
      Problemas comuns ao configurar o nginx para entrega por HTTP com inicialização PXE.
    </para>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-config">
        <title>Erros na sintaxe da configuração</title>
        <para>
        A sintaxe incorreta da configuração do nginx impede que o serviço seja iniciado ou recarregado de maneira apropriada.
      </para>
        <procedure xml:id="proc-debug-nginx-config">
          <title>Resolvendo problemas da configuração do nginx</title>
          <step>
            <para>
            Teste a sintaxe da configuração:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>nginx -t</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status do serviço nginx se a inicialização falhar:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros detalhados de erros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u nginx.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            Consulte o arquivo de registro de erros do nginx:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/nginx/error.log</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-permissions">
        <title>Problemas de acesso e permissão de arquivos</title>
        <para>
        O nginx pode falhar ao transmitir arquivos devido a permissões incorretas ou diretórios ausentes.
      </para>
        <procedure xml:id="proc-debug-nginx-permissions">
          <title>Resolvendo problemas de acesso a arquivos</title>
          <step>
            <para>
            Verifique se o diretório de inicialização existe e está acessível:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se o diretório de instalação existe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/install/</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se o nginx pode ler os diretórios:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo -u nginx ls /srv/tftpboot/boot/</command>
            </screen>
          </step>
          <step>
            <para>
            Crie os diretórios ausentes, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mkdir -p /srv/install</command>
            </screen>
          </step>
          <step>
            <para>
            Defina as permissões apropriadas:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chmod -R 755 /srv/tftpboot/boot /srv/install</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-nginx-troubleshoot-port">
        <title>Conflitos de vinculação de porta</title>
        <para>
        Pode haver falha para iniciar o nginx se outro serviço está usando a porta 80.
      </para>
        <procedure xml:id="proc-debug-nginx-port">
          <title>Resolvendo conflitos de porta</title>
          <step>
            <para>
            Verifique que serviço está usando a porta 80:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
          <step>
            <para>
            Pare os serviços em conflito, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop apache2</command>
            </screen>
          </step>
          <step>
            <para>
            Inicie o serviço nginx:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start nginx.service</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se o nginx escuta na porta 80:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -tlnp | grep :80</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-nginx-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com o nginx configurado para entrega por HTTP, você pode prosseguir para a configuração dos serviços DHCP, para direcionar os clientes PXE aos carregadores de boot e recursos HTTP apropriados.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-configure-dns">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando um servidor DNS usando dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar os serviços DNS usando o dnsmasq para fornecer resolução de nomes de host aos clientes PXE que acessam os recursos de instalação do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. A configuração de DNS permite que os clientes usem nomes de host em vez de endereços IP nos URLs de inicialização e nas configurações de DHCP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-dns-intro">
      <title>Introdução</title>
      <para>
      Os serviços DNS permitem que os clientes PXE resolvam os nomes de host nos URLs de inicialização e nas fontes de instalação. A configuração completa do servidor DNS está fora do escopo deste documento, mas esta seção apresenta uma configuração de DNS básica usando o dnsmasq, que permite que os clientes resolvam o nome de host do servidor PXE (<replaceable>PXE.EXAMPLE.NET</replaceable>) para os respectivos endereços IP.
    </para>
      <para>
      Sem a configuração de DNS, os URLs de inicialização devem usar diretamente os endereços IP, como <literal>http://192.168.1.200/</literal> ou <literal>http://[2001:db8:0:1::200]/</literal>. Algumas implementações de firmware BIOS/UEFI não suportam nomes de host em URLs DHCP/TFTP e exigem endereços IP como <literal>tftp://[2001:db8:0:1::200]/</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-requirements">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>dnsmasq</package> instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Configuração de endereços IP estáticos para o servidor PXE
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços DNS
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-setup">
      <title>Configurando serviços DNS do dnsmasq</title>
      <para>
      A configuração de DNS do dnsmasq fornece uma resolução de nome de host local e usa servidores de nomes upstream para consultas externas.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dns">
        <title>Configurando o servidor DNS do dnsmasq:</title>
        <step>
          <para>
          Crie o arquivo de configuração de DNS para o dnsmasq:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dns.conf &lt;&lt; 'EOF'</command>
# DNS configuration file for dnsmasq

# Log DNS queries
log-queries

# DNS cache behavior
cache-size=10000
local-ttl=60
neg-ttl=10

# Never forward A or AAAA queries for plain names to upstream name servers
domain-needed

# Add local domain to simple names in /etc/hosts and DHCP
expand-hosts

# Specifies DNS domain and networks including local forward and reverse declarations
domain=<replaceable>EXAMPLE.NET</replaceable>,192.168.1.0/24,local
domain=<replaceable>EXAMPLE.NET</replaceable>,2001:db8:0:1::/64,local
EOF
</screen>
        </step>
        <step>
          <para>
          Adicione entradas de nome de host ao arquivo de hosts do sistema:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/hosts &lt;&lt; 'EOF'</command>
192.168.1.200 <replaceable>PXE.EXAMPLE.NET</replaceable>
2001:db8:0:1::200 <replaceable>PXE.EXAMPLE.NET</replaceable>
EOF
</screen>
        </step>
        <step>
          <para>
          Teste a configuração do dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>Comportamento do encaminhamento de DNS</title>
        <para>
        Por padrão, o dnsmasq usa os servidores de nomes em <filename>/etc/resolv.conf</filename> como encaminhadores e fornece registros de <filename>/etc/hosts</filename>. Isso permite que o servidor PXE resolva nomes de host externos enquanto fornece uma resolução local para serviços relacionados ao PXE.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-verify">
      <title>Verificando a configuração de DNS</title>
      <para>
      Teste a funcionalidade do servidor DNS para garantir que a resolução de nomes de host funcione para os clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dns">
        <title>Testando a funcionalidade do servidor DNS</title>
        <step>
          <para>
          Teste a resolução de nome de host IPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost</command>
          </screen>
        </step>
        <step>
          <para>
          Teste a resolução de nome de host IPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup <replaceable>PXE.EXAMPLE.NET</replaceable> localhost | grep 2001:db8</command>
          </screen>
        </step>
        <step>
          <para>
          Teste a pesquisa DNS reversa para IPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup 192.168.1.200 localhost</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique se o encaminhamento de DNS externo ainda funciona:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup google.com localhost</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-troubleshooting">
      <title>Solucionando problemas da configuração de DNS</title>
      <para>
      Problemas comuns ao configurar o dnsmasq para serviços DNS em ambientes PXE.
    </para>
      <section xml:id="sles-pxe-server-dns-troubleshoot-config">
        <title>Problemas de configuração e serviço</title>
        <para>
        Pode haver falha para iniciar o dnsmasq devido a erros de configuração ou conflitos de porta.
      </para>
        <procedure xml:id="proc-debug-dns-config">
          <title>Resolvendo problemas da configuração de DNS</title>
          <step>
            <para>
            Teste a sintaxe de configuração do dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status do serviço dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status dnsmasq</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique que serviço está usando a porta DNS 53:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :53</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros de erros do dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            Pare os serviços DNS em conflito, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop systemd-resolved</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-resolution">
        <title>Falhas na resolução de nome de host</title>
        <para>
        As consultas DNS podem falhar devido à configuração incorreta ou a entradas de nome de host ausentes.
      </para>
        <procedure xml:id="proc-debug-dns-resolution">
          <title>Diagnosticando problemas da resolução de DNS</title>
          <step>
            <para>
            Verifique se as entradas de nome de host existem no arquivo hosts:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep <replaceable>PXE.EXAMPLE.NET</replaceable> /etc/hosts</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração do domínio no dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep domain= /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a consulta DNS com uma saída detalhada:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dig @localhost <replaceable>PXE.EXAMPLE.NET</replaceable></command>
            </screen>
          </step>
          <step>
            <para>
            Monitore os registros da consulta dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "query"</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie o dnsmasq para recarregar a configuração:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dns-troubleshoot-forwarding">
        <title>Problemas de encaminhamento de DNS</title>
        <para>
        As consultas DNS externas poderão falhar se a configuração do servidor de nomes upstream estiver incorreta.
      </para>
        <procedure xml:id="proc-debug-dns-forwarding">
          <title>Solucionando problemas de encaminhamento de DNS</title>
          <step>
            <para>
            Verifique a configuração do servidor de nomes upstream:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/resolv.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a consulta direta no servidor de nomes upstream:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nslookup google.com 8.8.8.8</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração do encaminhamento de dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "server=|no-resolv" /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Adicione um servidor de nomes upstream específico, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>echo "server=8.8.8.8" &gt;&gt; /etc/dnsmasq.d/dns.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie o serviço dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-dns-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com os serviços DNS configurados, os clientes PXE agora podem resolver os nomes de host nos URLs de inicialização e nas fontes de instalação. Você pode prosseguir para configurar os serviços DHCP que fazem referência ao servidor DNS para configuração do cliente.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-configure-ntp">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando um servidor NTP com o <systemitem>chrony</systemitem></title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar os serviços NTP usando o <systemitem>chrony</systemitem> para fornecer sincronização de horário precisa aos clientes PXE durante as instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. A sincronização de horário apropriada é essencial para validação de certificados e registro do sistema durante as instalações baseadas em rede.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-configure-ntp-intro">
      <title>Introdução</title>
      <para>
      Os serviços NTP garantem a sincronização de horário precisa em toda a infraestrutura de rede. Para ambientes de inicialização PXE, o horário sincronizado é crucial para validação de certificados durante conexões HTTPS, marcações de horário apropriadas dos registros e operações coordenadas do sistema. Esta seção apresenta a configuração básica do servidor NTP usando o <systemitem>chrony</systemitem>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>chrony</package> instalado
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>zypper install chrony</command>
          </screen>
        </listitem>
        <listitem>
          <para>
          Conectividade de rede com os servidores NTP upstream
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços NTP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-setup">
      <title>Configurando o serviço NTP <systemitem>chrony</systemitem></title>
      <para>
      O serviço de <systemitem>chrony</systemitem> oferece a funcionalidade NTP com sincronização automática de horário para servidores upstream e recursos de exibição de horário local para clientes de rede.
    </para>
      <procedure xml:id="proc-configure-chrony">
        <title>Configurando o servidor NTP do <systemitem>chrony</systemitem></title>
        <step>
          <para>
          Habilite e inicie o serviço <systemitem>chrony</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now chronyd.service</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-verify">
      <title>Verificando a configuração do NTP</title>
      <para>
      Teste a funcionalidade do serviço NTP para garantir que a sincronização de horário funcione corretamente.
    </para>
      <procedure xml:id="proc-verify-ntp">
        <title>Testando a funcionalidade do servidor NTP</title>
        <step>
          <para>
          Verifique o status do serviço <systemitem>chrony</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd.service</command>
          </screen>
        </step>
        <step>
          <para>
          Veja o status da sincronização de horário atual:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc tracking</command>
          </screen>
        </step>
        <step>
          <para>
          Liste as fontes de NTP configuradas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sources</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique as estatísticas do servidor NTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>chronyc sourcestats</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-troubleshooting">
      <title>Solucionando problemas da configuração do NTP</title>
      <para>
      Problemas comuns ao configurar o <systemitem>chrony</systemitem> para serviços NTP em ambientes PXE.
    </para>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-service">
        <title>Problemas de inicialização do serviço</title>
        <para>Pode haver falha para iniciar o serviço <systemitem>chrony</systemitem> devido a erros de configuração ou problemas de conectividade de rede.
      </para>
        <procedure xml:id="proc-debug-ntp-service">
          <title>Resolvendo problemas do serviço NTP</title>
          <step>
            <para>
            Verifique o status e os registros do serviço <systemitem>chrony</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status chronyd.service</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros detalhados do serviço:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u chronyd.service -f</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a configuração do <systemitem>chrony</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyd -Q</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie os serviços, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart chronyd.service</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-sync">
        <title>Falhas de sincronização de horário</title>
        <para>
        Pode haver falha na sincronização de horário devido a problemas de rede ou à configuração incorreta do servidor.
      </para>
        <procedure xml:id="proc-debug-ntp-sync">
          <title>Diagnosticando problemas de sincronização de horário</title>
          <step>
            <para>
            Verifique o status da sincronização atual:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc tracking</command>
            </screen>
          </step>
          <step>
            <para>
            Veja a conectividade da fonte de NTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc sources -v</command>
            </screen>
          </step>
          <step>
            <para>
            Force a sincronização imediata:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>chronyc makestep</command>
            </screen>
          </step>
          <step>
            <para>
            Compare o horário do sistema com o relógio do hardware:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>timedatectl status</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a conectividade de rede com os servidores NTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>chronyc activity</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ntp-troubleshoot-firewall">
        <title>Problemas de firewall e rede</title>
        <para>
        As regras de firewall podem bloquear o tráfego NTP, impedindo a sincronização de horário.
      </para>
        <procedure xml:id="proc-debug-ntp-firewall">
          <title>Resolvendo a conectividade de rede NTP</title>
          <step>
            <para>
            Verifique se a porta NTP está aberta no firewall:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-services | grep ntp</command>
            </screen>
          </step>
          <step>
            <para>
            Adicione o serviço NTP ao firewall, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --permanent --add-service=ntp</command>
            </screen>
          </step>
          <step>
            <para>
            Recarregue a configuração do firewall:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>firewall-cmd --reload</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a conectividade NTP manualmente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ntpdate -q pool.ntp.org</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o uso da porta do <systemitem>chrony</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :123</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-configure-ntp-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com os serviços NTP configurados, o servidor PXE e os clientes mantêm a sincronização de horário precisa. Isso garante a validação apropriada de certificados e operações coordenadas do sistema durante instalações baseadas em rede.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-ipv6-router">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando o anúncio do roteador IPv6</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção descreve como configurar a funcionalidade de anúncio do roteador IPv6 para fornecer anúncios do roteador adequados aos clientes PXE. O RA IPv6 habilita a configuração do roteamento IPv6 e a configuração automática de endereço DHCPv6 com informações de estado para as instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-ipv6-router-intro">
      <title>Introdução</title>
      <para>
      O anúncio do roteador (RA, Router Advertisement) IPv6 fornece informações essenciais da configuração de rede aos clientes PXE, incluindo roteamento IPv6 e definições automática de configuração de endereço DHCPv6. Esta seção considera que um roteador IPv6 está configurado para fornecer anúncios do roteador adequados para configurar o roteamento IPv6 para a rede e a rota padrão e para habilitar a configuração automática de endereço DHCPv6 com informações de estado usando <literal>AdvManagedFlag on</literal>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>radvd</package> instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Configuração de rede IPv6 na interface do servidor
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços de anúncio do roteador
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-setup">
      <title>Configurando o <systemitem>radvd</systemitem> para anúncio do roteador IPv6</title>
      <para>
      O serviço <systemitem>radvd</systemitem> oferece a funcionalidade de anúncio do roteador IPv6 com base na configuração definida em <filename>/etc/radvd.conf</filename>.
    </para>
      <procedure xml:id="proc-configure-radvd">
        <title>Configurando o anúncio do roteador IPv6 de <systemitem>radvd</systemitem></title>
        <step>
          <para>
          Configure o serviço <systemitem>radvd</systemitem>:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/radvd.conf &lt;&lt; 'EOF'</command>
interface eno1
{
    # radvd options
    IgnoreIfMissing on;                 # Do not fail and exit when interface is missed
    AdvSendAdvert on;                   # Sending RAs on the interface is not disabled

    # Configuration settings

    AdvManagedFlag on;                  # Request IPv6 address and dns options via DHCPv6
    AdvOtherConfigFlag off;             # Request only dns info via DHCPv6, IP via SLAAC

    AdvDefaultLifetime 1800;            # Add default route via this router for 1800sec

    prefix 2001:db8:0:1::/64            # Add direct route for this local network/prefix
    {
        AdvAutonomous           off;    # Assign IPv6 address via SLAAC
        AdvValidLifetime        7200;
        AdvPreferredLifetime    3600;
    };
};
EOF
</screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço <systemitem>radvd</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now radvd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-verify">
      <title>Verificando o anúncio do roteador IPv6</title>
      <para>
      Teste a funcionalidade RA do IPv6 RA para garantir configuração e operação apropriadas.
    </para>
      <procedure xml:id="proc-verify-radvd">
        <title>Testando o anúncio do roteador IPv6</title>
        <step>
          <para>
          Verifique o status do serviço <systemitem>radvd</systemitem>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
        </step>
        <step>
          <para>
          Revise e verifique as configurações de RA do IPv6 usando o <command>ravdump</command>:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>radvdump</command>
          </screen>
          <para>
          O utilitário <command>radvdump</command> exibe as configurações de RA do IPv6 enviadas pelo roteador IPv6 a cada poucos minutos.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-forwarding">
      <title>Configurando o encaminhamento de IP para a funcionalidade do roteador</title>
      <para>
      Se o servidor PXE também atua como roteador, o encaminhamento de IP deve ser habilitado para permitir que o sistema funcione na função de roteador.
    </para>
      <procedure xml:id="proc-enable-ip-forwarding">
        <title>Habilitando o encaminhamento de IP no servidor PXE</title>
        <step>
          <para>
          Crie o arquivo de configuração de rede:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/sysctl.d/90-network.conf &lt;&lt; 'EOF'</command>
# This machine is a router
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Accept host autoconf on router uplink
net.ipv6.conf.uplink.accept_ra = 2
EOF
</screen>
        </step>
        <step>
          <para>
          Aplique as configurações de rede:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
          </screen>
        </step>
      </procedure>
      <note>
        <title>Considerações sobre a configuração do roteador</title>
        <para>
        Por padrão, um roteador não processa RAs do IPv6 para configuração automática de host. Para aceitar RA do IPv6 em uma interface uplink do roteador, é necessária a configuração do sysctl <literal>accept_ra = 2</literal>. Consulte a seção Configuração de rede na Guia de Administração para obter mais detalhes sobre a configuração do roteador, incluindo ajustes de firewall e outras etapas necessárias.
      </para>
      </note>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-troubleshooting">
      <title>Solucionando problemas de anúncio do roteador IPv6</title>
      <para>
      Problemas comuns ao configurar o anúncio do roteador IPv6 para ambientes PXE.
    </para>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-service">
        <title>Problemas do serviço <systemitem>radvd</systemitem></title>
        <para>
        Pode haver falha para iniciar o serviço <systemitem>radvd</systemitem> devido a erros de configuração ou problemas de interface.
      </para>
        <procedure xml:id="proc-debug-radvd-service">
          <title>Resolvendo problemas do serviço <systemitem>radvd</systemitem></title>
          <step>
            <para>
            Verifique o status e os registros do serviço <systemitem>radvd</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros detalhados do serviço:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u radvd -f</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a sintaxe de configuração do <systemitem>radvd</systemitem>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>radvd -C /etc/radvd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se a interface especificada existe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip link show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie o serviço depois de corrigir a configuração:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart radvd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-forwarding">
        <title>Problemas de configuração do encaminhamento de IP</title>
        <para>
        Configurações de encaminhamento de IP incorretas podem impedir a funcionalidade adequada do roteador.
      </para>
        <procedure xml:id="proc-debug-ip-forwarding">
          <title>Diagnosticando problemas de encaminhamento de IP</title>
          <step>
            <para>
            Verifique o status atual do encaminhamento de IP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv4.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status do encaminhamento de IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.all.forwarding</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o arquivo de configuração do sysctl:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Aplique a configuração se os valores estiverem incorretos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sysctl -p /etc/sysctl.d/90-network.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração de accept_ra na interface uplink:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sysctl net.ipv6.conf.uplink.accept_ra</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-ipv6-troubleshoot-ra">
        <title>Problemas de recebimento de anúncios do roteador</title>
        <para>
        Os clientes podem não receber ou processar corretamente os anúncios do roteador IPv6.
      </para>
        <procedure xml:id="proc-debug-ra-reception">
          <title>Solucionando problemas de recebimento de RA</title>
          <step>
            <para>
            Monitore os anúncios do roteador usando o <command>ravdump</command>:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>radvdump -d</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração da interface IPv6 nos clientes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 addr show</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a tabela de roteamento de IPv6 nos clientes:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip -6 route show</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a conectividade do IPv6 com o roteador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::1</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique as regras de firewall para ICMPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>firewall-cmd --list-protocols | grep ipv6-icmp</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-ipv6-router-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com o anúncio do roteador IPv6 configurado, os clientes PXE pode receber uma configuração de rede IPv6 adequada. Isso habilita a funcionalidade DHCPv6 e a conectividade IPv6 nas instalações baseadas em rede.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-dhcp-dnsmasq">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando um servidor DHCP com o dnsmasq</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar os serviços DHCP com o dnsmasq para fornecer informações de configuração de rede e inicialização PXE às instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. O servidor DHCP dnsmasq usa uma configuração baseada em tags para suportar clientes PXE tanto IPv4 quanto IPv6 com recursos de inicialização UEFI e BIOS.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-intro">
      <title>Introdução</title>
      <para>
      O servidor DHCP dnsmasq fornece as informações de configuração de rede e de arquivo de inicialização aos clientes PXE usando um sistema baseado em tags para corresponder os tipos de cliente e fornecer os carregadores de boot apropriados. Essa configuração suporta ambas as correspondências de PXEClient e HTTPClient que funcionam para DHCPv4 e DHCPv6, o que permite a inicialização por sistemas UEFI e BIOS em várias arquiteturas.
    </para>
      <important>
        <title>Limitações do HTTPClient no dnsmasq</title>
        <para>
        O dnsmasq versão 2.90 e anterior não suporta o envio da opção de classe de fornecedor 6:16 de volta aos clientes DHCPv6 para configurações de HTTPClient. Para suporte completo do HTTPClient, considere usar os servidores DHCP Kea ou ISC.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          O pacote <package>dnsmasq</package> instalado
        </para>
        </listitem>
        <listitem>
          <para>
          Arquivos de inicialização PXE devidamente organizados em <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interface de rede configurada para o serviço DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-setup">
      <title>Configurando serviços DHCP do dnsmasq</title>
      <para>
      A configuração do DHCP dnsmasq inclui a correspondência de tipos de cliente, os intervalos de rede e as atribuições de arquivos de inicialização para ambas as redes IPv4 e IPv6.
    </para>
      <procedure xml:id="proc-configure-dnsmasq-dhcp">
        <title>Configurando o servidor DHCP do dnsmasq</title>
        <step>
          <para>
          Crie o arquivo de configuração de DHCP para o dnsmasq:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>
# DHCP configuration file for dnsmasq

# Log DHCP processing
log-dhcp

# This is the only DHCP server, don't ignore unknown clients/send NAK
dhcp-authoritative

# Disable re-use of the DHCPv4 servername and filename fields as extra
# option space, which may confuse old or broken clients
dhcp-no-override

# IPv4 PXE/HTTP boot client matches (no enterprise number)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,HTTPClient:Arch:00019

# IPv6 PXE/HTTP boot client matches (enterprise:343 intel)
# Match client type in PXEClient:Arch and map to a tag
dhcp-vendorclass=set:tftp_bios_x86_pc,enterprise:343,PXEClient:Arch:00000
dhcp-vendorclass=set:tftp_uefi_x86_64,enterprise:343,PXEClient:Arch:00007
dhcp-vendorclass=set:tftp_ieee_ppc_64,enterprise:343,PXEClient:Arch:0000e
dhcp-vendorclass=set:tftp_uefi_arm_64,enterprise:343,PXEClient:Arch:00011
# Match client type in HTTPClient:Arch and map to a tag
dhcp-vendorclass=set:http_uefi_x86_64,enterprise:343,HTTPClient:Arch:00016
dhcp-vendorclass=set:http_uefi_arm_64,enterprise:343,HTTPClient:Arch:00019
EOF
</screen>
        </step>
        <step>
          <para>
          Configure o intervalo e as opções de DHCP IPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 range and options
dhcp-range=set:net0v4,192.168.1.100,192.168.1.199,255.255.255.0,1h
dhcp-option=tag:net0v4,option:domain-search,example.net
dhcp-option=tag:net0v4,option:dns-server,192.168.1.200
dhcp-option=tag:net0v4,option:ntp-server,192.168.1.1
dhcp-option=tag:net0v4,option:router,192.168.1.1
EOF
</screen>
        </step>
        <step>
          <para>
          Configure as opções de inicialização PXE de IPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv4 PXEClient boot
dhcp-boot=tag:net0v4,tag:tftp_bios_x86_pc,/boot/grub2/i386-pc/core.0,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_x86_64,/boot/grub2/x86_64-efi/bootx64.efi,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_ieee_ppc_64,/boot/grub2/powerpc-ieee1275/core.elf,192.168.1.200
dhcp-boot=tag:net0v4,tag:tftp_uefi_arm_64,/boot/grub2/arm64-efi/bootaa64.efi,192.168.1.200

# IPv4 HTTPClient boot
dhcp-option-force=tag:net0v4,tag:http_uefi_x86_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_x86_64,http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option-force=tag:net0v4,tag:http_uefi_arm_64,option:vendor-class,HTTPClient
dhcp-boot=tag:net0v4,tag:http_uefi_arm_64,http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi
EOF
</screen>
        </step>
        <step>
          <para>
          Configure o intervalo e as opções de DHCP IPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 range and options
dhcp-range=set:net0v6,2001:db8:0:1:d::,2001:db8:0:1:d::ffff,64,1h
dhcp-option=tag:net0v6,option6:domain-search,example.net
dhcp-option=tag:net0v6,option6:dns-server,[2001:db8:0:1::200]
dhcp-option=tag:net0v6,option6:sntp-server,[2001:db8:0:1::1]
EOF
</screen>
        </step>
        <step>
          <para>
          Configure as opções de inicialização PXE de IPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt;&gt; /etc/dnsmasq.d/dhcp.conf &lt;&lt; 'EOF'</command>

# IPv6 PXEClient boot
dhcp-option=tag:net0v6,tag:tftp_bios_x86_pc,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0
dhcp-option=tag:net0v6,tag:tftp_uefi_x86_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi
dhcp-option=tag:net0v6,tag:tftp_ieee_ppc_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf
dhcp-option=tag:net0v6,tag:tftp_uefi_arm_64,option6:bootfile-url,tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi

# IPv6 HTTPClient boot
# Note: dnsmasq &lt;= 2.90 does not support sending vendor-class option6:16 back to client
EOF
</screen>
        </step>
        <step>
          <para>
          Teste a configuração do dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dnsmasq --test</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dnsmasq</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-verify">
      <title>Verificando a configuração da DHCP</title>
      <para>
      Teste a funcionalidade do servidor DHCP para garantir a configuração de rede e a entrega de arquivos de inicialização apropriadas para os clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-dnsmasq">
        <title>Testando o servidor DHCP dnsmasq</title>
        <step>
          <para>
          Verifique o status do serviço dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique a vinculação da porta DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep :67</command>
          </screen>
        </step>
        <step>
          <para>
          Monitore as atribuições de concessão DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique as concessões DHCP ativas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshooting">
      <title>Solucionando problemas da configuração do DHCP dnsmasq</title>
      <para>
      Problemas comuns ao configurar o dnsmasq para serviços DHCP em ambientes PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-service">
        <title>Problemas de inicialização e configuração de serviço</title>
        <para>
        O dnsmasq pode falhar ao ser iniciado devido a erros de configuração ou conflitos de porta com outros serviços DHCP.
      </para>
        <procedure xml:id="proc-debug-dnsmasq-dhcp-service">
          <title>Resolvendo problemas do serviço DHCP dnsmasq</title>
          <step>
            <para>
            Teste a sintaxe de configuração do dnsmasq:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dnsmasq --test</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se há conflitos de porta DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Pare os serviços DHCP em conflito:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros detalhados do serviço:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f</command>
            </screen>
          </step>
          <step>
            <para>
            Reinicie o dnsmasq depois de resolver os conflitos:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dnsmasq</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-leases">
        <title>Problemas de atribuição de concessão DHCP</title>
        <para>
        Os clientes podem não receber endereços IP devido a problemas de configuração de intervalos ou conectividade de rede.
      </para>
        <procedure xml:id="proc-debug-dhcp-leases">
          <title>Diagnosticando problemas de concessão DHCP</title>
          <step>
            <para>
            Verifique a configuração de intervalos do DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-range /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore as solicitações DHCP em tempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq -f | grep DHCP</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status da interface de rede:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração de autorização do DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-authoritative /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a resposta do DHCP com dhcping:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-pxe">
        <title>Problemas na entrega de arquivos de inicialização PXE</title>
        <para>
        Os clientes PXE podem receber endereços IP, mas não podem ser inicializados devido à configuração incorreta do arquivo de inicialização ou a problemas de correspondência de tipo de cliente.
      </para>
        <procedure xml:id="proc-debug-pxe-boot">
          <title>Solucionando problemas de configuração da inicialização PXE</title>
          <step>
            <para>
            Verifique a correspondência de classe do fornecedor do cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-vendorclass /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique os caminhos dos arquivos de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep dhcp-boot /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste o acesso por TFTP aos arquivos de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore os registros do DHCP específicos do PXE:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep -E "PXE|HTTP"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a atribuição de tags nos registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "tags:"</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-dnsmasq-troubleshoot-ipv6">
        <title>Problemas na configuração do DHCP IPv6</title>
        <para>
        Os clientes DHCP IPv6 exigem a configuração apropriada do anúncio do roteador e podem ter requisitos de endereçamento diferentes do IPv4.
      </para>
        <procedure xml:id="proc-debug-ipv6-dhcp">
          <title>Resolvendo problemas do DHCP IPv6</title>
          <step>
            <para>
            Verifique a configuração de intervalos do DHCP IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "2001:db8" /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status do anúncio do roteador IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore as solicitações DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dnsmasq | grep "DHCPv6"</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a conectividade do IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração da opção IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep option6 /etc/dnsmasq.d/dhcp.conf</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-dnsmasq-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com os serviços DHCP dnsmasq configurados, os clientes PXE podem receber informações de configuração de rede e de arquivos de inicialização para os ambientes tanto IPv4 quanto IPv6. O sistema baseado em tags oferece atribuição flexível de arquivos de inicialização com base na arquitetura do cliente e nos requisitos do método de inicialização.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-dhcp-kea">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando um servidor DHCP com o Kea</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar os serviços DHCP com o Kea para fornecer informações de configuração de rede e inicialização PXE às instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Kea é um servidor DHCP moderno que suporta IPv4 e IPv6 com correspondência de classe do cliente para cenários de inicialização PXE e HTTP.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-kea-intro">
      <title>Introdução</title>
      <para>
      Kea é o servidor DHCP moderno desenvolvido pela ISC como sucessor do servidor ISC DHCP antigo. Ele oferece suporte avançado para DHCPv4 e DHCPv6 com recursos de classificação de cliente que permitem a entrega apropriada de arquivos de inicialização com base na arquitetura do cliente e no método de inicialização. O Kea usa os arquivos de configuração baseados em JSON e suporta recursos avançados, como identificação de classe de fornecedor para inicialização HTTP.
    </para>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Pacotes Kea DHCP instalados: <package>kea-dhcp4</package> e <package>kea-dhcp6</package>
        </para>
        </listitem>
        <listitem>
          <para>
          Arquivos de inicialização PXE devidamente organizados em <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interface de rede configurada para o serviço DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv4">
      <title>Configurando o servidor Kea DHCPv4</title>
      <para>
      A configuração do Kea DHCPv4 usa as classes de cliente para corresponder os tipos de cliente PXE e HTTP e fornecer os arquivos de inicialização apropriados para diferentes arquiteturas.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv4">
        <title>Configurando o servidor Kea DHCPv4</title>
        <step>
          <para>
          Configure o servidor Kea DHCPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp4.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea4-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp4.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 3150,
    "valid-lifetime": 3600,
    "option-data": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00000'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/i386-pc/core.0"
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00007'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/x86_64-efi/bootx64.efi"
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:0000e'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/powerpc-ieee1275/core.elf"
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[60].hex,0,20) == 'PXEClient:Arch:00011'",
        "next-server": "192.168.1.200",
        "boot-file-name": "/boot/grub2/arm64-efi/bootaa64.efi"
      },
      {
        "name": "httpclients#00016",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00016'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      },
      {
        "name": "httpclients#00019",
        "test": "substring(option[60].hex,0,21) == 'HTTPClient:Arch:00019'",
        "boot-file-name": "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi",
        "option-data": [
          {
            "name": "vendor-class-identifier",
            "data": "HTTPClient"
          }
        ]
      }
    ],
    "subnet4": [
      {
        "id": 1,
        "subnet": "192.168.1.0/24",
        "pools": [
          {
            "pool": "192.168.1.100 - 192.168.1.199"
          }
        ],
        "option-data": [
          {
            "name": "routers",
            "data": "192.168.1.1"
          },
          {
            "name": "ntp-servers",
            "data": "192.168.1.1"
          },
          {
            "name": "domain-name-servers",
            "data": "192.168.1.200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp4",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp4.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Crie o diretório de registro do Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>mkdir -p /var/log/kea</command>
          </screen>
        </step>
        <step>
          <para>
          Teste a configuração do Kea DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço Kea DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp4</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-dhcpv6">
      <title>Configurando o servidor Kea DHCPv6</title>
      <para>
      A configuração do Kea DHCPv6 fornece atribuição de endereços IPv6 e informações de arquivos de inicialização usando a correspondência de classe de fornecedor para diferentes arquiteturas de cliente.
    </para>
      <procedure xml:id="proc-configure-kea-dhcpv6">
        <title>Configurando o servidor Kea DHCPv6</title>
        <step>
          <para>
          Configure o servidor Kea DHCPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/kea/kea-dhcp6.conf &lt;&lt; 'EOF'</command>
{
  "Dhcp6": {
    "interfaces-config": {
      "interfaces": [
        "eno1"
      ]
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea6-ctrl-socket"
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp6.leases",
      "lfc-interval": 3600
    },
    "expired-leases-processing": {
      "reclaim-timer-wait-time": 10,
      "flush-reclaimed-timer-wait-time": 25,
      "hold-reclaimed-time": 3600,
      "max-reclaim-leases": 100,
      "max-reclaim-time": 250,
      "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1800,
    "rebind-timer": 2880,
    "preferred-lifetime": 3600,
    "valid-lifetime": 7200,
    "option-data": [],
    "option-def": [],
    "client-classes": [
      {
        "name": "pxeclients#00000",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00000'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0"
          }
        ]
      },
      {
        "name": "pxeclients#00007",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00007'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi"
          }
        ]
      },
      {
        "name": "pxeclients#0000e",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:0000e'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf"
          }
        ]
      },
      {
        "name": "pxeclients#00011",
        "test": "substring(option[16].hex,6,20) == 'PXEClient:Arch:00011'",
        "option-data": [
          {
            "name": "bootfile-url",
            "data": "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi"
          }
        ]
      }
    ],
    "subnet6": [
      {
        "id": 1,
        "subnet": "2001:db8:0:1::/64",
        "interface": "eno1",
        "pools": [
          {
            "pool": "2001:db8:0:1:d::/112"
          }
        ],
        "option-data": [
          {
            "name": "sntp-servers",
            "data": "2001:db8:0:1::1"
          },
          {
            "name": "dns-servers",
            "data": "2001:db8:0:1::200"
          },
          {
            "name": "domain-search",
            "data": "example.net"
          }
        ],
        "reservations": []
      }
    ],
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output-options": [
          {
            "output": "/var/log/kea/dhcp6.log"
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ]
  }
}
EOF
</screen>
        </step>
        <step>
          <para>
          Teste a configuração do Kea DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço Kea DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now kea-dhcp6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-verify">
      <title>Verificando a configuração do Kea DHCP</title>
      <para>
      Teste a funcionalidade do servidor Kea DHCP para garantir a configuração de rede e a entrega de arquivos de inicialização apropriadas para os clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-kea">
        <title>Testando os servidores Kea DHCP</title>
        <step>
          <para>
          Verifique o status do serviço Kea DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique o status do serviço Kea DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp6</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique a vinculação da porta DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          Monitore os registros do DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp4.log</command>
          </screen>
        </step>
        <step>
          <para>
          Monitore os registros do DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tail -f /var/log/kea/dhcp6.log</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique as concessões DHCP ativas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-troubleshooting">
      <title>Solucionando problemas da configuração do Kea DHCP</title>
      <para>
      Problemas comuns ao configurar serviços Kea DHCP para ambientes de inicialização PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-config">
        <title>Problemas de configuração e serviço</title>
        <para>
        Pode haver falha para iniciar os serviços Kea devido a erros de configuração do JSON ou problemas de interface de rede.
      </para>
        <procedure xml:id="proc-debug-kea-config">
          <title>Resolvendo problemas da configuração do Kea</title>
          <step>
            <para>
            Teste a sintaxe de configuração do DHCPv4:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp4 -t /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a sintaxe de configuração do DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>kea-dhcp6 -t /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se há erros de sintaxe do JSON:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>python3 -m json.tool /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração da interface de rede:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique os registros do serviço Kea:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u kea-dhcp4 -f</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-leases">
        <title>Problemas de atribuição de concessão DHCP</title>
        <para>
        Os clientes podem não receber endereços IP devido a problemas de configuração de sub-rede ou esgotamento de pool.
      </para>
        <procedure xml:id="proc-debug-kea-leases">
          <title>Diagnosticando problemas de concessão do Kea</title>
          <step>
            <para>
            Verifique a configuração da sub-rede e do pool:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet4\|pools" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore as atribuições de concessão em tempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -E "ALLOC|DISCOVER"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se há conflitos no banco de dados de concessão:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /var/lib/kea/dhcp4.leases | tail -20</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a vinculação da interface:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep interfaces /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Limpe o banco de dados de concessão, se necessário:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl stop kea-dhcp4</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>mv /var/lib/kea/dhcp4.leases /var/lib/kea/dhcp4.leases.backup</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl start kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-pxe">
        <title>Problemas de correspondência de classe de cliente PXE</title>
        <para>
        Os clientes PXE podem receber endereços IP, mas não obtêm os arquivos de inicialização corretos devido a problemas de configuração da classe do cliente.
      </para>
        <procedure xml:id="proc-debug-kea-pxe">
          <title>Solucionando problemas de classificação do cliente Kea</title>
          <step>
            <para>
            Verifique as definições de classe de cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "client-classes" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore a correspondência de classe de cliente nos registros:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp4.log | grep -i class</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique os padrões do identificador de classe de cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "PXEClient\|HTTPClient" /etc/kea/kea-dhcp4.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a acessibilidade do arquivo de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite o registro de depuração para análise detalhada do cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i 's/"debuglevel": 0/"debuglevel": 99/' /etc/kea/kea-dhcp4.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart kea-dhcp4</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-kea-troubleshoot-ipv6">
        <title>Problemas específicos do DHCPv6</title>
        <para>
        Os clientes DHCP IPv6 exigem a configuração apropriada do anúncio do roteador e têm um gerenciamento de opções de classe de fornecedor diferente do IPv4.
      </para>
        <procedure xml:id="proc-debug-kea-ipv6">
          <title>Resolvendo problemas de DHCPv6 do Kea</title>
          <step>
            <para>
            Verifique a configuração da sub-rede DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet6" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status do anúncio do roteador IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore a correspondência de classe de fornecedor do DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/kea/dhcp6.log | grep "option\[16\]"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o formato da opção bootfile-url IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/kea/kea-dhcp6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a conectividade do IPv6 com o servidor de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-kea-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com os serviços DHCP Kea configurados, os clientes PXE podem receber informações abrangentes de configuração de rede e de arquivos de inicialização para os ambientes tanto IPv4 quanto IPv6. O sistema de classificação de cliente fornece atribuição precisa de arquivos de inicialização com base na arquitetura do cliente e suporta os métodos de inicialização PXE tradicionais e HTTP modernos.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-dhcp-isc">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Configurando um servidor DHCP com o ISC DHCP</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção explica como configurar o servidor ISC DHCP para fornecer informações de configuração de rede e inicialização PXE às instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> 15. O pacote dhcp-server da ISC não está mais disponível no <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. O ISC DHCP usa a correspondência de classe e subclasse para suportar cenários de inicialização PXE e HTTP em diferentes arquiteturas de cliente.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-dhcp-isc-intro">
      <title>Introdução</title>
      <para>
      O ISC DHCP é o servidor DHCP tradicional que fornece informações de configuração de rede e arquivo de inicialização para clientes PXE usando um sistema de classe e subclasse. A ISC anunciou o fim do serviço desse servidor a partir de 2022, mas ele ainda é amplamente utilizado nas implantações existentes e oferece suporte robusto a cenários de inicialização PXE e HTTP com identificação de classe de fornecedor.
    </para>
      <important>
        <title>Status de fim do serviço do ISC DHCP</title>
        <para>
        O fim do serviço do ISC DHCP foi anunciado pela ISC em 2022. Para novas implantações, considere usar o Kea ou dnsmasq em vez dele. Esta configuração é fornecida para compatibilidade com as instalações existentes do ISC DHCP.
      </para>
      </important>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Pacotes ISC DHCP instalados: <package>dhcp-server</package>
        </para>
        </listitem>
        <listitem>
          <para>
          Arquivos de inicialização PXE devidamente organizados em <filename>/srv/tftpboot</filename>
        </para>
        </listitem>
        <listitem>
          <para>
          Interface de rede configurada para o serviço DHCP
        </para>
        </listitem>
        <listitem>
          <para>
          Privilégios administrativos para configurar os serviços DHCP
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv4">
      <title>Configurando o servidor ISC DHCPv4</title>
      <para>
      A configuração do ISC DHCPv4 usa as declarações de classe e subclasse para corresponder os tipos de cliente PXE e HTTP e fornecer os arquivos de inicialização apropriados para diferentes arquiteturas.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv4">
        <title>Configurando o servidor ISC DHCPv4</title>
        <step>
          <para>
          Configure o servidor ISC DHCPv4:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first read
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
#
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# default lease time
default-lease-time              3600;
max-lease-time                  7200;

##
## PXE / HTTP boot option declarations
##
class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        match substring (option vendor-class-identifier, 0, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        match substring (option vendor-class-identifier, 0, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        next-server     192.168.1.200;
        filename        "/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option vendor-class-identifier "HTTPClient";
        filename        "http://192.168.1.200/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet 192.168.1.0 netmask 255.255.255.0 {
        authoritative;

        range  dynamic-bootp            192.168.1.100 192.168.1.199;

        option subnet-mask              255.255.255.0;

        option routers                  192.168.1.1;
        option ntp-servers              192.168.1.1;
        option domain-name-servers      192.168.1.200;
        option domain-name              "example.net";
        option domain-search            "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configure a interface DHCP no sysconfig:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD_INTERFACE="eno1"' &gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Teste a configuração do DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -t -cf /etc/dhcpd.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço ISC DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-dhcpv6">
      <title>Configurando o servidor ISC DHCPv6</title>
      <para>
      A configuração do ISC DHCPv6 fornece atribuição de endereços IPv6 e informações de arquivos de inicialização usando a correspondência de classe de fornecedor para o gerenciamento adequado da opção DHCPv6.
    </para>
      <procedure xml:id="proc-configure-isc-dhcpv6">
        <title>Configurando o servidor ISC DHCPv6</title>
        <step>
          <para>
          Configure o servidor ISC DHCPv6:
        </para>
          <screen><prompt>&gt; </prompt><command>sudo</command><command>cat &gt; /etc/dhcpd6.conf &lt;&lt; 'EOF'</command>
# /etc/dhcpd6.conf
#
# Sample DHCPv6 configuration file for ISC dhcpd
#
# *** PLEASE CONFIGURE IT FIRST ***
#
# Don't forget to set the DHCPD6_INTERFACE in the
# /etc/sysconfig/dhcpd file.
#

# if you want to use dynamical DNS updates, you should first
# read /usr/share/doc/packages/dhcp-server/DDNS-howto.txt
ddns-updates off;

# Use this to enable / disable dynamic dns updates globally.
ddns-update-style none;

# IPv6 address valid lifetime
#  (at the end the address is no longer usable by the client)
#  (set to 30 days, the usual IPv6 default)
default-lease-time 7200;

# IPv6 address preferred lifetime
#  (at the end the address is deprecated, i.e., the client should use
#   other addresses for new connections)
#  (set to 7 days, the	usual IPv6 default)
preferred-lifetime 3600;

##
## PXE / HTTP boot option declarations
##

# The dhcp6 option 16 is in fact an:
#   { uint32 enterprise-number, array of { uint16 len, string tag} vendor-class-data }
# this declaration is using the whole option data as string for substring match:
option dhcp6.vendor-class-as-string code 16 = string;

# this declaration is using the enterprise-number with 1st tag length and string:
option dhcp6.vendor-class-en-len-tag code 16 = {integer 32, integer 16, string};

class "pxeclients" {
        # PXEClient:Arch:00000:UNDI:002001
        # note: +6 to skip the enterprise-number+len until the PXEClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 20);
}
class "httpclients" {
        # HTTPClient:Arch:00016:UNDI:003001
        # note: +6 to skip the enterprise-number+len until the HTTPClient string
        match substring (option dhcp6.vendor-class-as-string, 6, 21);
}

##
## PXE / HTTP boot subclass request matches
##
subclass "pxeclients"   "PXEClient:Arch:00000" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/i386-pc/core.0";
}
subclass "pxeclients"   "PXEClient:Arch:00007" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "pxeclients"   "PXEClient:Arch:0000e" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/powerpc-ieee1275/core.elf";
}
subclass "pxeclients"   "PXEClient:Arch:00011" {
        option dhcp6.bootfile-url "tftp://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

subclass "httpclients"  "HTTPClient:Arch:00016" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/x86_64-efi/bootx64.efi";
}
subclass "httpclients"  "HTTPClient:Arch:00019" {
        option dhcp6.vendor-class-en-len-tag 343 10 "HTTPClient";
        option dhcp6.bootfile-url "http://[2001:db8:0:1::200]/boot/grub2/arm64-efi/bootaa64.efi";
}

##
## Subnet declaration for the pxe network
##
subnet6 2001:db8:0:1::/64 {
       authoritative;

       range6  2001:db8:0:1:d:: 2001:db8:0:1:d::ffff;

       option dhcp6.sntp-servers       2001:db8:0:1::1;
       option dhcp6.name-servers       2001:db8:0:1::200;
       option dhcp6.domain-search      "example.net";
}
EOF
</screen>
        </step>
        <step>
          <para>
          Configure a interface DHCPv6 no sysconfig:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>echo 'DHCPD6_INTERFACE="eno1"' &gt;&gt; /etc/sysconfig/dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Teste a configuração do DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
          </screen>
        </step>
        <step>
          <para>
          Habilite e inicie o serviço ISC DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>sudo</command>
            <command>systemctl enable --now dhcpd6</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-verify">
      <title>Verificando a configuração do ISC DHCP</title>
      <para>
      Teste a funcionalidade do servidor ISC DHCP para garantir a configuração de rede e a entrega de arquivos de inicialização apropriadas para os clientes PXE.
    </para>
      <procedure xml:id="proc-verify-dhcp-isc">
        <title>Testando os servidores ISC DHCP</title>
        <step>
          <para>
          Verifique o status do serviço ISC DHCPv4:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique o status do serviço ISC DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd6</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique a vinculação da porta DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
        </step>
        <step>
          <para>
          Monitore os registros do DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
        </step>
        <step>
          <para>
          Verifique as concessões DHCP ativas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
        </step>
        <step>
          <para>
          Monitore as atividades do DHCPv6:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd6 -f</command>
          </screen>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-troubleshooting">
      <title>Solucionando problemas da configuração do ISC DHCP</title>
      <para>
      Problemas comuns ao configurar os servidores ISC DHCP para ambientes de inicialização PXE.
    </para>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-config">
        <title>Problemas de configuração e serviço</title>
        <para>
        Pode haver falha para iniciar os serviços ISC DHCP devido a erros na sintaxe de configuração ou problemas de vinculação de interface.
      </para>
        <procedure xml:id="proc-debug-isc-config">
          <title>Resolvendo problemas da configuração do ISC DHCP</title>
          <step>
            <para>
            Teste a sintaxe de configuração do DHCPv4:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -t -cf /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a sintaxe de configuração do DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>dhcpd -6 -t -cf /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração da interface:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>cat /etc/sysconfig/dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o status da interface de rede:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se há conflitos de porta:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Veja os registros detalhados do serviço:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd -xe</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-leases">
        <title>Problemas de atribuição de concessão DHCP</title>
        <para>
        Os clientes podem não receber endereços IP devido a problemas de configuração de sub-rede ou autorização.
      </para>
        <procedure xml:id="proc-debug-isc-leases">
          <title>Diagnosticando problemas de concessão ISC DHCP</title>
          <step>
            <para>
            Verifique a configuração da sub-rede e do intervalo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 10 "subnet\|range" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a configuração de autorização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep authoritative /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore as atribuições de concessão em tempo real:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep dhcpd</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se há erros no banco de dados de concessão:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -20 /var/lib/dhcp/dhcpd.leases</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a resposta do DHCP manualmente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>dhcping -s 192.168.1.200 -h aa:bb:cc:dd:ee:ff</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-classes">
        <title>Problemas de correspondência de classe e subclasse</title>
        <para>
        Os clientes PXE podem receber endereços IP, mas não obtêm os arquivos de inicialização corretos devido a problemas de configuração de correspondência de classe.
      </para>
        <procedure xml:id="proc-debug-isc-classes">
          <title>Solucionando problemas da correspondência de classe do ISC DHCP</title>
          <step>
            <para>
            Verifique as definições de classe:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "class.*clients" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique as entradas de subclasse:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 5 "subclass" /etc/dhcpd.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore a identificação de classe de fornecedor:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tail -f /var/log/messages | grep -E "PXEClient|HTTPClient"</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a acessibilidade do arquivo de inicialização:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Habilite o registro detalhado:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>sed -i '1i\log-facility local7;' /etc/dhcpd.conf</command>
            </screen> <screen>
              <prompt>&gt; </prompt>
              <command>sudo</command>
              <command>systemctl restart dhcpd</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-dhcp-isc-troubleshoot-ipv6">
        <title>Problemas de opção de classe de fornecedor DHCPv6</title>
        <para>
        Os clientes DHCP IPv6 têm um gerenciamento de opções de classe de fornecedor complexo que pode exigir uma configuração específica para oferecer o suporte adequado à inicialização PXE.
      </para>
        <procedure xml:id="proc-debug-isc-ipv6">
          <title>Resolvendo problemas do ISC DHCPv6</title>
          <step>
            <para>
            Verifique as definições de opção do DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -A 3 "option dhcp6" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a análise de string de classe de fornecedor:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "substring.*6.*20\|21" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore a correspondência de classe de fornecedor do DHCPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd6 | grep -i vendor</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique o formato do bootfile-url IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "bootfile-url" /etc/dhcpd6.conf</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a dependência de anúncio do roteador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>systemctl status radvd</command>
            </screen>
          </step>
          <step>
            <para>
            Teste a conectividade do IPv6:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ping6 2001:db8:0:1::200</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-dhcp-isc-next-steps">
      <title>Próximas etapas</title>
      <para>
      Com os serviços ISC DHCP configurados, os clientes PXE podem receber informações de configuração de rede e arquivo de inicialização usando o sistema de classe e subclasse tradicional. O ISC DHCP chegou ao fim do serviço, mas esta configuração fornece compatibilidade com as implantações existentes que exigem a funcionalidade de inicialização PXE e HTTP em várias arquiteturas de cliente.
    </para>
    </section>
  </section>
  <section role="task" xml:lang="pt-br" version="5.2" xml:id="sles-pxe-server-validate">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">Validando a configuração do servidor PXE</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        Esta seção descreve como validar e testar a configuração completa do servidor PXE para garantir que todos os componentes estejam funcionando corretamente para as instalações de rede do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>. Ela aborda a verificação de serviço, o teste de conectividade de rede e a validação completa da inicialização PXE.
      </para>
      </abstract>
    </info>
    <section xml:id="sles-pxe-server-validate-intro">
      <title>Introdução</title>
      <para>
      Depois de configurar todos os componentes do servidor PXE, incluindo os serviços de carregador de boot TFTP, HTTP, DNS, DHCP e GRUB 2, é essencial validar o devido funcionamento de todo o sistema. Essa validação garante que os clientes PXE possam ser inicializados com êxito no instalador Agama e executar instalações baseadas em rede do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
    </section>
    <section xml:id="sles-pxe-server-validate-reqs">
      <title>Requisitos</title>
      <itemizedlist>
        <listitem>
          <para>
          Todos os componentes do servidor PXE configurados e em execução
        </para>
        </listitem>
        <listitem>
          <para>
          Sistemas de cliente de teste com capacidade para inicialização PXE
        </para>
        </listitem>
        <listitem>
          <para>
          Conectividade de rede entre o servidor PXE e os clientes
        </para>
        </listitem>
        <listitem>
          <para>
          Acesso administrativo para monitorar os serviços do servidor
        </para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sles-pxe-server-validate-services">
      <title>Validando os serviços do servidor PXE</title>
      <para>
      Verifique se todos os serviços essenciais do servidor PXE estão em execução e devidamente configurados antes de fazer o teste com os clientes PXE.
    </para>
      <procedure xml:id="proc-validate-services">
        <title>Verificando o status do serviço do servidor PXE</title>
        <step>
          <para>
          Verifique o status do serviço TFTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status tftp.socket</command>
          </screen>
          <para>
          Resultado esperado: O serviço deve estar ativo e escutar na porta 69.
        </para>
        </step>
        <step>
          <para>
          Verifique o serviço HTTP nginx:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status nginx</command>
          </screen>
          <para>
          Resultado esperado: O serviço deve estar ativo e escutar na porta 80.
        </para>
        </step>
        <step>
          <para>
          Verifique o serviço DNS (se usar o dnsmasq):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          Resultado esperado: O serviço deve estar ativo e escutar na porta 53.
        </para>
        </step>
        <step>
          <para>
          Verifique o status do serviço DHCP (escolha o serviço apropriado):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dhcpd</command>
          </screen>
          <para>
          Para DHCP dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status dnsmasq</command>
          </screen>
          <para>
          Para DHCP Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status kea-dhcp4 kea-dhcp6</command>
          </screen>
          <para>
          Resultado esperado: O serviço DHCP deve estar ativo e escutar nas portas apropriadas.
        </para>
        </step>
        <step>
          <para>
          Verifique o anúncio do roteador IPv6 (se configurado):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status radvd</command>
          </screen>
          <para>
          Resultado esperado: O serviço deve estar ativo para os ambientes IPv6.
        </para>
        </step>
        <step>
          <para>
          Verifique o serviço NTP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>systemctl status chronyd</command>
          </screen>
          <para>
          Resultado esperado: O serviço deve estar ativo e sincronizado.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-network">
      <title>Testando a conectividade de rede e o acesso a arquivos</title>
      <para>
      Valide que os clientes PXE podem acessar os arquivos de inicialização e o conteúdo da instalação pela rede usando ambos os protocolos TFTP e HTTP.
    </para>
      <procedure xml:id="proc-validate-network">
        <title>Testando o acesso aos arquivos de rede</title>
        <step>
          <para>
          Teste o acesso por TFTP aos arquivos do carregador de boot:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>tftp localhost -c get /boot/grub2/x86_64-efi/bootx64.efi /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          Verifique se o arquivo foi recuperado:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>file /tmp/test-bootx64.efi</command>
          </screen>
          <para>
          Limpe o arquivo de teste:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>rm /tmp/test-bootx64.efi</command>
          </screen>
        </step>
        <step>
          <para>
          Teste o acesso HTTP à configuração do GRUB 2:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/grub2/grub.cfg</command>
          </screen>
          <para>
          Resultado esperado: Resposta HTTP 200 OK.
        </para>
        </step>
        <step>
          <para>
          Verifique o acesso por HTTP aos arquivos do instalador:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl -I http://localhost/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
          </screen>
          <para>
          Resultado esperado: Resposta HTTP 200 OK com tamanho do conteúdo apropriado.
        </para>
        </step>
        <step>
          <para>
          Teste a resolução de DNS (se o DNS local estiver configurado):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>nslookup pxe.example.net localhost</command>
          </screen>
          <para>
          Resultado esperado: Resolução de registro adequada A e AAAA.
        </para>
        </step>
        <step>
          <para>
          Verifique a navegação de diretórios para os locais de autoindex:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>curl http://localhost/boot/</command>
          </screen>
          <para>
          Resultado esperado: Listagem de diretórios mostrando os arquivos de inicialização.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-dhcp">
      <title>Validando a funcionalidade do DHCP</title>
      <para>
      Teste as respostas do servidor DHCP e verifique se as informações de inicialização adequadas são fornecidas a diferentes tipos de cliente.
    </para>
      <procedure xml:id="proc-validate-dhcp">
        <title>Testando as respostas do servidor DHCP</title>
        <step>
          <para>
          Verifique a vinculação da porta DHCP:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>ss -ulnp | grep -E ":67|:547"</command>
          </screen>
          <para>
          Resultado esperado: Serviços DHCP que escutam nas portas 67 (IPv4) e 547 (IPv6).
        </para>
        </step>
        <step>
          <para>
          Monitore as solicitações DHCP em tempo real:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dhcpd -f</command>
          </screen>
          <para>
          Ou para dnsmasq:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -u dnsmasq -f</command>
          </screen>
          <para>
          Deixe-o em execução para observar a atividade do DHCP durante o teste.
        </para>
        </step>
        <step>
          <para>
          Teste a resposta do DHCP usando dhcping (se disponível):
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>dhcping -s 192.168.1.200</command>
          </screen>
          <para>
          Resultado esperado: Resposta do DHCP bem-sucedida do servidor.
        </para>
        </step>
        <step>
          <para>
          Verifique as concessões DHCP ativas:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/dhcp/dhcpd.leases</command>
          </screen>
          <para>
          Ou para Kea:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>cat /var/lib/kea/dhcp4.leases</command>
          </screen>
          <para>
          Resultado esperado: Entradas de concessão para clientes de teste.
        </para>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-pxe-boot">
      <title>Teste da inicialização PXE completo</title>
      <para>
      Faça testes completos da inicialização PXE com os sistemas de clientes reais para validar todo o processo de inicialização, do DHCP à inicialização do instalador Agama.
    </para>
      <procedure xml:id="proc-validate-pxe-boot">
        <title>Testando o processo de inicialização PXE completo</title>
        <step>
          <para>
          Prepare um sistema de cliente de teste:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Configurar BIOS/UEFI para habilitar inicialização de rede
            </para>
            </listitem>
            <listitem>
              <para>
              Definir a inicialização de rede como prioridade de primeira inicialização
            </para>
            </listitem>
            <listitem>
              <para>
              Conectar o cliente à mesma rede que o servidor PXE
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Monitore os registros do servidor PXE durante a inicialização do cliente:
        </para>
          <screen>
            <prompt>&gt; </prompt>
            <command>journalctl -f | grep -E "dhcp|tftp|nginx"</command>
          </screen>
        </step>
        <step>
          <para>
          Inicialize o cliente de teste e observe a seguinte sequência:
        </para>
          <orderedlist>
            <listitem>
              <para>
              O cliente deve receber o endereço IP por DHCP
            </para>
            </listitem>
            <listitem>
              <para>
              O cliente deve baixar o carregador de boot por TFTP
            </para>
            </listitem>
            <listitem>
              <para>
              O menu do GRUB 2 deve aparecer com as opções de instalação
            </para>
            </listitem>
            <listitem>
              <para>
              O kernel e o initrd devem ser carregados por HTTP
            </para>
            </listitem>
            <listitem>
              <para>
              O instalador Agama deve ser iniciado com êxito
            </para>
            </listitem>
          </orderedlist>
        </step>
        <step>
          <para>
          Verifique a detecção de arquitetura de cliente testando diferentes tipos de cliente:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Sistemas BIOS x86_64 antigos (deve obter core.0)
            </para>
            </listitem>
            <listitem>
              <para>
              Sistemas UEFI x86_64 (deve obter bootx64.efi)
            </para>
            </listitem>
            <listitem>
              <para>
              Sistemas UEFI aarch64 (deve obter boota64.efi)
            </para>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
          Teste a inicialização PXE do IPv6 (se o IPv6 estiver configurado):
        </para>
          <itemizedlist>
            <listitem>
              <para>
              Habilitar a configuração de rede somente IPv6 no cliente de teste
            </para>
            </listitem>
            <listitem>
              <para>
              Verificar a atribuição de endereços DHCPv6
            </para>
            </listitem>
            <listitem>
              <para>
              Confirmar a entrega do bootfile-url IPv6
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-installation">
      <title>Validando a funcionalidade do instalador Agama</title>
      <para>
      Verifique se o instalador Agama é iniciado corretamente e pode acessar as fontes de instalação para realizar as instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase>.
    </para>
      <procedure xml:id="proc-validate-agama">
        <title>Testando a inicialização do instalador Agama</title>
        <step>
          <para>
          Verifique a acessibilidade da interface da Web do Agama:
        </para>
          <para>
          Durante a inicialização do cliente, observe o endereço IP atribuído e o acesso:
        </para>
          <screen>http://<replaceable>CLIENT_IP_ADDRESS</replaceable></screen>
          <para>
          Resultado esperado: A interface da Web do Agama deve ser carregada com êxito.
        </para>
        </step>
        <step>
          <para>
          Verifique os registros do instalador Agama no cliente:
        </para>
          <para>
          Alterne para o console (Alt+F2) e execute:
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>journalctl -u agama-web-server -f</command>
          </screen>
          <para>
          Resultado esperado: Nenhum erro crítico na inicialização do Agama.
        </para>
        </step>
        <step>
          <para>
          Verifique a acessibilidade da fonte de instalação:
        </para>
          <para>
          Para instalações com ISO completa, verifique o acesso ao repositório:
        </para>
          <screen>
            <prompt role="root"># </prompt>
            <command>curl -I http://192.168.1.200/install/SLES-16.0/x86_64/</command>
          </screen>
          <para>
          Resultado esperado: Resposta HTTP 200 OK com a listagem de diretórios.
        </para>
        </step>
        <step>
          <para>
          Teste a capacidade de instalação do pacote:
        </para>
          <para>
          Na interface do Agama, verifique se:
        </para>
          <itemizedlist>
            <listitem>
              <para>
              O sistema pode detectar os discos disponíveis
            </para>
            </listitem>
            <listitem>
              <para>
              A configuração da rede está preservada
            </para>
            </listitem>
            <listitem>
              <para>
              O repositório de pacotes está acessível
            </para>
            </listitem>
            <listitem>
              <para>
              A instalação pode prosseguir até a conclusão
            </para>
            </listitem>
          </itemizedlist>
        </step>
      </procedure>
    </section>
    <section xml:id="sles-pxe-server-validate-troubleshooting">
      <title>Solução de problemas de falhas de validação</title>
      <para>
      Problemas comuns durante a validação do servidor PXE e as respectivas etapas de resolução.
    </para>
      <section xml:id="sles-pxe-server-validate-troubleshoot-dhcp">
        <title>Falhas de atribuição de DHCP</title>
        <para>
        Os clientes não recebem endereços IP durante a inicialização PXE.
      </para>
        <procedure xml:id="proc-troubleshoot-dhcp-validation">
          <title>Resolvendo problemas de validação de DHCP</title>
          <step>
            <para>
            Verifique os conflitos do serviço DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ss -ulnp | grep :67</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique se a interface de rede está em funcionamento:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ip addr show eno1</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a disponibilidade do intervalo DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>nmap -sn 192.168.1.100-199</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore possíveis erros nos registros do DHCP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u dhcpd | tail -50</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-boot">
        <title>Falhas na entrega dos arquivos de inicialização</title>
        <para>
        Os clientes recebem os endereços IP, mas não conseguem baixar os arquivos de inicialização.
      </para>
        <procedure xml:id="proc-troubleshoot-boot-validation">
          <title>Resolvendo problemas de arquivos de inicialização</title>
          <step>
            <para>
            Verifique a acessibilidade do serviço TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>tftp 192.168.1.200 -c get /boot/grub2/x86_64-efi/bootx64.efi</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique as permissões de arquivo:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>ls -la /srv/tftpboot/boot/grub2/x86_64-efi/</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore os registros de acesso por TFTP:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -u tftp.socket -f</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a detecção de arquitetura de cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep -E "PXEClient|HTTPClient" /var/log/messages</command>
            </screen>
          </step>
        </procedure>
      </section>
      <section xml:id="sles-pxe-server-validate-troubleshoot-installer">
        <title>Falhas na inicialização do instalador Agama</title>
        <para>
        Os arquivos de inicialização são carregados com êxito, mas o instalador Agama não é iniciado.
      </para>
        <procedure xml:id="proc-troubleshoot-installer-validation">
          <title>Resolvendo problemas de inicialização do Agama</title>
          <step>
            <para>
            Verifique o acesso por HTTP aos arquivos do instalador:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>curl -I http://192.168.1.200/boot/images/SLES-16.0/x86_64/liveiso/LiveOS/squashfs.img</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a sintaxe do parâmetro do kernel na configuração do GRUB 2:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>grep "root=live:" /srv/tftpboot/boot/grub2/menu.cfg</command>
            </screen>
          </step>
          <step>
            <para>
            Monitore o processo de inicialização do cliente:
          </para>
            <screen>
              <prompt>&gt; </prompt>
              <command>journalctl -f | grep -E "kernel|initrd|agama"</command>
            </screen>
          </step>
          <step>
            <para>
            Verifique a persistência da configuração de rede:
          </para>
            <screen>
              <prompt role="root"># </prompt>
              <command>ip addr show</command>
            </screen>
          </step>
        </procedure>
      </section>
    </section>
    <section xml:id="sles-pxe-server-validate-checklist">
      <title>Lista de verificação de validação do servidor PXE</title>
      <para>
      Use essa lista de verificação para conferir sistematicamente todos os aspectos da configuração do servidor PXE.
    </para>
      <table xml:id="table-pxe-validation-checklist">
        <title>Lista de verificação de validação do servidor PXE</title>
        <tgroup cols="3">
          <colspec colnum="1" colname="col1" colwidth="30*"/>
          <colspec colnum="2" colname="col2" colwidth="50*"/>
          <colspec colnum="3" colname="col3" colwidth="20*"/>
          <thead>
            <row>
              <entry>Componente</entry>
              <entry>Etapa de validação</entry>
              <entry>Status</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Serviço TFTP</entry>
              <entry>Serviço ativo, porta de escuta 69, arquivos acessíveis</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Serviço HTTP</entry>
              <entry>nginx ativo, porta de escuta 80, arquivos do instalador acessíveis</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Serviço DNS</entry>
              <entry>Resolução de nomes de host funcionando, porta de escuta 53</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Serviço DHCP</entry>
              <entry>Atribuição de IP funcionando, opções de inicialização entregues</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Configuração do GRUB 2</entry>
              <entry>Menu carregado, detecção de arquitetura funcionando</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Suporte ao IPv6</entry>
              <entry>Anúncio do roteador ativo, DHCPv6 funcionando</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Inicialização PXE</entry>
              <entry>Cliente inicializado com êxito, recebe o carregador de boot correto</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Instalador Agama</entry>
              <entry>Instalador iniciado, interface da Web acessível</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Fonte de instalação</entry>
              <entry>Repositório acessível, pacotes instaláveis</entry>
              <entry>☐</entry>
            </row>
            <row>
              <entry>Persistência da rede</entry>
              <entry>Configuração de rede mantida durante a instalação</entry>
              <entry>☐</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section xml:id="sles-pxe-server-validate-conclusion">
      <title>Conclusão da validação</title>
      <para>
      Um servidor PXE devidamente validado deve demonstrar a funcionalidade completa e bem-sucedida da inicialização de rede do cliente por meio da inicialização do instalador Agama. Todos os serviços devem funcionar sem erros, e os clientes podem concluir as instalações do <phrase><phrase os="sles;sles_ai">SUSE Linux Enterprise Server</phrase></phrase> <phrase><phrase os="sles">16.0</phrase></phrase> pela rede. Os testes de validação regulares garantem a confiabilidade contínua da infraestrutura do PXE para implantações automatizadas.
    </para>
    </section>
  </section>
  <section version="5.2" xml:id="legal-disclaimer">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">Informações legais</title>
    </info>
    <para> Copyright© 2006 – <?dbtimestamp format="Y"?> SUSE LLC e colaboradores. Todos os direitos reservados. </para>
    <para>
    Permissão concedida para copiar, distribuir e/ou modificar este documento sob os termos da Licença GNU de Documentação Livre, Versão 1.2 ou (por sua opção) versão 1.3; com a Seção Invariante sendo estas informações de copyright e a licença. Uma cópia da versão 1.2 da licença está incluída na seção intitulada <quote>GNU Free Documentation License</quote> (Licença GNU de Documentação Livre).
  </para>
    <para>
    Para saber as marcas registradas da SUSE, visite <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.suse.com/company/legal/"></link>. Todas as marcas comerciais de terceiros pertencem a seus respectivos proprietários. Os símbolos de marca registrada (®, ™ etc.) indicam marcas registradas da SUSE e de suas afiliadas. Os asteriscos (*) indicam marcas registradas de terceiros.
  </para>
    <para>
    Todas as informações deste manual foram compiladas com a maior atenção possível aos detalhes. Entretanto, isso não garante uma precisão absoluta. A SUSE LLC, suas afiliadas, os autores ou tradutores não serão responsáveis por possíveis erros nem pelas consequências resultantes de tais erros.
  </para>
  </section>
  <appendix xmlns:its="http://www.w3.org/2005/11/its" version="5.2" role="legal" its:translate="no" xml:id="doc-gfdl-license">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">GNU Free Documentation License</title>
    </info>
    <para>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </para>
    <bridgehead renderas="sect4">
    0. PREAMBLE
  </bridgehead>
    <para>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </para>
    <para>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </para>
    <para>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </para>
    <bridgehead renderas="sect4">
    1. APPLICABILITY AND DEFINITIONS
  </bridgehead>
    <para>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </para>
    <para>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </para>
    <para>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </para>
    <para>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </para>
    <para>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </para>
    <para>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </para>
    <para>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </para>
    <para>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </para>
    <para>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </para>
    <para>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </para>
    <bridgehead renderas="sect4">
    2. VERBATIM COPYING
  </bridgehead>
    <para>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </para>
    <para>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </para>
    <bridgehead renderas="sect4">
    3. COPYING IN QUANTITY
  </bridgehead>
    <para>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </para>
    <para>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </para>
    <para>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </para>
    <para>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </para>
    <bridgehead renderas="sect4">
    4. MODIFICATIONS
  </bridgehead>
    <para>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </para>
    <orderedlist numeration="upperalpha" spacing="normal">
      <listitem>
        <para>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </para>
      </listitem>
      <listitem>
        <para>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the copyright notices of the Document.
   </para>
      </listitem>
      <listitem>
        <para>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </para>
      </listitem>
      <listitem>
        <para>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </para>
      </listitem>
      <listitem>
        <para>
    Include an unaltered copy of this License.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </para>
      </listitem>
      <listitem>
        <para>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </para>
      </listitem>
      <listitem>
        <para>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </para>
      </listitem>
      <listitem>
        <para>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </para>
      </listitem>
      <listitem>
        <para>
    Preserve any Warranty Disclaimers.
   </para>
      </listitem>
    </orderedlist>
    <para>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </para>
    <para>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </para>
    <para>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </para>
    <para>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </para>
    <bridgehead renderas="sect4">
    5. COMBINING DOCUMENTS
  </bridgehead>
    <para>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </para>
    <para>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </para>
    <para>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </para>
    <bridgehead renderas="sect4">
    6. COLLECTIONS OF DOCUMENTS
  </bridgehead>
    <para>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </para>
    <para>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </para>
    <bridgehead renderas="sect4">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </bridgehead>
    <para>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </para>
    <para>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </para>
    <bridgehead renderas="sect4">
    8. TRANSLATION
  </bridgehead>
    <para>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </para>
    <para>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </para>
    <bridgehead renderas="sect4">
    9. TERMINATION
  </bridgehead>
    <para>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </para>
    <bridgehead renderas="sect4">
    10. FUTURE REVISIONS OF THIS LICENSE
  </bridgehead>
    <para>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.gnu.org/copyleft/"></link>.
 </para>
    <para>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </para>
    <bridgehead renderas="sect4">
    ADDENDUM: How to use this License for your documents
  </bridgehead>
    <screen>Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</screen>
    <para>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the &#x201C;with...Texts.&#x201D; line with this:
 </para>
    <screen>with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</screen>
    <para>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </para>
    <para>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
</para>
  </appendix>
</article>
