<?xml version="1.0" encoding="UTF-8"?>
<article xmlns="http://docbook.org/ns/docbook" xml:base="Micro-deployment-raw-images-ibmz.xml" version="5.0" xml:id="deployment-raw-ibmz-dasd" xml:lang="zh-cn">
  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">在 IBM Z DASD 磁盘上使用原始磁盘映像部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase></title>
    <revhistory xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="rh-deployment-raw-ibmz-dasd">
      <revision>
        <date>2024-04-02</date>
        <revdescription>
          <itemizedlist>
            <listitem>
              <para>
                  Initial version.
                </para>
            </listitem>
          </itemizedlist>
        </revdescription>
      </revision>
    </revhistory>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="updated" content="2024-04-02" its:translate="no"/>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="architecture">
      <phrase>IBM</phrase>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="productname" its:translate="no">
      <productname version="6.0" os="slmicro">
        <phrase>
          <phrase os="slmicro">SUSE Linux Micro</phrase>
        </phrase>
      </productname>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="title" its:translate="yes">在 IBM Z 上部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase></meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="description" its:translate="yes">在 IBM Z 上部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 原始映像</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="social-descr" its:translate="yes">在 IBM Z 上部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 原始映像</meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="category">
      <phrase>系统管理</phrase>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="task">
      <phrase>配置</phrase>
      <phrase>安装</phrase>
    </meta>
    <meta xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" name="series">产品和解决方案</meta>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <dm:bugtracker>
        <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
        <dm:component>Documentation</dm:component>
        <dm:product>SUSE Linux Enterprise Micro 6.0</dm:product>
        <dm:assignee>jsindelarova@suse.com</dm:assignee>
      </dm:bugtracker>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
      <variablelist>
        <varlistentry>
          <term>解释</term>
          <listitem>
            <para><phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 提供可直接部署到设备存储区的原始映像（也称为预构建映像）。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>原因</term>
          <listitem>
            <para>
                本文为您提供了在 IBM Z 计算机上部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 的分步说明。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>工作量</term>
          <listitem>
            <para>
                读完本文大约需要 20 分钟。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>目标</term>
          <listitem>
            <para>在系统上成功部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase>。
              </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>要求</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>
                    运行 Linux 的磁盘。
                  </para>
              </listitem>
              <listitem>
                <para>
                    将部署原始映像并运行 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 的磁盘。
                  </para>
              </listitem>
              <listitem>
                <para>
                    充当配置媒体的磁盘。
                  </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </abstract>
  </info>
  <section role="concept" xml:lang="zh-cn" version="5.2" xml:id="deployment-about-pre-built-images">
    <info>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">关于预构建映像</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
      <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
        <para>
        预构建映像代表正在运行的操作系统，随时可供使用。它们不是通过安装程序以传统方式安装的，而是会复制到目标主机的硬盘中。本主题将介绍有关这些预构建映像的基本信息。
      </para>
      </abstract>
    </info>
    <para>
    在首次引导时，需使用预构建映像中提供的工具对其进行配置。引导加载程序会按照<xref linkend="deployment-first-boot-detection"/>中所述检测首次引导。每个映像附带默认挂载的子卷，在首次引导配置期间，这些子卷可能会发生更改。有关子卷的细节，请参见<xref linkend="deployment-default-partitioning"/>。
  </para>
    <section role="concept" xml:lang="zh-cn" version="5.2" xml:id="deployment-default-partitioning">
      <info>
        <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
          <para/>
        </abstract>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">默认分区</title>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
      </info>
      <para>
    提供的预构建映像会使用默认的分区方案，在首次引导期间，可以使用 <xref linkend="deployment-configuring-with-ignition" xrefstyle="template:Ignition"/> 或 <xref linkend="deployment-configuring-with-combustion" xrefstyle="template:Combustion"/> 更改该方案。
  </para>
      <important>
        <title>根文件系统必须使用 Btrfs</title>
        <para>
      如果您要对默认分区方案进行任何更改，根文件系统必须是 Btrfs。
    </para>
      </important>
      <para>
    每个映像都具有以下子卷：
  </para>
<screen>/home
/root
/opt
/srv
/usr/local
/var
</screen>
      <para>
    <literal>/etc</literal> 目录会挂载为 OverlayFS，其中上一级目录挂载到 <filename>/var/lib/overlay/1/etc/</filename>。
  </para>
      <para>
    您可以通过 <filename>/etc/fstab</filename> 中的 <literal>x-initrd.mount</literal> 选项来识别默认挂载的子卷。其他子卷或分区必须通过 Ignition 或 Combustion 进行配置。
  </para>
    </section>
    <section role="concept" xml:lang="zh-cn" version="5.2" xml:id="deployment-first-boot-detection">
      <info>
        <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
          <para/>
        </abstract>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">首次引导检测</title>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
      </info>
      <para>
    部署配置只在首次引导时运行。为了区分首次引导和后续引导，完成首次引导后，系统会创建标志文件 <filename>/boot/writable/firstboot_happened</filename>。如果文件系统中没有该文件，则会将 <literal>ignition.firstboot</literal> 属性传递给内核命令行，因而触发 Ignition 和 Combustion 的运行（在 initrd 中）。完成首次引导后，系统便会创建 <filename>/boot/writable/firstboot_happened</filename> 标志文件。
  </para>
      <note>
        <title>系统始终会创建该标志文件</title>
        <para>
      即使由于配置文件错误或缺失导致配置失败，系统也会创建 <filename>/boot/writable/firstboot_happened</filename> 标志文件。
    </para>
      </note>
      <section xml:id="deployment-first-boot-invokation">
        <title>在后续引导时强制重配置系统</title>
        <para>
      如果您需要在发生首次引导后重配置系统，可以在后续引导时强制重配置。此处可以采取两种做法。
    </para>
        <itemizedlist>
          <listitem>
            <para>
          可以将 <literal>ignition.firstboot=1</literal> 属性传递给内核命令行。
        </para>
          </listitem>
          <listitem>
            <para>
          可以删除标志文件 <filename>/boot/writable/firstboot_happened</filename>。
        </para>
          </listitem>
        </itemizedlist>
      </section>
    </section>
  </section>
  <section role="concept" xml:lang="zh-cn" version="5.2" xml:id="deployment-raw-ibmz-dasd-overview">
    <info>
      <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
        <para/>
      </abstract>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion"><phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 部署</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    </info>
    <para>
    <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 的部署过程分为三个阶段。请勿跳过任何阶段，并按照以下顺序操作。
  </para>
    <orderedlist>
      <listitem>
        <para>
        DASD 磁盘激活 - 在开始部署之前，需要确保要使用的所有磁盘都可用且已启用。有关细节，请参见<xref linkend="deployment-raw-ibmz-dasd-preparing-machine"/>。
      </para>
      </listitem>
      <listitem>
        <para>
        准备配置设备 - 要配置网络、添加用户和注册系统，请根据<xref linkend="deployment-raw-ibmz-dasd-preparing-configuration"/>中提供的说明准备配置。
      </para>
      </listitem>
      <listitem>
        <para>
        下载 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 映像并将其部署到磁盘上。有关细节，请参见<xref linkend="deployment-raw-ibmz-dasd-deploying-image"/>。
      </para>
      </listitem>
    </orderedlist>
  </section>
  <section role="task" xml:lang="zh-cn" version="5.2" xml:id="deployment-raw-ibmz-dasd-preparing-machine">
    <info>
      <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
        <para/>
      </abstract>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">准备计算机</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    </info>
    <para>
    在开始部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 之前，您需要检查所需的三个 DASD 磁盘是否都已启用。要检查磁盘的状态，请运行以下命令：
  </para>
<screen><prompt role="root"># </prompt>lsdasd

Bus-ID    Status    Name      Device  Type         BlkSz  Size      Blocks 
================================================================================ 
0.0.0100  active    dasda     94:0    ECKD         4096   30720MB   7864380 
0.0.0101  active    dasdc     94:8    ECKD         4096   20480MB   5243040
0.0.0102  active    dasdb     94:4    ECKD         4096   5120MB    1310760
      </screen>
    <para>
    5 GB 磁盘将用作配置设备，20 GB 磁盘是将部署 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 的磁盘。
  </para>
    <para>
    如果在命令输出中看不到磁盘，则需要激活磁盘。为此，请执行如下操作：
  </para>
    <procedure>
      <step>
        <para>
        运行 <command>lszdev dasd</command> 以显示完整的设备列表：
      </para>
<screen><prompt role="root"># </prompt>lszdev dasd

TYPE       ID        ON   PERS  NAMES 
dasd-eckd  0.0.0100  yes  no    dasda 
dasd-eckd  0.0.0101  no   no    
dasd-eckd  0.0.0102  no   no   
dasd-eckd  0.0.0190  no   no     
dasd-eckd  0.0.019d  no   no     
dasd-eckd  0.0.019e  no   no     
dasd-eckd  0.0.0592  no   no
      </screen>
      </step>
      <step>
        <para>
        使用以下命令激活磁盘：
      </para>
<screen><prompt role="root"># </prompt>chzdev -e<replaceable>DISK_ID</replaceable></screen>
        <para>
        例如，要激活磁盘 <literal>0.0.0101</literal>，请使用以下命令：
      </para>
<screen><prompt role="root"># </prompt>chzdev -e 0.0.0101</screen>
      </step>
      <step>
        <para>
        在 <command>lsdasd</command> 命令的输出中校验磁盘是否已启用。
      </para>
      </step>
    </procedure>
  </section>
  <section role="task" xml:lang="zh-cn" version="5.2" xml:id="deployment-raw-ibmz-dasd-preparing-configuration">
    <info>
      <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
        <para/>
      </abstract>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">准备配置磁盘</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    </info>
    <tip>
      <title>虚拟磁盘与物理磁盘</title>
      <para>
      虚拟磁盘可能更适合生产部署，而物理磁盘更适合开发环境。
    </para>
    </tip>
    <para>
    在安装过程中，可以传递复杂的配置来定义用户、目录或提供 SSH 密钥。为此，请创建用于存储完整配置的配置设备。以下示例过程介绍了如何创建此类设备：
  </para>
    <procedure>
      <step>
        <para>
        识别 5 GB 磁盘：
      </para>
    <screen><prompt role="root"># </prompt>lsdasd

Bus-ID    Status    Name      Device  Type         BlkSz  Size      Blocks 
================================================================================ 
0.0.0100  active    dasda     94:0    ECKD         4096   30720MB   7864380 
0.0.0101  active    dasdc     94:8    ECKD         4096   20480MB   5243040
0.0.0102  active    dasdb     94:4    ECKD         4096   5120MB    1310760
      </screen>
        <para>
        在上面的输出中，要用作配置设备的磁盘的 <literal>Bus-ID</literal> 值为 <emphasis>0.0.0102</emphasis>。请使用 <literal>Bus-ID</literal> 的值或磁盘大小来识别磁盘，因为设备名称 (<literal>/dev/dasdX</literal>) 在系统每次重引导后都可能会发生变化。
      </para>
      </step>
      <step>
        <para>
        格式化磁盘。请记住，格式化操作会去除该磁盘上的所有数据。
      </para>
<screen><prompt role="root"># </prompt>dasdfmt -b 4096 -y -p /dev/dasdb
      </screen>
      </step>
      <step>
        <para>
        创建分区：
      </para>
<screen><prompt role="root"># </prompt>parted /dev/dasdb mkpart ext2 0% 100%
      </screen>
      </step>
      <step>
        <para>
        格式化分区：
      </para>
<screen><prompt role="root"># </prompt>mkfs.ext4 /dev/dasdb1
      </screen>
      </step>
      <step>
        <para>
        将分区标记为 <literal>ignition</literal>：
      </para>
<screen><prompt role="root"># </prompt>e2label /dev/dasdb1 ignition</screen>
      </step>
      <step>
        <para>
        校验文件系统：
      </para>
<screen><prompt role="root"># </prompt>blkid</screen>
      </step>
      <step>
        <para>
        挂载分区：
      </para>
<screen><prompt role="root"># </prompt>mount /dev/dasdb1 /mnt
      </screen>
      </step>
      <step>
        <para>
        准备 Ignition 和/或 Combustion 的目录结构。对于 Ignition，请使用以下命令：
      </para>
<screen><prompt role="root"># </prompt>mkdir -p  /mnt/ignition</screen>
        <para>
        对于 Combustion，请使用以下命令：
      </para>
<screen><prompt role="root"># </prompt>mkdir -p /mnt/combustion
      </screen>
      </step>
      <step>
        <para>
        将您的公用 SSH 密钥复制到 <filename>/mnt/combustion</filename> 并重命名为 <filename>ssh_key.pub</filename>。
      </para>
      </step>
      <step>
        <para>
        按照后续说明准备配置。
      </para>
      </step>
    </procedure>
    <section xml:lang="zh-cn" role="concept" version="5.1" xml:id="deployment-configuring-with-combustion">
      <info>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" name="maintainer" content="tbazant@suse.com" its:translate="no"/>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">使用 Combustion 配置 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 部署</title>
        <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">
          <para>
        Combustion 是一种 dracut 模块，可用于在首次引导时配置系统。您可以使用 Combustion 来更改默认分区、设置用户口令、创建文件、安装软件包等。
      </para>
        </abstract>
      </info>
      <section xml:id="how-it-works-combustion">
        <title>Combustion 的工作原理</title>
        <para>
      系统将在 <literal>ignition.firstboot</literal> 参数传递给内核命令行后调用 Combustion。Combustion 会读取提供的文件（名为 <filename>script</filename>）并执行其中的命令，以对文件系统进行更改。如果 <filename>script</filename> 中包含网络标志，Combustion 会尝试配置网络。挂载 <literal>/sysroot</literal> 后，Combustion 会尝试激活 <filename>/etc/fstab</filename> 中的所有挂载点，然后调用 <command>transactional-update</command> 来应用其他更改，例如设置 <systemitem class="username">root</systemitem> 口令或安装软件包。
    </para>
        <para condition="deployment-bare-metal">
        配置文件 <filename>script</filename> 必须位于标记为 <literal>combustion</literal> 的配置媒体的 <filename>combustion</filename> 子目录中。目录结构必须如下所示：
      </para>
<screen condition="deployment-bare-metal">&lt;root directory&gt;
└── combustion
    └── script
    └── other files
</screen>
        <tip>
          <title>搭配使用 Combustion 与 Ignition</title>
          <para>
          Combustion 可与 Ignition 搭配使用。如果您要将它们搭配使用，请将配置媒体标记为 <literal>ignition</literal>，并在目录结构中添加包含 <filename>config.ign</filename> 的 <filename>ignition</filename> 目录，如下所示：
        </para>
<screen>&lt;root directory&gt;
└── combustion
    └── script
    └── other files
└── ignition
    └── config.ign
</screen>
          <para>
          在此情况下，Ignition 会先于 Combustion 运行。
        </para>
        </tip>
      </section>
      <section xml:lang="zh-cn" role="reference" version="5.1" xml:id="deployment-combustion-configuration">
        <info>
          <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" name="maintainer" content="tbazant@suse.com" its:translate="no"/>
          <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">Combustion 配置示例</title>
        </info>
        <section xml:id="configuring-combustion-script">
          <title><filename>script</filename> 配置文件</title>
          <para>
      <filename>script</filename> 配置文件是一组由 Combustion 在 <command>transactional-update</command> 外壳中分析并执行的命令。本文提供了 Combustion 执行的配置任务的一些示例。
    </para>
          <important>
            <title>包含解释器声明</title>
            <para>
        <filename>script</filename> 文件由外壳解释，所以请务必在文件的第一行以解释器声明开头。例如，对于 Bash：
      </para>
<screen>#!/bin/<replaceable>bash</replaceable></screen>
          </important>
          <para>
      为了登录系统，请至少包含 <systemitem class="username">root</systemitem> 口令，但建议使用 SSH 密钥建立身份验证。如果您需要使用 <systemitem class="username">root</systemitem> 口令，请务必配置安全口令。对于随机生成的口令，请至少包含 10 个字符。如果您要手动创建口令，请包含 10 个以上的字符，并结合使用大写与小写字母和数字。
    </para>
          <section xml:id="deployment-combustion-network">
            <title>网络配置</title>
            <para>
        要在首次引导期间配置并使用网络连接，请在 <filename>script</filename> 中添加以下语句：
      </para>
<screen># combustion: network</screen>
            <para>
        使用此语句会将 <literal>rd.neednet=1</literal> 参数传递给 dracut。网络配置默认设为使用 DHCP。如果需要使用不同的网络配置，请按照<xref linkend="combustion-prepare-statement"/>中所述操作。
      </para>
            <para>
        如果不使用该语句，将不会为系统配置任何网络连接。
      </para>
          </section>
          <section xml:id="combustion-prepare-statement">
            <title>在 initramfs 中进行修改</title>
            <para>
        您可能需要对 initramfs 环境进行更改，例如，将 NetworkManager 的自定义网络配置写入 <filename>/etc/NetworkManager/system-connections/</filename> 中。要执行此操作，请使用 <literal>prepare</literal> 语句。
      </para>
            <para>
        例如，要使用静态 IP 地址创建连接并配置 DNS，请执行以下操作：
      </para>
<screen>#!/bin/bash
# combustion: network prepare
set -euxo pipefail
          
nm_config() {
  umask 077 # Required for NM config
  mkdir -p /etc/NetworkManager/system-connections/
  cat &gt;/etc/NetworkManager/system-connections/static.nmconnection &lt;&lt;-EOF
  [connection]
  id=static
  type=ethernet
  autoconnect=true
          
  [ipv4]
  method=manual
  dns=192.168.100.1
  address1=192.168.100.42/24,192.168.100.1
EOF
}
          
if [ "${1-}" = "--prepare" ]; then
  nm_config # Configure NM in the initrd
  exit 0
fi
          
# Redirect output to the console
exec &gt; &gt;(exec tee -a /dev/tty0) 2&gt;&amp;1
          
  nm_config # Configure NM in the system
  curl example.com
# Leave a marker
echo "Configured with combustion" &gt; /etc/issue.d/combustion</screen>
          </section>
          <section xml:id="combustion-script-partitioning">
            <title>分区</title>
            <para>提供的 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 原始映像会使用<xref linkend="deployment-default-partitioning"/>中所述的默认分区方案。您可能希望使用不同的分区方式。下面一组示例代码段会将 <filename>/home</filename> 移至另一个分区。
      </para>
            <note>
              <title>在快照中包含的目录外部进行更改</title>
              <para>
          以下脚本会执行快照中未包含的更改。如果脚本失败且快照被丢弃，那么某些更改将仍然可见且无法还原，例如对 <literal>/dev/vdb</literal> 设备的更改。
        </para>
            </note>
            <para>
        以下代码段会在 <literal>/dev/vdb</literal> 设备上创建仅含一个分区的 GPT 分区方案：
      </para>
<screen>sfdisk /dev/vdb &lt;&lt;EOF
label: gpt
type=linux
EOF

partition=/dev/vdb1
</screen>
            <para>
        该分区为 Btrfs 格式：
      </para>
<screen>wipefs --all ${partition}
mkfs.btrfs ${partition}
</screen>
            <para>
        以下代码段会将 <filename>/home</filename> 中可能包含的内容移到新的 <filename>/home</filename> 文件夹位置：
      </para>
<screen>mount /home
mount ${partition} /mnt
rsync -aAXP /home/ /mnt/
umount /home /mnt
</screen>
            <para>
        下面的代码段会去除 <filename>/etc/fstab</filename> 中的旧项并创建新项：
      </para>
<screen>awk -i inplace '$2 != "/home"' /etc/fstab
echo "$(blkid -o export ${partition} | grep ^UUID=) /home btrfs defaults 0 0" &gt;&gt;/etc/fstab
</screen>
          </section>
          <section xml:id="combustion-adding-users">
            <title>创建新用户</title>
            <para>
        由于某些服务（例如 Cockpit）要求使用非 root 用户身份登录，因此请在此处至少定义一个非特权用户。或者，您可以按<xref linkend="deployment-postinstall-adding-users"/>中所述在正在运行的系统中创建此类用户。
      </para>
            <para>
        要添加新用户帐户，请先创建一个代表用户口令的哈希字符串。使用 <command>openssl passwd -6</command> 命令。
      </para>
            <para>
        获取口令哈希后，在 <filename>script</filename> 中添加以下几行内容：
      </para>
<screen>mount /home
useradd -m <replaceable>EXAMPLE_USER</replaceable>
echo '<replaceable>EXAMPLE_USER</replaceable>:<replaceable>PASSWORD_HASH</replaceable>' | chpasswd -e</screen>
          </section>
          <section xml:id="combustion-script-security">
            <title>设置 <systemitem class="username">root</systemitem> 的口令</title>
            <para>
        在设置 <systemitem class="username">root</systemitem> 口令前，请先生成口令的哈希，例如，使用 <command>openssl passwd
        -6</command> 来生成。要设置口令，请在 <filename>script</filename> 中添加以下几行内容：
      </para>
<screen>echo 'root:<replaceable>PASSWORD_HASH</replaceable>' | chpasswd -e</screen>
          </section>
          <section xml:id="combustion-script-sshkeys">
            <title>添加 SSH 密钥</title>
            <para>
        以下代码段会创建用于存储 <systemitem class="username">root</systemitem> 的 SSH 密钥的目录，然后将位于配置设备上的公共 SSH 密钥复制到 <filename>authorized_keys</filename> 文件中。
      </para>
<screen>mkdir -pm700 /root/.ssh/
cat id_rsa_new.pub &gt;&gt; /root/.ssh/authorized_keys
</screen>
            <note>
              <para>
          如果您需要通过 SSH 进行远程登录，则必须启用 SSH 服务。有关细节，请参见<xref linkend="combustion-script-services"/>。
        </para>
            </note>
          </section>
          <section xml:id="combustion-script-services">
            <title>启用服务</title>
            <para>
        要启用系统服务（例如 SSH 服务），请将下面一行添加到 <filename>script</filename> 中：
      </para>
<screen>systemctl enable sshd.service</screen>
          </section>
          <section xml:id="combustion-script-install">
            <title>安装软件包</title>
            <important>
              <title>可能需要注册您的系统并连接网络</title>
              <para>
          由于您可能需要额外订阅特定的软件包，因此可能需事先注册系统。此外，安装额外的软件包可能还需要有网络连接。
        </para>
            </important>
            <para>
        在首次引导配置期间，可以在系统上安装额外的软件包。例如，可以通过添加以下命令安装 <literal>vim</literal> 编辑器：
      </para>
<screen>zypper --non-interactive install vim-small</screen>
            <note>
              <para>
          请注意，在配置完毕并引导到配置的系统前，您将无法使用 <command>zypper</command>。如果想要在稍后进行更改，则必须使用 <command>transactional-update</command> 命令创建已更改快照。
        </para>
            </note>
          </section>
        </section>
        <section arch="zseries" xml:id="combustion-script-example-ibmz">
          <title><filename>script</filename> 文件的完整示例</title>
          <para>
      下面的 <filename>script</filename> 提供了完整的设置，可以作为如何编写自己的 Combustion 配置的指南。该示例不需要进一步配置 Ignition。
    </para>
<screen>
    #!/bin/bash
    # combustion: network prepare
    
    
    set -euxo pipefail
    
    ## The OSA subchannels to enable
    ZNET_SUBCHANNELS=0.0.1000,0.0.1001,0.0.1002
    
    ## Network information to configure
    IPADDRESS="10.144.64.155/24" ## Formet is ipaddress/cidr
    GATEWAY="10.144.64.254"
    NAMESERVERS="10.144.53.53;10.144.53.54" ## A semicolon-separated list of name servers
    
    ## Hostname information
    NODE_HOSTNAME="micro6"
    
    ## Add password for root user
    ## Use either 'openssl passwd -6' or 'mkpasswd --method=sha-512' to encrypt the password.
    ROOT_USER_PASSWORD='<replaceable>PASSWORD_HASH</replaceable>'
    SSH_ROOT_PUBLIC_KEY=ssh_key.pub
    
    ## Add a regular user, because root login may be disallowed in some services.
    CREATE_NORMAL_USER=user ## Replace the "user" with a desired username here.
    NORMAL_USER_PASSWORD='<replaceable>PASSWORD_HASH</replaceable>'
    SSH_USER_PUBLIC_KEY=ssh_key.pub
    
    ## Register to SUSE Customer Center and install additional packages
    REG_EMAIL='tux@suse.com' ## Email address for product registration
    SLMICRO_REGCODE='<replaceable>REGISTRATIONCODE</replaceable>' ## A registration code required to install additional packages
    ADDITIONAL_PACKAGES='' ## A space separated list of additional packages to install
    
    
    nm_config() {
      umask 077 # Required for Network Manager configuration
      mkdir -p /etc/NetworkManager/system-connections/
      cat &gt;'/etc/NetworkManager/system-connections/Wired connection 1.nmconnection' &lt;&lt;EOF
      [connection]
      id=static
      type=ethernet
      autoconnect=true
    
      [ipv4]
      method=manual
      address1=$IPADDRESS
      gateway=$GATEWAY
      dns=$NAMESERVERS
    EOF
    }
    
    if [ "${1-}" = "--prepare" ]; then
      # Configure Network Manager in the initrd
      nm_config
      # Enable OSA network devices
      chzdev qeth $ZNET_SUBCHANNELS -ep
      chzdev qeth $ZNET_SUBCHANNELS -e    
      exit 0
    fi
    
    
    
    ## Post output on stdout
    exec &gt; &gt;(exec tee -a /dev/ttyS0) 2&gt;&amp;1
    
    ## Set hostname
    echo $NODE_HOSTNAME &gt; /etc/hostname
    
    ## Set root password
    echo root:$ROOT_USER_PASSWORD | chpasswd -e
    ## Add ssh public key as authorized key for the root user
    mkdir -pm700 /root/.ssh/
    cat $SSH_ROOT_PUBLIC_KEY &gt;&gt; /root/.ssh/authorized_keys
    
    ## Mount /var and /home so user can be created smoothly
    if [ "$CREATE_NORMAL_USER" ]
    then
      mount /var &amp;&amp; mount /home
    fi
    ## User creation
    if [ "$CREATE_NORMAL_USER" ]
    then
      echo "User creation is requested, creating user."
      useradd -m $CREATE_NORMAL_USER -s /bin/bash -g users
      echo $CREATE_NORMAL_USER:$NORMAL_USER_PASSWORD | chpasswd -e
      echo $CREATE_NORMAL_USER "ALL=(ALL) NOPASSWD: ALL" &gt;&gt; /etc/sudoers.d/adminusers
      mkdir -pm700 /home/$CREATE_NORMAL_USER/.ssh/
      chown -R $CREATE_NORMAL_USER:users /home/$CREATE_NORMAL_USER/.ssh/
      cat $SSH_USER_PUBLIC_KEY &gt;&gt; /home/$CREATE_NORMAL_USER/.ssh/authorized_keys
      echo "Requested user has been created, requested password has been set."
    else
      echo "No user will be created"
    fi
    
    # Configure NM in the system
    nm_config
    # Enable OSA network device
    chzdev qeth $ZNET_SUBCHANNELS -ep
    chzdev qeth $ZNET_SUBCHANNELS -e
    
    ## Enable services
    echo "Enabling services."
    systemctl enable cockpit.socket
    systemctl enable sshd
    
    ## Unmount var and home
    if [ "$CREATE_NORMAL_USER" ]
    then
      umount /var &amp;&amp; umount /home
    fi  
    
    
    echo "Configured with Combustion at $(date)" &gt; /etc/issue.d/combustion
     </screen>
        </section>
      </section>
    </section>
    <section xml:lang="zh-cn" role="concept" version="5.1" xml:id="deployment-configuring-with-ignition">
      <info>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" name="maintainer" content="tbazant@suse.com" its:translate="no"/>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">使用 Ignition 配置 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 部署</title>
        <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">
          <para><link xlink:href="https://coreos.github.io/ignition/">Ignition</link> 是一种预配工具，可让您在首次引导时根据您的具体要求配置系统。
      </para>
        </abstract>
      </info>
      <section xml:id="how-it-works-ignition">
        <title>Ignition 的工作原理</title>
        <para>
      首次引导系统时，Ignition 将作为 <filename>initramfs</filename> 的一部分加载，并在特定的目录中（在 USB 闪存盘上，或者您可以提供 URL）搜索配置文件。所有更改都是在内核从临时文件系统切换到实际根文件系统前（即在 <literal>switch_root</literal> 命令发出前）进行的。
    </para>
        <para>
      Ignition 使用名为 <filename>config.ign</filename> 的 JSON 格式配置文件。您可以手动编写配置，也可以使用 <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://ignite.opensuse.org"/> 上的 Fuel Ignition Web 应用程序生成配置。
    </para>
        <important>
          <para>
        Fuel Ignition 尚未涵盖完整的 Ignition 词汇，生成的 JSON 文件可能需要进行额外的手动调整。
      </para>
        </important>
        <section xml:id="deployment-ignition-config-file">
          <title>
            <filename>config.ign</filename>
          </title>
          <para condition="deployment-bare-metal">
        配置文件 <filename>config.ign</filename> 必须位于配置媒体（例如，标签为 <literal>ignition</literal> 的 USB 记忆棒）的 <filename>ignition</filename> 子目录中。目录结构必须如下所示：
      </para>
<screen condition="deployment-bare-metal">&lt;root directory&gt;
└── ignition
    └── config.ign

 </screen>
          <tip condition="deployment-bare-metal">
            <para>
          要通过 Ignition 配置创建磁盘映像，可以使用 https://ignite.opensuse.org 上的 Fuel Ignition Web 应用程序。
        </para>
          </tip>
          <para>
        <filename>config.ign</filename> 包含多种数据类型：对象、字符串、整数、布尔值和对象列表。如需完整规范，请参见 <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://coreos.github.io/ignition/configuration-v3_3/">Ignition
        specification v3.3.0</link>。
      </para>
          <para>
        <literal>version</literal> 属性是必需的，在 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 中，其值必须设置为 <literal>3.3.0</literal> 或任何更低版本。否则，Ignition 将会失败。
      </para>
          <para>
        要以 <systemitem class="username">root</systemitem> 身份登录到系统，必须至少包含 <systemitem class="username">root</systemitem> 的口令。但建议通过 SSH 密钥建立访问权限。要配置口令，请务必使用安全口令。如果您使用随机生成的口令，请至少包含 10 个字符。如果您要手动创建口令，请包含 10 个以上的字符，并结合使用大写与小写字母和数字。
      </para>
        </section>
      </section>
      <section xml:lang="zh-cn" role="reference" version="5.1" xml:id="reference-ignition-configuration">
        <info>
          <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" name="maintainer" content="tbazant@suse.com" its:translate="no"/>
          <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">Ignition 配置示例</title>
        </info>
        <section xml:id="sec-ignition-examples">
          <title>配置示例</title>
          <para>
      本部分提供内置 JSON 格式的 Ignition 配置的几个示例。
    </para>
          <important>
            <para><xref linkend="deployment-default-partitioning"/>列出了在运行预构建的映像时默认挂载的子卷。如果您要在默认未挂载的子卷上添加新用户或修改任何文件，则需要先声明此类子卷，以便将其挂载。有关挂载文件系统的详细信息，请参见<xref linkend="sec-storage-filesystem"/>。
      </para>
          </important>
          <note>
            <title><literal>version</literal> 属性为必要属性</title>
            <para>
        每个 <filename>config.fcc</filename> 都必须包含版本 1.4.0 或更低版本，该版本随后会转换为相应的 Ignition 规范。
      </para>
          </note>
          <section xml:id="sec-ignition-storage">
            <title>储存配置</title>
            <para>
        <literal>storage</literal> 属性用于配置分区、RAID，定义文件系统，创建文件等。要定义分区，请使用 <literal>disks</literal> 属性。<literal>filesystems</literal> 属性用于格式化分区和定义特定分区的挂载点。<literal>files</literal> 属性可用于在文件系统中创建文件。后续章节中将介绍上述每个属性。
      </para>
            <section xml:id="sec-storage-disks">
              <title><literal>disks</literal> 属性</title>
              <para>
          <literal>disks</literal> 属性是设备列表，可用于定义这些设备上的分区。<literal>disks</literal> 属性必须至少包含一个 <literal>device</literal>，其他属性为可选属性。以下示例使用单个虚拟设备，并将磁盘划分为四个分区：
        </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "storage": {
    "disks": [
      {
        "device": "/dev/vda",
        "partitions": [
          {
            "label": "root",
            "number": 1,
            "typeGuid": "4F68BCE3-E8CD-4DB1-96E7-FBCAF984B709"
          },
          {
            "label": "boot",
            "number": 2,
            "typeGuid": "BC13C2FF-59E6-4262-A352-B275FD6F7172"
          },
          {
            "label": "swap",
            "number": 3,
            "typeGuid": "0657FD6D-A4AB-43C4-84E5-0933C84B4F4F"
          },
          {
            "label": "home",
            "number": 4,
            "typeGuid": "933AC7E1-2EB4-4F13-B844-0E14E2AEF915"
          }
        ],
        "wipeTable": true
      }
    ]
  }
}
</screen>
            </section>
            <section xml:id="sec-storage-raid">
              <title><literal>raid</literal> 属性</title>
              <para>
          <literal>raid</literal> 是 RAID 阵列列表。<literal>raid</literal> 的下列属性为必要属性：
        </para>
              <variablelist>
                <varlistentry>
                  <term>level</term>
                  <listitem>
                    <para>
                特定 RAID 阵列的级别（线性、raid0、raid1、raid2、raid3、raid4、raid5、raid6）
              </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term>devices</term>
                  <listitem>
                    <para>
                阵列中设备的列表，通过绝对路径引用这些设备
              </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term>name</term>
                  <listitem>
                    <para>
                将用于 md 设备的名称
              </para>
                  </listitem>
                </varlistentry>
              </variablelist>
              <para>
         例如：
        </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "storage": {
    "raid": [
      {
        "devices": [
          "/dev/sda",
          "/dev/sdb"
        ],
        "level": "raid1",
        "name": "system"
      }
    ]
  }
}
</screen>
            </section>
            <section xml:id="sec-storage-filesystem">
              <title><literal>filesystems</literal> 属性</title>
              <para><literal>filesystems</literal> 必须包含以下属性：
        </para>
              <variablelist>
                <varlistentry>
                  <term>device</term>
                  <listitem>
                    <para>
                设备的绝对路径，如果是物理磁盘，通常为 <literal>/dev/sda</literal>
              </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term>format</term>
                  <listitem>
                    <para>
                文件系统格式（Btrfs、Ext4、xfs、vfat 或 swap）
              </para>
                    <note>
                      <para>
                  对于 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase>，<literal>root</literal> 文件系统必须为 Btrfs 格式。
                </para>
                    </note>
                  </listitem>
                </varlistentry>
              </variablelist>
              <para>
          下面的示例演示如何使用 <literal>filesystems</literal> 属性。<filename>/opt</filename> 目录将挂载到 <literal>/dev/sda1</literal> 分区，该分区为 Btrfs 格式。系统将不会擦除该设备。
        </para>
              <para>
          例如：
        </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "storage": {
    "filesystems": [
      {
        "device": "/dev/sda1",
        "format": "btrfs",
        "path": "/opt",
        "wipeFilesystem": false
      }
    ]
  }
}
</screen>
              <para>
          普通用户的主目录通常位于 <filename>/home/<replaceable>USER_NAME</replaceable></filename> 目录中。由于 <filename>/home</filename> 默认不会挂载到 initrd 中，因此必须明确定义挂载，才能成功创建用户：
        </para>
<screen>
{
  "ignition": {
    "version": "3.1.0"
  },
  "passwd": {
    "users": [
      {
        "name": "root",
        "passwordHash": "<replaceable>PASSWORD_HASH</replaceable>",
        "sshAuthorizedKeys": [
          "ssh-rsa <replaceable>SSH_KEY_HASH</replaceable>"
        ]
      }
    ]
  },
  "storage": {
    "filesystems": [
      {
        "device": "/dev/sda3",
        "format": "btrfs",
        "mountOptions": [
          "subvol=/@/home"
        ],
        "path": "/home",
        "wipeFilesystem": false
      }
    ]
  }
}
</screen>
            </section>
            <section xml:id="sec-storage-files">
              <title><literal>files</literal> 属性</title>
              <para>
          您可以使用 <literal>files</literal> 属性在计算机上创建任何文件。请注意，要在默认的分区方案之外创建文件，需使用 <literal>filesystems</literal> 属性定义目录。
        </para>
              <para>
          在下面的示例中，将使用 <literal>files</literal> 属性创建一个主机名。将创建文件 <filename>/etc/hostname</filename>，其中包含 <emphasis>sl-micro1</emphasis> 主机名：
        </para>
              <important>
                <para>
            请记住，JSON 接受十进制数格式的文件模式，例如 <literal>420</literal>。
          </para>
              </important>
              <para>
          JSON：
        </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "storage": {
    "files": [
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "contents": {
          "source": "data:,sl-micro1"
        },
        "mode": 420
      }
    ]
  }
}
</screen>
            </section>
            <section xml:id="sec-storage-directories">
              <title><literal>directories</literal> 属性</title>
              <para>
          <literal>directories</literal> 属性是将在文件系统中创建的目录列表。<literal>directories</literal> 属性必须至少包含一个 <literal>path</literal> 属性。
        </para>
              <para>
          例如：
        </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "storage": {
    "directories": [
      {
        "path": "/home/tux",
        "user": {
          "name": "tux"
        }
      }
    ]
  }
}
</screen>
            </section>
          </section>
          <section xml:id="sec-ignition-users">
            <title>用户管理</title>
            <para>
        <literal>passwd</literal> 属性用于添加用户。由于某些服务（例如 Cockpit）要求使用非 root 用户身份登录，因此请在此处至少定义一个非特权用户。或者，您可以按<xref linkend="deployment-postinstall-adding-users"/>中所述在正在运行的系统中创建此类用户。
      </para>
            <para>
        要登录系统，请创建 <systemitem class="username">root</systemitem> 和一个普通用户，并设置他们的口令。您需要对口令进行哈希处理，例如使用 <command>openssl</command> 命令来处理：
      </para>
<screen>openssl passwd -6
 </screen>
            <para>
        该命令会为您选择的口令创建哈希。使用此哈希作为 <literal>password_hash</literal> 属性的值。
      </para>
            <para>
       例如：
      </para>
<screen>
{
  "ignition": {
    "version": "3.0.0"
  },
  "passwd": {
    "users": [
      {
        "name": "root",
        "passwordHash": "<replaceable>PASSWORD_HASH</replaceable>",
        "sshAuthorizedKeys": [
          "ssh-rsa <replaceable>SSH_KEY_HASH</replaceable> <replaceable>USER</replaceable>@<replaceable>HOST</replaceable>"
        ]
      }
    ]
  }
}
</screen>
            <para>
        <literal>users</literal> 属性必须至少包含一个 <literal>name</literal> 属性。<literal>ssh_authorized_keys</literal> 是用户的 SSH 密钥列表。
      </para>
          </section>
          <section xml:id="sec-ignition-systemd">
            <title>启用 <literal>systemd</literal> 服务</title>
            <para>
        您可以通过在 <literal>systemd</literal> 属性中指定 <systemitem class="daemon">systemd</systemitem> 服务来启用相应服务。
      </para>
            <para>
        例如：
      </para>
<screen>{
  "ignition": {
    "version": "3.0.0"
  },
  "systemd": {
    "units": [
      {
        "enabled": true,
        "name": "sshd.service"
      }
    ]
  }
}
</screen>
          </section>
        </section>
        <section xml:lang="zh-cn" role="task" version="5.1" xml:id="deployment-convert-yaml-to-json">
          <info>
            <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" name="maintainer" content="tbazant@suse.com" its:translate="no"/>
            <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">将 YAML 格式的文件转换为 JSON 格式</title>
            <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">
              <para>
        JSON 是一种用于存储结构化数据的通用文件格式，Ignition 等应用程序使用这种文件存储和检索其配置。由于 JSON 的语法复杂难懂，因此您可以使用更加直观易懂的 YAML 格式编写配置，然后将其转换为 JSON 格式。
      </para>
            </abstract>
          </info>
          <section xml:id="deployment-converting-config">
            <title>将 YAML 文件转换为 JSON 格式</title>
            <para>
      <literal>butane</literal> 工具可将 YAML 文件中特定于 Ignition 的词汇转换为 JSON 格式。它还会校验 YAML 文件的语法，捕获结构中可能存在的错误。若要使用最新版 <literal>butane</literal>，请添加以下储存库：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  zypper ar -f \
  https://download.opensuse.org/repositories/devel:/kubic:/ignition/openSUSE_Tumbleweed/ \
  devel_kubic_ignition
</screen>
            <para>
      将 <literal>openSUSE_Tumbleweed</literal> 替换为以下其中一项（具体取决于您的发行套件）：
    </para>
            <itemizedlist>
              <listitem>
                <para>
                  <literal>'openSUSE_Leap_$releasever'</literal>
                </para>
              </listitem>
              <listitem>
                <para>
                  <literal>15.5</literal>
                </para>
              </listitem>
            </itemizedlist>
            <para>
      现在，您可以安装 <literal>butane</literal> 工具：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  zypper ref &amp;&amp; zypper in butane</screen>
            <para>
      安装完成后，可通过运行以下命令调用 <literal>butane</literal>：
    </para>
<screen><prompt>&gt; </prompt> butane -p -o config.ign config.fcc</screen>
            <itemizedlist>
              <listitem>
                <para><filename>config.fcc</filename> 是 YAML 配置文件的路径。
        </para>
              </listitem>
              <listitem>
                <para><filename>config.ign</filename> 是输出 JSON 配置文件的路径。
        </para>
              </listitem>
              <listitem>
                <para>
          <option>-p</option> 命令选项会在输出文件中添加换行符，使其更易于阅读。
        </para>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
    </section>
  </section>
  <section role="task" xml:lang="zh-cn" version="5.2" xml:id="deployment-raw-ibmz-dasd-deploying-image">
    <info>
      <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
        <para/>
      </abstract>
      <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">在 DASD 磁盘上部署原始磁盘映像</title>
      <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse@com" its:translate="no"/>
    </info>
    <para>
    要将 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 部署到 20 GB DASD 磁盘，请按以下步骤操作：
  </para>
    <procedure>
      <step>
        <para>
        使用 <command>wget</command> 或 <command>curl</command> 下载原始磁盘映像。例如：
      </para>
<screen><prompt>&gt; </prompt>curl -L0kO</screen>
      </step>
      <step>
        <para>
        解压缩映像：
      </para>
<screen><prompt>&gt; </prompt>unpack xz -d<replaceable>BUILD_IDENTIFICATION</replaceable>.raw.xz</screen>
      </step>
      <step>
        <para>
        导出一个用于查找并存储 20 GB 设备名称的变量。
      </para>
<screen><prompt role="root"># </prompt>export SMDASD=$(lsdasd -s | grep 20480MB | tr -s [:blank:] | cut -d' ' -f3)</screen>
      </step>
      <step>
        <para>
        格式化磁盘：
      </para>
        <itemizedlist>
          <listitem>
            <para>
            如果磁盘是第一次格式化：
          </para>
<screen><prompt role="root"># </prompt>dasdfmt -b 4096 -y -p /dev/$SMDASD</screen>
          </listitem>
          <listitem>
            <para>
            如果磁盘以前已格式化：
          </para>
<screen><prompt role="root"># </prompt>dasdfmt -b 4096 -M quick -y -p /dev/$SMDASD</screen>
          </listitem>
        </itemizedlist>
      </step>
      <step>
        <para>
        将原始磁盘映像复制到磁盘（在本例中，设备名称为 /dev/dasdc）：
      </para>
<screen>dd if=<replaceable>IMAGE_NAME</replaceable>.raw status=progress  of=/dev/dasdc bs=4k</screen>
      </step>
      <step>
        <para>
        关闭正在运行的 Linux：
      </para>
<screen><prompt role="root"># </prompt>init 0</screen>
      </step>
      <step>
        <para>
        在 x3270 终端中引导第二个 DASD 迷你磁盘，以启动 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase>：
      </para>
<screen><prompt role="root"># </prompt>ipl 101</screen>
      </step>
    </procedure>
  </section>
  <section>
    <info>
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">部署后步骤</title>
    </info>
    <section role="task" xml:lang="zh-cn" version="5.2" xml:id="deployment-registering-system">
      <info>
        <abstract xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude">
          <para>
              如果在部署过程中未使用 Combustion <filename>script</filename> 注册您的系统，您可以从正在运行的系统注册。
            </para>
        </abstract>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">从 CLI 注册 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase></title>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
      </info>
      <para>
    要在 SUSE Customer Center 中注册 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase>，请执行以下操作：
  </para>
      <procedure>
        <step>
          <para>
        按如下方式运行 <command>transactional-update register</command>：
      </para>
<screen><prompt role="root"># </prompt>transactional-update register -r<replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
          <para>
        要在本地注册服务器中注册，另请提供该服务器的 URL：
      </para>
<screen><prompt role="root"># </prompt>transactional-update register -r<replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
 --url "https://suse_register.example.com/"</screen>
          <para>
        将 <replaceable>REGISTRATION_CODE</replaceable> 替换为随您的 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 一起收到的注册码。将 <replaceable>EMAIL_ADDRESS</replaceable> 替换为与您或贵组织管理订阅时所用 SUSE 帐户关联的电子邮件地址。
      </para>
        </step>
        <step>
          <para>
        重引导您的系统以切换到最新的快照。
      </para>
        </step>
        <step>
          <para><phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 现已注册完毕。
      </para>
        </step>
      </procedure>
      <note>
        <title>其他注册选项</title>
        <para>
      如果所需的信息超出了本节的范畴，请使用 <command>SUSEConnect --help</command> 查看内嵌文档。
    </para>
      </note>
    </section>
    <section role="task" xml:lang="zh-cn" version="5.2" xml:id="deployment-postinstall-adding-users">
      <info>
        <title xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">添加用户</title>
        <meta xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion" name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
        <abstract xmlns:its="http://www.w3.org/2005/11/its" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:trans="http://docbook.org/ns/transclusion">
          <para>
        由于 <phrase><phrase os="slmicro">SLE Micro</phrase></phrase> 要求使用非特权用户身份通过 SSH 登录系统或访问 Cockpit，因此您需要创建这样的帐户。
      </para>
        </abstract>
      </info>
      <para condition="zseries">
    如果已在 Combustion 中定义了非特权用户，则可以不执行此步骤。
  </para>
      <procedure>
        <step>
          <para>
        如下所示运行 <command>useradd</command> 命令：
      </para>
<screen><prompt role="root"># </prompt><command>useradd -m <replaceable>USER_NAME</replaceable></command>
          </screen>
        </step>
        <step>
          <para>
        为该帐户设置口令：
      </para>
<screen><prompt role="root"># </prompt>passwd<replaceable>USER_NAME</replaceable></screen>
        </step>
        <step>
          <para>
        根据需要将用户添加到 <literal>wheel</literal> 组：
      </para>
<screen><prompt role="root"># </prompt>usermod -aG wheel<replaceable>USER_NAME</replaceable></screen>
        </step>
      </procedure>
    </section>
  </section>
  <section version="5.2" xml:id="legal-disclaimer">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">法律声明</title>
    </info>
    <para> 版权所有 © 2006–<?dbtimestamp format="Y"?>

 SUSE LLC 和贡献者。保留所有权利。 </para>
    <para>
    根据 GNU 自由文档许可证 (GNU Free Documentation License) 版本 1.2 或（根据您的选择）版本 1.3 中的条款，在此授予您复制、分发和/或修改本文档的权限；本版权声明和许可证附带不可变部分。许可版本 1.2 的副本包含在题为<quote>GNU Free Documentation License</quote>的部分。
  </para>
    <para>
    有关 SUSE 商标，请参见 <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.suse.com/company/legal/"/>。所有其他第三方商标分别为相应所有者的财产。商标符号（®、™ 等）代表 SUSE 及其关联公司的商标。星号 (*) 代表第三方商标。
  </para>
    <para>
    本指南力求涵盖所有细节，但这不能确保本指南准确无误。SUSE LLC 及其关联公司、作者和译者对于可能出现的错误或由此造成的后果皆不承担责任。
  </para>
  </section>
  <appendix xmlns:its="http://www.w3.org/2005/11/its" version="5.2" role="legal" its:translate="no" xml:id="doc-gfdl-license">
    <info>
      <title xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">GNU 自由文档许可证</title>
    </info>
    <para>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.允许任何人复制和分发此许可证文档的逐字副本，但禁止对其进行更改。
 </para>
    <bridgehead renderas="sect4">
    0. 导言
  </bridgehead>
    <para>
  此许可证的目的是赋予手册、教科书或其他功能性的和有用的文档以“自由”：即保证每个人都有复制和再分发此类文档的有效自由，无论是否进行修改，也无论将其用于商业或非商业用途。其次，此许可证为作者和出版者保留了因工作获得声誉但不视为对他人所做修改负责的方式。
 </para>
    <para>
  本许可证是一种“非盈利版权”，这意味着从该文档衍生的作品也必须是以同一方式自由的。它补充了 GNU 通用公共许可证（为自由软件设计的非盈利版权许可证）。
 </para>
    <para>
  我们设计此许可证旨在将其用于免费软件的手册，因为免费软件需要自由文档：免费程序所附手册应具有与软件本身同样的自由。但是此许可证不限于软件手册；它可以用于任何文本作品，无论主题如何或它是否作为印刷书籍出版。建议本许可证主要用于目的是指导或参考的作品。
 </para>
    <bridgehead renderas="sect4">
    1. 适用性和定义
  </bridgehead>
    <para>
  此许可证适用的对象：由版权所有者在其中明确声明可按照此许可证条款以任何媒体分发的任何手册和其他作品。此类声明授予在此处所述的条款和条件下使用该作品的全球无限期无版权许可证。下述“文档”指任何此类手册或作品。任何公众成员都是一个被许可人，以下称为“您”。如果您以需要版权法许可的任何方式复制、修改或分发该作品，则表示您接受该许可证。
 </para>
    <para>
  该文档的“修改版本”表示包含该文档或其一部分（或者逐字复制或者有修改和/或翻译为另一语言）的任何作品。
 </para>
    <para>
  “次要章节”是该文档的命名附录或扉页章节，专门讲述该文档的出版者或作者与该文档整个主题（或相关问题）的关系，不包含与整个主题相关的内容。（因此，如果该文档是数学课本的一部分，则辅助部分可能不说明任何数学问题。）这种关系可以是与主题或相关问题的历史联系，或与它们相关的法律、商业、哲学、伦理或政治地位。
 </para>
    <para>
  在该文档基于此许可证项发布的声明中，“固定章节”是将其标题指定为固定章节标题的一些辅助章节。如果一个章节不适用上述辅助章节的定义，则不允许将其指定为固定章节。该文档可能不包含固定章节。如果该文档不标识任何固定章节，则表示没有固定章节。
 </para>
    <para>
  在该文档基于此许可证项发布的声明中，“封页文本”是作为封面文本或封底文本列出的简短文本段落。封面文本最多 5 个单词，封底文本最多 25 个单词。
 </para>
    <para>
  文档的“透明”副本是一个机器可读的副本，使用公众可以得到其规范的格式表达，这样的副本适合于使用通用文本编辑器、（对于像素构成的图像）通用绘图程序、（对于绘制的图形）广泛使用的绘画编辑器直接修改文档，也适用于输入到文本格式处理程序或自动翻译成各种适于适用于输入到文本格式处理程序的格式。一个用其他透明文件格式表示的副本，如果该格式的标记（或缺少标记）已经构成了对读者的后续修改的障碍，那么就是不透明的。表示实质性数量的文本的图像格式都是不透明的。不“透明”的副本称为“不透明”。
 </para>
    <para>
  适于作为透明副本的格式的示例有：没有标记的纯 ASCII 文本、Texinfo 输入格式、LaTeX 输入格式、使用公共可用 DTD 的 SGML 或 XML，符合标准的简单 HTML、可以人为修改的 PostScript 或 PDF。透明图像格式的示例有 PNG、XCF 和 JPG。不透明的格式包括：仅可以被私有版权的字处理软件使用的私有版权格式、所用的 DTD 和/或处理工具不是广泛可用的的 SGML 或 XML、机器生成的 HTML、一些字处理器生成的只用于输出目的的 PostScript 或 PDF。
 </para>
    <para>
  对于印刷书籍，“扉页”就是扉页本身以及随后的一些用于补充的页，显然本许可资料需要出现在扉页上。对于那些没有扉页的作品形式，“扉页”代表接近作品最突出标题的、在文本正文之前的文本。
 </para>
    <para>
  “命名为 XYZ”的章节表示文档的一个特定的子单元，其标题就是 XYZ 或在括号中包含 XYZ 且后跟 XYZ 的其他语言翻译文本。（这里 XYZ 代表下面提及的特定章节名称，比如“致谢”、“题献”、“签名”或“历史”。）要在修改文档时对这类章节“保留标题”就是依据此定义保持这样一个“命名为 XYZ”的章节。
 </para>
    <para>
  文档可能在文档遵照此许可证的声明后面包含免责声明。这些免责声明应作为参考信息包含在此许可证中，但是只能将其视作免责声明：这些免责声明暗指的任何其他含义均无效，且对此许可证的含义不产生任何影响。
 </para>
    <bridgehead renderas="sect4">
    2. 逐字复制
  </bridgehead>
    <para>
  您可以用任何媒体复制并分发文档，无论是出于商业还是非商业目的，只要保证此许可证、版权声明和声称此许可证应用于文档的声明都完整地、无任何附加条件地存在于所有副本中。不能使用任何技术手段阻碍或控制您制作或发布的副本的阅读或再次复制。不过您可以在副本交易中得到报酬。如果发布足够多的副本，则您必须遵循下面第三节中的条件。
 </para>
    <para>
  您也可以在如上的条件下出租副本和向公众放映副本。
 </para>
    <bridgehead renderas="sect4">
    3. 大量复制
  </bridgehead>
    <para>
  如果您出版的文档印刷版副本（或是有印制封页的其他媒体副本）多于 100 份，而文档的许可证声明中要求有封页文本，则您必须将它清晰地置于封页之上，封面文本在封面上，封底文本在封底上。封面和封底上还必须标明您是这些副本的出版者。封面必须同等显著地完整展现标题的所有文字。您可以在封页上加入其他资料。改动仅限于封页的复制，只要保持文档的标题不变并满足这些条件，可以在其他方面被视为逐字复制。
 </para>
    <para>
  如果需要加上的文本对于封面或封底过多，无法明显地表示，您应该在封页上列出前面的（在合理的前提下尽量多），把其他的放在邻近的页面上。
 </para>
    <para>
  如果您出版或分发了超过 100 份文档的不透明副本，则必须在每个不透明副本中包含一份计算机可读的透明副本，或是在每个不透明副本中给出一个计算机网络地址，通过这个地址，网络公共用户可以使用标准网络协议下载文档的无任何附加资料的完整透明副本。如果您选择后者，则必须在开始大量分发非透明副本的时候采用相当谨慎的步骤，保证透明副本在其所给出的位置在（直接或通过代理和零售商）分发最后一次该版本的非透明副本的时间之后一年之内始终是有效的。
 </para>
    <para>
  在重新大量发布副本之前，请您（但不是必须）与文档的作者联系，以便他们可以有机会向您提供文档的更新版本。
 </para>
    <bridgehead renderas="sect4">
    4. 修改
  </bridgehead>
    <para>
  在上述第 2、3 节的条件下，您可以复制和分发文档的修改版本，前提是严格按照此许可证发布修改后的文档，将修改版本用作文档，从而允许任何拥有此修改版副本的人执行分发或修改。另外，在修改版中，您需要做到如下几点：
 </para>
    <orderedlist numeration="upperalpha" spacing="normal">
      <listitem>
        <para>
    用于与文档以及以前各个版本（如果有，应该列在文档的“历史”章节中）显著不同的扉页（和封页，如果有）。如果那个版本的原始发行者允许的话，您可以使用和以前版本相同的标题。
   </para>
      </listitem>
      <listitem>
        <para>
    与作者一样，在扉页上列出承担修改版本中的修改的作者责任的一个或多个人或实体和至少五个文档的原作者（如果原作者不足五个就全部列出），除非他们免除了您的这个责任。
   </para>
      </listitem>
      <listitem>
        <para>
    与原来的发行者一样，在扉页上列出修改版的发行者的姓名。
   </para>
      </listitem>
      <listitem>
        <para>
    保持该文档的全部版权声明不变。
   </para>
      </listitem>
      <listitem>
        <para>
    在与其他版权声明邻近的位置加入恰当的针对您的修改的版权声明。
   </para>
      </listitem>
      <listitem>
        <para>
    在紧接着版权声明的位置加入许可声明，按照下面附录中给出的形式，以本许可证给公众授于是用修订版本的权利。
   </para>
      </listitem>
      <listitem>
        <para>
    保持原文档的许可声明中的全部不可变章节、封面文字和封底文字的声明不变。
   </para>
      </listitem>
      <listitem>
        <para>
    包含一份未作任何修改的本协议的副本。
   </para>
      </listitem>
      <listitem>
        <para>
    保持命名为“历史”的章节不变，保持它的标题不变，并在其中加入一项，至少声明扉页上的已修改版本的标题、年份、新作者和出版者。如果文档中没有命名为“历史”章节，则请新建它，并加入一项以声明原文档扉页上所列的标题、年份、作者与出版者，再在其后加入如上所说的描述修改版本的项。
   </para>
      </listitem>
      <listitem>
        <para>
    如果文档中有用于公共用户访问的文档透明副本的网址，则保持网址不变，并同样提供它所基于的以前文档版本的网址。这些网址可以放在“历史”章节。您可以不给出那些在原文档发行之前已经发行至少四年的版本给出的网址，或者该版本的发行者授权不列出网址。
   </para>
      </listitem>
      <listitem>
        <para>
    对于任何命名为“致谢”或“题献”的章节，保持其标题不变，并保持其全部内容以及对每位贡献者致谢和/或题献的语气不变。
   </para>
      </listitem>
      <listitem>
        <para>
    保持文档的所有固定章节不变，不改变它们的标题和内容。章节的编号或相当的内容不被认为是章节标题的一部分。
   </para>
      </listitem>
      <listitem>
        <para>
    删除命名为“签名”的章节。这样的章节不可以被包含在修改后的版本中。
   </para>
      </listitem>
      <listitem>
        <para>
    不要把任何现有章节重命名为“签名”或与任何不可变章节相冲突的标题。
   </para>
      </listitem>
      <listitem>
        <para>
    保持任何免责声明不变。
   </para>
      </listitem>
    </orderedlist>
    <para>
  如果修改版本加入了新的符合次要章节定义的引言或附录章节，并且不含有从原文档中复制的内容，您可以选择将其标记为固定。如果需要这样做，则将它们的标题加入修改版本许可声明的不可变章节列表之中。这些标题必须和其他章节的标题相区分。
 </para>
    <para>
  您可以加入一个命名为“签名”的章节，只要它只包含对您的修改版本由不同的各方给出的签名，例如书评或是声明文本已经被一个组织认定为一个标准的权威定义。
 </para>
    <para>
  您可以加入一个最多 5 个字的段落作为封面文本和一个最多 25 个字的段落作为封底文本，将它们加入修改版本的封页文本列表末端。一个实体只可以添加（或编排）一段封面和一段封底文本。如果原文档已经为该封页（封面或封底）包含了封页文本，由您或您所代表的实体先前加入或排列的文本，不能再新加入一个，但您可以在原来的发行者的明确许可下替换掉原来的那个。
 </para>
    <para>
  作者和发行者不能通过本许可证授权公众使用他们的名字推荐或暗示认可任何一个修改版本。
 </para>
    <bridgehead renderas="sect4">
    5. 组合文档
  </bridgehead>
    <para>
  遵照第 4 节所说的修改版本的规定，您以将文档和其他文档合并并以本许可证发布，只要您在合并结果中包含原文档的所有不可变章节，对它们不加以任何改动，并在合并结果的许可声明中将它们全部列为不可变章节，而且维持原作者的免责声明不变。
 </para>
    <para>
  合并作品仅需要包含一份此许可证，多个相同的固定章节可以由一个副本取代。如果有多个名称相同但内容不同的固定章节，通过在章节名称后面的括号中加上原作者或出版者的姓名（如果已知）来加以区别，或者使用唯一编号加以区别。并对合并作品许可声明中的固定章节列表中的章节标题做相同的调整。
 </para>
    <para>
  在合并过程中，必须合并不同原始文档中任何命名为“历史”的章节，从而形成新的命名为“历史”的章节；类似地，还要合并命名为“致谢”和“题献”的章节。必须删除所有命名为“签名”的章节。
 </para>
    <bridgehead renderas="sect4">
    6. 文档的合集
  </bridgehead>
    <para>
  您可以制作一个文档和其他文档的合集，在本许可证下发布，并在合集中将不同文档中的多个本许可证的副本以一个单独的副本来代替，只要您在文档的其他方面遵循本许可证的逐字复制的条款即可。
 </para>
    <para>
  您可以从一个这样的合集中提取一个单独的文档，并将它在本许可证下单独发布，只要您想这个提取出的文档中加入一份本许可证的副本，并在文档的其他方面遵循本许可证的逐字复制的原则。
 </para>
    <bridgehead renderas="sect4">
    7. 独立作品的聚合体
  </bridgehead>
    <para>
  将文档或其派生品以及其他独立和无关文档或作品编撰在一个储存卷中或分发媒体上，这称为文档的“聚合体”，前提是编撰成品的著作权对其使用者的法律权限的限制未超出各个独立作品的许可范围。当基于此许可证发布的文档包含在一个聚合体中时，此许可证不适用于聚合体中的本非该文档派生作品的其他作品。
 </para>
    <para>
  如果第 3 节中的封页文本要求适用于这些文档的副本，则若文档在聚合体中所占的比重小于全作品的一半，文档的封页文本可以放置在聚合体内包含文档部分的封页上，或是电子文档中的等效部分。否则，它必须位于整个聚合体的印刷的封页上。
 </para>
    <bridgehead renderas="sect4">
    8. 翻译
  </bridgehead>
    <para>
  翻译被视为一种修改，因此您可以根据第 4 节的条款分发文档的翻译。将固定章节替换为翻译内容需要经得其版权所有者的特别许可，但除了这些固定章节的原始版本之外，您还可以包含一部分或所有固定章节的翻译。您可以包含一个此许可证以及所有许可证声明和免责声明的翻译版本，前提是同时包含它们的原始英文版本。当翻译版本和英文版发生冲突的时候，原始版本有效。
 </para>
    <para>
  如果在文档中有命名为“致谢”、“题献”或“历史”的章节，保持标题（第 1 节）的要求（第 4 节）恰恰需要更换实际的标题。
 </para>
    <bridgehead renderas="sect4">
    9. 终止
  </bridgehead>
    <para>
  除非此许可证中有明确规定，否则您不能对该文档进行复制、修改、分授许可或分发。在此许可证规定外对该文档所进行的任何复制、修改、分授许可或分发都是无效的，并且将自动终止您在此许可证下所拥有的权利。但是，对于在此许可证的规定下从您这里获得副本或权利的各方，只要其完全遵守此许可证的规定，其许可证将不会被终止。
 </para>
    <bridgehead renderas="sect4">
    10. 本许可的未来修订版本
  </bridgehead>
    <para>
  自由软件基金会有时会发布 GNU 自由文档许可证的新的修订版版本。这些新版本的主旨和精神与当前版本是一致的，但在解决新问题的具体细节方面可能有所不同。请参见 <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.gnu.org/copyleft/"/>。
 </para>
    <para>
  许可证的每个版本都有一个不同的版本号。如果文档指定了适用于它的此许可证“或任何后续版本”的特定带编号版本，则您可以选择遵从指定版本或自由软件基金会发布的任何随后版本（非草稿）的条款和条件。如果文档没有指定此许可证的版本号，您可以选择自由软件基金会发布的任何许可证版本（非草稿）。
 </para>
    <bridgehead renderas="sect4">
    附录：如何针对您的文档使用此许可证
  </bridgehead>
<screen>Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</screen>
    <para>
  如果您有固定章节、封面文本和封底文本，请将“with...Texts”部分替换为：
 </para>
<screen>with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</screen>
    <para>
  如果有不可变章节而没有封页文本，或这三种内容（不可变章节、封面文本、封底文本）的任何其他组合，请合并这两个备选项以适应您的情况。
 </para>
    <para>
  如果您的文档包含不一般的程序代码示例，建议同时选择自由软件许可证（如 GNU 通用公共许可证）发布这些示例，以允许它们可以用于自由软件。
</para>
  </appendix>
</article>
