<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="reference-zypper-update-software"
 role="reference" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Updating software with &zypper;</title>
    <!--add author's email address-->
    <meta name="maintainer" content="" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
       Introductory text
      </para>
    </abstract>
  </info>
  <section xml:id="zypper-update-software">
    <title>Updating software with &zypper;</title>
    <para>
     There are two different ways to update software with &zypper;: by installing patches or by
     installing a new version of a package.
    </para>
    <section xml:id="sec-zypper-softup-patch">
     <title>Installing all needed patches</title>
     <para>
      <emphasis>Patching</emphasis> &sle; is the most reliable way to install
      new versions of installed packages. It guarantees that all required
      packages with correct versions are installed and ensures that package versions
      considered as <emphasis>conflicting</emphasis> are omitted.
     </para>
     <para>
      To install all officially released patches that apply to your system, run:
     </para>
  <screen>&prompt.sudo;zypper patch</screen>
     <para>
      All patches available from repositories configured on your computer are
      checked for their relevance to your installation. If they are relevant (and
      not classified as <literal>optional</literal> or
      <literal>feature</literal>), they are installed immediately.
      If <command>zypper patch</command> succeeds, it is guaranteed that no
      vulnerable version package is installed unless you confirm the exception.
      <phrase os="sles;sled">Note that the official update repository is only
      available after registering your &productname; installation.</phrase>
     </para>
     <para>
      If a patch that is about to be installed includes changes that require a
      system reboot, you will be warned before.
     </para>
     <para>
      The plain <command>zypper patch</command> command does not apply patches
      from third party repositories. To update also the third party repositories,
      use the <literal>with-update</literal> command option as follows:
     </para>
  <screen>&prompt.sudo;zypper patch --with-update</screen>
     <para>
      To install also optional patches, use:
     </para>
  <screen>&prompt.sudo;zypper patch --with-optional</screen>
     <remark>
      The structure here is a bit unfortunate: We explain how to use the
      --cve/--bugzilla options in more detail below ("Listing Patches").
      However, the first bit people get is the very brief intro immediately below.
      Not sure whether to replicate all the information from "Listing Patches"
      here.
      - sknorr, 2016-04-25
     </remark>
     <para>
      To install all patches relating to a specific Bugzilla issue, use:
     </para>
  <screen>&prompt.sudo;zypper patch --bugzilla=<replaceable>NUMBER</replaceable></screen>
     <para>
      To install all patches relating to a specific CVE database entry, use:
     </para>
  <screen>&prompt.sudo;zypper patch --cve=<replaceable>NUMBER</replaceable></screen>
     <para>
      For example, to install a security patch with the CVE number
      <literal>CVE-2010-2713</literal>, execute:
     </para>
  <screen>&prompt.sudo;zypper patch --cve=CVE-2010-2713</screen>
     <para>
      To install only patches which affect Zypper and the package management
      itself, use:
     </para>
  <screen>&prompt.sudo;zypper patch --updatestack-only</screen>
     <para>
      Bear in mind that other command options that would also update other
      repositories will be dropped if you use the
      <literal>updatestack-only</literal> command option.
     </para>
    </section>
    <section xml:id="sec-zypper-softup-listpatch">
     <title>Listing patches</title>
     <para>
      To find out whether patches are available, Zypper allows viewing the
      following information:
     </para>
     <variablelist>
      <varlistentry>
       <term>Number of needed patches</term>
       <listitem>
        <para>
         To list the number of needed patches (patches that apply to your system
         but are not yet installed), use <command>patch-check</command>:
        </para>
  <screen>&prompt.user;zypper patch-check
  Loading repository data...
  Reading installed packages...
  5 patches needed (1 security patch)</screen>
        <para>
         This command can be combined with the
         <option>--updatestack-only</option> option to list only the patches
         which affect Zypper and the package management itself.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>List of needed patches</term>
       <listitem>
        <para>
         To list all needed patches (patches that apply to your system but are
         not yet installed), use <command>zypper list-patches</command>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>List of all patches</term>
       <listitem>
        <para>
         To list all patches available for &productname;, regardless of whether
         they are already installed or apply to your installation, use
         <command>zypper patches</command>.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      It is also possible to list and install patches relevant to specific
      issues. To list specific patches, use the <command>zypper
      list-patches</command> command with the following options:
     </para>
     <variablelist>
      <varlistentry>
       <term>By Bugzilla issues</term>
       <listitem>
        <para>
         To list all needed patches that relate to Bugzilla issues, use the
         option <option>--bugzilla</option>.
        </para>
        <para>
         To list patches for a specific bug, you can also specify a bug number:
         <option>--bugzilla=<replaceable>NUMBER</replaceable></option>. To search
         for patches relating to multiple Bugzilla issues, add commas between the
         bug numbers, for example:
        </para>
  <screen>&prompt.user;zypper list-patches --bugzilla=972197,956917</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>By CVE number</term>
       <listitem>
        <para>
         To list all needed patches that relate to an entry in the CVE database
         (Common Vulnerabilities and Exposures), use the option
         <option>--cve</option>.
        </para>
        <para>
         To list patches for a specific CVE database entry, you can also specify
         a CVE number: <option>--cve=<replaceable>NUMBER</replaceable></option>.
         To search for patches relating to multiple CVE database entries, add
         commas between the CVE numbers, for example:
        </para>
  <screen>&prompt.user;zypper list-patches --cve=CVE-2016-2315,CVE-2016-2324</screen>
       </listitem>
       </varlistentry>
       <varlistentry>
        <term>List retracted patches</term>
        <listitem>
          <para>
            In the &sle;&nbsp;15 codestream, some patches are automatically 
            retracted. Maintenance updates are carefully tested, because there 
            is a risk that an update contains a new bug. If an update proves to
            contain a bug, a new update (with a higher version number) is 
            issued to revert the buggy update, and the buggy update is blocked 
            from being installed again. You can list retracted patches with
            <command>zypper</command>:
          </para>
          <screen>&prompt.user;<command>zypper lp --all |grep retracted</command>
  SLE-Module-Basesystem15-SP3-Updates | SUSE-SLE-Module-Basesystem-15-SP3-2021-1965 
   | recommended | important | ---    | retracted  | Recommended update for multipath-tools 
  SLE-Module-Basesystem15-SP3-Updates | SUSE-SLE-Module-Basesystem-15-SP3-2021-2689 
   | security    | important | ---    | retracted  | Security update for cpio
  SLE-Module-Basesystem15-SP3-Updates | SUSE-SLE-Module-Basesystem-15-SP3-2021-3655 
   | security    | important | reboot | retracted  | Security update for the Linux Kernel</screen> 
          <para>
            See complete information on a retracted (or any) patch:
          </para>
          <screen>&prompt.user;<command>zypper patch-info SUSE-SLE-Product-SLES-15-2021-2689</command>
  Loading repository data...
  Reading installed packages...
  
  Information for patch SUSE-SLE-Product-SLES-15-2021-2689:
  ---------------------------------------------------------
  Repository  : SLE-Product-SLES15-LTSS-Updates
  Name        : SUSE-SLE-Product-SLES-15-2021-2689
  Version     : 1
  Arch        : noarch
  Vendor      : maint-coord@suse.de
  Status      : retracted
  Category    : security
  Severity    : important
  Created On  : Mon 16 Aug 2021 03:44:00 AM PDT
  Interactive : ---
  Summary     : Security update for cpio
  Description : 
      This update for cpio fixes the following issues:
  
      It was possible to trigger Remote code execution due to a integer overflow 
      (CVE-2021-38185, bsc#1189206)
  
      UPDATE:
      This update was buggy and could lead to hangs, so it has been retracted. 
      There will be a follow up update.
      [...]</screen>   
        </listitem>
       </varlistentry>
       <varlistentry>
         <term>Patch with conflicting packages</term>
         <listitem>
  <screen>
  Information for patch openSUSE-SLE-15.3-2022-333:
  -------------------------------------------------
  Repository  : Update repository with updates from SUSE Linux Enterprise 15
  Name        : openSUSE-SLE-15.3-2022-333
  Version     : 1
  Arch        : noarch
  Vendor      : maint-coord@suse.de
  Status      : needed
  Category    : security
  Severity    : important
  Created On  : Fri Feb  4 09:30:32 2022
  Interactive : reboot
  Summary     : Security update for xen
  Description :
      This update for xen fixes the following issues:
  
      - CVE-2022-23033: Fixed guest_physmap_remove_page not removing the p2m mappings. (XSA-393) (bsc#1194576)
      - CVE-2022-23034: Fixed possible DoS by a PV guest Xen while unmapping a grant. (XSA-394) (bsc#1194581)
      - CVE-2022-23035: Fixed insufficient cleanup of passed-through device IRQs. (XSA-395) (bsc#1194588)
  Provides    : patch:openSUSE-SLE-15.3-2022-333 = 1
  Conflicts   : [22]
      xen.src &lt; 4.14.3_06-150300.3.18.2
      xen.noarch &lt; 4.14.3_06-150300.3.18.2
      xen.x86_64 &lt; 4.14.3_06-150300.3.18.2
      xen-devel.x86_64 &lt; 4.14.3_06-150300.3.18.2
      xen-devel.noarch &lt; 4.14.3_06-150300.3.18.2
  [...]
  </screen>
          <para>
           The above patch conflicts with the affected or vulnerable versions of
           22 packages. If any of these affected or vulnerable packages are
           installed, it triggers a conflict, and the patch is classified as
           <emphasis>needed</emphasis>. <command>zypper patch</command> tries to
           install all available patches. If it encounters problems, it reports
           them, thus informing you that not all updates are installed. The
           conflict can be resolved by either updating the affected or vulnerable
           packages or by removing them. Because &suse; update repositories also
           ship fixed packages, updating is a standard way to resolve conflicts.
           If the package cannot be updated&mdash;for example, because of dependency
           issues or package locks&mdash;it is deleted after the user's approval.
          </para>
         </listitem>
        </varlistentry>
      </variablelist>
     <para>
      To list all patches regardless of whether they are needed, use the option
      <option>--all</option> additionally. For example, to list all patches with
      a CVE number assigned, use:
     </para>
  <screen><?dbsuse-fo font-size="0.70em"?>&prompt.user;zypper list-patches --all --cve
  Issue | No.           | Patch             | Category    | Severity  | Status
  ------+---------------+-------------------+-------------+-----------+----------
  cve   | CVE-2019-0287 | SUSE-SLE-Module.. | recommended | moderate  | needed
  cve   | CVE-2019-3566 | SUSE-SLE-SERVER.. | recommended | moderate  | not needed
  [...]</screen>
    </section>
    <section xml:id="sec-zypper-softup-update">
     <title>Installing new package versions</title>
     <para>
      If a repository contains only new packages, but does not provide patches,
      <command>zypper&nbsp;patch</command> does not show any effect. To update
      all installed packages with newer available versions, use the following command:
     </para>
  <screen>&prompt.sudo;zypper update</screen>
  <important>
   <para>
    <command>zypper update</command> ignores problematic packages.
    For example, if a package is locked, <command>zypper update</command> 
    omits the package, even if a higher version of it is available. Conversely,
    <command>zypper patch</command> reports a conflict if the package is
    considered vulnerable.
   </para>
  </important>
     <para>
      To update individual packages, specify the package with either the update
      or install command:
     </para>
  <screen>&prompt.sudo;zypper update <replaceable>PACKAGE_NAME</replaceable>
  &prompt.sudo;zypper install <replaceable>PACKAGE_NAME</replaceable></screen>
     <para>
      A list of all new installable packages can be obtained with the command:
     </para>
  <screen>&prompt.user;zypper list-updates</screen>
     <para>
      Note that this command only lists packages that match the following
      criteria:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        has the same vendor like the already installed package,
       </para>
      </listitem>
      <listitem>
       <para>
        is provided by repositories with at least the same priority than the
        already installed package,
       </para>
      </listitem>
      <listitem>
       <para>
        is installable (all dependencies are satisfied).
       </para>
      </listitem>
     </itemizedlist>
     <para>
      A list of <emphasis>all</emphasis> new available packages (regardless
      whether installable or not) can be obtained with:
     </para>
  <screen>&prompt.sudo;zypper list-updates --all</screen>
     <para>
      To find out why a new package cannot be installed, use the <command>zypper
      install</command> or <command>zypper update</command> command as described
      above.
     </para>
    </section>
    <section xml:id="sec-zypper-softup-orphaned">
     <title>Identifying orphaned packages</title>
     <para>
      Whenever you remove a repository from Zypper or upgrade your system, some
      packages can get in an <quote>orphaned</quote> state. These
      <emphasis>orphaned</emphasis> packages belong to no active repository
      anymore. The following command gives you a list of these:
     </para>
  <screen>&prompt.sudo;zypper packages --orphaned</screen>
     <para>
      With this list, you can decide if a package is still needed or can be
      removed safely.
     </para>
    </section>

  </section>
</topic>
