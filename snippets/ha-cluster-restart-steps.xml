<!-- include like this:
<xi:include href="../snippets/ha-cluster-restart-steps.xml"/>
-->
<!DOCTYPE step [
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
  %entities;
]>
<step xmlns="http://docbook.org/ns/docbook" version="5.2"
xmlns:xi="http://www.w3.org/2001/XInclude"
xmlns:xlink="http://www.w3.org/1999/xlink">
  <para>
    If you need to restart the cluster services manually, follow these steps to avoid
    resource downtime:
  </para>
  <substeps>
    <step>
      <para>
        Put the cluster into maintenance mode:
      </para>
<screen>&prompt.user;<command>sudo crm maintenance on</command></screen>
      <para>
        In this state, the cluster stops monitoring all resources. This allows the services
        managed by the resources to keep running during the cluster restart.
      </para>
    </step>
    <step>
      <para>
        Restart the cluster services on all nodes:
      </para>
<screen>&prompt.user;<command>sudo crm cluster restart --all</command></screen>
    </step>
    <step>
      <para>
        Check the status of the cluster:
      </para>
<screen>&prompt.user;<command>sudo crm status</command></screen>
      <para>
        The nodes will have the status <literal>UNCLEAN (offline)</literal>, but will soon
        change to <literal>Online</literal>.
      </para>
    </step>
    <step>
      <para>
        When the nodes are back online, put the cluster back into normal operation:
      </para>
<screen>&prompt.user;<command>sudo crm maintenance off</command></screen>
    </step>
  </substeps>
</step>
