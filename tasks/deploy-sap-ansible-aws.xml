<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="deploy-sap-ansible-aws"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Deploying a &ha; distributed &s4h; 16 system on AWS</title>
    <!-- can be changed via merge in the assembly -->
    <!--add author's email address-->
    <meta name="maintainer" content="amrita.sakthivel" its:translate="no"/>
    <abstract>
  <para>The following example deploys a &s4h; sandbox system using two deployment scenarios: on an AWS cloud environment and existing hosts.
  </para>
    </abstract>
  </info>
  <para>You can refer to <filename>/usr/share/ansible/playbooks/ansible.playbooks_for_sap/deploy_scenarios/sap_s4hana_sandbox</filename>for this deployment scenario.</para>
  <procedure><title>Deployment on AWS cloud environment</title>
    <step><para>Prepare your AWS cloud environment with the following:</para>
    <itemizedlist>
      <listitem><para>VPC with subnets: <literal>public</literal> for Bastion host and <literal>private</literal> for provisioned hosts.</para></listitem>
      <listitem><para>Route 53 (private DNS)</para></listitem>
      <listitem><para>Internet Gateway (SNAT)</para></listitem>
      <listitem><para>Elastic File System (EFS) Network File System (NFS)</para></listitem>
      <listitem><para>Bastion host in public subnet with SSH keys and access to private subnet</para></listitem>
      <listitem><para>SSH keys: one for Bastion and one for provisioned hosts</para></listitem>
 </itemizedlist>
    </step>
    <step><para>Prepare the Ansible control node.</para>
   <screen>&prompt.sudo; <command>zypper install --type pattern sles_sap_automation</command></screen>
   <screen>&prompt.sudo; <command> zypper install python313-boto3</command></screen>
   <screen>&prompt.sudo; <command> ansible-galaxy collection install amazon.aws</command></screen>
    </step>
    <step><para>Update the required variable files in the <filename>sap_s4hana_sandbox</filename> directory.</para>
      <itemizedlist>
        <listitem><para><emphasis role="bold">ansible_extravars.yml</emphasis>: contains scenario specific variables that are not specific to platform.</para>
      <itemizedlist><listitem><para>&sap; System details such as SAP System Identification (SID), instance numbers, software version, etc.</para></listitem>
        <listitem><para>Preset and customizable variables for preconfigure and installation roles.</para></listitem>
        <listitem><para>Customizable directory with definition of &sap; software to be installed.</para></listitem>
             </itemizedlist>
      </listitem>
        <listitem><para> <emphasis role="bold">ansible_extravars_aws_ec2_vs.yml</emphasis>: contains platform specific variable. </para>
          <itemizedlist><listitem><para>AWS credentials</para></listitem>
            <listitem><para>AWS infrastructure details</para></listitem>
            <listitem><para>Bastion server details</para></listitem>
            <listitem><para>Customizable dictionary with definition of available operating system images in AWS</para></listitem>
            <listitem><para>Customizable dictionary with definition of provisioned host </para></listitem>
          </itemizedlist>
        </listitem>
       </itemizedlist>
       <note><para>We recommend using Ansible Vault as a secure storage for storing important variables.</para></note>
      </step>
      <step><para>Run the playbook.</para>
       <screen>&prompt.sudo;<command>ansible-playbook sap_test_ansible_playbook.yml \
        --extra-vars "@./ansible_extravars.yml" \
        --extra-vars "@./ansible_extravars_aws_ec2_vs.yml"</command></screen>
        </step>
    </procedure>
    <procedure><title>Deployment on existing hosts</title>
      <step><para>Prepare an automation user on existing hosts as new user with &sudo; permissions or &rootuser;
         and generate SSH keys to communicate between a control node and managed nodes.</para>
        </step>
        <step><para>Prepare the Ansible control node.</para>
       <screen>&prompt.sudo; <command>zypper install --type pattern sles_sap_automation</command></screen>
        </step>
        <step><para>Update the required variables.</para>
          <itemizedlist>
            <listitem><para><emphasis role="bold">ansible_extravars.yml</emphasis>: contains scenario specific variables that are not specific to platform.</para>
          <itemizedlist><listitem><para>&sap; System details such as SAP System Identification (SID), instance numbers, software version, etc.</para></listitem>
            <listitem><para>Preset and customizable variables for preconfigure and installation roles.</para></listitem>
            </itemizedlist>
          </listitem>
            <listitem><para> (optional)<emphasis role="bold">ansible_extravars_existing_hosts.yml</emphasis>: contains details of existing hosts.</para>
              <itemizedlist><listitem><para>Domain details</para></listitem>
                <listitem><para>Customizable dictionary with definition of existing host.</para></listitem>
                 </itemizedlist>
            </listitem>
            <listitem><para> (optional)<emphasis role="bold">ansible_inventory_noninteractive.yml</emphasis>: is an inventory file with existing hosts.</para>
              <itemizedlist><listitem><para>This is a predefined file with a standard structure and needs to be updated with connection details to existing hosts and path to SSH keys on the control node.</para></listitem>
                             </itemizedlist>
            </listitem>
           </itemizedlist>
           <note><para>We recommend using Ansible Vault as a secure storage for storing important variables.</para></note>
          </step>
          <step><para>Run the playbook.</para>
           <screen>&prompt.sudo;<command> ansible-playbook sap_test_ansible_playbook.yml \
            --extra-vars "@./ansible_extravars.yml" \
            --extra-vars "@./optional/ansible_extravars_existing_hosts.yml" \
            --inventory "./optional/ansible_inventory_noninteractive.yml"</command></screen>
            </step>
        </procedure>
 <para>For more information on deployment scenarios, refer to <filename>/usr/share/ansible/playbooks/ansible.playbooks_for_sap/deploy_scenarios </filename>. </para>

</topic>