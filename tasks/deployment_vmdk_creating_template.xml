<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="deployment-vmdk-creating-template"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating a template from the delivered VMDK image</title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
       Creating a virtual machine template with a preconfigured &productname; accelerates future
       deployment and keeps the delivered image untouched.
      </para>
    </abstract>
  </info>
  <para>
    To create the template, you first need to import the &productname; VMDK image, then create a
    machine from the imported image and then convert the machine into a template. All steps are
    described in the following sections.
  </para>
  <section xml:id="deployment-vmdk-creating-template-import">
    <title>Importing the VMDK image</title>
    <procedure>
    <step>
      <para>
Navigate to the <guimenu>Staging</guimenu> area and select the uploaded image.
      </para>
      <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting the image in the staging area</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_staged_vmdk.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_staged_vmdk.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
    </step>
    <step>
      <para>
        Click <guimenu>MOVE TO</guimenu> to copy the image to the  <guimenu>Imported
        VMDKs</guimenu> location and confirm with <guimenu>OK</guimenu>. Wait for the process to be complete.
      </para>
      <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Copying the imported image</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="copy_vmdk_from_staging_to_imported_images.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="copy_vmdk_from_staging_to_imported_images.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
    </step>
  </procedure>
  </section>  
  <section xml:id="deployment-vmdk-creating-template-vm">
    <title>Creating a virtual machine</title>
    <para>
      Now you need to create a virtual machine from the image. To do so, proceed as follows:
    </para>
<procedure>
  <step>
    <para>
      Navigate to the <guimenu>VMs and Templates</guimenu> view.
    </para>
    <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Navigating to VMs and Templates view</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="vms_and_templates1.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="vms_and_templates1.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
  </step>
  <step>
    <para>
      Right-click the cluster and host where you want to create the virtual machine, and select
      <guimenu>New Virtual Machine</guimenu>.
    </para>
    <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Creating a new virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_new_virtual_machine.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_new_virtual_machine.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
  </step>
  <step>
    <para>
      The wizard for adding virtual machine details opens. See details in the following procedure.
    </para>    
  </step>
</procedure>
<para>
  The following procedure describes how to provide virtual machine details.
</para>
<procedure>
  <step>
        <para>
          Under <guimenu>Select a creation type</guimenu>, choose <guimenu>Create a New Virtual
          Machine</guimenu> and proceed with <guimenu>Next</guimenu>.
                    </para>
                    <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>New virtual machine details</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="create_new_virtual_machine_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="create_new_virtual_machine_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>
          Under <guimenu>Select a name and folder</guimenu>, fill in the <guimenu>Virtual machine
          name</guimenu> and select a location for the machine. Proceed with <guimenu>Next</guimenu>.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting a location for the virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_a_name_and_folder_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_a_name_and_folder_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para> 
          Under <guimenu>Select a compute resource</guimenu>, click the destination machine IP
          address on the list. Proceed with <guimenu>Next</guimenu>.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting resources of a virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_a_compute_resource_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_a_compute_resource_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>
          Under <guimenu>Select storage</guimenu>, click the target datastore on the right and click <guimenu>Next</guimenu>.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting storage of a virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_storage_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_storage_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>
Under <guimenu>Select compatibility</guimenu>, select <guimenu>ESX 6.7 and later</guimenu>  and proceed with <guimenu>Next</guimenu>. 
      </para>
      <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting compatibility for a virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_compatibility_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_compatibility_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>
          Under <guimenu>Select a guest OS</guimenu>, choose <guimenu>Linux</guimenu> as the
          <guimenu>Guest OS Family</guimenu> and as the <guimenu>Guest OS Version</guimenu>, select
          <guimenu>SUSE Linux Enterprise 15 (64-bit)</guimenu>. Proceed with <guimenu>Next</guimenu>.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting the guest operating system</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_guest_os_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_guest_os_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>
          Under <guimenu>Customize hardware</guimenu>, perform the following steps:
        </para>
        <substeps>
          <step>
            <para>
               Remove the preconfigured hard disk.
            </para>
            <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Removing preconfigured hard disk</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="remove_preconfigured_harddrive.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="remove_preconfigured_harddrive.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
          </step>
          <step>
            <para>
              Click <guimenu>ADD NEW DEVICE</guimenu> and <guimenu>Existing Hard Disk</guimenu>.
            </para>
            <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Adding new hard disk</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="add_new_device_existing_hard_drive.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="add_new_device_existing_hard_drive.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
          </step>
          <step>
            <para>
Select a datastore and click <guimenu>OK</guimenu>.
            </para>
          </step>
          <step>
            <para>
In the <guimenu>Select File</guimenu> window, under <guimenu>Imported VMDKs</guimenu>, select the
&productname; image and proceed with <guimenu>OK</guimenu>.
            </para>
            <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Selecting the imported image</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="select_file_screen.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="select_file_screen.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
          </step>
          <step>
            <para>
              Click <guimenu>Advanced Parameters</guimenu>. Set the <guimenu>Attribute</guimenu> to
              <literal>guestinfo.userdata.encoding</literal> and set its value to
              <literal>base64</literal>. Click <guimenu>Add</guimenu>.
            </para>
            <para>
              Add another <guimenu>Attribute</guimenu>, <literal>guestinfo.userdata</literal>, and
              set its value field to the encoded user data.
            </para>
            <para>
              Proceed with <guimenu>Next</guimenu>.
            </para>
            <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Adding user data</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="guestinfo_userdata.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="guestinfo_userdata.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
          </step>
        </substeps>       
                  </step>
                  <step>
                    <para>
                      In <guimenu>Ready to complete</guimenu>, review the configuration and if
                      everything is correct, click <guimenu>Finish</guimenu>.
                    </para>
                  </step>
                  <step>
                    <para>
                      The template should appear in the <guimenu>Hosts and Clusters</guimenu> view.
                    </para>
                  </step>
</procedure>
  </section>
  <section xml:id="deployment-vmdk-creating-template-installation">
    <title>Installing the virtual machine</title>
    <para>
      After the configuration is finished, you can start the installation of the virtual machine as described below.
    </para>
    <procedure>
      <step>
        <para>
Navigate to the <guimenu>Hosts and Clusters</guimenu> view and select the &productname; template.
        </para>
      </step>
      <step>
        <para>Click the <guimenu>Power on</guimenu> icon.</para>       
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Turning on the virtual machine</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="poweron_vmtemplate_for_initial_build.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="poweron_vmtemplate_for_initial_build.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
      <step>
        <para>Open the Web console to monitor the installation process.</para>
        <para>
          After the installation is complete, the virtual machine should power off as configured in the provided user data.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Monitoring the installation</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="launch_webconsole.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="launch_webconsole.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      
      </step>
    </procedure>
  </section>
  <section xml:id="deployment-vmdk-creating-template-building">
    <title>Converting the virtual machine into a template</title>
    <para>
      The final part of the deployment is to create a template from the configured machine that can
      be used to clone virtual machines from and thus speed up the later deployment.
    </para>
    <procedure>
      <step>
        <para>
          Navigate to the <guimenu>VMs and Templates</guimenu> and select the template there.
        </para>
      </step>
      <step>
        <para>
          Click <guimenu>Actions</guimenu> and in the roll-up menu, select
          <guimenu>Template</guimenu> or right-click the template.
        </para>
        <informalfigure>
        <mediaobject>
          <textobject role="description"><phrase>Creating a template</phrase>
                </textobject>
            <imageobject role="fo">
              <imagedata fileref="convert_to_template.png" width="100%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="convert_to_template.png" width="100%"/>
            </imageobject>
        </mediaobject>
      </informalfigure>
      </step>
    </procedure>
  </section>
</topic>
