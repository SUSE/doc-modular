<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="firewalld-adding-zones-cli"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Managing firewall rules and zones using the <command>firewalld-cmd</command> utility</title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="amrita.sakthivel@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
       You can use the CLI interface to manage &firewalld; zones.
      </para>
    </abstract>
  </info>
  <section xml:id="firewalld-adding-zones-cli-new-zone">
    <title>Adding &firewalld; zones</title>
    <para>
      To add a new &firewalld; zone:
    </para>
    <procedure>
      <step>
        <para>
          Create a new zone, for example:
        </para>
        <screen>&prompt.sudo;<command>firewall-cmd --permanent --new-zone=<replaceable>test</replaceable></command></screen>
      </step>
      <step>
        <para>
         Set the trust level of the zone that defines the default behavior:
        </para>
        <screen>&prompt.sudo;<command>firewall-cmd --permanent --zone=example --set-target=<replaceable>trusted</replaceable></command></screen>
      </step>
      <step>
        <para>
          Reload the &firewalld; service to apply the new configuration:
        </para>
        <screen>&prompt.sudo;firewall-cmd --reload</screen>
      </step>
    </procedure>
  </section>
  <section xml:id="firewalld-adding-zones-cli-add-service">
    <title>Adding a service to a zone</title>
<para>To add a service to a zone:</para>
<procedure>
  <step>
    <para>
      List all the services to check incase your service is already predefined:
    </para>
    <screen>&prompt.sudo;<command>firewall-cmd --get-services</command>
      0-AD RH-Satellite-6 RH-Satellite-6-capsule afp alvr amanda-client amanda-k5-client amqp amqps anno-1602
      anno-1800 apcupsd audit ausweisapp2 bacula bacula-client bareos-director bareos-filedaemon bareos-storage bb bgp bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc bittorrent-lsd ceph ceph-exporter ceph-mon cfengine checkmk-agent civilization-iv civilization-v cockpit collectd condor-collector cratedb ctdb dds dds-multicast dds-unicast dhcp dhcpv6 dhcpv6-client distcc dns dns-over-quic dns-over-tls docker-registry docker-swarm dropbox-lansync elasticsearch etcd-client etcd-server factorio finger foreman foreman-proxy freeipa-4 freeipa-ldap freeipa-ldaps freeipa-replication freeipa-trust ftp galera
      ganglia-client ganglia-master git gpsd grafana gre http http3 https ident imap imaps ipfs ipp ipp-client ipsec irc ircs
      [...]
    </screen>
  </step>
  <step>
    <para>
     You can either add a service temporarily for the runtime session or permanently, for example:
    </para>
    <screen>&prompt.sudo;<command> firewall-cmd --zone=public --add-service=http</command></screen>
    <screen>&prompt.sudo;<command> firewall-cmd --zone=public --permanent --add-service=http</command></screen>
  <para>The <literal>--permanent</literal>flag ensures the change persists in all reboots. </para>
  </step>
  <step>
    <para>
      Reload the &firewalld; service to apply the new configuration:
    </para>
    <screen>&prompt.sudo;firewall-cmd --reload</screen>
  </step>
  <step>
    <para>
     You can verify:
    </para>
    <screen>&prompt.sudo;firewall-cmd --zone=public --list-services</screen>
  </step>
</procedure>
  </section>
  <section xml:id="firewalld-adding-zones-cli-add-port">
    <title>Adding a port to a zone</title>
<para>If your application does not have a predefined service, you can open a specific port or a range of ports.</para>
<procedure>
   <step>
    <para>
     You can either add a port temporarily for the runtime session or permanently, for example:
    </para>
    <screen>&prompt.sudo;<command> firewall-cmd --zone=public --add-port=8080/tcp</command></screen>
    <screen>&prompt.sudo;<command> firewall-cmd --zone=public --permanent --add-port=8080/tcp</command></screen>
  <para>The <literal>--permanent</literal>flag ensures the change persists in all reboots. </para>
  </step><step>
        <para>
          Reload the &firewalld; service to apply the new configuration:
        </para>
        <screen>&prompt.sudo;firewall-cmd --reload</screen>
      </step>
     <step>
      <para>
       You can verify:
      </para>
      <screen>&prompt.sudo;firewall-cmd --zone=public --list-ports</screen>
    </step>
 </procedure>
  </section>
  <section xml:id="firewalld-deleting-zones-cli">
    <title>Deleting &firewalld; zones</title>
    <para>
     To delete a zone:
    </para>
    <procedure>
      <step>
       <para>
        Verify the zone is not the default or in use:
       </para>
       <screen>&prompt.sudo;<command> firewall-cmd --get-default-zone</command></screen>
       <para>If the zone is in use or default, set a different zone, for example: </para>
       <screen>&prompt.sudo;<command> firewall-cmd --set-default-zone=<replaceable>NEW_DEFAULT_ZONE</replaceable></command></screen>
      </step>
      <step>
         <para>
          Check if any network interfaces are bound to the zone:
         </para>
         <screen>&prompt.sudo;firewall-cmd --zone=<replaceable>ZONE_TO_BE_DELETED</replaceable> --list-all</screen>
        </step>
        <step><para>The <literal>interfaces</literal> field in the output lists all the interfaces. Theses interfaces need to be
          reassigned to another zone. For example:</para>
        <screen>&prompt.sudo;firewall-cmd --zone=public --permanent --change-interface=<replaceable>ITERFACE_NAME</replaceable></screen>
        </step>
        <step><para>Delete the zone:</para>
        <screen>&prompt.sudo;firewall-cmd --permanent --delete-zone=<replaceable>ZONE_TO_BE_DELETED</replaceable></screen>
        </step>
        <step>
          <para>
            Reload the &firewalld; service to apply the new configuration:
          </para>
          <screen>&prompt.sudo;firewall-cmd --reload</screen>
        </step>
       </procedure>
  </section>
</topic>