<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="freeradius-deployment"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Deploying FreeRADIUS</title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="shalaka.harne@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
    <para>After you have successfully tested your FreeRADIUS setup using the debugging mode and test certificates, you must update the server for production use. A production environment requires higher security, persistence, and performance monitoring.</para></abstract>
  </info>  
  <procedure xml:id="freeradius-setup-server-deploying-freeradius"><title>Deploying FreeRADIUS</title>
    <para>You must remove all the test certificates in <filename>/etc/raddb/certs</filename> and replace them with your own certificates, comment out all the test users and clients, and stop radiusd.</para>
   <step><para>Before updating the configurations and replacing certificates, you must stop <filename>radiusd</filename>.</para>
  <screen>&prompt.sudo; systemctl stop radiusd</screen></step>
    <step><para>Replace the self-signed test certificates created by <filename>bootstrap</filename> with the correct certificates.</para></step>
  <step><para>Delete all files in <filename>/etc/raddb/certs/</filename> excluding <filename>README</filename>.</para></step>
  <step><para>Install your CA-signed certificates or generate production-grade certificates with strong bit-lengths (at least 2048-bit) and appropriate expiration dates.</para></step>
  <step><para>Ensure the <literal>radiusd</literal> user has read permissions for the new certificate files.</para>
  <screen>ls -l /etc/raddb/certs/
    -rw-r----- 1 root radiusd 1704 Jan 27 10:00 server.key 
    -rw-r----- 1 root radiusd 1200 Jan 27 10:00 server.crt
  </screen></step>
  <step><para>Delete test users in <filename>/etc/raddb/mods-config/files/authorize</filename>, and <filename>/etc/raddb/users</filename></para></step>
  <step><para>Remove the <filename>localhost</filename> with default secret <filename>testing123</filename> in <filename>clients.conf</filename></para></step>
  <step><para>Update your client blocks to use strong secrets unique to each Network Access Server (NAS).</para></step>
 <step><para>Verify the configurations.</para>
  <screen>&prompt.sudo; raidusd -C</screen>
<para>The configurations are verified before starting FreeRADIUS.</para></step>
   <step><para>Ensure you are not running <command>radiusd -X</command> while deploying as it is slow and logs passwords to the screen. Use the system service.</para>
  <screen>sudo systemctl enable --now radiusd</screen>
  </step>
  <step><para>Start FreeRADIUS.</para>
  <screen>&prompt.sudo; systemctl start radiusd</screen></step>
 </procedure>
</topic>
