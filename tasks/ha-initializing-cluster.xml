<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/article_installation.xml
     and https://github.com/SUSE/doc-sleha/blob/main/xml/ha_bootstrap_install.xml -->

<!-- REQUIRES FURTHER TESTING -->
<topic xml:id="ha-initializing-cluster"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Initializing the cluster with <command>crm cluster init</command></title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
        Configure the cluster on the first node with the <command>crm cluster init</command>
        script. The script prompts you for basic information about the cluster and configures
        the required settings and services.
      </para>
      <para>
        For more information, run the <command>crm cluster init --help</command> command.
      </para>
    </abstract>
  </info>
  <procedure>
    <step>
      <para>
        Log in to the first node as either the &rootuser; user or a user with
        <command>sudo</command> privileges.
      </para>
    </step>
    <step>
      <para>
        Start the script:
      </para>
<screen>&prompt.user;<command>sudo crm cluster init</command></screen>
      <para>
        The script checks for &chrony; configuration and a hardware watchdog service.
        If required, it generates the public and private SSH keys used for SSH access and
        &csync; synchronization and starts the respective services.
      </para>
    </step>
    <step>
      <para>
        Configure the cluster communication layer (&corosync;):
      </para>
      <substeps>
        <step>
          <para>
            Enter a network address to bind to. By default, the script
            proposes the network address of <systemitem>eth0</systemitem>.
            Alternatively, enter a different network address, for example the
            address of <literal>bond0</literal>.
          </para>
        </step>
        <step>
          <para>
            Accept the proposed port (<literal>5405</literal>) or enter a different one.
          </para>
        </step>
      </substeps>
    </step>
    <step>
      <para>
        Set up &sbd; as the node fencing mechanism:</para>
      <substeps>
        <step>
          <para>
            Confirm with <literal>y</literal> that you want to use &sbd;.</para>
        </step>
        <step>
          <para>
            When prompted for a path to a block device, enter <literal>none</literal> to
            configure diskless &sbd;.</para>
        </step>
      </substeps>
    </step>
    <step>
      <para>
        Configure a virtual IP address for cluster administration with the &hawk; Web interface:
      </para>
      <substeps>
        <step>
          <para>
            Confirm with <literal>y</literal> that you want to configure a
            virtual IP address.</para></step>
        <step>
          <para>
            Enter an unused IP address that you want to use as the administration IP
            for &hawk;.
          </para>
          <para>
            Instead of logging in to an individual cluster node with &hawk;,
            you can connect to the virtual IP address.
          </para>
        </step>
      </substeps>
    </step>
    <step>
      <para>
        Choose whether to configure &qdevice; and &qnet;. For the minimal setup
        described in this document, decline with <literal>n</literal>.
      </para>
    </step>
  </procedure>
  <para>
    The script starts the cluster services to bring the
    cluster online and enable &hawk;. The URL to use for &hawk; is
    displayed on the screen. You can also check the status of the cluster with
    the <command>crm status</command> command.
  </para>
</topic>
