<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_resource_constraints.xml -->

<topic xml:id="ha-resources-adding-colocation-constraints"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Adding colocation constraints</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
        A colocation constraint tells the cluster which resources may or may not
        run together on a node. As a colocation constraint defines a dependency
        between resources, you need at least two resources to create a colocation
        constraint.
        </para>
        <para>
        You can add colocation constraints using either &hawk; or &crmsh;.
        </para>
    </abstract>
  </info>

<section xml:id="sec-conf-hawk2-cons-col">
   <title>Adding colocation constraints with &hawk;</title>
   <procedure xml:id="pro-hawk2-constraints-colocation">
    <title>Adding colocation constraints</title>
    <step>
     <para>
      Log in to &hawk;:
     </para>
 <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para>
      From the left navigation bar, select <menuchoice> <guimenu>Configuration</guimenu>
      <guimenu>Add Constraint</guimenu> <guimenu>Colocation</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Enter a unique <guimenu>Constraint ID</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Enter a <guimenu>Score</guimenu>. The score determines the location
      relationship between the resources. Positive values indicate that the
      resources should run on the same node. Negative values indicate that the
      resources should not run on the same node. The score is combined with
      other factors to decide where to put the resource.
     </para>
     <para>
      Some often-used values can also be set via the drop-down box:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        To force the resources to run on the same node, click the
        arrow icon and select <literal>Always</literal>. This sets the score to
        <literal>INFINITY</literal>.
       </para>
      </listitem>
      <listitem>
       <para>
        If you never want the resources to run on the same node, click the arrow
        icon and select <literal>Never</literal>. This sets the score to
        <literal>-INFINITY</literal>, meaning that the resources must not run on
        the same node.
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      To define the resources for the constraint:
     </para>
     <substeps performance="required">
      <step xml:id="step-hawk2-col-rsc">
       <para>
        From the drop-down box in the <guimenu>Resources</guimenu> category,
        select a resource (or a template).
       </para>
       <para>
        The resource is added and a new empty drop-down box appears beneath.
       </para>
      </step>
      <step>
       <para>
        Repeat this step to add more resources.
       </para>
       <para>
        As the topmost resource depends on the next resource and so on, the
        cluster first decides where to put the last resource, then place the
        depending ones based on that decision. If the constraint cannot be
        satisÔ¨Åed, the cluster may not allow the dependent resource to run.
       </para>
      </step>
      <step>
       <para>
        To swap the order of resources within the colocation constraint, click
        the arrow up icon next to a resource to swap it with the entry above.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      If needed, specify further parameters for each resource (such as
      <literal>Started</literal>, <literal>Stopped</literal>,
      <literal>Promote</literal>, <literal>Demote</literal>). Click the empty
      drop-down box next to the resource and select the desired entry.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Create</guimenu> to finish the configuration. A message at
      the top of the screen shows if the action has been successful.
     </para>
    </step>
   </procedure>
  </section>

   <section xml:id="sec-ha-manual-config-constraints-collocational">
    <title>Adding colocation constraints with &crmsh;</title>
    <para>
     The <command>colocation</command> command is used to define what
     resources should run on the same or on different hosts.
    </para>
    <para>
     You can set a score of either +inf or -inf, defining
     resources that must always or must never run on the same node.
     You can also use non-infinite scores. In that case the colocation
     is called <emphasis>advisory</emphasis> and the cluster may decide not
     to follow them in favor of not stopping other resources if there is a
     conflict.
    </para>
    <para>
     For example, to always run the resources <literal>resource1</literal>
     and <literal>resource2</literal> on the same host, use the following constraint:
    </para>
<screen>&prompt.crm.conf;<command>colocation coloc-2resource inf: resource1 resource2</command></screen>
    <para>
     For a primary/secondary configuration, it is necessary to know if the
     current node is a primary in addition to running the resource locally.
    </para>
   </section>
</topic>
