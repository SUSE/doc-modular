<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_resource_constraints.xml -->

<topic xml:id="ha-resources-adding-order-constraints"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Adding order constraints</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
   Order constraints can be used to start or stop a service right before or
   after a different resource meets a special condition, such as being started,
   stopped, or promoted to primary. For example, you cannot mount a file system
   before the device is available to a system. As an order constraint defines
   a dependency between resources, you need at least two resources to create
   an order constraint.
  </para>
  <para>
   You can add order constraints using either &hawk; or &crmsh;.
  </para>
    </abstract>
  </info>

<section xml:id="sec-conf-hawk2-cons-order">
   <title>Adding order constraints with &hawk;</title>
   <procedure xml:id="pro-hawk2-constraints-order">
    <title>Adding an order constraint</title>
    <step>
     <para>
      Log in to &hawk;:
     </para>
 <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para>
      From the left navigation bar, select <menuchoice> <guimenu>Configuration</guimenu>
      <guimenu>Add Constraint</guimenu> <guimenu>Order</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Enter a unique <guimenu>Constraint ID</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Select a <guimenu>Kind</guimenu> from the drop-down box:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        To make the order constraint mandatory, click the arrow icon
        and select <literal>Mandatory</literal>.
       </para>
      </listitem>
      <listitem>
       <para>
        To make the order constraint a suggestion only, click the
        arrow icon and select <literal>Optional</literal>.
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>Serialize</literal>: To ensure that no two stop/start actions
        occur concurrently for the resources, click the arrow icon and select
        <literal>Serialize</literal>. This makes sure that one resource must
        complete starting before the other can be started. A typical use case
        are resources that put a high load on the host during start-up.
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      For order constraints, you can usually keep the option
      <guimenu>Symmetrical</guimenu> enabled. This specifies that resources are
      stopped in reverse order.
     </para>
    </step>
    <step>
     <para>
      To define the resources for the constraint:
     </para>
     <substeps performance="required">
      <step xml:id="step-hawk2-order-rsc">
       <para>
        From the drop-down box in the <guimenu>Resources</guimenu> category,
        select a resource (or a template).
       </para>
       <para>
        The resource is added and a new empty drop-down box appears beneath.
       </para>
      </step>
      <step>
       <para>
        Repeat this step to add more resources.
       </para>
       <para>
        The topmost resource starts first, then the second, etc. Usually the
        resources are stopped in reverse order.
       </para>
      </step>
      <step>
       <para>
        To swap the order of resources within the order constraint, click the
        arrow up icon next to a resource to swap it with the entry above.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      If needed, specify further parameters for each resource (like
      <literal>Started</literal>, <literal>Stopped</literal>,
      <literal>Promote</literal>, <literal>Demote</literal>). Click the empty
      drop-down box next to the resource and select the desired entry.
     </para>
    </step>
    <step>
     <para>
      Confirm your changes to finish the configuration. A message at the top of
      the screen shows if the action has been successful.
     </para>
    </step>
   </procedure>
  </section>

   <section xml:id="sec-ha-manual-config-constraints-ordering">
    <title>Adding order constraints using &crmsh;</title>
    <para>
     The <command>order</command> command defines a sequence of action.
    </para>
    <para>
     For example, to always start <literal>resource1</literal> before
     <literal>resource2</literal>, use the following constraint:
    </para>
<screen>&prompt.crm.conf;<command>order res1_before_res2 Mandatory: resource1 resource2</command></screen>
   </section>
</topic>
