<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_configuring_resources.xml -->

<topic xml:id="ha-resources-creating-clones"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating clone resources</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
    You may want certain resources to run simultaneously on multiple nodes
    in your cluster. To do this, you must configure a resource as a clone.
    Examples of resources that might be configured as clones include
    cluster file systems like OCFS2. You can clone any
    resource provided. This is supported by the resource's Resource
    Agent. Clone resources may even be configured differently depending on
    which nodes they are hosted.
   </para>
    </abstract>
  </info>

<para>
    There are three types of resource clones:
   </para>
   <variablelist>
    <varlistentry>
     <term>Anonymous clones</term>
     <listitem>
      <para>
       These are the simplest type of clones. They behave identically
       anywhere they are running. Because of this, there can only be one
       instance of an anonymous clone active per machine.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Globally unique clones</term>
     <listitem>
      <para>
       These resources are distinct entities. An instance of the clone
       running on one node is not equivalent to another instance on another
       node; nor would any two instances on the same node be equivalent.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Promotable clones (multi-state resources)</term>
     <listitem>
      <para>
       Active instances of these resources are divided into two states:
       active and passive. These are also sometimes called primary and
       secondary. Promotable clones can be either
       anonymous or globally unique.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Clones must contain exactly one group or one regular resource.
   </para>
   <para>
    When configuring resource monitoring or constraints, clones have
    different requirements than simple resources. For details, see
    <link xlink:href="https://clusterlabs.org/projects/pacemaker/doc/"/>.
   </para>
   <para>
    You can create clone resources using either &hawk; or &crmsh;.
   </para>

  <variablelist role="tabs">
    <varlistentry>
      <term>&crmshell;</term>
      <listitem>
        <para>
          You can perform this procedure on any node in the cluster.
        </para>
        <procedure>
          <step>
            <para>
              Log in either as the &rootuser; user or as a user with <command>sudo</command> privileges.
            </para>
          </step>
          <step>
            <para>
              Configure the primitive, for example:
            </para>
<screen>&prompt.user;<command>sudo crm configure primitive Apache apache \
  op monitor timeout=20s interval=10s</command></screen>
            </step>
            <step>
            <para>
              Clone the primitive:
            </para>
<screen>&prompt.user;<command>sudo crm configure clone cl-apache Apache</command></screen>
            </step>
        </procedure>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>&hawk;</term>
      <listitem>
        <para>
          You can access the &hawk; Web interface from any machine that has network access to the nodes.
        </para>
        <procedure>
          <step>
            <para>
              In a Web browser, go to
              <literal>https://<replaceable>HAWKSERVER</replaceable>:7630/</literal>
              and log in.
            </para>
          </step>
          <step>
            <para>
            From the left navigation bar, select <menuchoice> <guimenu>Configuration</guimenu>
            <guimenu>Add Resource</guimenu> <guimenu>Clone</guimenu> </menuchoice>.
            </para>
          </step>
          <step>
            <para>
            Enter a unique <guimenu>Clone ID</guimenu>.
            </para>
          </step>
          <step>
            <para>
            From the <guimenu>Child Resource</guimenu> list, select the primitive or
            group to use as a subresource for the clone.
            </para>
          </step>
          <step>
            <para>
            If needed, modify or add <guimenu>Meta Attributes</guimenu>.
            </para>
          </step>
          <step>
            <para>
            Click <guimenu>Create</guimenu> to finish the configuration. A message at
            the top of the screen shows if the action has been successful.
            </para>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
  </variablelist>

  <para>
    Promotable clones (formerly known as multi-state resources) are a
    specialization of clones. They allow the
    instances to be in one of two operating modes (primary or
    secondary). Promotable clones must contain
    exactly one group or one regular resource.
   </para>
   <para>
    When configuring resource monitoring or constraints, promotable
    clones have different requirements than simple resources. For
    details, see <link xlink:href="https://clusterlabs.org/projects/pacemaker/doc/"/>.
   </para>
   <para>
    You can create promotable clones using either &hawk; or &crmsh;.
   </para>

  <variablelist role="tabs">
    <varlistentry>
      <term>&crmshell;</term>
      <listitem>
        <para>
          You can perform this procedure on any node in the cluster.
        </para>
        <procedure>
          <step>
            <para>
              Log in either as the &rootuser; user or as a user with <command>sudo</command> privileges.
            </para>
          </step>
          <step>
            <para>
            Configure the primitive. Change the intervals if needed:
            </para>
<screen>&prompt.user;<command>sudo crm configure primitive my-rsc ocf:myCorp:myAppl \
  op monitor interval=60 \
  op monitor interval=61 role=Promoted</command></screen>
          </step>
          <step>
            <para>
            Create the promotable clone resource:
            </para>
<screen>&prompt.user;<command>sudo crm configure clone clone-rsc my-rsc meta promotable=true</command></screen>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>&hawk;</term>
      <listitem>
        <para>
          You can access the &hawk; Web interface from any machine that has network access to the nodes.
        </para>
        <procedure>
          <step>
            <para>
              In a Web browser, go to
              <literal>https://<replaceable>HAWKSERVER</replaceable>:7630/</literal>
              and log in.
            </para>
          </step>
          <step>
            <para>
            From the left navigation bar, select <menuchoice>
            <guimenu>Configuration</guimenu>  <guimenu>Add Resource</guimenu>
            <guimenu>Multi-state</guimenu> </menuchoice>.
            </para>
          </step>
          <step>
<!-- tahliar 2026-01-23: Hawk UI still says multi-state instead of promotable as of 16.0. -->
            <para>
            Enter a unique <guimenu>Multi-state ID</guimenu>.
            </para>
          </step>
          <step>
            <para>
            From the <guimenu>Child Resource</guimenu> list, select the primitive or
            group to use as a subresource for the multi-state resource.
            </para>
          </step>
          <step>
            <para>
            If needed, modify or add <guimenu>Meta Attributes</guimenu>.
            </para>
          </step>
          <step>
            <para>
            Click <guimenu>Create</guimenu> to finish the configuration. A message at
            the top of the screen shows if the action has been successful.
            </para>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
  </variablelist>
</topic>
