<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_configuring_resources.xml -->

<topic xml:id="ha-resources-creating-groups"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating resource groups</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
    Some cluster resources depend on other components or resources. They
    require that each component or resource starts in a specific order and
    runs together on the same server as the resources it depends on. To
    simplify this configuration, you can use cluster resource groups.
   </para>
   <para>
    You can create resource groups using either &hawk; or &crmsh;.
   </para>
    </abstract>
  </info>

<example xml:id="ex-ha-config-resource-group">
    <title>Resource group for a web server</title>
    <para>
     An example of a resource group would be a Web server that requires an
     IP address and a file system. In this case, each component is a
     separate resource that is combined into a cluster resource group. The
     resource group would run on one or more servers. In case of a software
     or hardware malfunction, the group would fail over to another server
     in the cluster, similar to an individual cluster resource.
    </para>
   </example>
   <figure pgwide="0">
    <title>Resource group</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ha-resource-group.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ha-resource-group.svg" width="80%"/>
     </imageobject>
     <textobject role="description">
       <phrase>
         TODO
       </phrase>
     </textobject>
    </mediaobject>
   </figure>
   <para>
    Groups have the following properties:
   </para>
   <variablelist>
    <varlistentry>
     <term>Starting and stopping</term>
     <listitem>
      <para>
       Resources are started in the order they appear in and stopped in
       reverse order.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Dependency</term>
     <listitem>
      <para>
       If a resource in the group cannot run anywhere, then none of the
       resources located after that resource in the group is allowed to
       run.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Contents</term>
     <listitem>
      <para>
       Groups may only contain a collection of primitive cluster resources.
       Groups must contain at least one resource, otherwise the
       configuration is not valid. To refer to the child of a group
       resource, use the child's ID instead of the group's ID.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Constraints</term>
     <listitem>
      <para>
       Although it is possible to reference the group's children in
       constraints, it is usually preferable to use the group's name
       instead.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Stickiness</term>
     <listitem>
      <para>
       Stickiness is additive in groups. Every <emphasis>active</emphasis>
       member of the group contributes its stickiness value to the
       group's total. So if the default
       <literal>resource-stickiness</literal> is <literal>100</literal> and
       a group has seven members (Ô¨Åve of which are active), the group as
       a whole will prefer its current location with a score of
       <literal>500</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Resource monitoring</term>
     <listitem>
      <para>
       To enable resource monitoring for a group, you must configure
       monitoring separately for each resource in the group that you want
       monitored.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>

  <itemizedlist>
    <title>Requirements</title>
    <listitem>
      <para>
        The primitive resources already exist.
      </para>
    </listitem>
  </itemizedlist>

  <variablelist role="tabs">
    <varlistentry>
      <term>&crmshell;</term>
      <listitem>
        <para>
          You can perform this procedure on any node in the cluster.
        </para>
        <procedure>
          <step>
            <para>
              Log in either as the &rootuser; user or as a user with <command>sudo</command> privileges.
            </para>
          </step>
          <step>
            <para>
              Check the list of resources:
            </para>
<screen>&prompt.user;<command>sudo crm resource status</command></screen>
            <para>
              You can only add a resource to a group if the resource is not already part of a
              <literal>Resource Group</literal> or <literal>Clone Set</literal>.
            </para>
          </step>
          <step>
            <para>
              Create a group. Add the resources in the order you want them to start:
            </para>
<screen>&prompt.user;<command>sudo crm configure group <replaceable>GROUP_NAME RESOURCE1 RESOURCE2 RESOURCE3</replaceable></command></screen>
            <para>
              The resources start in the specified order and stop in the reverse order.
            </para>
          </step>
          <step>
            <para>
              Check the configuration of the group:
            </para>
<screen>&prompt.user;<command>sudo crm configure show <replaceable>GROUP_NAME</replaceable></command></screen>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>&hawk;</term>
      <listitem>
        <para>
          You can access the &hawk; Web interface from any machine that has network access to the nodes.
        </para>
        <procedure>
          <step>
            <para>
              In a Web browser, go to
              <literal>https://<replaceable>HAWKSERVER</replaceable>:7630/</literal>
              and log in.
            </para>
          </step>
          <step>
            <para>
              From the left navigation bar, select <menuchoice> <guimenu>Configuration</guimenu>
              <guimenu>Add Resource</guimenu></menuchoice>.
            </para>
          </step>
          <step>
            <para>
              Click <guimenu>Group</guimenu>.
            </para>
          </step>
          <step>
            <para>
              Enter a unique <guimenu>Group ID</guimenu>.
            </para>
          </step>
          <step>
            <para>
              In the list of <guimenu>Children</guimenu>, select the resources to add to the group.
              You can drag and drop the resources into a different order using the icons on the
              right. The resources start in the specified order and stop in the reverse order.
            </para>
          </step>
          <step performance="optional">
            <para>
              Add <guimenu>Meta Attributes</guimenu> to the group by selecting them from the
              drop-down list.
            </para>
          </step>
          <step>
            <para>
              Click <guimenu>Create</guimenu> to finish the configuration.
            </para>
            <para>
              A message at the top of the screen shows if the action was successful.
            </para>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
  </variablelist>
</topic>
