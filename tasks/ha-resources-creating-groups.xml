<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_configuring_resources.xml -->

<topic xml:id="ha-resources-creating-groups"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating resource groups</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
    Some cluster resources depend on other components or resources. They
    require that each component or resource starts in a specific order and
    runs together on the same server as the resources it depends on. To
    simplify this configuration, you can use cluster resource groups.
   </para>
   <para>
    You can create resource groups using either &hawk; or &crmsh;.
   </para>
    </abstract>
  </info>

<example xml:id="ex-ha-config-resource-group">
    <title>Resource group for a web server</title>
    <para>
     An example of a resource group would be a Web server that requires an
     IP address and a file system. In this case, each component is a
     separate resource that is combined into a cluster resource group. The
     resource group would run on one or more servers. In case of a software
     or hardware malfunction, the group would fail over to another server
     in the cluster, similar to an individual cluster resource.
    </para>
   </example>
   <figure pgwide="0">
    <title>Resource group</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ha-resource-group.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ha-resource-group.svg" width="80%"/>
     </imageobject>
     <textobject role="description">
       <phrase>
         TODO
       </phrase>
     </textobject>
    </mediaobject>
   </figure>
   <para>
    Groups have the following properties:
   </para>
   <variablelist>
    <varlistentry>
     <term>Starting and stopping</term>
     <listitem>
      <para>
       Resources are started in the order they appear in and stopped in
       reverse order.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Dependency</term>
     <listitem>
      <para>
       If a resource in the group cannot run anywhere, then none of the
       resources located after that resource in the group is allowed to
       run.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Contents</term>
     <listitem>
      <para>
       Groups may only contain a collection of primitive cluster resources.
       Groups must contain at least one resource, otherwise the
       configuration is not valid. To refer to the child of a group
       resource, use the child's ID instead of the group's ID.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Constraints</term>
     <listitem>
      <para>
       Although it is possible to reference the group's children in
       constraints, it is usually preferable to use the group's name
       instead.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Stickiness</term>
     <listitem>
      <para>
       Stickiness is additive in groups. Every <emphasis>active</emphasis>
       member of the group contributes its stickiness value to the
       group's total. So if the default
       <literal>resource-stickiness</literal> is <literal>100</literal> and
       a group has seven members (Ô¨Åve of which are active), the group as
       a whole will prefer its current location with a score of
       <literal>500</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Resource monitoring</term>
     <listitem>
      <para>
       To enable resource monitoring for a group, you must configure
       monitoring separately for each resource in the group that you want
       monitored.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>

   <section xml:id="sec-conf-hawk2-rsc-group">
    <title>Creating resource groups with &hawk;</title>
    <note>
     <title>Empty groups</title>
     <para>
      Groups must contain at least one resource, otherwise the configuration is
      not valid. While creating a group, &hawk; allows you to create more
      primitives and add them to the group.
     </para>
    </note>
    <procedure xml:id="pro-conf-hawk2-group">
     <title>Adding a resource group with &hawk;</title>
     <step>
      <para>
       Log in to &hawk;:
      </para>
  <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
     </step>
     <step>
      <para>
       From the left navigation bar, select <menuchoice>
       <guimenu>Configuration</guimenu> <guimenu>Add Resource</guimenu>
       <guimenu>Group</guimenu> </menuchoice>.
      </para>
     </step>
     <step>
      <para>
       Enter a unique <guimenu>Group ID</guimenu>.
      </para>
     </step>
     <step>
      <para>
       To define the group members, select one or multiple entries in the list of
       <guimenu>Children</guimenu>. Re-sort group members by dragging and
       dropping them into the order you want by using the <quote>handle</quote>
       icon on the right.
      </para>
     </step>
     <step>
      <para>
       If needed, modify or add <guimenu>Meta Attributes</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Create</guimenu> to finish the configuration. A message at
       the top of the screen shows if the action has been successful.
      </para>
     </step>
    </procedure>
   </section>

   <section xml:id="sec-ha-manual-config-group">
    <title>Creating a resource group with &crmsh;</title>
    <para>
     The following example creates two primitives (an IP address and an
     e-mail resource).
    </para>
    <procedure>
     <title>Adding a resource group with &crmsh;</title>
     <step>
      <para>
       Configure the primitives:
      </para>
<screen>&prompt.crm.conf;<command>primitive Public-IP ocf:heartbeat:IPaddr2 \
    params ip=1.2.3.4 \
    op monitor interval=10s</command>
&prompt.crm.conf;<command>primitive Email systemd:postfix \
    op monitor interval=10s</command></screen>
     </step>
     <step>
      <para>
       Group the primitives with their relevant identifiers in the correct
       order:
      </para>
  <screen>&prompt.crm.conf;<command>group g-mailsvc Public-IP Email</command></screen>
     </step>
    </procedure>
   </section>
</topic>
