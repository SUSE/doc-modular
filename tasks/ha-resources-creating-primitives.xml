<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_configuring_resources.xml -->

<topic xml:id="ha-resources-creating-primitives"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating primitive resources</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
    Before you can use a resource in the cluster, it must be set up. For
    example, to use an Apache server as a cluster resource, set
    up the Apache server first and complete the Apache configuration before
    starting the respective resource in your cluster.
   </para>
   <para>
    If a resource has specific environment requirements, make sure they are
    present and identical on all cluster nodes. This kind of configuration
    is not managed by &sleha;. You must do this yourself.
   </para>
   <para>
    You can create primitive resources using either &hawk; or &crmsh;.
   </para>
    </abstract>
  </info>

<note>
    <title>Do not touch services managed by the cluster</title>
    <para>
     When managing a resource with &sleha;, the same resource must not
     be started or stopped otherwise (outside of the cluster, for example
     manually or on boot or reboot). The &ha; software is responsible
     for all service start or stop actions.
    </para>
    <para>
     If you need to execute testing or maintenance tasks after the services
     are already running under cluster control, make sure to put the
     resources, nodes, or the whole cluster into maintenance mode before you
     touch any of them manually.
    </para>
   </note>
   <important>
    <title>Resource IDs and node names</title>
    <para>Cluster resources and cluster nodes should be named differently.
     Otherwise, &hawk; fails.</para>
   </important>

   <section xml:id="sec-conf-hawk2-rsc-primitive">
    <title>Creating primitive resources with &hawk;</title>
    <para>
     To create the most basic type of resource, proceed as follows:
    </para>
    <procedure xml:id="pro-conf-hawk2-primitive-add">
     <title>Adding a primitive resource with &hawk;</title>
     <step>
      <para>
       Log in to &hawk;:
      </para>
  <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
     </step>
     <step>
      <para>
       From the left navigation bar, select <menuchoice>
       <guimenu>Configuration</guimenu> <guimenu>Add
       Resource</guimenu> <guimenu>Primitive</guimenu> </menuchoice>.
      </para>
     </step>
     <step>
      <para>
       Enter a unique <guimenu>Resource ID</guimenu>.
      </para>
     </step>
     <step>
      <para>
       If a resource template exists on which you want to base the resource
       configuration, select the respective <guimenu>Template</guimenu>.
      </para>
     </step>
     <step xml:id="step-ha-config-hawk2-primitive-start">
      <para>
       Select the resource agent <guimenu>Class</guimenu> you want to use:
       <literal>lsb</literal>, <literal>ocf</literal>,
       <literal>service</literal>, <literal>stonith</literal> or
       <literal>systemd</literal>.
      </para>
     </step>
     <step>
      <para>
       If you selected <literal>ocf</literal> as class, specify the
       <guimenu>Provider</guimenu> of your OCF resource agent. The OCF
       specification allows multiple vendors to supply the same resource agent.
      </para>
     </step>
     <step>
      <para>
       From the <guimenu>Type</guimenu> list, select the resource agent you want
       to use (for example, <guimenu>IPaddr</guimenu> or
       <guimenu>Filesystem</guimenu>). A short description for this resource
       agent is displayed.
      </para>
      <note>
       <para>
        The selection you get in the <guimenu>Type</guimenu> list depends on the
        <guimenu>Class</guimenu> (and for OCF resources also on the
        <guimenu>Provider</guimenu>) you have chosen.
       </para>
      </note>
     </step>
     <step>
      <para>
       After you have specified the resource basics, &hawk; shows
       the following categories. Either keep these categories as suggested by &hawk;,
       or edit them as required.
      </para>
      <variablelist>
       <varlistentry>
        <term>Parameters (instance attributes)</term>
        <listitem>
         <para>
          Determines which instance of a service the resource controls.
          When creating a resource, &hawk; automatically shows any required
          parameters. Edit them to get a valid resource configuration.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Operations</term>
        <listitem>
         <para>
          Needed for resource monitoring. When creating a resource, &hawk; displays
          the most important resource operations (<literal>monitor</literal>,
          <literal>start</literal> and <literal>stop</literal>).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Meta attributes</term>
        <listitem>
         <para>
          Tells the CRM how to treat a specific resource. When creating a resource,
          &hawk; automatically lists the important meta
          attributes for that resource (for example, the
          <literal>target-role</literal> attribute that defines the initial state of
          a resource. By default, it is set to <literal>Stopped</literal>, so the
          resource does not start immediately).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Utilization</term>
        <listitem>
         <para>
          Tells the CRM what capacity a certain resource requires from a node.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       Click <guimenu>Create</guimenu> to finish the configuration. A message at the
       top of the screen shows if the action has been successful.
      </para>
     </step>
    </procedure>
   </section>

   <section xml:id="sec-ha-manual-config-create">
    <title>Creating primitive resources with &crmsh;</title>
    <procedure xml:id="pro-ha-manual-config-create">
     <title>Adding a primitive resource with &crmsh;</title>
     <step>
      <para>
       Log in as &rootuser; and start the <command>crm</command> tool:
      </para>
  <screen>&prompt.root;<command>crm configure</command></screen>
     </step>
     <step>
      <para>
       Configure a primitive IP address:
      </para>
  <screen>&prompt.crm.conf;<command>primitive myIP IPaddr \
      params ip=127.0.0.99 op monitor interval=60s</command></screen>
      <para>
       The previous command configures a <quote>primitive</quote> with the
       name <literal>myIP</literal>. You need to choose a class (here
       <literal>ocf</literal>), provider (<literal>heartbeat</literal>), and
       type (<literal>IPaddr</literal>). Furthermore, this primitive expects
       other parameters like the IP address. Change the address to your
       setup.
      </para>
     </step>
     <step>
      <para>
       Display and review the changes you have made:
      </para>
  <screen>&prompt.crm.conf;<command>show</command></screen>
     </step>
     <step>
      <para>
       Commit your changes to take effect:
      </para>
  <screen>&prompt.crm.conf;<command>commit</command></screen>
     </step>
    </procedure>
   </section>
</topic>
