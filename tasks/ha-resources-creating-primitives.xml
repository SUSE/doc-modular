<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_configuring_resources.xml -->

<topic xml:id="ha-resources-creating-primitives"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Creating primitive resources</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
    Before you can use a resource in the cluster, it must be set up. For
    example, to use an Apache server as a cluster resource, set
    up the Apache server first and complete the Apache configuration before
    starting the respective resource in your cluster.
   </para>
   <para>
    If a resource has specific environment requirements, make sure they are
    present and identical on all cluster nodes. This kind of configuration
    is not managed by &sleha;. You must do this yourself.
   </para>
   <para>
    You can create primitive resources using either &hawk; or &crmsh;.
   </para>
    </abstract>
  </info>

<note>
    <title>Do not touch services managed by the cluster</title>
    <para>
     When managing a resource with &sleha;, the same resource must not
     be started or stopped otherwise (outside of the cluster, for example
     manually or on boot or reboot). The &ha; software is responsible
     for all service start or stop actions.
    </para>
    <para>
     If you need to execute testing or maintenance tasks after the services
     are already running under cluster control, make sure to put the
     resources, nodes, or the whole cluster into maintenance mode before you
     touch any of them manually.
    </para>
   </note>
   <important>
    <title>Resource IDs and node names</title>
    <para>Cluster resources and cluster nodes should be named differently.
     Otherwise, &hawk; fails.</para>
   </important>

  <variablelist role="tabs">
    <varlistentry>
      <term>&crmshell;</term>
      <listitem>
        <para>
          You can perform this procedure on any node in the cluster.
        </para>
        <procedure>
          <step>
            <para>
              Log in either as the &rootuser; user or as a user with <command>sudo</command> privileges.
            </para>
          </step>
          <step>
            <para>
            Configure a primitive resource:
            </para>
<screen>&prompt.user;<command>sudo crm configure primitive <replaceable>RESOURCE_NAME RESOURCE_AGENT</replaceable> \</command><co xml:id="co-primitive-resource"/>
  <command>params <replaceable>ATTRIBUTE=VALUE</replaceable> \</command><co xml:id="co-primitive-params"/>
  <command>op <replaceable>OPERATION ATTRIBUTE=VALUE</replaceable> \</command><co xml:id="co-primitive-op"/>
  <command>meta <replaceable>ATTRIBUTE=VALUE</replaceable> \</command><co xml:id="co-primitive-meta"/>
  <command>utilization <replaceable>ATTRIBUTE=VALUE</replaceable></command><co xml:id="co-primitive-util"/></screen>
            <calloutlist>
              <callout arearefs="co-primitive-resource">
                <para>

                </para>
             </callout>
             <callout arearefs="co-primitive-params">
                <para>

                </para>
              </callout>
              <callout arearefs="co-primitive-op">
                <para>

                </para>
             </callout>
             <callout arearefs="co-primitive-meta">
                <para>

                </para>
              </callout>
              <callout arearefs="co-primitive-util">
                <para>

                </para>
              </callout>
            </calloutlist>
          </step>
          <step>
            <para>
              Check the status of the resource:
            </para>
<screen>&prompt.user;<command>sudo crm status</command></screen>
          </step>
          <step>
            <para>
              If the resource is <literal>Stopped</literal>, you can start it with the
              following command:
            </para>
<screen>&prompt.user;<command>sudo crm resource start <replaceable>RESOURCE_NAME</replaceable></command></screen>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>&hawk;</term>
      <listitem>
        <para>
          You can access the &hawk; Web interface from any machine that has network access to the nodes.
        </para>
        <procedure>
          <step>
            <para>
              In a Web browser, go to
              <literal>https://<replaceable>HAWKSERVER</replaceable>:7630/</literal>
              and log in.
            </para>
          </step>
          <step>
            <para>
              From the left navigation bar, select <menuchoice><guimenu>Configuration</guimenu>
              <guimenu>Add Resource</guimenu></menuchoice>.
            </para>
          </step>
          <step>
            <para>
              Click <guimenu>Primitive</guimenu>.
            </para>
          </step>
          <step>
            <para>
              Enter a unique <guimenu>Resource ID</guimenu>.
            </para>
          </step>
          <step>
            <para>
              Select the resource agent <guimenu>Class</guimenu>: <literal>lsb</literal>,
              <literal>ocf</literal>, <literal>service</literal>, <literal>stonith</literal> or
              <literal>systemd</literal>.
            </para>
          </step>
          <step>
            <para>
              If you selected the <literal>ocf</literal> class, select the resource agent
              <guimenu>Provider</guimenu>.
            </para>
          </step>
          <step>
            <para>
              From the <guimenu>Type</guimenu> list, select a resource agent.
            </para>
            <para>
              &hawk; displays a description of the selected resource agent.
            </para>
          </step>
          <step>
            <para>
              After you select a resource agent, &hawk; shows the following categories. Either keep these categories as suggested by &hawk;, or edit them as required.
            </para>
            <variablelist>
            <varlistentry>
              <term>Parameters (instance attributes)</term>
              <listitem>
              <para>
                Determines which instance of a service the resource controls.
                When creating a resource, &hawk; automatically shows any required
                parameters. Edit them to get a valid resource configuration.
              </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>Operations</term>
              <listitem>
              <para>
                Needed for resource monitoring. When creating a resource, &hawk; displays
                the most important resource operations (<literal>monitor</literal>,
                <literal>start</literal> and <literal>stop</literal>).
              </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>Meta attributes</term>
              <listitem>
              <para>
                Tells the CRM how to treat a specific resource. When creating a resource,
                &hawk; automatically lists the important meta
                attributes for that resource (for example, the
                <literal>target-role</literal> attribute that defines the initial state of
                a resource. By default, it is set to <literal>Stopped</literal>, so the
                resource does not start immediately).
              </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>Utilization</term>
              <listitem>
              <para>
                Tells the CRM what capacity a certain resource requires from a node.
              </para>
              </listitem>
            </varlistentry>
            </variablelist>
          </step>
          <step>
            <para>
              Click <guimenu>Create</guimenu> to finish the configuration.
            </para>
            <para>
              A message at the top of the screen shows if the action was successful.
            </para>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
  </variablelist>
</topic>
