<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_managing_resources.xml -->

<topic xml:id="ha-resources-migrating"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Migrating cluster resources</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
   The cluster fails over (migrates) resources automatically during software or hardware
   failures, according to certain parameters you can define (for example,
   migration threshold or resource stickiness). You can also manually migrate a
   resource to another node in the cluster, or move the resource
   away from the current node and let the cluster decide where to put it.
  </para>
  <para>
   You can migrate a cluster resource using either &hawk; or &crmsh;.
  </para>
    </abstract>
  </info>

<section xml:id="sec-conf-hawk2-manage-migrate">
  <title>Migrating cluster resources with &hawk;</title>
  <procedure xml:id="pro-hawk2-rsc-migrate">
   <title>Manually migrating a resource</title>
   <step>
    <para>
     Log in to &hawk;:
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     From the left navigation bar, select <menuchoice><guimenu>Monitoring</guimenu>
     <guimenu>Status</guimenu></menuchoice>. The list of
     <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the list of <guimenu>Resources</guimenu>, select the respective
     resource.
    </para>
   </step>
   <step>
    <para>
     In the <guimenu>Operations</guimenu> column, click the arrow down button
     and select <guimenu>Migrate</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the window that opens, you have the following choices:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Away from current node</guimenu>: This creates a location
       constraint with a <literal>-INFINITY</literal> score for the current
       node.
      </para>
     </listitem>
     <listitem>
      <para>
       Alternatively, you can move the resource to another node. This creates a
       location constraint with an <literal>INFINITY</literal> score for the
       destination node.
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     Confirm your choice.
    </para>
   </step>
  </procedure>
  <para>
   To allow a resource to move back again, proceed as follows:
  </para>
  <procedure xml:id="pro-hawk2-rsc-migrate-back">
   <title>Unmigrating a resource</title>
   <step>
    <para>
     Log in to &hawk;:
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     From the left navigation bar, select <menuchoice><guimenu>Monitoring</guimenu>
     <guimenu>Status</guimenu></menuchoice>. The list of
     <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the list of <guimenu>Resources</guimenu>, go to the respective
     resource.
    </para>
   </step>
   <step>
    <para>
     In the <guimenu>Operations</guimenu> column, click the arrow down button
     and select <guimenu>Clear</guimenu>. To continue, confirm the message
     that appears.
    </para>
    <para>
     &hawk; uses the <command>crm_resource&nbsp;</command> <option>--clear</option>
     command. The resource can move back to its original location or it may
     stay where it is (depending on resource stickiness).
    </para>
   </step>
  </procedure>
  <para>
   For more information, see <link xlink:href="https://www.clusterlabs.org/pacemaker/doc/"/>.
   Refer to section <citetitle>Resource Migration</citetitle>.
  </para>
  </section>

  <section xml:id="sec-ha-manual-config-migrate">
   <title>Migrating cluster resources with &crmsh;</title>
   <para>
    Use the <command>move</command> command for this task. For example,
    to migrate the resource <literal>ipaddress1</literal> to a cluster node
    named <systemitem class="domainname">&node2;</systemitem>, use these
    commands:
   </para>
 <screen>&prompt.root;<command>crm resource</command>
 &prompt.root;<command>crm resource move ipaddress1 &node2;</command></screen>
  </section>
</topic>
