<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_managing_resources.xml -->

<topic xml:id="ha-resources-removing-migration-constraints"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Removing migration constraints from resources</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
   The cluster fails over (migrates) resources automatically during software or hardware
   failures, according to certain parameters you can define (for example,
   migration threshold or resource stickiness). You can also manually move a
   resource to another node in the cluster, or move the resource
   away from the current node and let the cluster decide where to put it.
  </para>
  <itemizedlist>
     <listitem>
      <para>
       <guimenu>Away from current node</guimenu>: This creates a location
       constraint with a <literal>-INFINITY</literal> score for the current
       node.
      </para>
     </listitem>
     <listitem>
      <para>
       Alternatively, you can move the resource to another node. This creates a
       location constraint with an <literal>INFINITY</literal> score for the
       destination node.
      </para>
     </listitem>
    </itemizedlist>
    <para>
    To allow the resource to move back to the original node, you must remove the migration
    constraint. When you remove the constraint, the resource might move back to the original node
    automatically or it might stay on the current node, depending on the resource's stickiness.
  </para>
  <para>
   You can remove a migration constraint with the &crmshell; (&crmsh;) or with &hawk;.
  </para>
    </abstract>
  </info>


  <variablelist role="tabs">
    <varlistentry>
      <term>&crmshell;</term>
      <listitem>
        <para>
          You can perform this procedure on any node in the cluster.
        </para>
        <procedure>
          <step>
            <para>
              Log in either as the &rootuser; user or as a user with <command>sudo</command>
              privileges.
            </para>
          </step>
          <step>
            <para>
              Show the existing location constraints:
            </para>
<screen>&prompt.user;<command>sudo crm configure show type:location</command></screen>
            <para>
              Migration constraints are named either
              <literal>cli-prefer-<replaceable>RESOURCE</replaceable></literal> or
              <literal>cli-ban-<replaceable>RESOURCE</replaceable>-on-<replaceable>NODE</replaceable></literal>.
            </para>
          </step>
          <step>
            <para>
              Remove the migration constraint:
            </para>
<screen>&prompt.user;<command>sudo crm resource clear <replaceable>RESOURCE</replaceable></command></screen>
          </step>
          <step>
            <para>
              Check the status to see which node the resource is now running on:
            </para>
<screen>&prompt.user;<command>sudo crm status</command></screen>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>&hawk;</term>
      <listitem>
        <para>
          You can access the &hawk; Web interface from any machine that has network access to
          the nodes.
        </para>
        <procedure>
          <step>
            <para>
              In a Web browser, go to
              <literal>https://<replaceable>HAWKSERVER</replaceable>:7630/</literal>
              and log in.
            </para>
          </step>
          <step>
            <para>
              From the left navigation bar, select <menuchoice><guimenu>Monitoring</guimenu>
              <guimenu>Status</guimenu></menuchoice>.
            </para>
          </step>
          <step>
            <para>
              Find the resource you want to remove the migration constraint from. In the
              <guimenu>Operations</guimenu> column, click the down arrow button and select
              <guimenu>Clear</guimenu>.
            </para>
          </step>
          <step>
            <para>
              Click <guimenu>OK</guimenu> to continue.
            </para>
            <para>
              The link icon disappears from the <guimenu>Status</guimenu> column.
            </para>
          </step>
          <step>
            <para>
              Check the <guimenu>Location</guimenu> column to see which node the resource is
              now running on.
            </para>
          </step>
        </procedure>
      </listitem>
    </varlistentry>
  </variablelist>
</topic>
