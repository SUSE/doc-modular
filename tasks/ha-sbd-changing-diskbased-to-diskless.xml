<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_storage_protection.xml -->

<topic xml:id="ha-sbd-changing-diskbased-to-diskless"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Changing disk-based &sbd; to diskless &sbd;</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
        Use this procedure to change disk-based &sbd; to diskless &sbd;.
      </para>
    </abstract>
  </info>

  <procedure>
    <step>
      <para>
        Put the cluster into maintenance mode:
      </para>
<screen>&prompt.root;<command>crm maintenance on</command></screen>
      <para>
        In this state, the cluster stops monitoring all resources. This allows the services managed
        by the resources to keep running even if the cluster services stop. However, be aware that
        the resources will not have cluster protection while in maintenance mode.
      </para>
    </step>
    <step>
      <para>
        Configure diskless &sbd;:
          </para>
<screen>&prompt.root;<command>crm -F cluster init sbd -S</command></screen>
      <para>
        The <option>-F</option> option allows &crmsh; to reconfigure &sbd; even if the &sbd; service is
        already running.
      </para>
    </step>
    <step>
      <para>
        Check the status of the cluster:
      </para>
<screen>&prompt.root;<command>crm status</command></screen>
      <para>
        The nodes will have the status <literal>UNCLEAN (offline)</literal>, but will soon change
        to <literal>Online</literal>.
      </para>
    </step>
    <step>
      <para>
        Check the status of the &sbd; service:
      </para>
<screen>&prompt.root;<command>systemctl status sbd</command></screen>
      <para>
        The following section should <emphasis>not</emphasis> include a device ID:
      </para>
<screen>CGroup: /system/.slice/sbd.service
        |&mdash;23314 "sbd: inquisitor"
        |&mdash;23315 "sbd: watcher: Pacemaker"
        |&mdash;23316 "sbd: watcher: Cluster"</screen>
    </step>
    <step>
      <para>
        When the nodes are back online, put the cluster back into normal operation:
      </para>
<screen>&prompt.root;<command>crm maintenance off</command></screen>
    </step>
  </procedure>
</topic>
