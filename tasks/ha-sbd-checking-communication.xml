<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>

<!-- refers to legacy doc: https://github.com/SUSE/doc-sleha/blob/main/xml/ha_storage_protection.xml -->

<topic xml:id="ha-sbd-checking-communication"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Checking &sbd; communication</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
        Check whether the &sbd; device can send and receive messages between the nodes.
        This procedure uses example nodes called <systemitem>&node1;</systemitem> and
        <systemitem>&node2;</systemitem>.
      </para>
    </abstract>
  </info>
  <procedure>
    <step>
      <para>
        On either node, list the node slots and their current messages from the &sbd; device:
      </para>
<screen>&prompt.user;<command>sudo sbd -d /dev/disk/by-id/<replaceable>DEVICE_ID</replaceable> list</command>
0      &node1;  clear
1      &node2;    clear</screen>
    </step>
    <step>
      <para>
        On <systemitem>&node2;</systemitem>, send a test message to <systemitem>&node1;</systemitem>:
      </para>
<screen>&prompt.user;<command>sudo sbd -d /dev/disk/by-id/<replaceable>DEVICE_ID</replaceable> message &node1; test</command></screen>
    </step>
    <step>
      <para>
        On <systemitem>&node1;</systemitem>, check <filename>/var/log/messages</filename> for the
        message from <systemitem>&node2;</systemitem>:
      </para>
<screen>&prompt.user;<command>sudo cat /var/log/messages | grep "test"</command>
[...]
Received command test from &node2; on disk /dev/disk/by-id/<replaceable>DEVICE_ID</replaceable></screen>
      <para>
        This confirms that &sbd; is running and ready to receive messages.
      </para>
    </step>
  </procedure>
</topic>
