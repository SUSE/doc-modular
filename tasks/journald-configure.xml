<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="journal-configure-journald"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Configuring <command>systemd-journald</command></title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="shalaka.harne@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
        You can configure the basic behavior of <command>systemd-journald</command> service by modifying <filename>/etc/systemd/journald.conf</filename>.</para>
      </abstract>
  </info>
  <para>
    To configure <command>systemd-journald</command>, proceed as follows:
  </para>
  <procedure>
    <title>Configuring <command>systemd-journald</command></title>
    <step>
      <para>Open the <command>systemd-journald</command> configuration file:</para>
<screen>&prompt.sudo; vi /etc/systemd/journald.conf</screen>
<screen>[Journal]

# Store journals on disk so logs survive reboot
Storage=persistent

# Disk space limits
SystemMaxUse=2G
SystemKeepFree=10%

# Per-file max size
SystemMaxFileSize=200M

# RAM (runtime) journal limits
RuntimeMaxUse=500M
RuntimeKeepFree=10%

# Log retention
MaxRetentionSec=4weeks

# Compression for old logs
Compress=yes

# Optional: also forward to rsyslog/syslog
ForwardToSyslog=yes</screen>
</step>
<step>
  <para>Modify the configurations:</para>
    <itemizedlist>
      <listitem>
      <para>
        To modify the storage type, modify <command>Storage=auto</command>.</para>
          <para>The available options are: </para>
          <itemizedlist>
            <listitem><para><guimenu>volatile</guimenu>: RAM only (clears on reboot).</para></listitem>
            <listitem><para><guimenu>persistent</guimenu>: stored in <filename>/var/log/journal</filename>.</para></listitem>
            <listitem><para><guimenu>auto</guimenu>: persistent if directory exists, otherwise volatile.</para></listitem>
            <listitem><para><guimenu>none</guimenu>: no logs written to disk or memory.</para></listitem>
          </itemizedlist>
          <para>If the journal log data is saved to a persistent location, it uses up to 10% of the file system the <filename>/var/log/journal</filename> resides on. For example, if <filename>/var/log/journal</filename> is located on a 30 GB /var partition, the journal may use up to 3 GB of the disk space. To change this limit, change (and uncomment) the <command>SystemMaxUse</command> option:</para>
     <screen>SystemMaxUse=50M
&prompt.sudo; systemctl restart systemd-journald</screen>
      </listitem>
      <listitem>
      <para>To limit the log rate to prevent flooding logs:</para>
        <screen>RateLimitIntervalSec=30s
RateLimitBurst=1000</screen>
    </listitem>
    <listitem>
      <para>
        To send the journal to a terminal device to inform you about system messages on a preferred terminal screen, for example <filename>/dev/tty12</filename>:
       </para>
       <screen>ForwardToConsole=yes
TTYPath=/dev/tty12</screen>
      </listitem>
      <listitem>
        <para>To forward logs to syslog, modify <command>ForwardToSyslog=yes</command>. <literal>journald</literal> is backward compatible with traditional syslog implementations such as rsyslog.</para>
        <itemizedlist>
          <listitem><para>Install rsyslog:</para><screen>rpm -q rsyslog</screen></listitem>
          <listitem><para>Enable rsyslog:</para><screen>systemctl is-enabled rsyslog</screen></listitem>
          <listitem><para>Enable forwarding to rsyslog in <filename>/etc/systemd/journald.conf</filename>:</para><screen>ForwardToSyslog=yes</screen></listitem>
        </itemizedlist>
        <para>For more information on file descriptions, see <command>man 5 journald.conf</command>.</para>
      </listitem>
    </itemizedlist>
    </step>
    <step><para>Save and restart <command>systemd-journald</command>.</para>
    <screen>&prompt.sudo; systemctl restart systemd-journald</screen>
    </step>
  </procedure>
</topic>
