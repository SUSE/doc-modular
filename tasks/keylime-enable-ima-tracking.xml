<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<topic xml:id="keylime-enable-ima-tracking"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Enabling IMA tracking for &keylime;</title>
    <meta name="maintainer" content="tbazant@suse.com" its:translate="no"/>
    <abstract>
      <para>
        The Integrity Management Architecture (IMA) detects unauthorized file
        changes in your system. &keylime; uses IMA to monitor the health status
        of remote nodes.
      </para>
    </abstract>
  </info>
  <para>
    IMA creates cryptographic hashes of files in the kernel. These hashes extend
    to Platform Configuration Register (PCR) 10 in the Trusted Platform Module
    (TPM). The verifier component requests PCR 10 quotes from the TPM. These
    quotes provide detailed logs of file access activities.
  </para>
  <para>
    To use &keylime;, you must first enable IMA/EVM support. Configure the agent
    kernel to boot with these parameters:
  </para>
  <procedure>
    <step>
      <para>
        Add parameters to <option>GRUB_CMDLINE_LINUX_DEFAULT</option> in
        <filename>/etc/default/grub</filename>:
      </para>
<screen>GRUB_CMDLINE_LINUX_DEFAULT="ima_appraise=log ima_policy=tcb"</screen>
    </step>
    <step>
      <para>
        Generate a new <filename>grub.cfg</filename>:
      </para>
<screen>&prompt.root;transactional-update grub.cfg</screen>
    </step>
    <step>
      <para>
        Reboot your system.
      </para>
    </step>
  </procedure>
  <para>
    This procedure implements the default IMA policy. We recommend creating a
    custom policy to reduce the size of generated logs. For detailed
    information, see the
    <link xlink:href="https://keylime-docs.readthedocs.io/en/latest/user_guide/runtime_ima.html">&keylime;
    documentation</link>.
  </para>
  <para>
    The <command>keylime_tenant</command> command supports these monitoring
    options:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        <option>--allowlist</option> to set expected file hashes
      </para>
    </listitem>
    <listitem>
      <para>
        <option>--exclude</option> to view ignored files
      </para>
    </listitem>
  </itemizedlist>
<screen>&prompt.root;keylime_tenant --allowlist -v 127.0.0.1 -u <replaceable>UUID</replaceable></screen>
</topic>
