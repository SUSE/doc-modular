<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="keylime-setup-verifier-and-registrar"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Setting up the &keylime; verifier and registrar</title>
    <meta name="maintainer" content="tbazant@suse.com" its:translate="no"/>
    <abstract>
      <para>
        &keylime; is a remote attestation solution that enables you to monitor
        the health of remote nodes. The <emphasis>verifier</emphasis> and
        <emphasis>registrar</emphasis> are essential components of &keylime; on
        remote systems to perform the registration and attestation of &keylime;
        agents.
      </para>
    </abstract>
  </info>
  <para>
    Before you start installing and registering agents, prepare the verifier
    and the registrar on remote hosts as described in the following procedure.
  </para>
  <procedure>
    <step>
      <para>
        Check the content of configuration files in
        <filename>/usr/etc/keylime/*.conf</filename>. The defaults are normally
        sufficient without any changes, but if you need to adjust the
        configuration, add the changes to either
        <filename>/etc/keylime/verifier.conf.d/</filename> or
        <filename>/etc/keylime/registrar.conf.d/</filename>. For the verifier
        node, set the ownership to <literal>keylime:tss</literal> and change
        the permissions as follows:
      </para>
<screen>
&prompt.root;chown -R keylime:tss /etc/keylime/verifier.conf.d/
&prompt.root;chmod -R 600 /etc/keylime/verifier.conf.d/
</screen>
    </step>
    <step>
      <para>
        Start and enable the verifier service:
      </para>
<screen>&prompt.root;systemctl enable --now keylime_verifier.service</screen>
      <para>
        Starting the service generates certificates that are further required
        by the registrar.
      </para>
    </step>
    <step>
      <para>
        If the previous command completes successfully, you can start and
        enable the registrar service:
      </para>
<screen>&prompt.root;systemctl enable --now keylime_registrar.service</screen>
    </step>
  </procedure>
</topic>
