<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: https://github.com/SUSE/doc-sle/blob/main/xml/net_bonding.xml -->

<topic xml:id="network-bond-configure"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Configuring network bonding</title>
    <meta name="maintainer" content="tahlia.richardson@suse.com" its:translate="no"/>
    <abstract>
      <para>
        Network bonding combines two or more network interfaces into a single bonded device to
        increase bandwidth and/or provide redundancy. The behavior of the bonded device is
        configured using <emphasis>bonding modes</emphasis>.
      </para>
    </abstract>
  </info>
  <section xml:id="network-bond-requirements">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          Network connection
        </para>
      </listitem>
      <listitem>
        <para>
          Existing network interfaces to include in the bonded device
        </para>
      </listitem>
      <listitem>
        <para>
          Basic understanding of networking and IP addresses
        </para>
      </listitem>
    </itemizedlist>
    <tip>
      <title>Bonding and virtualization</title>
      <para>
        Bonded devices are made up of multiple network interfaces. In most configurations you should
        only configure bonding in the host. Virtual interfaces to guests are then created as a bridge
        with the bonded devices, simplifying guest creation and deployment.
      </para>
      <para>
        It is possible, but not recommended, to configure bonding in a guest. When configuring
        bonding in a guest you must assign multiple interfaces to the guest, and configure the host
        without bonding. You must also be careful to configure the host and its network bridges so
        that you do not mix bonding in the host and guests.
      </para>
    </tip>
  </section>
  <section xml:id="network-bond-modes">
    <title>Bonding modes</title>
    <para>
      The following bonding modes are available:
    </para>
    <variablelist>
      <varlistentry>
        <term><guimenu>0</guimenu> (<guimenu>balance-rr</guimenu>)</term>
        <listitem>
          <para>
            Packets are transmitted in round-robin fashion from the first to the last available
            interface. Provides fault tolerance and load balancing. Requires switch support.
            Certain switches might fail with this mode.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>1</guimenu> (<guimenu>active-backup</guimenu>)</term>
        <listitem>
          <para>
            Only one network interface is active. If it fails, a different interface becomes active.
            Provides fault tolerance. This is the default mode. No specific switch support is required.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>2</guimenu> (<guimenu>balance-xor</guimenu>)</term>
        <listitem>
          <para>
            Traffic is split between all available interfaces based on the number of interfaces
            included in the bonded device. Provides fault tolerance and load balancing. Requires
            switch support. Certain switches might fail with this mode.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>3</guimenu> (<guimenu>broadcast</guimenu>)</term>
        <listitem>
          <para>
            All traffic is broadcast on all interfaces. Provides fault tolerance.
            Requires switch support. Certain switches might fail with this mode. If possible,
            use mode <guimenu>1</guimenu> instead, or use this mode to provide sniffing capability
            by connecting each member of the bond to different switches or devices.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>4</guimenu> (<guimenu>802.3ad</guimenu>)</term>
        <listitem>
          <para>
            Also called <emphasis>LACP</emphasis>. All interfaces in the LACP group must share the
            same speed and duplex settings, and must be connected to the same switch. Provides
            fault tolerance and load balancing. Requires <command>ethtool</command> support in the
            interface drivers, and a switch that supports and is configured for IEEE 802.3ad Dynamic
            link aggregation. If your switch supports it, this is the preferred mode.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>5</guimenu> (<guimenu>balance-tlb</guimenu>)</term>
        <listitem>
          <para>
            Adaptive transmit load balancing. Provides fault tolerance and load balancing. Requires
            <command>ethtool</command> support in the interface drivers. No specific switch support
            is required, but certain switches might fail with this mode.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>6</guimenu> (<guimenu>balance-alb</guimenu>)</term>
        <listitem>
          <para>
            Adaptive load balancing. Provides fault tolerance and load balancing. Requires
            <command>ethtool</command> support in the interface drivers. No specific switch support
            is required, but certain switches might fail with this mode.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>
      Consult your hardware manual to check which modes your switch supports.
    </para>
    <para>
      For a more detailed description of the modes, see
      <link xlink:href="https://www.kernel.org/doc/Documentation/networking/bonding.txt"/>.
    </para>
    <note arch="power">
      <title>
        IBM &power;: Bonding modes 5 and 6 (<literal>balance-tlb</literal> and
        <literal>balance-alb</literal>) unsupported by ibmveth
      </title>
      <para>
        The bonding drivers in <literal>tlb</literal> mode and <literal>alb</literal> mode send
        Ethernet Loopback packets with both the source and destination MAC addresses listed as the
        Virtual Ethernet MAC address. These packets are not supported by Power firmware.
        Therefore, bonding modes 5 and 6 are unsupported by ibmveth.
      </para>
    </note>
  </section>
  <section xml:id="network-bond-configure-with-yast">
    <title>Configuring network bonding with &yast;</title>
<!--trichardson 2023-05-19: It might be good to also add a section for configuring bonding manually?-->
    <procedure>
      <step>
        <para>
          Start the graphical version of &yast;, or run the command <command>yast2</command> to
          start &yast; in text mode.
        </para>
      </step>
      <step>
        <para>
          Select <menuchoice><guimenu>System</guimenu><guimenu>Network Settings</guimenu></menuchoice>.
        </para>
      </step>
      <step>
        <para>
          Select <guimenu>Add</guimenu> and change the <guimenu>Device Type</guimenu> to
          <guimenu>Bonding</guimenu>.
        </para>
      </step>
      <step>
        <para>
          Select <guimenu>Next</guimenu> to open the <guimenu>Network Card Setup</guimenu> menu.
        </para>
      </step>
      <step>
        <para>
          In the <guimenu>Address</guimenu> tab, select how to assign an IP address to the bonded
          device:
        </para>
        <itemizedlist>
          <listitem>
            <para>
              <guimenu>Dynamic Address</guimenu>: Automatically assign a dynamic IP address.
              The default setup is to use DHCP with both IPv4 and IPv6. You can change these
              settings if required.
            </para>
          </listitem>
          <listitem>
            <para>
              <guimenu>Statically Assigned IP Address</guimenu>: Manually assign an
              <guimenu>IP Address</guimenu>, <guimenu>Subnet Mask</guimenu>, and
              <guimenu>Hostname</guimenu>.
            </para>
          </listitem>
          <listitem>
            <para>
              Do not use <guimenu>No Link and IP Setup</guimenu>. This option is only used for
              individual network interfaces that will be added to a bonded device.
            </para>
          </listitem>
        </itemizedlist>
      </step>
      <step>
        <para>
          In the <guimenu>Bond Ports</guimenu> tab, select the network interfaces to include in the
          bonded device by activating the check boxes.
        </para>
      </step>
      <step>
        <para>
          From the <guimenu>Bond Driver Options</guimenu> drop-down box, choose a bonding mode.
          The default mode is <literal>active-backup</literal>.
        </para>
        <important role="compact">
          <para>
            Do not remove <literal>miimon=100</literal>. Without this parameter, data integrity
            is not checked regularly.
          </para>
        </important>
      </step>
      <step>
        <para>
          Select <guimenu>Next</guimenu>.
        </para>
      </step>
      <step>
        <para>
          If you are prompted to adapt the existing configuration for bonding, select
          <guimenu>Continue</guimenu>.
        </para>
      </step>
      <step>
        <para>
          Select <guimenu>OK</guimenu> to create the bonded device.
        </para>
      </step>
      <step>
        <para>
          Select <guimenu>Quit</guimenu> or press <keycap>F9</keycap> to close &yast;.
        </para>
      </step>
    </procedure>
  </section>
  <!--section xml:id="task-example-summary">
    <title>Summary</title>
    <para>
      A paragraph of text, summing up the result of the task.
    </para>
  </section-->
  <!--section xml:id="task-example-troubleshooting">
    <title>Troubleshooting</title>
    <para>
      Add some troubleshooting information, if applicable.
    </para>
  </section-->
</topic>
