<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="networkmanager-nmcli-configure"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Configuring NetworkManager</title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="shalaka.harne@suse.com" its:translate="no"/>
    <abstract>
        <para>
        NetworkManager is a tool that enables configuring network connections and devices. NetworkManager provides a CLI interface to manage your connections. By using the nmcli interface, you can connect to a particular network, edit a connection, edit a device, and so on. You can configure ethernet connection, Wi-Fi connection, network bonding, network teaming, network  bridge, and VPN connection using NetworkManager.
        The behavior of NetworkManager is defined in <filename>/etc/NetworkManager/NetworkManager.conf</filename>. You can configure the settings on how NetworkManager must behave such as the connectivity details, logging and so on in the <filename>NetworkManager.conf</filename> file.</para>
 </abstract>
   </info>
<section><title>Configuring NetworkManager behavior</title>
<para>The main configuration file for the NetworkManager is <filename>/etc/NetworkManager/NetworkManager.conf</filename>. This file can be used to configure the behavior of NetworkManager.</para>
<para>The file consists of sections of key-value pairs. Each key-value pair must belong to a section. A section starts with a name enclosed in <literal>[]</literal>. Lines beginning with a <literal>#</literal> are considered comments. A common configuration includes the <literal>[main]</literal> section with the <literal>plugins</literal> value, <literal>[logging]</literal>, and <literal>[connectivity]</literal>:</para>
<screen>   [main]
plugins=keyfile
dhcp=dhclient

[connectivity]
uri=http://name.org

[logging]
level=INFO
domains=ALL
</screen>
<itemizedlist>
<listitem>
  <para><code>[main]</code> controls the general settings for NetworkManager.</para>
</listitem>
<listitem>
  <para><code>[connectivity]</code> defines connection defaults and options.</para>
</listitem>
<listitem>
  <para><code>[logging]</code> manages the NetworkManager logging levels and domains.</para>
</listitem>
<listitem>
  <para><code>[keyfile]</code> manages how the connection profiles are stored.</para>
</listitem>
</itemizedlist>
<para> The [keyfile] plug-in supports all the connection types and capabilities of NetworkManager.</para>
<para>The default configuration file contains the connectivity section that specifies the URI to check the network connection.</para>
<procedure><title>Modifying NetworkManager.conf</title>
<step><para>Open the configuration file.</para>
<screen>&prompt.sudo; vi /etc/NetworkManager/NetworkManager.conf</screen>
</step>
<step><para>Modify the sections.</para></step>
<step><para>Save the changes and restart NetworkManager.</para>
<screen>&prompt.sudo; systemctl restart NetworkManager</screen></step>
<step><para>To view the existing configuration and settings, run the following command:</para>
<screen>nmcli general show
</screen></step>
</procedure>
</section>
<section><title>Configuring an ethernet connection</title>
  <para>To configure the ethernet connection using the <command>nmcli</command> command, proceed as follows:</para>
  <procedure xml:id="networkmanager-ethernet">
    
    <step><para>View the list of connection using the command:</para>
  <screen>nmcli connection show</screen>
<para>The NetworkManager creates profile for each Network Interface Controller (NIC). You must create separate profiles for each network to connect the NIC to networks with different settings.</para>
<para>To create a new connection profile, run the command <command>nmcli connection add con-name <replaceable>connection-name</replaceable> ifname <replaceable>device-name</replaceable> type ethernet</command>.</para>
<para>To rename an existing profile, run the command <command>nmcli connection modify "<replaceable>ExistingConnection</replaceable>" connection.id "<replaceable>NewConnection</replaceable>"</command></para>
</step>
<step><para>View the existing network settings of the new connection profile using the command:</para>
<screen>nmcli connection show NewConnection</screen>
</step>
<step><para>Configure the IPv4 settings:</para>
<substeps>
  <step><para>To use DHCP, run the command:</para>
  <screen>nmcli connection modify <replaceable>NewConnection</replaceable> ipv4.method auto</screen></step>
  <step><para>To configure a static IPv4 address, network mask, default gateway, DNS servers, and search domain, run the command:</para>
    <screen>nmcli connection modify <replaceable>NewConnection</replaceable> ipv4.method manual ipv4.addresses 192.0.2.1/24 ipv4.gateway 192.0.2.254 ipv4.dns 192.0.2.200 ipv4.dns-search example.com</screen>
    </step>
  </substeps>
</step>
<step>
  <para>Configure the IPv6 settings:</para>
  <substeps>
    <step>
      <para>To use stateless address autoconfiguration (SLAAC), run the command:</para>
    <screen>nmcli connection modify <replaceable>NewConnection</replaceable> ipv6.method auto</screen></step>
    <step>
      <para>To configure a static IPv6 address, network mask, default gateway, DNS servers, and search domain, run the command:</para>
      <screen>nmcli connection modify Internal-LAN ipv6.method manual ipv6.addresses 2001:db8:1::fffe/64 ipv6.gateway 2001:db8:1::fffe ipv6.dns 2001:db8:1::ffbb ipv6.dns-search example.com</screen>
      </step>
    </substeps>
  </step>
  <step>
    <para>Configure other settings in the profile using the command:</para>
  <screen>nmcli connection modify <replaceable>Nameoftheconnection</replaceable> <replaceable>setting</replaceable> <replaceable>value</replaceable></screen>
  </step>
  <step><para>Activate the profile using the command:</para>
  <screen>nmcli connection up <replaceable>NewConnection</replaceable></screen>
  </step>
  <step><para>Verify the configurations:</para>
  <substeps><step><para>Verify the IP settings of the NIC:</para>
  <screen>ip address show <replaceable>nameofthehost</replaceable></screen>
    </step>
    <step><para>Verify the default IPv4 gateway:</para>
      <screen>ip route show default</screen>
        </step>
        <step><para>Verify the default IPv6 gateway:</para>
          <screen>ip -6 route show default</screen>
            </step>
            <step><para>View the DNS settings:</para>
              <screen>cat /etc/resolv.conf</screen>
                </step>
  </substeps>
  </step>
</procedure>
</section>
<section xml:id="configure-wifi"><title>Configuring Wi-Fi connection</title>
<para>You can connect to a Wi-Fi using the <command>nmcli</command>. The NetworkManager creates a new connection profile when you connect to a Wi-Fi. You can configure the profile after connecting to the Wi-Fi.</para>
<procedure>
  <step>
    <para>Enable the Wi-Fi radio using the command:</para>
      <screen>nmcli radio wifi on</screen>
    
  </step>
  <step><para>Connect to Wi-Fi using the command:
     </para>
     <screen>nmcli device wifi connect <replaceable>Wi-FiConnectionName</replaceable> <replaceable>password</replaceable> </screen>
<para>To view the list of available Wi-Fi Networks and their SSIDs, run the command <command>nmcli device list</command>.</para>
<note><para>You can configure the connection if your Wi-Fi network requires static IP address.</para>
  <para>Configure iPV4 settings using the command:</para>
<screen>nmcli connection modify <replaceable>Wi-FiConnectionName</replaceable> ipv4.method manual ipv4.addresses <replaceable>IP_Address/subnet mask</replaceable></screen></note>
  <para>Configure iPV6 settings using the command:</para>
  <screen>nmcli connection modify <replaceable>Wi-FiConnectionName</replaceable> ipv6.method manual ipv6.addresses <replaceable>IP_Address/subnet mask</replaceable></screen>
</step>
<step><para>Enable the connection using the command:</para>
<screen>nmcli connection up <replaceable>Wi-FiConnectionName</replaceable></screen>
</step>
<step><para>Verify the connection using the command <command>nmcli connection show --active</command>.</para>
<para>The list of available active connections appears.</para>
</step>
</procedure>
</section>
<section xml:id="configure-network-bond">
  <title>Configuring a network bond</title>
<para>A network bond combines physical and virtual network interfaces and it provides a logical interface. You can create network bonds on ethernet devices, Virtual LANs, and so on.</para>
<para>You must have two or more physical or virtual networks installed on the server.
</para>
<itemizedlist><listitem><para>If you use ethernet devices as network bond, you must install the physical or virtual ethernet devices on the server.</para></listitem>
<listitem><para> If you use network team, network bridge, or VLAN devices as ports for the bond, you can create these network team, bridge, and VLAN while creating network bond or create these before creating network bond.</para></listitem>
</itemizedlist>
<procedure xml:id="network-bond-configuration">
  <title>Creating network bond</title>
  <step><para>Create a bond interface using the command:</para>
  <screen>nmcli connection add type bond con-name <replaceable>nwbond</replaceable> ifname <replaceable>nwbond</replaceable> bond.options "mode=active-backup"</screen>
  <para>
   A network bond, <replaceable>nwbond</replaceable> that uses <varname>active-backup</varname> mode is created.
  </para>
  <para>You can run the following command to set Media Independent Interface (MII) monitoring interval.
  </para>
  <screen>nmcli connection add type bond con-name <replaceable>nwbond</replaceable> ifname <replaceable>nwbond</replaceable> bond.options "mode=active-backup, miimon=1000"</screen>
  </step>
  <step><para>To view the list of network interfaces, run the command:</para>
  <screen>nmcli device status
  </screen>
  <screen>DEVICE         TYPE      STATE                   CONNECTION    
    wlan0          wifi      connected               Vision 
    virbr0         bridge    connected (externally)  virbr0        
    p2p-dev-wlan0  wifi-p2p  disconnected            --            
    eth0           ethernet  unavailable             --            
    lo             loopback  unmanaged               --   </screen>
<para>The list of available network interfaces appear. You can configure the devices that are not configured. You can configure the devices that are not configured.
  In the given list, p2p-dev-wlan0 , is not configured and virbr0 is configured and have connection profile.</para>
</step>
<step><para>To configure p2p-dev-wlan0 as port, create connection profile using the following command:</para>
<screen>nmcli connection add type wifi-p2p slave-type bond con-name bond0-port1 ifname p2p-dev-wlan0 master bond0</screen>
<para>A new profile is created for  p2p-dev-wlan0 and added to the bond0 connection.</para></step>
<step><para>To assign existing connection to bond, run the command:</para>
<para>nmcli connection modify virbr0 master bond0</para>
<para>The  connection profile for virbr0  is added to the bond0 connection.</para>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up virbr0</screen></step>
<step><para>Configure the IPv4 settings:</para>
<substeps><step><para>To use the bond0 as port for other devices, run the command:</para>
<screen>nmcli connection modify bond0 ipv4.method disabled</screen>
</step>
<step><para>To use DHCP, no configuration is required.
</para></step>
<step><para>To configure static IPv4 address, network mask, default gateway, and DNS server to the bond0 connection, run the command:</para>
<screen>nmcli connection modify bond0 ipv4.addresses '192.0.2.1/24' ipv4.gateway '192.0.2.254' ipv4.dns '192.0.2.253' ipv4.dns-search 'example.com' ipv4.method manual
</screen>
</step>
</substeps>
</step>
<step><para>Configure the IPv6 settings</para>
<substeps><step><para>To use this bond device as a port of other devices, enter:</para>
<screen>nmcli connection modify bond0 ipv6.method disabled</screen>
</step>
<step><para>To use stateless address autoconfiguration (SLAAC), no action is required. </para></step>
<step><para>To set a static IPv6 address, network mask, default gateway, and DNS server to the bond0 connection, enter:</para>
<screen>nmcli connection modify bond0 ipv6.addresses '2001:db8:1::1/64' ipv6.gateway '2001:db8:1::fffe' ipv6.dns '2001:db8:1::fffd' ipv6.dns-search 'example.com' ipv6.method manual
</screen>
</step>
</substeps>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up bond0</screen>
</step>
<step><para>View and verify the connections using the command:</para>
<screen>nmcli device</screen>
<para>The list of connections appear.</para>
</step>
</procedure>
</section>
<section xml:id="configure-network-team">
  <title>Configuring a network team</title>
<para>Network teaming combines physical and virtual networks and provides a logical interface with higher efficiency. You can configure Network team using nmcli.</para>
<para>To configure network team, ensure the following:</para>
<itemizedlist>
  <listitem>
    <para>Install the teamd and NetworkManager-team packages.</para>
  </listitem>
<listitem>
  <para>Install two or more physical or virtual devices on the server.</para>
</listitem>
<listitem>
  <para>
    To use Ethernet devices as ports of the team, the physical or virtual Ethernet devices must be installed on the server and connected to a switch.
  </para>
</listitem>
<listitem>
  <para>To use bond, bridge, or VLAN devices as ports of the team, you can either create these devices while you create the team or you can create them in advance.</para>
</listitem>
</itemizedlist>
<procedure>
  <title>Creating network team</title>
  <step><para>Create a team interface using the command:</para>
  <screen>nmcli connection add type team con-name team0 ifname team0 team.runner activebackup</screen>
  <para>
   A network team, <replaceable>team0</replaceable> that uses the activebackup runner is created.
  </para>
  </step>
  <step>
  <para>To view the list of network interfaces, run the command:</para>
  <screen>nmcli device status
  </screen>
  <screen>DEVICE         TYPE      STATE                   CONNECTION    
    wlan0          wifi      connected               Vision 
    virbr0         bridge    connected (externally)  virbr0        
    p2p-dev-wlan0  wifi-p2p  disconnected            --            
    eth0         ethernet  unavailable             --            
    lo             loopback  unmanaged               --     
    </screen>
<para>The list of available network interfaces appear. You can add the interfaces to the team. In the given list, p2p-dev-wlan0, is not configured and virbr0 is configured and have connection profile.
  </para>
</step>
<step><para>To configure port interfaces to the team, run the following command:</para>
<screen>nmcli connection add type wifi-p2p slave-type team con-name team0-port1 ifname p2p-dev-wlan0 master team0</screen>
<para>A new profile is created for  p2p-dev-wlan0 and added to the bond0 connection.</para></step>
<step><para>To assign existing connection to the team, run the command:</para>
<screen>nmcli connection modify bond0 master team0</screen>
<para>The  connection profile for bond0  is added to the team0 connection.</para>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up bond0</screen></step>
<step><para>Configure the IPv4 settings:</para>
<substeps><step><para>To use the team device as port of other devices, run the command:</para>
<screen>nmcli connection modify team0 ipv4.method disabled</screen>
</step>
<step><para>To use DHCP, no configuration is required.
</para></step>
<step><para>To configure static IPv4 address, network mask, default gateway, and DNS server to the bond0 connection, run the command:</para>
<screen>nmcli connection modify team0 ipv4.addresses '192.0.2.1/24' ipv4.gateway '192.0.2.254' ipv4.dns '192.0.2.253' ipv4.dns-search 'example.com' ipv4.method manual</screen>
</step>
</substeps>
</step>
<step><para>Configure the IPv6 settings</para>
<substeps><step><para>To use this team device as a port of other devices, enter:</para>
<screen>nmcli connection modify team0 ipv6.method disabled</screen>
</step>
<step><para>To use stateless address autoconfiguration (SLAAC), no action is required. </para></step>
<step><para>To set a static IPv6 address, network mask, default gateway, and DNS server to the team0 connection, enter:</para>
<screen>nmcli connection modify team0 ipv6.addresses '2001:db8:1::1/64' ipv6.gateway '2001:db8:1::fffe' ipv6.dns '2001:db8:1::fffd' ipv6.dns-search 'example.com' ipv6.method manual
</screen>
</step>
</substeps>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up team0</screen>
</step>
<step><para>To view the status of the team, run the command:</para><screen>teamdctl team0 state</screen></step>
</procedure>
</section>
<section xml:id="configure-network-bridge">
  <title>Configuring a network bridge</title>
<para>To configure network bridge, ensure the following:</para>
<itemizedlist>
<listitem>
  <para>Install two or more physical or virtual devices on the server.</para>
</listitem>
<listitem>
  <para>
    To use Ethernet devices as ports of the team, the physical or virtual Ethernet devices must be installed on the server and connected to a switch.
  </para>
</listitem>
<listitem>
  <para>To use team, bond, or VLAN devices as ports of the team, you can either create these devices while you create the team or you can create them in advance.</para>
</listitem>
</itemizedlist>
<procedure xml:id="network-bridge-configuration">
  <title>Creating network bridge</title>
  <step><para>Create a bridge interface using the command:</para>
  <screen>nmcli connection add type bridge con-name bridge0 ifname bridge0</screen>
  <para>
   A network bridge, bridge0 is created.
  </para></step>
  <step><para>To view the list of network interfaces, run the command:</para>
  <screen>nmcli device status
  </screen>
  <screen>DEVICE         TYPE      STATE                   CONNECTION    
    wlan0          wifi      connected               Vision 
    virbr0         bridge    connected (externally)  virbr0        
    p2p-dev-wlan0  wifi-p2p  disconnected            --            
    eth0           ethernet  unavailable             --            
    lo             loopback  unmanaged               --      </screen>
<para>The list of available network interfaces appear. You can add the interfaces to the bridge. In the given list, p2p-dev-wlan0, is not configured and virbr0 is configured and have connection profile.
  </para>
</step>
<step><para>To configure interfaces to the bridge, run the following command:</para>
<screen>nmcli connection add type wifi-p2p slave-type bridge con-name bridge0-port1 ifname p2p-dev-wlan0 master bridge0</screen>
<para>A new profile is created for  p2p-dev-wlan0 and added to the bridge0 connection.</para></step>
<step><para>To assign existing connection to the bridge, run the command:</para>
<para>nmcli connection modify bond0 master bridge0</para>
<para>The  connection profile for bond0  is added to the bridge0 connection.</para>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up bond0</screen></step>
<step><para>Configure the IPv4 settings:</para>
<substeps><step><para>To use the bridge device as port of other devices, run the command:</para>
<screen>nmcli connection modify bridge0 ipv4.method disabled</screen>
</step>
<step><para>To use DHCP, no configuration is required.
</para></step>
<step><para>To configure static IPv4 address, network mask, default gateway, and DNS server to the bridge0 connection, run the command:</para>
<screen>nmcli connection modify bridge0 ipv4.addresses '192.0.2.1/24' ipv4.gateway '192.0.2.254' ipv4.dns '192.0.2.253' ipv4.dns-search 'example.com' ipv4.method manual</screen>
</step>
</substeps>
</step>
<step><para>Configure the IPv6 settings</para>
<substeps><step><para>To use this bridge device as a port of other devices, enter:</para>
<screen>nmcli connection modify bridge0 ipv6.method disabled</screen>
</step>
<step><para>To use stateless address autoconfiguration (SLAAC), no action is required. </para></step>
<step><para>To set a static IPv6 address, network mask, default gateway, and DNS server to the bridge0 connection, enter:</para>
<screen>nmcli connection modify bridge0 ipv6.addresses '2001:db8:1::1/64' ipv6.gateway '2001:db8:1::fffe' ipv6.dns '2001:db8:1::fffd' ipv6.dns-search 'example.com' ipv6.method manual
</screen>
</step>
</substeps>
</step>
<step><para>Activate the connection using the command:</para>
<screen>nmcli connection up bridge0</screen>
</step>
<step><para>To verify the connection, run the command:</para>
<screen>nmcli device</screen>
<para>When you activate any port of the connection, NetworkManager also activates the bridge, but not the other ports of it. Run the following command to enable all ports automatically when the bridge is enabled.</para>
<screen>nmcli connection modify bridge0 connection.autoconnect-slaves 1</screen>
</step>
<step><para>Activate the connection.</para>
  <screen>nmcli connection up bridge0</screen>
</step>
<step>
  <para>Run the following command to view the link status of Ethernet devices that are ports of a specific bridge.</para>
  <screen>ip link show master bridge0</screen>
</step>
<step>
  <para>
    Run the following command to view the status of Ethernet devices that are ports of any bridge device. 
  </para>
  <screen>bridge link show</screen>
</step>
</procedure>
</section>
<section xml:id="configure-vpn-connection">
  <title>Configuring a VPN connection</title>
<para>You can configure a VPN connection using the nmcli command. You must have NetworkManager and nmcli installed to configure a VPN connection.</para>
<procedure xml:id="configure-vpn-connections">
  <title>Configuring a VPN Connection</title>
  <step><para>To install OpenVPN, run the command:</para>
  <screen>&prompt.sudo; zypper install networkmanager-openvpn
&prompt.sudo; zypper install openvpn</screen></step>
   <step><para>To create a VPN connection, run the following command:</para>
  <screen>nmcli connection add type vpn con-name MyOpenVPN ifname -- vpn-type openvpn
nmcli connection modify MyOpenVPN vpn.data "remote=<replaceable>vpn-server-address</replaceable>,username=<replaceable>your-username</replaceable>"
nmcli connection modify MyOpenVPN vpn.secrets "password=<replaceable>your-password</replaceable>"</screen>
</step>
<step><para>To configure DNS settings, run the following command:</para>
<screen>nmcli connection modify MyOpenVPN ipv4.dns "8.8.8.8 8.8.4.4"</screen></step>
<step><para>To add routes, run the following command:</para>
<screen>nmcli connection modify MyOpenVPN ipv4.routes "192.168.1.0/24 192.168.1.1"</screen>
</step>
<step><para>To activate the VPN connections, rum the command::</para>
<screen>nmcli connection up MyOpenVPN</screen></step>
<step><para>To verify if the configured connection is active, run the command:</para>
<screen>nmcli connection show --active</screen>
</step>
</procedure>
</section>
</topic>