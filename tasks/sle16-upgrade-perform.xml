<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="sle16-upgrade-preform"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <!-- can be changed via merge in the assembly -->
    <title>Upgrading to &sle; with the distribution management </title>
    <!-- add author's e-mail -->
    <meta name="maintainer" content="cwickert@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
        This section describes the actual upgrade procedure with the distribution migration system.
      </para>
    </abstract>
  </info>
  <section xml:id="task-sle16-upgrade-requirements">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          The system must be registered with the &scc; or an &rmt; server.
          &quot;Pay as you go&quot; instances in the public cloud are automatically registered
          to the SUSE-operated update infrastructure.
        </para>
      </listitem>
      <listitem>
        <para>
          The upgrade path must be supported. Currently, it is only possible to upgrade from 
          &productname; 15&nbsp;SP7 to 16.0. It is possible to configure other versions of
          &productname; as the migration target, but doing so is not a tested or supported use case.
        </para>
      </listitem>
      <listitem>
        <para>
         The server that provides the migration target must have the appropriate repositories
         synced, and they must be up to date. This requirement is automatically met by the &scc;, and
         the &suse;-operated update infrastructure in the public cloud. If you are using an &rmt;
         server, make sure to mirror all relevant channels.
        </para>
      </listitem>
      <listitem>
        <para>
          The operating system needs to reside on a single partition.
          Support for multiple partitions, such as LVM, is limited to configurations where the
          separated partitions do not contain OS-critical data or processes. For example, a separate
          <filename>/home</filename> partition will function whereas a separate
          <filename>/var</filename> will not.
        </para>
      </listitem>
    </itemizedlist>
    <note>
      <title>SSH access during upgrade</title>
      <para>
        During the upgrade, it is only possible to log in via SSH key-based login.
        If your system is not configured for it, it is recommended that at least
        one of the users on the system has a <filename>~/.ssh/authorized_keys</filename> file with a
        private key accessible by the person executing the system upgrade.
      </para>
    </note>
  </section>
  <section xml:id="task-sle16-upgrade-executing">
    <title>Upgrading to &productname; &productnumber;</title>
    <para>
      The distribution migration process can be invoked using two different methods. One method
      is the <command>run_migration</command> included with the <package>SLES16-Migration</package>
      package. The second method to invoking the migration process is via reboot after installing
      the <package>suse-migration-sle16-activation</package> package.
    </para>
    <para>
      Depending on your architecture, perform the following steps for your architecture to trigger
      the upgrade:
    </para>
    <variablelist>
      <varlistentry>
        <term>Use <command>reboot</command> on x86_64, aarch64, ppc64le</term>
        <listitem>
          <para>
            After installing the <package>suse-migration-sle16-activation</package> package, start
            the migration process by rebooting the system:
            </para>
<screen>&prompt.sudo; <command>zypper</command> in suse-migration-sle16-activation
&prompt.sudo; reboot</screen>
            <para>
              The <package>suse-migration-sle16-activation</package> package installs
              <package>SLES16-Migration</package> as a dependency and modifies the bootloader
              configuration to boot into the upgrade image.
            </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Use <command>run_migration</command> on s390x: </term>
        <listitem>
          <para>
            Modifying the boot loader configuration is not supported on s390x, so you start
            the migration directly with <command>run_migration</command>.
          </para>
<screen>&prompt.sudo; <command>zypper</command> in SLES16-Migration
&prompt.sudo; <command>run_migration</command></screen>
          <para>
            The <command>run_migration</command> utility uses <command>&kexec;</command> and does 
            not work in &xen;-based environments. If <command>&kexec;</command> causes a kernel
            panic, refer to this TID: https://www.suse.com/support/kb/doc/?id=000019733 and set the 
            <option>soft_reboot</option> customization option.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  <!-- 
  </section>
  <section xml:id="sle16-upgrade-summary">
    <title>Summary</title>
    <para>
      A paragraph of text, summing up the result of the task.
    </para>
  </section>
  <section xml:id="sle16-upgrade-troubleshooting">
    <title>Troubleshooting</title>
    <para>
      Add some troubleshooting information, if applicable.
    </para>
  -->
  </section>
</topic>
