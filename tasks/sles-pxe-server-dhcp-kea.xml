<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refer to README.md for file and id naming conventions -->
<topic xml:id="sles-pxe-server-dhcp-kea"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Configuring Kea DHCP for HTTPBoot-based PXE booting</title>
    <meta name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
    <abstract>
      <para>
        This section explains how to configure Kea DHCP to provide the necessary PXE boot options
        to clients in a modern HTTP-based setup, using UEFI HTTPBoot in combination with &grub; and
        the &agama; installer.
      </para>
      <note>
        <title>Recommended for UEFI HTTPBoot-based setups</title>
        <para>
          Kea is the only supported DHCP server in this documentation that provides full support
          for UEFI HTTPBoot (via DHCP option 59). Use Kea when you intend to boot clients entirely
          via HTTP without relying on TFTP.
        </para>
        <para>
          If you use dnsmasq or legacy ISC DHCP, HTTPBoot will not function as expected. Those
          methods are suitable only for TFTP-based setups.
        </para>
      </note>
    </abstract>
  </info>
  <section xml:id="sles-pxe-server-dhcp-kea-intro">
    <title>Introduction</title>
    <para>
      Kea DHCP is a modern, modular DHCP server developed by ISC. Unlike traditional ISC DHCP, it
      supports dynamic reconfiguration, high availability, and modern PXE workflows including
      HTTPBoot via DHCP option 59. This section describes a minimal configuration for using Kea
      with &grub; over HTTP.
    </para>
  </section>
  <section xml:id="sles-pxe-server-dhcp-kea-reqs">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          The <literal>kea-dhcp4</literal> package must be installed.
        </para>
      </listitem>
      <listitem>
        <para>
          Administrative privileges are required to modify configuration and control the service.
        </para>
      </listitem>
      <listitem>
        <para>
          &grub; bootloader must be accessible via HTTP from the client, typically served by
          <literal>nginx</literal>.
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section xml:id="sles-pxe-server-dhcp-kea-exec">
    <title>Configuring Kea DHCP server</title>
    <para>
      Use the following procedure to define a PXE-capable Kea configuration for UEFI clients.
    </para>
    <procedure>
      <step>
        <para>
          Edit the configuration file <filename>/etc/kea/kea-dhcp4.conf</filename> and include the
          following content.
        </para>
        <example>
          <title>Sample Kea DHCP configuration for HTTPBoot</title>
<screen>
{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": [ "eth0" ]
    },
    "subnet4": [
      {
        "subnet": "192.168.1.0/24",
        "pools": [
          { "pool": "192.168.1.100 - 192.168.1.200" }
        ],
        "next-server": "192.168.1.10",
        "boot-file-name": "http://192.168.1.10/images/bootx64.efi",
        "option-data": [
          {
            "name": "bootfile-url",
            "space": "dhcp4",
            "code": 59,
            "data": "http://192.168.1.10/images/bootx64.efi"
          }
        ]
      }
    ]
  }
}
          </screen>
        </example>
      </step>
      <step>
        <para>
          Enable and start the Kea DHCP4 service.
        </para>
<screen>&prompt.sudo;<command>systemctl enable --now kea-dhcp4.service</command></screen>
      </step>
    </procedure>
  </section>
</topic>
