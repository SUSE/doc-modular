<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refer to README.md for file and id naming conventions -->
<topic xml:id="sles-pxe-server-http-nginx"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Configuring nginx for HTTP delivery</title>
    <meta name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
    <abstract>
      <para>
        This section explains how to configure nginx to serve PXE boot content over HTTP, allowing
        clients to load installer files like kernel, initrd and squashfs image from a central
        location.
      </para>
      <note>
        <title>Recommended delivery protocol</title>
        <para>
          Use the information on this topic if delivery over HTTP is preferred, which is
          recommended for &agama;-based installers in &productname; &productnumber;.
        </para>
        <para>
          For serving everything over HTTP, and supporting UEFI HTTPBoot and DHCPv6;, use
          Kea&mdash;the new DHCP server from ISC. For more information, refer to
          <link xlink:href="https://www.isc.org/kea/"></link>. You can also use ISC DHCP, but it has
          been declared <emphasis>end of life</emphasis> by ISC in 2022.
        </para>
        <para>
          However, if the PXE server serves only the kernel/initrd/squashfs over HTTP using nginx, and &grub;
          over TFTP, then you can also use dnsmasq. This distinction is necessary because dnsmasq
          doesn't support UEFI HTTPBoot natively, and therefore the client firmware cannot fetch
          the bootloader directly using HTTP.
        </para>
      </note>
    </abstract>
  </info>
  <section xml:id="sles-pxe-server-http-nginx-intro">
    <title>Introduction</title>
    <para>
      In PXE boot environments that rely on HTTP rather than TFTP, the installer files must be made
      available through a web server. This section covers how to configure nginx to expose those
      files under a predictable and consistent URL path.
    </para>
  </section>
  <section xml:id="sles-pxe-server-http-nginx-reqs">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          nginx must be installed and enabled.
        </para>
      </listitem>
      <listitem>
        <para>
          PXE boot files must be extracted under <filename>/srv/tftpboot</filename> or another
          known root.
        </para>
      </listitem>
      <listitem>
        <para>
          Administrative privileges are required to edit nginx configuration and reload the
          service.
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section xml:id="sles-pxe-server-http-nginx-exec">
    <title>Configuring nginx for PXE content</title>
    <para>
      Use the following procedure to configure nginx to serve PXE installer content.
    </para>
    <procedure>
      <step>
        <para>
          Create a new nginx configuration fragment under
          <filename>/etc/nginx/conf.d/pxe.conf</filename> with the following contents:
        </para>
        <example>
          <title>Sample nginx configuration snippet</title>
<screen>
server {
  listen 80;
  server_name _;

  location /images/ {
    root /srv/tftpboot;
    autoindex on;
  }
}
</screen>
        </example>
      </step>
      <step>
        <para>
          Test the nginx configuration for syntax errors.
        </para>
<screen>&prompt.sudo;<command>nginx -t</command></screen>
      </step>
      <step>
        <para>
          Reload nginx to apply the new configuration.
        </para>
<screen>&prompt.sudo;<command>systemctl reload nginx</command></screen>
      </step>
    </procedure>
  </section>
</topic>
