<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refer to README.md for file and id naming conventions -->
<topic xml:id="sles-pxe-server-ipv6-router"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Enabling IPv6 router advertisement for PXE clients</title>
    <meta name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
    <abstract>
      <para>
        This section describes how to enable basic IPv6 router advertisement and address assignment
        functionality for PXE and HTTP Boot clients for host IPv6 auto-configuration.
      </para>
      <note>
        <title>Required in IPv6-only or dual-stack (IPv4 and IPv6) networks</title>
        <para>
          Configure IPv6 router advertisement only if PXE clients are expected to receive IPv6
          addresses or operate in an IPv6-only or dual-stack environment. For purely IPv4
          deployments, this step is not necessary.
        </para>
      </note>
    </abstract>
  </info>
  <section xml:id="sles-pxe-server-ipv6-router-intro">
    <title>Introduction</title>
    <para>
      To support PXE booting in IPv6-enabled environments, the PXE server may optionally provide
      basic router advertisement functionality to inform clients of the network prefix. However, in
      production networks the router is usually a separate from the PXE server.
    </para>
  </section>
  <section xml:id="sles-pxe-server-ipv6-router-reqs">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          A statically assigned IPv6 address and prefix on the serverâ€™s primary interface.
        </para>
      </listitem>
      <listitem>
        <para>
          The <literal>radvd</literal> package must be installed.
        </para>
      </listitem>
      <listitem>
        <para>
          Administrative privileges are required to edit configuration files and start services.
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section xml:id="sles-pxe-server-ipv6-router-exec">
    <title>Enabling IPv6 router advertisement</title>
    <para>
      Use the following procedure to advertise the IPv6 prefix to clients on the local network.
    </para>
    <procedure>
      <step>
        <para>
          Edit the configuration file <filename>/etc/radvd.conf</filename> and insert the following
          content.
        </para>
        <example>
          <title>Sample radvd configuration for IPv6 PXE support</title>
<screen>
interface eth0
{
        IgnoreIfMissing on; <co xml:id="ignore-if-missing"></co>
        AdvSendAdvert on; <co xml:id="adv-send-advert"></co>

        AdvDefaultLifetime 1800; <co xml:id="adv-default-lifetime"></co>
        AdvManagedFlag on; <co xml:id="adv-managed-flag"></co>
        prefix 2001:db8:1::/64 <co xml:id="prefix-ipv6"></co>
        {
                AdvAutonomous  off; <co xml:id="adv-autonomous-off"></co>
                AdvValidLifetime        7200;
                AdvPreferredLifetime    3600;
        };
};
</screen>
          <calloutlist>
            <callout arearefs="ignore-if-missing">
              <para>
                Does not fail and exit when interface is missed.
              </para>
            </callout>
            <callout arearefs="adv-send-advert">
              <para>
                Sending RAs on this interface is enabled.
              </para>
            </callout>
            <callout arearefs="adv-default-lifetime">
              <para>
                Add default route for 1800 seconds.
              </para>
            </callout>
            <callout arearefs="adv-managed-flag">
              <para>
                Request IPv6 address, DNS, etc., using DHCPv6.
              </para>
            </callout>
            <callout arearefs="prefix-ipv6">
              <para>
                Add route to the network/prefix.
              </para>
            </callout>
            <callout arearefs="adv-autonomous-off">
              <para>
                Turn it on to assign IPv6 address using SLAAC.
              </para>
            </callout>
          </calloutlist>
        </example>
      </step>
      <step>
        <para>
          If you are using the PXE boot server as a router (not recommended for production
          networks), ensure that IP forwarding is enabled on the server.
        </para>
<screen>&prompt.sudo;<command>cat &gt;/etc/sysctl.d/90-network.conf &lt;&lt;-EOF</command></screen>
        <para>
          The expected output is as follows:
        </para>
<screen>
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1
EOF
</screen>
        <para>
          If the IP forwarding is not enabled, edit the <filename>90-network.conf</filename> and
          change the values of <literal>net.ipv4.conf.all.forwarding</literal> and
          <literal>net.ipv6.conf.all.forwarding</literal> from <literal>0</literal> to
          <literal>1</literal>.
        </para>
      </step>
      <step>
        <para>
          Load and apply the modified parameters from the network configuration file.
        </para>
<screen>&prompt.sudo;<command>sysctl -p /etc/sysctl.d/90-network.conf</command></screen>
      </step>
      <step>
        <para>
          Enable and start the router advertisement daemon.
        </para>
<screen>&prompt.sudo;<command>systemctl enable --now radvd</command></screen>
      </step>
    </procedure>
  </section>
</topic>
