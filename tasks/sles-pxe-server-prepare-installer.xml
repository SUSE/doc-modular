<?xml version="1.0" encoding="UTF-8"?>
<!-- This file originates from the project https://github.com/openSUSE/doc-kit -->
<!-- This file can be edited downstream. -->
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refer to README.md for file and id naming conventions -->
<topic xml:id="sles-pxe-server-prepare-installer"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Preparing the installer image content</title>
    <meta name="maintainer" content="souvik.sarkar@suse.com" its:translate="no"/>
    <abstract>
      <para>
        This section describes how to extract the kernel, initrd and live image files from a
        &productname; &productnumber; <literal>.install.iso</literal> image and place them under
        the PXE boot server file structure for use by &grub; and &agama;.
      </para>
    </abstract>
  </info>
  <section xml:id="sles-pxe-server-prepare-installer-intro">
    <title>Introduction</title>
    <para>
      PXE clients need access to three files to boot into the &agama; installer: the kernel image,
      the initrd, and the compressed root filesystem (squashfs). These files are located within the
      &productnameshort; <literal>.install.iso</literal> image and must be made available over HTTP
      or TFTP. This section guides you through extracting and organizing them into a bootable
      directory layout.
    </para>
  </section>
  <section xml:id="sles-pxe-server-prepare-installer-reqs">
    <title>Requirements</title>
    <itemizedlist>
      <listitem>
        <para>
          A &productname; &productnumber; installation image (<literal>.install.iso</literal>).
          Download the suitable ISO image files for your product from the &scc;. For example, the
          filename may maintain the format
          <filename>SLES-16.0-Full-x86_64-Beta4.install.iso</filename>.
        </para>
      </listitem>
      <listitem>
        <para>
          A temporary mount point, such as <filename>/mnt</filename>.
        </para>
      </listitem>
      <listitem>
        <para>
          Sufficient disk space under <filename>/srv/tftpboot</filename> or your chosen PXE root.
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section xml:id="sles-pxe-server-prepare-installer-exec">
    <title>Extracting the installer image files</title>
    <para>
      Perform the following steps to mount the ISO, extract necessary files, and organize them
      under your PXE boot directory.
    </para>
    <procedure>
      <step>
        <para>
          Mount the SLE .install.iso image under <filename>/mnt</filename>.
        </para>
<screen>&prompt.sudo;<command>mount -o loop <replaceable>PATH/TO/SLE-16.install.iso</replaceable> /mnt</command></screen>
      </step>
      <step>
        <para>
          Create a directory to hold the extracted installer files.
        </para>
<screen>&prompt.sudo;<command>mkdir -p /srv/tftpboot/images/SLES16.0/x86_64/liveiso</command></screen>
      </step>
      <step>
        <para>
          Copy the kernel and initrd from the ISO.
        </para>
<screen>&prompt.sudo;<command>cp /mnt/boot/x86_64/loader/linux /srv/tftpboot/images/SLES16.0/x86_64/liveiso/</command></screen>
<screen>&prompt.sudo;<command>cp /mnt/boot/x86_64/loader/initrd /srv/tftpboot/images/SLES16.0/x86_64/liveiso/</command></screen>
      </step>
      <step>
        <para>
          Copy the compressed root filesystem image.
        </para>
<screen>&prompt.sudo;<command>cp /mnt/LiveOS/squashfs.img /srv/tftpboot/images/SLES16.0/x86_64/liveiso/</command></screen>
      </step>
      <step>
        <para>
          Unmount the ISO when done.
        </para>
<screen>&prompt.sudo;<command>umount /mnt</command></screen>
      </step>
    </procedure>
  </section>
  <section xml:id="sles-pxe-server-prepare-installer-summary">
    <title>Verifying the result</title>
    <para>
      You should now have the following files in
      <filename>/srv/tftpboot/images/SLES16.0/x86_64/liveiso/</filename>:
    </para>
    <itemizedlist>
      <listitem>
        <para>
          <filename>linux</filename>
        </para>
      </listitem>
      <listitem>
        <para>
          <filename>initrd</filename>
        </para>
      </listitem>
      <listitem>
        <para>
          <filename>squashfs.img</filename>
        </para>
      </listitem>
    </itemizedlist>
    <para>
      These files will be referenced later in your &grub; configuration and served over HTTP to PXE
      clients.
    </para>
  </section>
</topic>
