<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="snapper-restore-files"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Using Snapper to restore files</title>
    <!-- can be changed via merge
      in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="daria.vladykina@suse.com" its:translate="no"/>
    <abstract>
      <!-- can be changed via merge in the assembly -->
      <para>
        Apart from the installation and administration snapshots, Snapper creates
        timeline snapshots. You can use these backup snapshots to restore files
        that have accidentally been deleted or to restore a previous version of a
        file. By using Snapper's diff feature you can also find out which
        modifications have been made at a certain point of time.
       </para>
    </abstract>
  </info>
    
    <para>
     Being able to restore files is especially interesting for data, which may
     reside on subvolumes or partitions for which snapshots are not taken by
     default. To be able to restore files from home directories, for example,
     create a separate Snapper configuration for <filename>/home</filename>
     doing automatic timeline snapshots. See
     <!--<xref linkend="sec-snapper-config"/> for instructions -->.
    </para>
    <warning>
     <title>Restoring files compared to rollback</title>
     <para>
      Snapshots taken from the root file system (defined by Snapper's root
      configuration), can be used to do a system rollback. The recommended way
      to do such a rollback is to boot from the snapshot and then perform the
      rollback. See <!--<xref linkend="sec-snapper-snapshot-boot"/> for details-->.
     </para>
     <para>
      Performing a rollback would also be possible by restoring all files from a
      root file system snapshot as described below. However, this is not
      recommended. You may restore single files, for example a configuration
      file from the <systemitem>/etc</systemitem> directory, but not the
      complete list of files from the snapshot.
     </para>
     <para>
      This restriction only affects snapshots taken from the root file system.
     </para>
    </warning>
    <procedure xml:id="proc-snapper-restore-yast">
     <title>Restoring files using the &yast; <guimenu>Snapper</guimenu> module</title>
     <step>
      <para>
       Start the <guimenu>Snapper</guimenu> module from the
       <guimenu>Miscellaneous</guimenu> section in &yast; or by entering
       <command>yast2 snapper</command>.
      </para>
     </step>
     <step>
      <para>
       Choose the <guimenu>Current Configuration</guimenu> from which to choose
       a snapshot.
      </para>
     </step>
     <step>
      <para>
       Select a timeline snapshot from which to restore a file and choose
       <guimenu>Show Changes</guimenu>. Timeline snapshots are of the type
       <guimenu>Single</guimenu> with a description value of
       <guimenu>timeline</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Select a file from the text box by clicking the file name. The difference
       between the snapshot version and the current system is shown. Activate
       the check box to select the file for restore. Do so for all files you
       want to restore.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Restore Selected</guimenu> and confirm the action by
       clicking <guimenu>Yes</guimenu>.
      </para>
     </step>
    </procedure>
    <procedure xml:id="proc-snapper-restore-cmdl">
     <title>Restoring files using the <command>snapper</command> command</title>
     <step>
      <para>
       Get a list of timeline snapshots for a specific configuration by running
       the following command:
      </para>
 <screen>&prompt.sudo;snapper -c <replaceable>CONFIG</replaceable> list -t single | grep timeline</screen>
      <para>
       <replaceable>CONFIG</replaceable> needs to be replaced by an existing
       Snapper configuration. Use <command>snapper list-configs</command> to
       display a list.
      </para>
     </step>
     <step>
      <para>
       Get a list of changed files for a given snapshot by running the following
       command:
      </para>
 <screen>&prompt.sudo;snapper -c <replaceable>CONFIG</replaceable> status <replaceable>SNAPSHOT_ID</replaceable>..0</screen>
      <para>
       Replace <replaceable>SNAPSHOT_ID</replaceable> by the ID for the snapshot
       from which you want to restore the files.
      </para>
     </step>
     <step>
      <para>
       Optionally list the differences between the current file version and the
       one from the snapshot by running
      </para>
 <screen>&prompt.sudo;snapper -c <replaceable>CONFIG</replaceable> diff <replaceable>SNAPSHOT_ID</replaceable>..0 <replaceable>FILE NAME</replaceable></screen>
      <para>
       If you do not specify <replaceable>&lt;FILE NAME&gt;</replaceable>, the
       difference for all files are shown.
      </para>
     </step>
     <step>
      <para>
       To restore one or more files, run
      </para>
 <screen>&prompt.sudo;snapper -c <replaceable>CONFIG</replaceable> -v undochange <replaceable>SNAPSHOT_ID</replaceable>..0 <replaceable>FILENAME1</replaceable> <replaceable>FILENAME2</replaceable></screen>
      <para>
       If you do not specify file names, all changed files will be restored.
      </para>
     </step>
    </procedure>
  
  <warning>
    <title>Data consistency</title>
    <para>
     There is no mechanism to ensure data consistency when creating a snapshot.
     Whenever a file (for example, a database) is written at the same time as the
     snapshot is being created, it will result in a corrupted or partly written
     file. Restoring such a file will cause problems. Furthermore, certain system
     files such as <filename>/etc/mtab</filename> must never be restored.
     Therefore it is strongly recommended to <emphasis>always</emphasis> closely
     review the list of changed files and their diffs. Only restore files that
     really belong to the action you want to revert.
    </para>
   </warning>
 
</topic>
