<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: https://github.com/SUSE/doc-sle/blob/main/xml/adm_sudo.xml -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="sudo-manage-wheel-group"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <title>
    Managing the <systemitem class="groupname">wheel</systemitem> user
   group for &sudo; privileges
  </title>
  <info>
    <meta name="maintainer" content="Julia Faltenbacher" its:translate="no"/>
    <abstract>
    <para>
    Members of the user group <systemitem class="groupname">wheel</systemitem>
    have access to the root account and can receive unlimited privileges.
    Learn how to add your user to the
    <systemitem class="groupname">wheel</systemitem> group.
    </para>
    </abstract>
  </info>
  <section xml:id="task-sudo-add-user-to-wheel">
    <title>
    Adding a user to the <systemitem class="groupname">wheel</systemitem> group
    </title>
    <para>
    The user group <systemitem class="groupname">wheel</systemitem> is available
    on all Linux systems by default. The group is managed in the
    <filename>sudoers</filename> and the members of this group can run all
    commands with &sudo;.
    </para>
    <procedure>
    <step>
    <para>
    Verify that the <systemitem class="groupname">wheel</systemitem> group
    exists:
    </para>
<screen>&prompt.user;<command>getent group wheel</command></screen>
    <para>
    This will return, for example:
    </para>
<screen>wheel:x:476:</screen>
    <para>
    If the previous command returned no result, install the
    <package>system-group-wheel</package> package that creates the
    <systemitem class="groupname">wheel</systemitem> group:
    </para>
<screen>&prompt.sudo;<command>zypper install system-group-wheel</command>
</screen>
    </step>
    <step>
    <para>
    To add your user account tho the
    <systemitem class="groupname">wheel</systemitem> group, run the following
    command:
    </para>
<screen>sudo usermod -a -G wheel <replaceable>USERNAME</replaceable></screen>
    <para>
    Enter the root password.
    </para>
    </step>
    <step>
    <para>
    Log out and log in again to enable the change. Verify that the change was
    successful by running the following command: 
    </para>
<screen>groups <replaceable>USERNAME</replaceable></screen>
    <para>
    This will return, for example:
    </para>
<screen><replaceable>USERNAME</replaceable> : users wheel</screen>
    </step>
    <step>
    <para>
    Create a new &sudo; configuration file with:
    </para>
<screen>sudo visudo -f /etc/sudoers.d/NAME</screen>
    </step>
    <step>
    <para>
    To configure &sudo; to ask for the root password instead of the user
    password, add the following line to the new file:
    </para>
<screen>Defaults !targetpw</screen>
    </step>
    <step>
    <para>
    Depending on whether you want users to re-enter their passwords, uncomment
    the appropriate line in <filename>/etc/sudoers</filename> and comment out
    the default rule.
    </para>
<screen>
## Uncomment to allow members of group wheel to execute any command
# %wheel ALL=(ALL) ALL

## Same thing without a password
# %wheel ALL=(ALL) NOPASSWD: ALL
</screen>
    </step>
    <step>
    <para>
    To make the default rule more restrictive, comment out or remove the allow-
    everything rule in <filename>/etc/sudoers</filename>:
    </para>
<screen>ALL     ALL=(ALL) ALL   # WARNING! Only use this together with 'Defaults targetpw'!</screen>
    <warning>
            <title>Dangerous rule in <filename>sudoers</filename></title>
            <para>
              Do not skip this step. Otherwise <emphasis>any</emphasis> user
              can execute <emphasis>any</emphasis> command as &rootuser;!
            </para>
          </warning>
    </step>
    <step>
    <para>
    To test the configuration, run &sudo; as member and non-member of
    <systemitem class="groupname">wheel</systemitem>.
    </para>
<screen>
<prompt>&exampleuser_plain;:~ &gt; </prompt>groups
users wheel
<prompt>&exampleuser_plain;:~ &gt; </prompt>sudo id -un
&exampleuser_plain;'s password:
root
<prompt>&exampleuserII_plain;:~ &gt; </prompt>groups
users
<prompt>&exampleuserII_plain;:~ &gt; </prompt>sudo id -un
&exampleuserII_plain; is not in the sudoers file.  This incident will be reported.
</screen>
    </step>
    <result>
    <para>
    You have added your user account to the
    <systemitem class="groupname">wheel</systemitem> user group.
    </para>
    </result>
    </procedure>
  </section>
</topic>
