<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: https://github.com/SUSE/doc-sle/blob/main/xml/adm_sudo.xml -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="sudo-without-root-password"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <meta name="maintainer" content="julia.faltenbacher@suse.com"
    its:translate="no"/>
    <title>Using &sudo; without &rootuser; password</title>
    <abstract>
      <para>
        Using a shared &rootuser; password for running commands with &sudo; by
        several users can create potential security problems. As a best
        practice, system administrators can provide &sudo; privileges to users
        without requiring them to use the &rootuser; password.
      </para>
    </abstract>
  </info>
  <para>
    To allow permitted users to use their own password instead of the
    &rootuser; password for &sudo; privileges, system administrators can add
    users to the <systemitem class="groupname">wheel</systemitem> group and
    modify the <filename>sudoers</filename> configuration.
  </para>
  <procedure>
    <title>Giving &sudo; privileges to a user without the &rootuser; password</title>
    <step>
     <para>
      As a system administrator, add the user to the <systemitem class="groupname">wheel</systemitem> group:
     </para>
     <screen>&prompt.sudo; usermod -aG wheel <replaceable>USERNAME</replaceable></screen>
     <para>
      You can also check status the user's membership of the <systemitem
      class="groupname">wheel</systemitem> group by running the following command:
     </para>
     <screen>&prompt.user; cut -d: -f1,4 /etc/group | grep wheel</screen>
     <screen>wheel:<replaceable>USERNAME</replaceable></screen>
    </step>
    <step>
      <para>
        Edit the file containing custom <filename>sudoers</filename>
        configuration by using the following command:
      </para>
<screen>&prompt.sudo;<command>visudo -f /etc/sudoers.d/<replaceable>FILENAME</replaceable></command></screen>
      <para>
        To create a custom <filename>sudoers</filename> configuration file, use
        the same command. You can use the content of the
        <filename>/etc/sudoers</filename> default file as the template.
        However, to prevent &sudo; from falling into a loop of
        <command>#includedir</command> directives, remove the following lines
        from the bottom of the file:
      </para>
<screen>
## Read drop-in files from /etc/sudoers.d
@includedir /etc/sudoers.d
</screen>
    </step>
    <step>
     <para>
      To disable the default target password for &sudo;, which is the &rootuser; password, comment out the following lines in
      the custom <filename>sudoers</filename> configuration file:
     </para>
<screen>
Defaults targetpw   # ask for the password of the target user i.e. root
ALL   ALL=(ALL) ALL   # WARNING! Only use this together with 'Defaults targetpw'!
</screen>
     <result>
      <para>After commenting, the lines should appear as follows:</para>
 <screen>
 # Defaults targetpw   # ask for the password of the target user i.e. root
 # ALL   ALL=(ALL) ALL   # WARNING! Only use this together with 'Defaults targetpw'!
 </screen>
     </result>
    </step>
    <step>
     <para>To enable all members of the <systemitem class="groupname">wheel</systemitem> group to
     run all commands, uncomment the following lines in the custom <filename>sudoers</filename> configuration
     file:</para>
<screen>
# %wheel ALL=(ALL:ALL) ALL
</screen>
     <para>
      As a best practice, you can also add rules to prevent the users in the <systemitem
      class="groupname">wheel</systemitem> group from modifying the &rootuser; password.
     </para>
     <result>
      <para>
       After the modifications, the lines should appear as follows:
      </para>
<screen>%wheel ALL=(ALL:ALL) ALL, !/usr/bin/passwd root</screen>
     </result>
    </step>
    <step>
     <para>
      Save the changes, but do not exit the editor. Before exiting the editor, start another
      terminal session and verify that you and the target user can use elevated privileges.
     </para>
     <result><para>After the verification is successful, exit the editor.</para></result>
    </step>
  </procedure>
</topic>
