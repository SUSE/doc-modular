<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<topic xml:id="systemd-example-secure-service"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>How to secure a &systemd; service</title>
    <meta name="maintainer" content="amrita.sakthivel@suse.com" its:translate="no"/>
    <abstract>
      <para>
       Use &systemd; to secure and strengthen services using specific directives and verify the same.
       &systemd; provides a command-line tool called <command>systemd-analyze</command>. Use the <literal>security</literal>
       option to analyze the security and the sandboxing settings of one or more specified services.
       </para>
       <para>The <command>systemd-analyze security</command> command checks security related service settings
      and assigns a numeric exposure level value. This is dependent on the importance of the setting.
    It then calculates an overall exposure levels for the whole unit , which ranges from 0.0-10.0. This number tells us the level of exposure for a service.</para>
    </abstract>

</info>
  <procedure>
       <step><para>Create a &systemd; service in the <filename>/etc/systemd/system</filename>. </para>
           </step>
           <step><para>Reload the service files to include the new service:</para>
            <screen>&prompt.sudo; systemctl daemon-reload</screen>
           </step>
           <step><para>Start,enable, and check the status of the service:</para>
            <screen>&prompt.sudo; systemctl start <replaceable>SERVICE_NAME</replaceable></screen>
            <para>For example:</para>
            <screen>&prompt.sudo; systemctl start test.service</screen>
            <screen>&prompt.sudo;systemctl enable <replaceable>SERVICE_NAME</replaceable></screen>
            <para>For example:</para>
            <screen>&prompt.sudo; systemctl enable test.service</screen>
            <screen>systemctl status <replaceable>SERVICE_NAME</replaceable></screen>
            <para>For example:</para>
            <screen>&prompt.sudo; systemctl status test.service</screen>
              </step>
              <step><para>Analyze the security settings of the service:</para>
                <screen>&prompt.sudo; systemd-analyze security <replaceable>SERVICE_NAME</replaceable></screen>
                <para>For example:</para>
            <screen>&prompt.sudo; systemd-analyze security test.service
              NAME                DESCRIPTION                              EXPOSURE
              ✗ PrivateNetwork=     Service has access to the host's network      0.5
              ✗ User=/DynamicUser=  Service runs as root user                     0.4
              ✗ DeviceAllow=        Service has no device ACL                     0.2
              ✓ IPAddressDeny=      Service blocks all IP address ranges
              ...
              → Overall exposure level for test.service: 9.6 UNSAFE
            </screen>

               </step>

    </procedure>
</topic>
