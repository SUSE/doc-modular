<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
[
  <!ENTITY % entities SYSTEM "../common/generic-entities.ent">
    %entities;
]>
<!-- refers to legacy doc: <add github link to legacy doc piece, if applicable> -->
<!-- point back to this document with a similar comment added to your legacy doc piece -->
<!-- refer to README.md for file and id naming conventions -->
<!-- metadata is dealt with on the assembly level -->
<topic xml:id="transactional-update-notification"
 role="task" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.2"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xmlns:trans="http://docbook.org/ns/transclusion">
  <info>
    <title>Setting up e-mail notifications if automatic &tr-up; fails</title><!-- can be changed via merge
in the assembly -->
    <!-- add author's e-mail -->
    <meta name="maintainer" content="jsindelarova@suse.com" its:translate="no"/>
    <abstract><!-- can be changed via merge in the assembly -->
      <para>
       The topic covers setting up a &systemd; mail notification service.
      </para>
    </abstract>
  </info>
  <para>
       In cases when an automatic &tr-up; fails, the failed snapshot is deleted and the system may reboot. You then cannot find out that the last automatic update failed. Therefore, you can configure a &systemd; service that will inform you that the automatic &tr-up; failed. To do so, follow the procedure bellow:
      </para>
      <procedure>
        <step>
          <para>
            If not present on your system, install the <literal>mailx</literal> package.
          </para>
        </step>
        <step>
          <para>
            Install the <literal>systemd-status-mail</literal> package:
          </para>
          <screen os="slemicro">&prompt.root;transactional-update pkg in systemd-status-mail<command></command>
          </screen>
        </step>
        <step>
          <para>
            Create a file <filename>/etc/default/systemd-status-mail</filename> with you settings. For details, refer to
          </para>
        </step>
        <step>
          <para>
            Define which event should trigger sending of the status mail:
          </para>
          <substeps>
            <substep>
              <para>
                Create a file <filename>/etc/systemd/system/os-update.service.d//etc/systemd/system/os-update.service.d/</filename>
              </para>
            </substep>
            <substep>
              <para>
                Add the following configuration to the file:
              </para>
              <screen>[Unit]
OnFailure=systemd-status-mail@%n.service</screen>
            </substep>
          </substeps>
        </step>
      </procedure>
</topic>
